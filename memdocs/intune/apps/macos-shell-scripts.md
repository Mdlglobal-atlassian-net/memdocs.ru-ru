---
title: Использование скриптов оболочки на устройствах macOS в Microsoft Intune | Документация Майкрософт
description: Создавайте, назначайте, отслеживайте и исправляйте скрипты оболочки для устройств macOS в Microsoft Intune.
keywords: ''
author: Erikre
ms.author: erikre
manager: dougeby
ms.date: 03/26/2020
ms.topic: conceptual
ms.service: microsoft-intune
ms.subservice: apps
ms.localizationpriority: high
ms.technology: ''
ms.assetid: ''
ms.reviewer: ''
ms.suite: ems
search.appverid: MET150
ms.custom: intune-azure
ms.collection: M365-identity-device-management
ms.openlocfilehash: 36936976528b5ea9c3fff1f77ec11223a4e4e63d
ms.sourcegitcommit: e7fb8cf2ffce29548b4a33b2a0c33a3a227c6bc4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/30/2020
ms.locfileid: "80401788"
---
# <a name="use-shell-scripts-on-macos-devices-in-intune-public-preview"></a>Использование скриптов оболочки для устройств macOS в Intune (общедоступная предварительная версия)

> [!NOTE]
> Скрипты оболочки для устройств macOS в настоящее время находятся на этапе предварительной версии. Просмотрите список [известных проблем в предварительной версии](macos-shell-scripts.md#known-issues) перед использованием этой функции.

Используйте скрипты оболочки, чтобы получить больше возможностей управления устройствами в Intune, чем предоставляет операционная система macOS. 

## <a name="prerequisites"></a>Предварительные условия
При создании скриптов оболочки и назначении их для устройств macOS убедитесь, что выполнены следующие необходимые условия. 
 - Устройства работают под управлением macOS 10.12 или более поздней версии.
 - Устройства управляются Intune. 
 - Скрипты оболочки начинаются с `#!` и должны находиться в допустимом расположении, например `#!/bin/sh` или `#!/usr/bin/env zsh`.
 - Установлены интерпретаторы командной строки для соответствующих оболочек.

## <a name="important-considerations-before-using-shell-scripts"></a>Важные моменты, которые следует учитывать перед использованием скриптов оболочки
 - Для скриптов оболочки требуется агент Microsoft Intune MDM на устройстве macOS. Дополнительные сведения см. в статье [Агент Microsoft Intune MDM для macOS](macos-shell-scripts.md#microsoft-intune-mdm-agent-for-macos).
 - Скрипты оболочки выполняются на устройствах параллельно как отдельные процессы.
 - Скрипты оболочки, которые выполняются от имени вошедшего в систему пользователя, будут запускаться для всех учетных записей пользователей, выполнивших вход на устройство во время выполнения.
 - Конечный пользователь должен войти на устройство для выполнения скриптов от имени вошедшего пользователя.
 - Права привилегированного пользователя необходимы в тех случаях, когда скрипт требует внесения изменений, на которые нет разрешений у обычной учетной записи пользователя.
 - В некоторых условиях скрипты оболочки будут пытаться выполняться чаще, чем выбранная периодичность, например если диск заполнен, место хранения изменено, локальный кэш удален или устройство Mac перезапускается.
 
## <a name="create-and-assign-a-shell-script-policy"></a>Создание и назначение политики скрипта оболочки
1. Войдите в [Центр администрирования Microsoft Endpoint Manager](https://go.microsoft.com/fwlink/?linkid=2109431).
2. Выберите **Устройства** > **macOS** > **Скрипты** > **Добавить**.
3. В разделе **Основные** укажите следующие свойства и нажмите **Далее**.
   - **Имя** — Введите имя скрипта оболочки.
   - **Описание**. Введите описание скрипта оболочки. Этот параметр является необязательным, но мы рекомендуем его использовать.
4. В разделе **Параметры скрипта** укажите следующие свойства и нажмите **Далее**.
   - **Отправить сценарий**. Укажите расположение скрипта оболочки. Размер файла скрипта не должен превышать 200 КБ.
   - **Запуск скрипта от имени вошедшего пользователя**. Выберите **Да**, чтобы запускать скрипт с помощью учетных данных пользователя на устройстве. Выберите **Нет** (по умолчанию) для запуска скрипта от имени привилегированного пользователя. 
5. В разделе **Теги области** дополнительно добавьте теги области для скрипта и нажмите **Далее**. Используя теги области в Intune, вы можете определить, кто может просматривать скрипты. Полные сведения о тегах области см. в статье [Use role-based access control (RBAC) and scope tags for distributed IT](../fundamentals/scope-tags.md) (Использование управления доступом на основе ролей (RBAC) и тегов области для распределенной ИТ-разработки).
6. Выберите пункты **Назначения** > **Выберите группы для включения**. Отобразится существующий список групп Azure AD. Выберите одну или несколько групп устройств, куда входят пользователи, чьи устройства macOS получат скрипт. Щелкните **Выбрать**. Выбранные группы отображаются в списке и получат вашу политику скрипта.
   > [!NOTE]
   > - Скрипты оболочки в Intune могут назначаться только группам безопасности устройств AAD. Назначение группы пользователей не поддерживается в предварительной версии. 
   > - При обновлении назначений для скриптов оболочки также обновляются назначения для [агента Microsoft Intune MDM для macOS](macos-shell-scripts.md#microsoft-intune-mdm-agent-for-macos).
7. В окне **Проверка и добавление** отображается сводка по настроенным параметрам. Выберите **Добавить**, чтобы сохранить сценарий. При нажатии кнопки **Добавить** политика скрипта развертывается в выбранных группах.

Созданный вами скрипт отображается в списке скриптов. 

## <a name="monitor-a-shell-script-policy"></a>Мониторинг политики скрипта оболочки
Вы можете отслеживать состояние выполнения всех назначенных скриптов для пользователей и устройств в одном из следующих отчетов:
- **Скрипты** > **выберите скрипт для отслеживания** > **Состояние устройства**
- **Скрипты** > **выберите скрипт для отслеживания** > **Состояние пользователя**

>[!IMPORTANT]
> Независимо от выбранной **частоты скрипта** состояние выполнения скрипта выводится только при первом запуске. Состояние выполнения скрипта не обновляется при последующих запусках. Однако обновленные скрипты считаются новыми, и их состояние выполнения указывается.

После выполнения скрипт возвращает одно из следующих состояний:
- Состояние выполнения скрипта **Сбой** указывает, что скрипт вернул ненулевой код выхода или имеет неправильный формат. 
- Состояние выполнения скрипта **Успешно** указывает, что скрипт вернул ноль в качестве кода выхода. 

## <a name="frequently-asked-questions"></a>Часто задаваемые вопросы
### <a name="why-are-assigned-shell-scripts-not-running-on-the-device"></a>Почему назначенные скрипты оболочки не выполняются на устройстве?
Существует несколько возможных причин:
* Для получения новых или обновленных скриптов агенту может потребоваться синхронизация. Синхронизация выполняется каждые 8 часов и отличается от синхронизации MDM. Убедитесь, что устройство активно и подключено к сети для успешной синхронизации агента, и дождитесь синхронизации агента.
* Возможно, агент не установлен. Убедитесь, что агент установлен в `/Library/Intune/Microsoft Intune Agent.app` на устройстве macOS.
* Возможно, агент находится в неработоспособном состоянии. Агент попытается выполнить восстановление в течение 24 часов, удалится и переустановится, если скрипты оболочки все еще назначены.

### <a name="how-frequently-is-script-run-status-reported"></a>Как часто выводится состояние выполнения скрипта?
Состояние выполнения скрипта выводится на консоли администрирования Microsoft Endpoint Manager сразу после завершения выполнения скрипта. Если запланировано периодическое выполнение скрипта с заданной частотой, состояние выводится только при первом запуске.

### <a name="when-are-shell-scripts-run-again"></a>Когда скрипты оболочки запускаются повторно?
Скрипт запускается снова только в том случае, если настроен параметр **Максимальное число повторных попыток при сбое скрипта**, и при запуске скрипта происходит сбой. Если **Максимальное число повторных попыток при сбое скрипта** не настроено и при выполнении скрипта происходит сбой, он не будет запущен повторно, а состояние выполнения будет указано как **Сбой**. 

### <a name="what-intune-role-permissions-are-required-for-shell-scripts"></a>Какие разрешения роли Intune требуются для скриптов оболочки?
Назначенная роль Intune требует разрешения **конфигураций устройств** для удаления, назначения, создания, обновления или чтения скриптов оболочки.

## <a name="microsoft-intune-mdm-agent-for-macos"></a>Агент Microsoft Intune MDM для macOS
 ### <a name="why-is-the-agent-required"></a>Зачем нужен агент?
 Агент Microsoft Intune MDM необходимо установить на управляемых устройствах macOS, чтобы обеспечить расширенные возможности управления устройствами, которые не поддерживаются в собственной операционной системе macOS.
 
 ### <a name="how-is-the-agent-installed"></a>Как устанавливается агент?
 Агент устанавливается автоматически на устройства macOS, управляемые Intune, которым в Центре администрирования Microsoft Endpoint Manager назначен по крайней мере один скрипт оболочки. Агент устанавливается в `/Library/Intune/Microsoft Intune Agent.app`, когда это применимо, и не отображается в разделе **Finder** > **Приложения** на устройствах macOS. Агент отображается как `IntuneMdmAgent` в **мониторе активности** при запуске на устройствах macOS.

### <a name="what-does-the-agent-do"></a>Что делает агент?
 - Агент автоматически проходит проверку подлинности в службах Intune перед синхронизацией, чтобы получить назначенные скрипты оболочки для устройства macOS.
 - Агент получает назначенные скрипты оболочки и запускает их на основе настроенного расписания, повторных попыток, параметров уведомлений и других параметров, заданных администратором.
 - Агент проверяет наличие новых или обновленных скриптов с помощью служб Intune, обычно каждые 8 часов. Этот процесс синхронизации не зависит от синхронизации MDM. 

 >[!NOTE]
 > Действие **Проверить параметры** на Корпоративном портале относится только к синхронизации MDM. Невозможно выполнить синхронизацию агента вручную.

 ### <a name="when-is-the-agent-removed"></a>Когда агент удаляется?
 Существует несколько условий, которые могут привести к удалению агента с устройства, например:
 - Скрипты оболочки больше не назначены устройству. 
 - Устройство macOS больше не управляется.
 - Агент находится в неисправимом состоянии более 24 часов (время ожидания устройства).

 ### <a name="how-to-turn-off-usage-data-sent-to-microsoft-for-shell-scripts"></a>Как отключить данные об использовании, отправляемые в корпорацию Майкрософт о скриптах оболочки?
 Чтобы отключить данные об использовании, отправляемые в корпорацию Майкрософт из агента Intune MDM, откройте Корпоративный портал и выберите **Меню** > **Параметры** > *снимите флажок "Разрешить Майкрософт получать данные об использовании"* . Таким образом вы отключите отправку данных об использовании как для агента Intune MDM, так и для Корпоративного портала.

## <a name="known-issues"></a>Известные проблемы
- **Назначение групп пользователей**. Скрипты оболочки, назначенные группам пользователей, не применяются к устройствам. Назначение группы пользователей в настоящее время не поддерживается в предварительной версии. Используйте назначение группы устройств для назначения скриптов.
- **Получить журналы**. Действие "Получить журналы" является видимым. Но при попытке получить журналы отображается сообщение "Произошла ошибка", а журналы не записываются. Получение журналов в настоящее время не поддерживается в предварительной версии.
- **Нет состояния выполнения скрипта**. В редких случаях, когда скрипт получен устройством, но устройство выходит из сети до получения сообщения о состоянии выполнения, устройство не будет сообщать о состоянии выполнения скрипта в консоли администрирования.
- **Отчет о состоянии пользователя**. Существует проблема с пустым отчетом. В [Центре администрирования Microsoft Endpoint Manager](https://go.microsoft.com/fwlink/?linkid=2109431) выберите **Монитор**. В поле состояния пользователя отображается пустой отчет.

## <a name="next-steps"></a>Дальнейшие шаги

- [Создание политики соответствия требованиям в Microsoft Intune](..\protect\create-compliance-policy.md)
