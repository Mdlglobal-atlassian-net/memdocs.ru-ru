---
title: Шаги последовательности задач
titleSuffix: Configuration Manager
description: Сведения о шагах, которые можно добавить в последовательность задач Configuration Manager.
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 7c888a6f-8e37-4be5-8edb-832b218f266d
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 385a7222b33275951de294554a870d8e490a5ddc
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81702022"
---
# <a name="task-sequence-steps"></a>Шаги последовательности задач

*Область применения: Configuration Manager (Current Branch)*

Следующие шаги последовательности задач, которые можно добавить в последовательность задач Configuration Manager. Дополнительные сведения см. в разделе [Использование редактора последовательности задач](task-sequence-editor.md).  

## <a name="common-settings"></a>Общие параметры

Следующие параметры являются общими для всех шагов последовательности задач:

### <a name="properties-for-all-steps"></a>Свойства для всех шагов

- **Имя** — Редактор последовательности задач требует указать короткое имя, описывающее этот шаг. При добавлении нового шага редактор по умолчанию задает имя "Тип". Длина значения параметра **Имя** не может превышать 50 символов.  

- **Описание**. При необходимости позволяет указать более подробные сведения об этом шаге. Длина значения параметра **Описание** не может превышать 256 символов.  

Оставшаяся часть этой статьи посвящена другим параметрам на вкладке **Свойства** для каждого шага последовательности задач.

### <a name="options-for-all-steps"></a>Параметры для всех шагов

- **Запретить этот этап**. Последовательность задач пропускает этот шаг при выполнении на компьютере. Значок для этого шага выделен серым цветом в редакторе последовательности задач.  

- **Продолжать при ошибке**. Выполнение последовательности задач продолжается при возникновении ошибки в шаге. Дополнительные сведения см. в статье [Вопросы планирования для автоматизации задач](../plan-design/planning-considerations-for-automating-tasks.md#BKMK_TSGroups).  

- **Добавить условие**. Последовательность задач вычисляет эти условные операторы, чтобы определить, выполняется ли шаг. Пример использования переменной последовательности задач в качестве условия см. в [этой статье](using-task-sequence-variables.md#bkmk_access-condition). См. дополнительные сведения об [условиях](task-sequence-editor.md#bkmk_conditions) в руководстве по использованию редактора последовательности задач.

В приведенных ниже разделах для конкретных последовательностей задач описаны другие возможные параметры на вкладке **Параметры**.



## <a name="apply-data-image"></a><a name="BKMK_ApplyDataImage"></a> Применить образ данных

Используйте этот шаг, чтобы скопировать образ данных в указанный конечный раздел.  

Этот шаг выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Применить образ данных**.

### <a name="variables-for-apply-data-image"></a>Переменные для применения образа данных

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDDataImageIndex](task-sequence-variables.md#OSDDataImageIndex)  
- [OSDWipeDestinationPartition](task-sequence-variables.md#OSDWipeDestinationPartition)  

### <a name="cmdlets-for-apply-data-image"></a>Командлеты для применения образа данных

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepApplyDataImage](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyDataImage?view=sccm-ps)
- [New-CMTSStepApplyDataImage](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepApplyDataImage?view=sccm-ps)
- [Remove-CMTSStepApplyDataImage](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepApplyDataImage?view=sccm-ps)
- [Set-CMTSStepApplyDataImage](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepApplyDataImage?view=sccm-ps)

### <a name="properties-for-apply-data-image"></a>Свойства для применения образа данных

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="image-package"></a>Пакет образа

Нажмите кнопку **Обзор**, чтобы указать **пакет образа**, используемый этой последовательностью задач. В диалоговом окне **Выбор пакета** выберите пакет для установки. В нижней части диалогового окна отображаются сведения о свойствах для существующих пакетов образов. Выбрав **пакет образа** , в раскрывающемся списке выберите **образ**, который требуется установить.  

> [!NOTE]  
> Это действие последовательности задач обрабатывает образ как файл данных. Это действие не выполняет никакой настройки для загрузки образа в виде операционной системы.  

#### <a name="destination"></a>Destination

Настройте один из следующих параметров:

- **Next available partition** (Следующий доступный раздел). Используйте следующий по порядку раздел, который еще не являлся целевым для шага **Применить операционную систему** или **Применить образ данных** в этой последовательности задач.  

- **Конкретный диск и раздел**. Выберите номер в полях **Диск** (начиная с 0) и **Раздел** (начиная с 1).  

- **Конкретный логический диск**. Укажите **букву диска**, которую Windows PE назначит этому разделу. Эта буква диска может отличаться от буквы диска, назначенной развернутой операционной системой.  

- **Имя логического диска хранится в виде переменной**. Укажите переменную последовательности задач, которая содержит букву диска, назначаемую разделу средой предустановки Windows. Эта переменная, как правило, задается в разделе "Дополнительно" диалогового окна **Свойства раздела** для шага последовательности задач **Отформатировать диск и создать разделы**.  

#### <a name="delete-all-content-on-the-partition-before-applying-the-image"></a>Удалить все содержимое раздела перед применением образа  

Указывает, что последовательность задач удаляет все файлы в целевом разделе перед установкой образа. Если не требуется удалять содержимое раздела, этот шаг можно использовать для применения дополнительного содержимого к разделу, который ранее был выбран в качестве целевого.  



## <a name="apply-driver-package"></a><a name="BKMK_ApplyDriverPackage"></a> Применить пакет драйверов  

Используйте этот шаг последовательности задач для скачивания всех драйверов в пакете драйверов и их установки в операционной системе Windows.

Шаг последовательности задач **Применить пакет драйверов** предоставляет операционной системе Windows доступ ко всем драйверам устройств в пакете драйверов. Этот шаг можно добавить между шагами **Применить операционную систему** и **Настройка Windows и Configuration Manager**, чтобы предоставить операционной системе Windows доступ к драйверам в пакете. Шаг последовательности задач **Применить пакет драйверов** также можно использовать в сценариях развертывания с помощью автономного носителя.  

Соберите сходные драйверы устройств в пакет драйверов и передайте их на соответствующие точки распространения. Например, можно поместить все драйверы устройств одного производителя в пакет драйверов, а затем передать его на точки распространения, где связанные компьютеры смогут получить к ним доступ.

Шаг **Применить пакет драйверов** удобно использовать для автономного носителя. Этот шаг также позволяет установить определенный набор драйверов. Сюда могут входить драйвера для устройств, не обнаруживаемых при сканировании в ОС Windows, например сетевых принтеров.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Драйверы** и **Применить пакет драйверов**.

> [!TIP]
> Общие сведения о драйверах в Configuration Manager см. в разделе [Использование последовательностей задач для установки драйверов](../get-started/manage-drivers.md#BKMK_TSDrivers).
>
> Используйте предварительное кэширование содержимого, чтобы скачать применимый пакет драйверов, прежде чем пользователь установит последовательность задач. Дополнительные сведения см. в разделе [Настройка предварительного кэширования содержимого](../deploy-use/configure-precache-content.md).

### <a name="variables-for-apply-driver-package"></a>Переменные для применения пакета драйверов

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDApplyDriverBootCriticalContentUniqueID](task-sequence-variables.md#OSDApplyDriverBootCriticalContentUniqueID)  
- [OSDApplyDriverBootCriticalHardwareComponent](task-sequence-variables.md#OSDApplyDriverBootCriticalHardwareComponent)  
- [OSDApplyDriverBootCriticalID](task-sequence-variables.md#OSDApplyDriverBootCriticalID)  
- [OSDApplyDriverBootCriticalINFFile](task-sequence-variables.md#OSDApplyDriverBootCriticalINFFile)  
- [OSDInstallDriversAdditionalOptions](task-sequence-variables.md#OSDInstallDriversAdditionalOptions)<!--516679/2840016-->

### <a name="cmdlets-for-apply-driver-package"></a>Командлеты для применения пакета драйверов

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepApplyDriverPackage](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyDriverPackage?view=sccm-ps)
- [New-CMTSStepApplyDriverPackage](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepApplyDriverPackage?view=sccm-ps)
- [Remove-CMTSStepApplyDriverPackage](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepApplyDriverPackage?view=sccm-ps)
- [Set-CMTSStepApplyDriverPackage](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepApplyDriverPackage?view=sccm-ps)

### <a name="properties-for-apply-driver-package"></a>Свойства для применения пакета драйверов

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="driver-package"></a>Пакет драйвера

Укажите пакет драйверов с нужными драйверами устройств. Нажмите кнопку **Обзор**, чтобы открыть диалоговое окно **Выбор пакета**. Выберите существующий пакет драйверов, который нужно применить. В нижней части диалогового окна отображаются свойства этого пакета.  

#### <a name="install-driver-package-via-running-dism-with-recurse-option"></a>Установка пакета драйверов с помощью запуска DISM с параметром recurse

Выберите этот параметр, чтобы добавить параметр `/recurse` в командную строку DISM, когда Windows применяет пакет драйверов.

При включении этого параметра можно также указать дополнительные параметры командной строки DISM. Используйте переменную последовательности задач [OSDInstallDriversAdditionalOptions](task-sequence-variables.md#OSDInstallDriversAdditionalOptions), чтобы включить дополнительные параметры. См. дополнительные сведения о [параметрах командной строки для DISM в Windows 10](https://docs.microsoft.com/windows-hardware/manufacture/desktop/deployment-image-servicing-and-management--dism--command-line-options).<!-- SCCMDocs#2125 -->

#### <a name="select-the-mass-storage-driver-within-the-package-that-needs-to-be-installed-before-setup-on-pre-windows-vista-operating-systems"></a>В пакете выберите драйвер запоминающего устройства, который необходимо установить перед запуском программы установки в операционных системах, предшествующих Windows Vista.

Укажите драйверы запоминающих устройств, необходимые для установки классической операционной системы.  

##### <a name="driver"></a>Драйвер

Выберите файл драйвера запоминающего устройства, который нужно установить перед установкой классический операционной системы. Раскрывающийся список заполняется из указанного пакета.  

##### <a name="model"></a>Модель

Укажите устройство, которое должно работать во время загрузки на операционных системах старше Windows Vista.  

#### <a name="do-unattended-installation-of-unsigned-drivers-on-version-of-windows-where-this-is-allowed"></a>Автоматически устанавливать неподписанные драйверы для всех версий Windows, если это возможно

Этот параметр позволяет операционной системе Windows устанавливать драйверы без цифровой подписи.  



## <a name="apply-network-settings"></a><a name="BKMK_ApplyNetworkSettings"></a> Применить параметры сети  

Этот шаг используется для задания параметров сети или рабочей группы на конечном компьютере. Последовательность задач сохраняет эти значения в соответствующем файле ответов. Программа установки Windows использует этот файл во время действия **Настройка Windows и Configuration Manager**.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Параметры** и **Применить параметры сети**.

> [!NOTE]
> Если в последовательность задач включено несколько экземпляров этого шага, условия не применяются. Параметры из последнего экземпляра этого шага в последовательности задач применяются к устройству. Чтобы обойти это поведение, включите каждый шаг в отдельную группу с условиями.

### <a name="variables-for-apply-network-settings"></a>Переменные для применения параметров сети

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDAdapter](task-sequence-variables.md#OSDAdapter)  
- [OSDAdapterCount](task-sequence-variables.md#OSDAdapterCount)  
- [OSDDNSDomain](task-sequence-variables.md#OSDDNSDomain)  
- [OSDDNSSuffixSearchOrder](task-sequence-variables.md#OSDDNSSuffixSearchOrder)  
- [OSDDomainName](task-sequence-variables.md#OSDDomainName)  
- [OSDDomainOUName](task-sequence-variables.md#OSDDomainOUName)  
- [OSDEnableTCPIPFiltering](task-sequence-variables.md#OSDEnableTCPIPFiltering)  
- [OSDJoinAccount](task-sequence-variables.md#OSDJoinAccount)  
- [OSDJoinPassword](task-sequence-variables.md#OSDJoinPassword)  
- [OSDWorkgroupName](task-sequence-variables.md#OSDWorkgroupName)  

### <a name="cmdlets-for-apply-network-settings"></a>Командлеты для применения параметров сети

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepApplyNetworkSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyNetworkSetting?view=sccm-ps)
- [New-CMTSStepApplyNetworkSetting](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepApplyNetworkSetting?view=sccm-ps)
- [Remove-CMTSStepApplyNetworkSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepApplyNetworkSetting?view=sccm-ps)
- [Set-CMTSStepApplyNetworkSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepApplyNetworkSetting?view=sccm-ps)

### <a name="properties-for-apply-network-settings"></a>Свойства для применения параметров сети

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="join-a-workgroup"></a>Присоединить к рабочей группе

Выберите этот параметр, чтобы присоединить конечный компьютер к указанной рабочей группе. Введите имя рабочей группы в строке **Рабочая группа** . Это значение можно переопределить значением, записанным на шаге последовательности задач **Сохранить параметры сети**.

#### <a name="join-a-domain"></a>Присоединить к домену

Выберите этот параметр, чтобы присоединить конечный компьютер к указанному домену. Укажите или выберите домен, например `fabricam.com`. Укажите или выберите LDAP-путь для подразделения, Например, так: `LDAP//OU=computers, DC=Fabricam.com, C=com`.  

#### <a name="account"></a>Учетная запись

Нажмите кнопку **Задать**, чтобы указать учетную запись с необходимыми разрешениями для присоединения компьютера к домену. В диалоговом окне **Учетная запись пользователя Windows** введите имя пользователя, используя следующий формат: `Domain\User`. Дополнительные сведения см. в статье [об учетной записи присоединения к домену](../../core/plan-design/hierarchy/accounts.md#task-sequence-domain-join-account).

#### <a name="adapter-settings"></a>Параметры адаптера

Укажите конфигурации сети для каждого сетевого адаптера на компьютере. Нажмите кнопку **Создать**, чтобы открыть диалоговое окно **Параметры сети**, а затем укажите параметры сети.

- Если также используется шаг **Сохранить параметры сети**, последовательность задач применяет сохраненные ранее параметры к сетевому адаптеру.
- Если последовательность задач не сохранила ранее параметры сети, она применяет указанные в этом шаге параметры.
- Они применяются к сетевым адаптерам в порядке перечисления устройств Windows.  
- Последовательность задач не мгновенно применяет к компьютеру указанные в этом шаге параметры.



## <a name="apply-operating-system-image"></a><a name="BKMK_ApplyOperatingSystemImage"></a> Применить образ операционной системы  

Используйте этот шаг для установки операционной системы на конечном компьютере.

Действие **Применить операционную систему** после выполнение сохраняет в переменной **OSDTargetSystemDrive** букву диска того раздела, который содержит файлы операционной системы.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Применить образ операционной системы**.

> [!TIP]
> Начиная с Windows 10 версии 1709, носитель содержит несколько выпусков. При настройке последовательности задач для использования пакета обновления операционной системы или образа ОС не забудьте выбрать [поддерживаемый выпуск](../../core/plan-design/configs/support-for-windows-10.md#windows-10-as-a-client).  
>
> Используйте предварительное кэширование содержимого, чтобы скачать применимый пакет обновления ОС, прежде чем пользователь установит последовательность задач. Дополнительные сведения см. в разделе [Настройка предварительного кэширования содержимого](../deploy-use/configure-precache-content.md).
>
> Шаг **Настройка Windows и Configuration Manager** запускает установку Windows.

### <a name="variables-for-apply-os-image"></a>Переменные для применения образа ОС

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDConfigFileName](task-sequence-variables.md#OSDConfigFileName)  
- [OSDImageIndex](task-sequence-variables.md#OSDImageIndex)  
- [OSDTargetSystemDrive](task-sequence-variables.md#OSDTargetSystemDrive)  

### <a name="cmdlets-for-apply-os-image"></a>Командлеты для применения образа ОС

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepApplyOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyOperatingSystem?view=sccm-ps)
- [New-CMTSStepApplyOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepApplyOperatingSystem?view=sccm-ps)
- [Remove-CMTSStepApplyOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepApplyOperatingSystem?view=sccm-ps)
- [Set-CMTSStepApplyOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepApplyOperatingSystem?view=sccm-ps)

### <a name="behaviors-for-apply-os-image"></a>Поведение для применения образа ОС

Этот шаг выполняет разные действия в зависимости от того, используется ли образ ОС или пакет обновления операционной системы.  

#### <a name="os-image-actions"></a>Действия с образом операционной системы

При использовании образа ОС шаг **Применить образ операционной системы** выполняет следующие действия:  

1. Удаляет все содержимое на целевом томе, за исключением файлов в папке, адрес которой указан в переменной **\_SMSTSUserStatePath**.  

2. Извлекает содержимое указанного WIM-файла в заданный конечный раздел.  

3. Подготавливает файл ответов:  

    1. Создает новый файл ответов программы установки Windows по умолчанию (sysprep.inf или unattend.xml) для развертываемой операционной системы.  

    2. Объединяет все значения из файла ответов, предоставленного пользователем.  

4. Копирует загрузчики Windows в активный раздел.  

5. Вносит в файл boot.ini или базу данных конфигурации загрузки (BCD) изменения, содержащие ссылку на установленную операционную систему.  

#### <a name="os-upgrade-package-actions"></a>Действия с пакетом обновления ОС

При использовании пакета обновления ОС шаг **Применить образ операционной системы** выполняет следующие действия:  

1. Удаляет все содержимое на целевом томе, за исключением файлов в папке, адрес которой указан в переменной **\_SMSTSUserStatePath**.  

2. Подготавливает файл ответов:  

    1. Создает новый файл ответов со стандартными значениями, созданными Configuration Manager.  

    2. Объединяет все значения из файла ответов, предоставленного пользователем.  

### <a name="properties-for-apply-os-image"></a>Свойства для применения образа ОС

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="apply-operating-system-from-a-captured-image"></a>Применить образ операционной системы

Устанавливает записанный образ операционной системы. Нажмите кнопку **Обзор**, чтобы открыть диалоговое окно **Выбор пакета**. Выберите существующий пакет образа, который вы хотите установить. Если с выбранным **пакетом образа** связано несколько образов, в раскрывающемся списке выберите из них тот, который нужно использовать для этого развертывания. Щелкнув образ, можно просмотреть основные сведения о нем.  

#### <a name="apply-operating-system-image-from-an-original-installation-source"></a>Применить операционную систему из дистрибутива установки

Устанавливает операционную систему с помощью пакета обновления операционной системы, который является исходным источником установки. Нажмите кнопку **Обзор**, чтобы открыть диалоговое окно **Выбор пакета обновления операционной системы**. Выберите существующий пакет обновления ОС, который вы хотите использовать. Щелкнув источник образа, можно просмотреть основные сведения о нем. В области результатов внизу диалогового окна отображаются свойства соответствующего исходного образа. Если с выбранным пакетом связано несколько выпусков, в раскрывающемся списке выберите нужный **выпуск**.  

> [!NOTE]  
> **Пакеты обновления операционной системы** предназначены в первую очередь для использования с обновлениями на месте, а не для новых установок Windows. При развертывании новых установок Windows используйте параметр **Применить образ операционной системы** и файл **install.wim** из исходных файлов установки.
>
> Развертывание новых установок Windows с использованием **пакетов обновления операционной системы** по-прежнему поддерживается, но зависит от драйверов, совместимых с этим методом. При выполнении установок Windows из пакета обновления ОС драйверы устанавливаются, находясь в Windows PE, а не просто внедряются в Windows PE. Некоторые драйверы невозможно установить, когда они находятся в Windows PE.
>
> В таком случае создайте **образ операционной системы** с использованием файла **install.wim** из исходных установочных файлов. Затем выполните развертывание, используя параметр **Применить образ операционной системы**.

#### <a name="use-an-unattended-or-sysprep-answer-file-for-a-custom-installation"></a>Использовать файл ответов автоматической установки или файл ответов Sysprep для заранее настроенной установки

Установите этот флажок, чтобы указать файл ответов программы установки Windows (**unattend.xml**, **unattend.txt**или **sysprep.inf**) в зависимости от версии операционной системы и метода установки. Указываемый файл может включать любые стандартные параметры конфигурации, поддерживаемые файлами ответов Windows. Например, его можно использовать, чтобы указать домашнюю страницу Internet Explorer по умолчанию. Укажите пакет, содержащий файл ответов, и соответствующий путь к файлу в пакете.  

> [!NOTE]  
> Предоставляемый файл ответов программы установки может содержать встроенные переменные последовательности задач в формате `%varname%`, где *varname* — это имя переменной. Шаг **Настройка Windows и Configuration Manager** заменяет упоминание переменной ее фактическим значением. Эти встроенные переменные последовательности задач нельзя использовать в полях файла ответов unattend.xml, предназначенных для числовых значений.  

Если вы не укажете файл ответов программы установки Windows, это действие последовательности задач создает файл ответов автоматически.  

#### <a name="destination"></a>Destination

Настройте один из следующих параметров:  

- **Next available partition** (Следующий доступный раздел). Используйте следующий по порядку раздел, который еще не являлся целевым для шага **Применить операционную систему** или **Применить образ данных** в этой последовательности задач.  

- **Конкретный диск и раздел**. Выберите номер в полях **Диск** (начиная с 0) и **Раздел** (начиная с 1).  

- **Конкретный логический диск**. Укажите **букву диска**, назначенную разделу средой предустановки Windows. Эта буква диска может отличаться от буквы диска, назначенной развернутой операционной системой.  

- **Имя логического диска хранится в виде переменной**. Укажите переменную последовательности задач, которая содержит букву диска, назначаемую разделу средой предустановки Windows. Эта переменная, как правило, задается в разделе "Дополнительно" диалогового окна **Свойства раздела** для шага последовательности задач **Отформатировать диск и создать разделы**.  

### <a name="options-for-apply-os-image"></a>Параметры для применения образа ОС

Кроме параметров по умолчанию, на вкладке **Параметры** этого шага последовательности задач можно настроить следующие дополнительные параметры:  

#### <a name="access-content-directly-from-the-distribution-point"></a>Доступ к содержимому непосредственно из точки распространения

Укажите, должна ли последовательность задач получать образ операционной системы напрямую из точки распространения. Например, можно использовать этот параметр при развертывании операционных систем на встроенных устройствах, которые имеют ограниченный объем хранилища. При выборе этого параметра также настройте параметры общей папки пакета на вкладке **Доступ к данным** для образа ОС.  

> [!NOTE]  
> Этот параметр переопределяет параметр развертывания, заданный на странице **Точки распространения** в **мастере развертывания программного обеспечения**. Это переопределение выполняется только для образа ОС, на который указывает этот шаг, а не для всего содержимого последовательности задач.  

> [!IMPORTANT]  
> Из соображений безопасности мы настоятельно рекомендуем не выбирать этот вариант. Он предназначен главным образом для устройств с ограниченной емкостью хранилища. Этот параметр не предназначен для ускорения последовательности задач. Если выбран этот вариант, не проверяется хэш пакета для пакета операционной системы. Это означает, что целостность пакета невозможно гарантировать, ведь его могут изменять любые пользователи с административными правами.



## <a name="apply-windows-settings"></a><a name="BKMK_ApplyWindowsSettings"></a> Применить настройки Windows

Используйте этот шаг, чтобы настроить параметры Windows для конечного компьютера. Последовательность задач сохраняет эти значения в соответствующем файле ответов. Программа установки Windows использует этот файл ответов во время действия **Настройка Windows и Configuration Manager**.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Параметры** и **Применить настройки Windows**.

### <a name="variables-for-apply-windows-settings"></a>Переменные для применения настроек Windows

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDComputerName](task-sequence-variables.md#OSDComputerName-input)  
- [OSDLocalAdminPassword](task-sequence-variables.md#OSDLocalAdminPassword)  
- [OSDProductKey](task-sequence-variables.md#OSDProductKey)  
- [OSDRandomAdminPassword](task-sequence-variables.md#OSDRandomAdminPassword)  
- [OSDRegisteredOrgName](task-sequence-variables.md#OSDRegisteredOrgName-input)  
- [OSDRegisteredUserName](task-sequence-variables.md#OSDRegisteredUserName)  
- [OSDServerLicenseConnectionLimit](task-sequence-variables.md#OSDServerLicenseConnectionLimit)  
- [OSDServerLicenseMode](task-sequence-variables.md#OSDServerLicenseMode)  
- [OSDTimeZone](task-sequence-variables.md#OSDTimeZone-input)  
- [OSDWindowsSettingsInputLocale](task-sequence-variables.md#OSDWindowsSettingsInputLocale)
- [OSDWindowsSettingsSystemLocale](task-sequence-variables.md#OSDWindowsSettingsSystemLocale)
- [OSDWindowsSettingsUILanguage](task-sequence-variables.md#OSDWindowsSettingsUILanguage)
- [OSDWindowsSettingsUILanguageFallback](task-sequence-variables.md#OSDWindowsSettingsUILanguageFallback)
- [OSDWindowsSettingsUserLocale](task-sequence-variables.md#OSDWindowsSettingsUserLocale)

### <a name="cmdlets-for-apply-windows-settings"></a>Командлеты для применения настроек Windows

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepApplyWindowsSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyWindowsSetting?view=sccm-ps)
- [New-CMTSStepApplyWindowsSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepApplyWindowsSetting?view=sccm-ps)
- [Remove-CMTSStepApplyWindowsSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepApplyWindowsSetting?view=sccm-ps)
- [Set-CMTSStepApplyWindowsSetting](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepApplyWindowsSetting?view=sccm-ps)

### <a name="properties-for-apply-windows-settings"></a>Свойства для применения настроек Windows

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="user-name"></a>Имя пользователя

Укажите имя зарегистрированного пользователя, которого нужно связать с конечным компьютером. Это значение можно переопределить значением, записанным на шаге последовательности задач **Сохранить параметры Windows**.  

#### <a name="organization-name"></a>Название организации

Укажите зарегистрированное название организации, которое нужно связать с конечным компьютером. Это значение можно переопределить значением, записанным на шаге последовательности задач **Сохранить параметры Windows**.  

#### <a name="product-key"></a>Ключ продукта  

Укажите ключ продукта для установки Windows на конечном компьютере.  

#### <a name="server-licensing"></a>Лицензирование сервера

Выбор режима лицензирования сервера.

- В качестве режима лицензирования выберите **Для каждого сервера** или **Для пользователя**.  
- При выборе режима **Для каждого сервера** также укажите максимальное число подключений, разрешенных в рамках лицензионного соглашения.  
- Выберите вариант **Не указывать**, если конечный компьютер не является сервером или не требуется указывать режим лицензирования.  

#### <a name="maximum-connections"></a>Максимальное количество соединений

> [!NOTE]
> Этот параметр применяется только к устаревшим версиям Windows, которые больше не поддерживаются.<!-- #4833 -->

#### <a name="randomly-generate-the-local-administrator-password-and-disable-the-account-on-all-supported-platforms-recommended"></a>Задать пароль локального администратора случайным образом и отключить учетную запись локального администратора на всех поддерживаемых платформах (рекомендуется)  

Установите этот флажок, чтобы создать случайный пароль для локального администратора. Кроме того, этот параметр отключает учетную запись локального администратора на платформах, поддерживающих эту возможность.  

#### <a name="enable-the-account-and-specify-the-local-administrator-password"></a>Включить учетную запись локального администратора и задать пароль  

Выберите этот параметр, чтобы включить учетную запись локального администратора с использованием заданного пароля. Введите пароль в строке **Пароль** и подтвердите его в строке **Подтверждение пароля** .  

#### <a name="time-zone"></a>Часовой пояс

Укажите часовой пояс для настройки на конечном компьютере. Это значение можно переопределить значением, записанным на шаге последовательности задач **Сохранить параметры Windows**.  

#### <a name="language-settings"></a>языковые параметры;

<!--5411057, 5138936-->

В версии 1910 и выше конфигурацией языков можно управлять в ходе развертывания ОС. Если вы уже применяете эти языковые параметры, это изменение поможет упростить последовательность задач развертывания операционной системы. Вместо того чтобы использовать несколько шагов для каждого языка или отдельные скрипты, используйте один экземпляр для каждого языка этого шага с условием для этого языка.

Настройте следующие параметры.

- Язык ввода (раскладка клавиатуры по умолчанию)
- языковой стандарт системы;
- язык пользовательского интерфейса;
- базовый язык пользовательского интерфейса;
- региональные параметры пользователя.

Дополнительные сведения об этих значениях файла ответов программы установки Windows см. в разделе [Microsoft-Windows-International-Core](https://docs.microsoft.com/windows-hardware/customize/desktop/unattend/microsoft-windows-international-core).

> [!NOTE]
> Если вы создаете пользовательский файл ответов программы установки Windows (unattend.xml), этот шаг перезаписывает все существующие значения. Чтобы автоматизировать динамический процесс для этих параметров, используйте соответствующие переменные последовательности задач. Например, [OSDWindowsSettingsInputLocale](task-sequence-variables.md#OSDWindowsSettingsInputLocale). 

## <a name="auto-apply-drivers"></a><a name="BKMK_AutoApplyDrivers"></a> Автоматическое применение драйверов

Используйте этот шаг, чтобы найти и установить драйверы в процессе развертывания операционной системы.  

> [!IMPORTANT]  
> Шаг **Автоматическое применение драйверов** нельзя использовать при запуске с автономного носителя. В этом режиме программа установки Windows не имеет доступа к сайту Configuration Manager.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Драйверы** и **Автоматическое применение драйверов**.

> [!TIP]
> Общие сведения о драйверах в Configuration Manager см. в разделе [Использование последовательностей задач для установки драйверов](../get-started/manage-drivers.md#BKMK_TSDrivers).

### <a name="behaviors-for-auto-apply-drivers"></a>Поведение для автоматического применения драйверов

Шаг последовательности задач **Автоматическое применение драйверов** выполняет следующие действия.  

1. Проверяет оборудование и находит идентификаторы самонастраивающихся устройств для всех устройств в системе.  

2. Отправляет список устройств и идентификаторов самонастраивающихся устройств на точку управления. Для каждого аппаратного устройства точка управления возвращает список совместимых драйверов из каталога драйверов. Этот список содержит все включенные драйверы с тегами определенной категории, независимо от того, в каких пакетах драйверов они находятся.  

3. Для каждого аппаратного устройства последовательность задач выбирает наиболее подходящий драйвер. Этот драйвер подходит для развернутой операционной системы и находится на доступной точке распространения.  

4. Последовательность задач скачивает выбранные драйверы с точки распространения и передает их на промежуточное хранение в целевую операционную систему.  

    1. При использовании образа операционной системы последовательность задач помещает драйверы в хранилище драйверов операционной системы.  

    2. При использовании пакета обновления операционной системы в качестве исходного источника установки последовательность задач настраивает расположение драйверов в программе установки Windows.  

5. Во время шага **Настройка Windows и Configuration Manager** в последовательности задач программа установки Windows находит драйверы, определенные в этом шаге.  

### <a name="variables-for-auto-apply-drivers"></a>Переменные для автоматического применения драйверов

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDAutoApplyDriverBestMatch](task-sequence-variables.md#OSDAutoApplyDriverBestMatch)  
- [OSDAutoApplyDriverCategoryList](task-sequence-variables.md#OSDAutoApplyDriverCategoryList)  
- [SMSTSDriverRequestConnectTimeOut](task-sequence-variables.md#SMSTSDriverRequestConnectTimeOut)  
- [SMSTSDriverRequestReceiveTimeOut](task-sequence-variables.md#SMSTSDriverRequestReceiveTimeOut)  
- [SMSTSDriverRequestResolveTimeOut](task-sequence-variables.md#SMSTSDriverRequestResolveTimeOut)  
- [SMSTSDriverRequestSendTimeOut](task-sequence-variables.md#SMSTSDriverRequestSendTimeOut)  

### <a name="cmdlets-for-auto-apply-drivers"></a>Командлеты для автоматического применения драйверов

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepAutoApplyDriver](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepAutoApplyDriver?view=sccm-ps)
- [New-CMTSStepAutoApplyDriver](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepAutoApplyDriver?view=sccm-ps)
- [Remove-CMTSStepAutoApplyDriver](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepAutoApplyDriver?view=sccm-ps)
- [Set-CMTSStepAutoApplyDriver](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepAutoApplyDriver?view=sccm-ps)

### <a name="properties-for-auto-apply-drivers"></a>Свойства для автоматического применения драйверов

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="install-only-the-best-matched-compatible-drivers"></a>Устанавливать только наиболее подходящие, совместимые драйверы

Шаг последовательности задач будет устанавливать для каждого обнаруженного устройства только наиболее подходящие драйверы.  

#### <a name="install-all-compatible-drivers"></a>Установить все совместимые драйверы

Последовательность задач устанавливает все совместимые драйверы для каждого обнаруженного устройства. После этого программа установки Windows выбирает наиболее подходящий драйвер. Этот вариант требует больше пропускной способности сети и дискового пространства. Последовательность задач скачивает больше драйверов, но Windows может выбрать из них наиболее подходящий.  

#### <a name="consider-drivers-from-all-categories"></a>Использовать драйверы всех категорий

Последовательность задач ищет подходящие драйверы устройств во всех доступных категориях.  

#### <a name="limit-driver-matching-to-only-consider-drivers-in-selected-categories"></a>Использовать драйверы только из указанных категорий

Последовательность задач ищет подходящие драйверы устройств в указанных категориях.  

Если вы выберете несколько категорий, возвращаются все подходящие драйверы из всех выбранных категорий. Это эквивалентно операции `OR`.<!-- SCCMDocs issue 851 -->

#### <a name="do-unattended-installation-of-unsigned-drivers-on-versions-of-windows-where-this-is-allowed"></a>Автоматически устанавливать неподписанные драйверы для всех версий Windows, если это возможно

Этот параметр позволяет операционной системе Windows устанавливать драйверы без цифровой подписи.  

> [!IMPORTANT]  
> Этот параметр не применяется к операционным системам, где невозможно настроить политику подписывания драйверов.  



## <a name="capture-network-settings"></a><a name="BKMK_CaptureNetworkSettings"></a> Сохранить параметры сети

Используйте этот шаг для записи параметров сети (Майкрософт) с компьютера, на котором выполняется последовательность задач. Последовательность задач сохраняет эти параметры в переменных последовательности задач. Эти параметры переопределяют параметры по умолчанию, настроенные в шаге **Применить параметры сети**.  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Параметры** и **Сохранить параметры сети**.

### <a name="variables-for-capture-network-settings"></a>Переменные для сохранения параметров сети

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDMigrateAdapterSettings](task-sequence-variables.md#OSDMigrateAdapterSettings)  
- [OSDMigrateNetworkMembership](task-sequence-variables.md#OSDMigrateNetworkMembership)  

### <a name="cmdlets-for-capture-network-settings"></a>Командлеты для сохранения параметров сети

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepCaptureNetworkSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepCaptureNetworkSettings?view=sccm-ps)
- [New-CMTSStepCaptureNetworkSettings](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepCaptureNetworkSettings?view=sccm-ps)
- [Remove-CMTSStepCaptureNetworkSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepCaptureNetworkSettings?view=sccm-ps)
- [Set-CMTSStepCaptureNetworkSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepCaptureNetworkSettings?view=sccm-ps)

### <a name="properties-for-capture-network-settings"></a>Свойства для сохранения параметров сети

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="migrate-domain-and-workgroup-membership"></a>Перенести членство в домене или рабочей группе

Запись сведений о членстве конечного компьютера в домене или рабочей группе.  

#### <a name="migrate-network-adapter-configuration"></a>Перенести настройки сетевого адаптера

Запись конфигурации сетевого адаптера конечного компьютера. Сохраняются следующие сведения:

- глобальные сетевые параметры;  
- количество адаптеров;  
- сетевые параметры для каждого адаптера: DNS, WINS, IP-адрес и фильтры портов.



## <a name="capture-operating-system-image"></a><a name="BKMK_CaptureOperatingSystemImage"></a> Записать образ операционной системы

Этот шаг записывает один или несколько образов с компьютера-образца. Последовательность задач создает WIM-файл в указанной сетевой папке. После этого выполните **мастер добавления пакета образа операционной системы**, чтобы импортировать этот образ в Configuration Manager для развертываний операционных систем на основе образов.  

Configuration Manager записывает каждый том (диск) компьютера-образца в виде отдельного образа в WIM-файле. Если компьютер-образец включает несколько томов, получившийся WIM-файл содержит отдельный образ для каждого тома. Этот шаг поддерживает запись только томов с файловыми системами NTFS или FAT32. Тома с другими форматами файловых систем и тома USB пропускаются.  

Версия установленной на компьютере-образце операционной системы Windows должна поддерживаться Configuration Manager. Используйте средство SysPrep, чтобы подготовить операционную систему на компьютере-образце. В качестве тома установки операционной системы и загрузочного тома должен использоваться один и тот же том.  

Укажите учетную запись с разрешениями на запись в выбранную сетевую папку. Дополнительные сведения об учетной записи образа ОС см. в разделе [Accounts](../../core/plan-design/hierarchy/accounts.md#capture-os-image-account) (Учетные записи).

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Записать образ операционной системы**.

### <a name="variables-for-capture-os-image"></a>Переменные для записи образа ОС

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDCaptureAccount](task-sequence-variables.md#OSDCaptureAccount)  
- [OSDCaptureAccountPassword](task-sequence-variables.md#OSDCaptureAccountPassword)  
- [OSDCaptureDestination](task-sequence-variables.md#OSDCaptureDestination)  
- [OSDImageCreator](task-sequence-variables.md#OSDImageCreator)  
- [OSDImageDescription](task-sequence-variables.md#OSDImageDescription)  
- [OSDImageVersion](task-sequence-variables.md#OSDImageVersion)  
- [OSDTargetSystemRoot](task-sequence-variables.md#OSDTargetSystemRoot-input)  

### <a name="cmdlets-for-capture-os-image"></a>Командлеты для записи образа ОС

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepCaptureSystemImage](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepCaptureSystemImage?view=sccm-ps)
- [New-CMTSStepCaptureSystemImage](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepCaptureSystemImage?view=sccm-ps)
- [Remove-CMTSStepCaptureSystemImage](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepCaptureSystemImage?view=sccm-ps)
- [Set-CMTSStepCaptureSystemImage](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepCaptureSystemImage?view=sccm-ps)

### <a name="properties-for-capture-os-image"></a>Свойства для записи образа ОС

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="target"></a>Target  

Путь файловой системы к расположению, которое Configuration Manager использует для хранения записанного образа операционной системы.  

#### <a name="description"></a>Описание:  

Необязательное пользовательское описание записанного образа операционной системы, которое сохраняется в WIM-файле.  

#### <a name="version"></a>Версия  

Необязательный номер версии, который задается пользователем и присваивается записанному образу операционной системы. Это значение может быть любым сочетанием букв и цифр. Оно сохраняется в WIM-файле.  

#### <a name="created-by"></a>Кем создан  

Необязательное имя пользователя, создавшего образ операционной системы. Оно сохраняется в WIM-файле.  

#### <a name="capture-operating-system-image-account"></a>Учетная запись для записи образа операционной системы  

Укажите учетную запись Windows с разрешениями на запись в указанную сетевую папку. Щелкните **Задать**, чтобы указать имя этой учетной записи Windows.  



## <a name="capture-user-state"></a><a name="BKMK_CaptureUserState"></a> Записать пользовательское состояние

Этот шаг использует средство миграции пользовательской среды (USMT), чтобы сохранить данные пользовательской среды и параметры компьютера, где выполняется последовательность задач. Этот шаг последовательности задач используется вместе с шагом **Восстановить пользовательское состояние** . На этом шаге всегда выполняется шифрование хранилища состояний USMT с помощью ключа шифрования, созданного и управляемого Configuration Manager.  

Дополнительные сведения об управлении состоянием пользователей при развертывании операционных систем см. в разделе [Управление пользовательской средой](../get-started/manage-user-state.md).  

Если требуется сохранить и восстановить параметры пользовательской среды на точке миграции состояния, используйте этот шаг вместе с шагами **Запросить хранилище состояний** и **Освободить хранилище состояний**.  

Этот шаг позволяет управлять ограниченным подмножеством наиболее распространенных параметров USMT. Укажите дополнительные параметры командной строки с помощью переменной последовательности задач **OSDMigrateAdditionalCaptureOptions**.  

Этот шаг последовательности задач выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Пользовательское состояние** и **Записать пользовательское состояние**.

### <a name="variables-for-capture-user-state"></a>Переменные для записи пользовательского состояния

Используйте для этого шага следующие переменные последовательности задач:  

- [_OSDMigrateUsmtPackageID](task-sequence-variables.md#OSDMigrateUsmtPackageID)  
- [OSDMigrateAdditionalCaptureOptions](task-sequence-variables.md#OSDMigrateAdditionalCaptureOptions)  
- [OSDMigrateConfigFiles](task-sequence-variables.md#OSDMigrateConfigFiles)  
- [OSDMigrateContinueOnLockedFiles](task-sequence-variables.md#OSDMigrateContinueOnLockedFiles)  
- [OSDMigrateEnableVerboseLogging](task-sequence-variables.md#OSDMigrateEnableVerboseLogging)  
- [OSDMigrateMode](task-sequence-variables.md#OSDMigrateMode)  
- [OSDMigrateSkipEncryptedFiles](task-sequence-variables.md#OSDMigrateSkipEncryptedFiles)  
- [OSDStateStorePath](task-sequence-variables.md#OSDStateStorePath)  

### <a name="cmdlets-for-capture-user-state"></a>Командлеты для записи пользовательского состояния

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepCaptureUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepCaptureUserState?view=sccm-ps)
- [New-CMTSStepCaptureUserState](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepCaptureUserState?view=sccm-ps)
- [Remove-CMTSStepCaptureUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepCaptureUserState?view=sccm-ps)
- [Set-CMTSStepCaptureUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepCaptureUserState?view=sccm-ps)

### <a name="properties-for-capture-user-state"></a>Свойства для записи пользовательского состояния

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="user-state-migration-tool-package"></a>Пакет средств миграции пользовательской среды

Укажите пакет, содержащий средство миграции пользовательской среды (USMT). Последовательность задач использует эту версию USMT, чтобы сохранить пользовательскую среду и параметры. Для этого пакета не требуется программа. Укажите пакет, содержащий 32- или 64-разрядную версию средства миграции пользовательской среды. Архитектура USMT зависит от архитектуры операционной системы, состояние которой записывает последовательность задач.  

#### <a name="capture-all-user-profiles-with-standard-options"></a>Захватить все профили пользователей, используя стандартные параметры

Позволяет перенести все данные профиля пользователя. Это значение по умолчанию.  

Если выбрать этот параметр, не установив флажок **Восстановить профили локальных пользователей компьютера** в шаге **Восстановить пользовательское состояние**, произойдет сбой последовательности задач. Configuration Manager не может переносить новые учетные записи, не назначая им пароли.

При использовании параметра **Установить существующий образ** в мастере **создания последовательности задач** получившаяся последовательность задач по умолчанию выполняет шаг **Захватить все профили пользователей, используя стандартные параметры**. Эта последовательность задач по умолчанию не восстанавливает **профили локальных пользователей компьютера**, то есть учетные записи, не входящие в домен.  

Установите флажок **Восстановить профили локальных пользователей компьютера** и укажите пароль для переносимой учетной записи. Если используется последовательность задач, созданная вручную, этот параметр находится в шаге **Восстановить пользовательское состояние**. В последовательности задач, созданной с помощью мастера **создания последовательности задач** , этот параметр находится в шаге **Восстановить файлы и параметры пользователя** страницы мастера.  

Если локальные учетные записи пользователей отсутствуют, этот параметр не применяется.  

#### <a name="customize-how-user-profiles-are-captured"></a>Настройка захвата профилей пользователей

Установите этот флажок, чтобы указать пользовательский файл профиля для переноса. Щелкните **Файлы**, чтобы выбрать файлы конфигурации, которые средство миграции пользовательской среды будет использовать для этого шага. Укажите настраиваемый XML-файл с правилами, которые определяют набор переносимых файлов пользовательской среды.  

#### <a name="click-here-to-select-configuration-files"></a>Щелкните здесь, чтобы выбрать файлы конфигурации

Щелкните эту ссылку, что выбрать файлы конфигурации в USMT-пакете, которые будут использоваться для записи профилей пользователей. Щелкните **Файлы**, чтобы открыть диалоговое окно **Файлы конфигурации**. Чтобы указать файл конфигурации, введите имя файла в строку **Имя файла** и нажмите кнопку **Добавить**.  

#### <a name="enable-verbose-logging"></a>Включить подробное ведение журнала

Включите этот параметр, чтобы сформировать более подробные сведения о файле журнала. При записи состояния последовательность задач по умолчанию создает журнал **ScanState.log** в своей папке журналов `%WinDir%\ccm\logs`.  

#### <a name="skip-files-using-encrypted-file-system"></a>Пропустить файлы, использующие шифрованную файловую систему

Включите этот параметр, чтобы пропустить запись файлов, зашифрованных с помощью шифрованной файловой системы (EFS), включая файлы профилей пользователей. В зависимости от версий операционной системы и средства миграции пользовательской среды, зашифрованные файлы могут стать нечитаемыми после восстановления. Дополнительные сведения см. в документации средства миграции пользовательской среды.  

#### <a name="copy-by-using-file-system-access"></a>Скопировать, используя доступ к файловой системе

Установите этот флажок, чтобы указать любой из следующих параметров.  

- **Продолжать при невозможности захвата некоторых файлов**. Включите этот параметр, чтобы продолжить процесс миграции, даже если не удается записать некоторые файлы. Если этот параметр отключен, шаг завершается сбоем при невозможности записать любой из файлов. Этот параметр по умолчанию включен.  

- **Захватить локально, используя ссылки (hardlink), а не копируя файлы**. Включите этот параметр, чтобы использовать жесткие связи NTFS для записи файлов.  

    Дополнительные сведения о миграции данных с помощью жестких связей см. в статье [Хранилище миграции с жесткой связью](https://docs.microsoft.com/windows/deployment/usmt/usmt-hard-link-migration-store)  

- **Выполнить захват в автономном режиме (только в ОС Windows PE)** . Включите этот параметр, чтобы собрать данные о пользовательской среде из среды предустановки Windows, а не из полнофункциональной операционной системы.  

#### <a name="capture-by-using-volume-copy-shadow-services-vss"></a>Захватить, используя службу VSS

Этот параметр позволяет записывать файлы, даже если они заблокированы для редактирования другим приложением.  



## <a name="capture-windows-settings"></a><a name="BKMK_CaptureWindowsSettings"></a> Сохранить параметры Windows

Используйте этот шаг для записи параметров Windows с компьютера, на котором выполняется последовательность задач. Последовательность задач сохраняет эти параметры в переменных последовательности задач. Эти записанные параметры переопределяют параметры по умолчанию, настроенные в шаге **Применить настройки Windows**.  

Этот шаг последовательности задач выполняется в Windows PE и в полной версии операционной системы.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Параметры** и **Сохранить параметры Windows**.

### <a name="variables-for-capture-windows-settings"></a>Переменные для сохранения параметров Windows

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDComputerName](task-sequence-variables.md#OSDComputerName-output)  
- [OSDMigrateComputerName](task-sequence-variables.md#OSDMigrateComputerName)  
- [OSDMigrateRegistrationInfo](task-sequence-variables.md#OSDMigrateRegistrationInfo)  
- [OSDMigrateTimeZone](task-sequence-variables.md#OSDMigrateTimeZone)  
- [OSDRegisteredOrgName](task-sequence-variables.md#OSDRegisteredOrgName-output)  
- [OSDTimeZone](task-sequence-variables.md#OSDTimeZone-output)  

### <a name="cmdlets-for-capture-windows-settings"></a>Командлеты для сохранения параметров Windows

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepCaptureWindowsSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepCaptureWindowsSettings?view=sccm-ps)
- [New-CMTSStepCaptureWindowsSettings](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepCaptureWindowsSettings?view=sccm-ps)
- [Remove-CMTSStepCaptureWindowsSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepCaptureWindowsSettings?view=sccm-ps)
- [Set-CMTSStepCaptureWindowsSettings](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepCaptureWindowsSettings?view=sccm-ps)

### <a name="properties-for-capture-windows-settings"></a>Свойства для сохранения параметров Windows

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="migrate-computer-name"></a>Перенести имя компьютера

Позволяет записать NetBIOS-имя компьютера.  

#### <a name="migrate-registered-user-and-organization-names"></a>Перенести имя зарегистр. пользователя и название организации

Позволяет записать зарегистрированные имена пользователей и названия организаций с компьютера.  

#### <a name="migrate-time-zone"></a>Перенести часовой пояс

Позволяет записать параметр часового пояса на компьютере.  



## <a name="check-readiness"></a><a name="BKMK_CheckReadiness"></a> Проверить готовность

Используйте этот шаг, чтобы проверить соответствие компьютера указанным необходимым условиям развертывания.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Проверить готовность**.

Начиная с версии 2002, этот шаг включает в себя восемь новых проверок. Ни одна из этих новых проверок не выбрана по умолчанию в новых или существующих экземплярах этого шага.<!--6005561--> Дополнительные сведения о каждой проверке см. в указанных ниже разделах.

- **Архитектура текущей ОС**
- **Минимальная версия ОС**
- **Максимальная версия ОС**
- **Минимальная версия клиента**
- **Язык текущей ОС**
- **Питание от сети включено**
- **Сетевой адаптер подключен**
  - **Сетевой адаптер не является беспроводным**

> [!IMPORTANT]
> Чтобы воспользоваться преимуществами этих новых функций Configuration Manager, после обновления сайта нужно также обновить клиенты до последней версии. Хотя новые функции появляются в консоли Configuration Manager после обновления ее и сайта, полный сценарий будет работать только с последней версией клиента.

**smsts.log** содержит результаты всех проверок. Если одна из проверок завершается неудачно, подсистема последовательности задач продолжит оценивать другие проверки. Этот шаг не завершается сбоем, пока все проверки не будут выполнены. Если хотя бы одна проверка завершается сбоем, шаг завершается сбоем, и возвращается код ошибки **4316**. Этот код ошибки означает: "Ресурс, необходимый для этой операции, не существует".

### <a name="variables-for-check-readiness"></a>Переменные для проверки готовности

Используйте для этого шага следующие переменные последовательности задач:  

- [_TS_CRMEMORY](task-sequence-variables.md#TSCRMEMORY)
- [_TS_CRSPEED](task-sequence-variables.md#TSCRSPEED)
- [_TS_CRDISK](task-sequence-variables.md#TSCRDISK)
- [_TS_CROSTYPE](task-sequence-variables.md#TSCROSTYPE)
- [_TS_CRARCH](task-sequence-variables.md#TSCRARCH)
- [_TS_CRMINOSVER](task-sequence-variables.md#TSCRMINOSVER)
- [_TS_CRMAXOSVER](task-sequence-variables.md#TSCRMAXOSVER)
- [_TS_CRCLIENTMINVER](task-sequence-variables.md#TSCRCLIENTMINVER)
- [_TS_CROSLANGUAGE](task-sequence-variables.md#TSCROSLANGUAGE)
- [_TS_CRACPOWER](task-sequence-variables.md#TSCRACPOWER)
- [_TS_CRNETWORK](task-sequence-variables.md#TSCRNETWORK)
- [_TS_CRWIRED](task-sequence-variables.md#TSCRWIRED)

### <a name="cmdlets-for-check-readiness"></a>Командлеты для проверки готовности

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepPrestartCheck](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepPrestartCheck?view=sccm-ps)
- [New-CMTSStepPrestartCheck](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepPrestartCheck?view=sccm-ps)
- [Remove-CMTSStepPrestartCheck](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepPrestartCheck?view=sccm-ps)
- [Set-CMTSStepPrestartCheck](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepPrestartCheck?view=sccm-ps)

### <a name="properties-for-check-readiness"></a>Свойства для проверки готовности

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="minimum-memory-mb"></a>Минимальный объем памяти (МБ)

Позволяет убедиться, что объем памяти в мегабайтах (МБ) равен заданному значению или превышает его. Шаг включает этот параметр по умолчанию.  

#### <a name="minimum-processor-speed-mhz"></a>Минимальная скорость процессора (МГц)  

Позволяет убедиться, что скорость процессора в мегагерцах (МГц) равна заданному значению или превышает его. Шаг включает этот параметр по умолчанию.  

#### <a name="minimum-free-disk-space-mb"></a>Минимальное свободное место на диске (МБ)

Позволяет убедиться, что объем свободного места на диске в мегабайтах (МБ) равен заданному значению или превышает его.  

#### <a name="current-os-to-be-refreshed-is"></a>Текущая операционная система для обновления

Позволяет убедиться, что операционная система на конечном компьютере соответствует заданному требованию. По умолчанию шаг задает для этого параметра значение **Клиент**.  

#### <a name="architecture-of-current-os"></a>Архитектура текущей ОС

Начиная с версии 2002, проверьте, является ли текущая ОС **32-разрядной** или **64-разрядной**.

#### <a name="minimum-os-version"></a>Минимальная версия ОС

Начиная с версии 2002, убедитесь, что используется версия текущей ОС позднее указанной. Укажите версию: основную и дополнительную и номер сборки. Например, `10.0.16299`.

#### <a name="maximum-os-version"></a>Максимальная версия ОС

Начиная с версии 2002, убедитесь, что используется версия текущей ОС ранее указанной. Укажите версию: основную и дополнительную и номер сборки. Например, `10.0.18356`.

#### <a name="minimum-client-version"></a>Минимальная версия клиента

Начиная с версии 2002, убедитесь, что клиент Configuration Manager имеет как минимум указанную версию. Укажите версию клиента в следующем формате: `5.00.8913.1005`.

#### <a name="language-of-current-os"></a>Язык текущей ОС

Начиная с версии 2002, убедитесь, что текущий язык ОС совпадает с указанным. Выберите название языка. На этом шаге сравнивается соответствующий код языка. В ходе проверки указанный вами язык сравнивается со свойством **OSLanguage** класса **Win32_OperatingSystem** на стороне клиента.

#### <a name="ac-power-plugged-in"></a>Питание от сети включено

Начиная с версии 2002, убедитесь, что устройство подключено к сети, а не работает от аккумулятора.

#### <a name="network-adapter-connected"></a>Сетевой адаптер подключен

Начиная с версии 2002, убедитесь, что устройство имеет сетевой адаптер, подключенный к сети. Можно также выбрать зависимую проверку, чтобы убедиться, что **Сетевой адаптер не является беспроводным**.

### <a name="options-for-check-readiness"></a>Параметры для проверки готовности

> [!NOTE]  
> При включении параметра **Продолжать при ошибке** на вкладке **Параметры** этого шага он заносит в журнал только результаты проверки готовности. Если проверка завершается неудачно, последовательность задач не останавливается.  



## <a name="connect-to-network-folder"></a><a name="BKMK_ConnectToNetworkFolder"></a> Подключить к сетевой папке

Используйте этот шаг, чтобы создать подключение к общей сетевой папке.  

Этот шаг последовательности задач выполняется в полной версии операционной системы и в Windows PE.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Подключить к сетевой папке**.

### <a name="variables-for-connect-to-network-folder"></a>Переменные для подключения к сетевой папке

Используйте для этого шага следующие переменные последовательности задач:  

- [SMSConnectNetworkFolderAccount](task-sequence-variables.md#SMSConnectNetworkFolderAccount)  
- [SMSConnectNetworkFolderDriveLetter](task-sequence-variables.md#SMSConnectNetworkFolderDriveLetter)  
- [SMSConnectNetworkFolderPassword](task-sequence-variables.md#SMSConnectNetworkFolderPassword)  
- [SMSConnectNetworkFolderPath](task-sequence-variables.md#SMSConnectNetworkFolderPath)  

### <a name="cmdlets-for-connect-to-network-folder"></a>Командлеты для подключения к сетевой папке

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepConnectNetworkFolder](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepConnectNetworkFolder?view=sccm-ps)
- [New-CMTSStepConnectNetworkFolder](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepConnectNetworkFolder?view=sccm-ps)
- [Remove-CMTSStepConnectNetworkFolder](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepConnectNetworkFolder?view=sccm-ps)
- [Set-CMTSStepConnectNetworkFolder](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepConnectNetworkFolder?view=sccm-ps)

### <a name="properties-for-connect-to-network-folder"></a>Свойства для подключения к сетевой папке

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="path"></a>Путь  

Нажмите кнопку **Обзор**, чтобы указать путь к сетевой папке. Используйте следующий формат: `\\server\share`.

#### <a name="drive"></a>Накопитель  

Выберите букву локального диска, чтобы назначить этому подключению.

#### <a name="account"></a>Учетная запись

Нажмите кнопку **Задать**, чтобы указать учетную запись пользователя с разрешениями на подключение к этой сетевой папке. Дополнительные сведения об учетной записи для подключения к общему сетевому ресурсу в последовательности задач см. в разделе [Accounts](../../core/plan-design/hierarchy/accounts.md#task-sequence-network-folder-connection-account) (Учетные записи).



## <a name="disable-bitlocker"></a><a name="BKMK_DisableBitLocker"></a> Отключить BitLocker

Используйте этот шаг, чтобы отключить шифрование BitLocker на текущем диске операционной системы или на определенном диске. Это действие оставляет предохранитель ключа в виде открытого текста на жестком диске. Он не выполняет расшифровку содержимого диска. Это действие завершает практически мгновенно.  

> [!NOTE]  
> Функция шифрования диска BitLocker обеспечивает низкоуровневое шифрование содержимого томов диска.  

Если у вас есть несколько зашифрованных дисков, отключите шифрование BitLocker на всех дисках с данными, прежде чем отключать его на диске операционной системы.  

Этот шаг выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Диски** и **Отключить BitLocker**.

### <a name="variables-for-disable-bitlocker"></a>Переменные для отключения BitLocker

Начиная с версии 1906, используйте следующие переменные последовательности задач для этого шага:  

- [OSDBitLockerRebootCount](task-sequence-variables.md#OSDBitLockerRebootCount);  
- [OSDBitLockerRebootCountOverride](task-sequence-variables.md#OSDBitLockerRebootCountOverride).  

### <a name="cmdlets-for-disable-bitlocker"></a>Командлеты для отключения BitLocker

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepDisableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepDisableBitLocker?view=sccm-ps)
- [New-CMTSStepDisableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepDisableBitLocker?view=sccm-ps)
- [Remove-CMTSStepDisableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepDisableBitLocker?view=sccm-ps)
- [Set-CMTSStepDisableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepDisableBitLocker?view=sccm-ps)

### <a name="properties-for-disable-bitlocker"></a>Свойства для отключения BitLocker

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="current-operating-system-drive"></a>Текущий диск с операционной системой

Отключение шифрования BitLocker на текущем диске операционной системы.  

#### <a name="specific-drive"></a>Другой диск  

Отключение BitLocker на конкретном диске. Используйте раскрывающееся меню, чтобы указать диск, на котором требуется отключить шифрование BitLocker.  

#### <a name="resume-protection-after-windows-has-been-restarted-the-specified-number-of-times"></a>Возобновление защиты после перезапуска Windows указанное число раз

<!-- 4512937 -->
Начиная с версии 1906 вы можете использовать этот параметр, чтобы указать число перезапусков, в течение которых защита BitLocker будет отключена. Вместо добавления нескольких экземпляров на этом этапе задайте значение в диапазоне от 1 (по умолчанию) до 15.

Это поведение можно настроить и изменить с помощью переменных последовательности задач [OSDBitLockerRebootCount](task-sequence-variables.md#OSDBitLockerRebootCount) и [OSDBitLockerRebootCountOverride](task-sequence-variables.md#OSDBitLockerRebootCountOverride).


## <a name="download-package-content"></a><a name="BKMK_DownloadPackageContent"></a> Скачать содержимое пакета

Используйте этот шаг, чтобы скачать любой из следующих типов пакетов:  

- Образы ОС  
- Пакеты обновления ОС  
- пакеты драйверов,  
- пакеты,  
- Образы загрузки <sup>[Примечание 1](#bkmk_note1)</sup>  

Этот шаг используется в последовательности задач для обновления операционной системы в следующих ситуациях.  

- Для использования единственной последовательности задач обновления, которая может работать с платформами x86 и x64. Включите два шага **Скачать содержимое пакета** в группу **Подготовка к обновлению**. Укажите условия на вкладке **Параметры**, чтобы определить архитектуру клиента и скачать только соответствующий пакет обновления ОС. Настройте каждый шаг **Скачать содержимое пакета** для использования одной переменной. Используйте эту переменную для пути к носителю на шаге **Обновить операционную систему**.  

- Для динамического скачивания применимого пакета драйверов используйте два шага загрузки **Скачать содержимое пакета** с условиями определения соответствующего типа оборудования для каждого пакета драйверов. Настройте каждый шаг **Скачать содержимое пакета** для использования одной переменной. Используйте эту переменную для значения **Промежуточное содержимое** в разделе драйверов в шаге **Обновить операционную систему**.  

> [!NOTE]  
> При развертывании последовательности задач, которая содержит этот шаг, не выбирайте значение **Загрузить все содержимое локально перед выполнением последовательности задач** или **Доступ к содержимому непосредственно из точки распространения** для **параметров развертывания** на странице **Точки распространения** мастера развертывания программного обеспечения.  

Этот шаг выполняется в полной версии операционной системы и в Windows PE. Но команда сохранения пакета в кэше клиента Configuration Manager не поддерживается для Windows PE.

> [!NOTE]  
> Задача **Скачать содержимое пакета** не поддерживается для использования с автономным носителем. Дополнительные сведения см. в разделе [Неподдерживаемые действия для автономных носителей](../deploy-use/create-stand-alone-media.md#unsupported-actions-for-stand-alone-media).  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Программное обеспечение** и **Скачать содержимое пакета**.

### <a name="cmdlets-for-download-package-content"></a>Командлеты для скачивания содержимого пакета

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepDownloadPackageContent](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepDownloadPackageContent?view=sccm-ps)
- [New-CMTSStepDownloadPackageContent](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepDownloadPackageContent?view=sccm-ps)
- [Remove-CMTSStepDownloadPackageContent](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepDownloadPackageContent?view=sccm-ps)
- [Set-CMTSStepDownloadPackageContent](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepDownloadPackageContent?view=sccm-ps)

### <a name="properties-for-download-package-content"></a>Свойства для скачивания содержимого пакета

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="select-package"></a>Выбор пакета  

Щелкните значок, чтобы выбрать скачиваемый пакет. Выбрав один пакет, щелкните этот значок еще раз, чтобы выбрать другой пакет.  

#### <a name="place-into-the-following-location"></a>Поместить в следующее расположение

Для сохранения пакета выберите одно из следующих расположений:  

- **Рабочий папка последовательности задач**. Это расположение также называется кэшем последовательности задач.  

- **Кэш клиента Configuration Manager**. Используйте этот параметр для сохранения содержимого в кэше клиента. По умолчанию используется путь `%WinDir%\ccmcache`.  

- **Пользовательский путь**. Подсистема выполнения последовательности задач сначала скачивает пакет в рабочую папку последовательности задач. Затем она перемещает его в расположение по указанному пути. Подсистема добавляет к пути ИД пакета.  

#### <a name="save-path-as-a-variable"></a>Сохранить путь как переменную

Сохраните путь к пакету в пользовательскую переменную последовательности задач. Затем используйте эту переменную в другом шаге последовательности задач.

Configuration Manager добавляет к имени переменной числовой суффикс. Например, можно указать пользовательскую переменную `%MyContent%`. Это корневой элемент, в котором последовательность задач хранит все содержимое, настроенное для этого шага. Это содержимое может содержать несколько пакетов. При ссылке на эту переменную добавляйте числовой суффикс. Для первого пакета используется имя `%MyContent01%`. При ссылке на эту переменную в последующих шагах, таких как **Обновить операционную систему**, используйте имя вида `%MyContent02%` или `%MyContent03%`, где число обозначает порядковый номер пакета в списке для шага **Скачать содержимое пакета**.  

#### <a name="if-a-package-download-fails-continue-downloading-other-packages-in-the-list"></a>Если произойдет сбой при скачивании пакета, продолжить скачивать другие пакеты в списке

Если последовательности задач не удается скачать пакет, она начинает скачивать следующий пакет в списке.  

### <a name="note-1-use-of-boot-images-in-the-download-package-content-step"></a><a name="bkmk_note1"></a> Примечание 1. Использование образов загрузки на шаге скачивания содержимого пакета

*Применимо к версии 1910 и более поздним*<!-- SCCMDocs-pr #4202 -->

Если вы настраиваете [свойства последовательности задач](../deploy-use/manage-task-sequences-to-automate-tasks.md#bkmk_prop-advanced) для **использования образа загрузки**, добавлять образ загрузки к этому шагу не нужно. Добавляйте образ загрузки к этому шагу, только если образ не указан в свойствах последовательности задач.

#### <a name="example-use-case"></a>Пример варианта использования

- Отдельная последовательность задач для предварительного скачивания содержимого:
  - Нет связанного образа загрузки.
  - Выполняется только в полнофункциональной операционной системе и, скорее всего, без участия пользователя.
  - Используется несколько шагов **Скачать содержимое пакета** с условиями. В зависимости от конкретного языка и архитектуры содержимое скачивается в кэш клиента для подготовки последовательности задач развертывания ОС.
  - Существует только один экземпляр этой последовательности задач со всеми возможными параметрами содержимого.

- Несколько последовательностей задач развертывания ОС:
  - Обычная последовательность задач развертывания операционной системы.
  - Имеет образ загрузки, на который ссылаются его свойства.
  - Существует несколько экземпляров этой последовательности задач с разными образами загрузки, необходимыми для архитектуры и языка.

## <a name="enable-bitlocker"></a><a name="BKMK_EnableBitLocker"></a> Включить BitLocker

Используйте этот шаг, чтобы включить шифрование BitLocker по меньшей мере на двух разделах жесткого диска. Первый активный раздел содержит загрузочный код Windows. Другой раздел содержит операционную систему. Загрузочный раздел должен остаться незашифрованным.  

Используйте шаг **Предварительная инициализация BitLocker**, чтобы включить BitLocker на диске в Windows PE. Дополнительные сведения см. в разделе [Предварительная инициализация BitLocker](#BKMK_PreProvisionBitLocker).  

> [!NOTE]  
> Функция шифрования диска BitLocker обеспечивает низкоуровневое шифрование содержимого томов диска.  

Этот шаг выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Диски** и **Включить BitLocker**.

Если вы указываете **Только TPM**, **TPM и ключ запуска на USB** или **TPM и ПИН-код**, то, прежде чем можно будет запустить шаг **Включить BitLocker**, доверенный платформенный модуль (TPM) должен быть в следующем состоянии:  

- Включено  
- Активировано  
- Допускается владение  

Этот шаг завершает все оставшиеся операции инициализации доверенного платформенного модуля (TPM). Остальные шаги не требуют физического присутствия или перезагрузок. При необходимости шаг **Включить BitLocker** прозрачно выполняет следующие операции инициализации доверенного платформенного модуля (TPM):  

- создание пары ключей подтверждения;  
- создание значения авторизации владельца и передача его на хранение в схему Active Directory, которая должна быть расширена для поддержки этого значения;  
- смена владельца;  
- создание корневых ключей хранилища или их сброс, если они имеются, но несовместимы.  

Если требуется, чтобы последовательность задач дожидалась завершения процесса шифрования диска в шаге **Включить BitLocker**, выберите параметр **Ожидать**. Если параметр **Ожидать** не выбран, шифрование диска выполняется в фоновом режиме. Последовательность задач сразу же переходит к следующему шагу.  

Функцию BitLocker можно использовать для шифрования нескольких дисков в системе компьютера (как дисков операционной системы, так и дисков данных). Чтобы зашифровать диск данных, сначала зашифруйте диск операционной системы и завершите процесс шифрования. Это требование вызвано тем, что на диске операционной системы хранятся предохранители ключа для дисков с данными. Если шифрование диска операционной системы и дисков данных выполняется в одной последовательности задач, выберите параметр **Ожидать** для шага **Включить BitLocker**, который шифрует диск операционной системы.  

Если жесткий диск уже зашифрован, а шифрование BitLocker отключено, шаг **Включить BitLocker** повторно включает предохранители ключа и выполняется очень быстро. Повторное шифрование жесткого диска в этом случае не требуется.  

### <a name="variables-for-enable-bitlocker"></a>Переменные для включения BitLocker

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDBitLockerRecoveryPassword](task-sequence-variables.md#OSDBitLockerRecoveryPassword)  
- [OSDBitLockerStartupKey](task-sequence-variables.md#OSDBitLockerStartupKey)  

### <a name="cmdlets-for-enable-bitlocker"></a>Командлеты для включения BitLocker

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepEnableBitLocker?view=sccm-ps)
- [New-CMTSStepEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepEnableBitLocker?view=sccm-ps)
- [Remove-CMTSStepEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepEnableBitLocker?view=sccm-ps)
- [Set-CMTSStepEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepEnableBitLocker?view=sccm-ps)

### <a name="properties-for-enable-bitlocker"></a>Свойства для включения BitLocker

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="choose-the-drive-to-encrypt"></a>Выберите диск для шифрования

Выбор диска для шифрования. Чтобы зашифровать текущий диск операционной системы, выберите **Текущий диск с операционной системой**. Затем настройте один из следующих параметров управления ключами.  

- **Только TPM**. Выберите этот параметр, чтобы использовать только доверенный платформенный модуль (TPM).  

- **Ключ запуска на USB**. Выберите этот параметр, чтобы использовать ключ запуска, хранящийся на USB-устройстве флэш-памяти. При выборе этого параметра BitLocker блокирует обычный процесс загрузки, пока устройство USB, содержащее ключ запуска BitLocker, не будет подключено к компьютеру.  

- **TPM и ключ запуска на USB**. Выберите этот параметр, чтобы использовать TPM и ключ запуска, хранящийся на USB-устройстве флэш-памяти. При выборе этого параметра BitLocker блокирует обычный процесс загрузки, пока устройство USB, содержащее ключ запуска BitLocker, не будет подключено к компьютеру.  

- **Довер. платф. модуль и ПИН-код**. Выберите этот параметр, чтобы использовать доверенный платформенный модуль и персональный идентификационный номер (ПИН-код). При выборе этого параметра BitLocker блокирует обычный процесс загрузки, пока пользователь не предоставит ПИН-код.  

Чтобы выполнить шифрование конкретного диска данных (без файлов операционной системы), выберите **Другой диск**. Затем выберите из списка нужный диск.  

#### <a name="use-full-disk-encryption"></a>Использование полного шифрования диска

<!--SCCMDocs-pr issue 2671-->
По умолчанию этот шаг шифрует только занятое место на диске. Это поведение по умолчанию является рекомендуемым из-за его быстродействия и эффективности. Включите этот параметр, если организации требуется шифровать весь диск во время программы установки. Программа установки Windows ожидает завершения шифрования всего диска, которое занимает много времени, особенно на больших дисках.

> [!TIP]
> Начиная с версии 1910, можно создавать и развертывать политики управления BitLocker, использующие полное шифрование *диска*. Включите этот параметр, чтобы управлять BitLocker на устройствах после развертывания операционной системы в рамках последовательности задач. Дополнительные сведения см. в статье [Планирование управления BitLocker](../../protect/plan-design/bitlocker-management.md).

#### <a name="choose-where-to-create-the-recovery-key"></a>Выбор места для создания ключа восстановления

Чтобы BitLocker создал пароль восстановления и передал его на хранение в Active Directory, выберите вариант **В Active Directory**. Для использования этого параметра нужно расширить схему Active Directory для доверительного хранения ключа BitLocker. После этого BitLocker сможет сохранить связанные данные восстановления в Active Directory. Выберите **Не создавать ключ восстановления**, чтобы не создавать пароль. Мы рекомендуем создавать пароль.  

#### <a name="wait-for-bitlocker-to-complete-the-drive-encryption-process-on-all-drives-before-continuing-task-sequence-execution"></a>Прежде чем продолжить выполнение последовательности задач, дождаться, пока BitLocker зашифрует все диски

Выберите этот параметр, чтобы функция шифрования диска BitLocker могла завершить работу, прежде чем будет запущен следующий шаг последовательности задач. Если выбран этот параметр, пользователь не сможет войти в систему, пока BitLocker не завершит шифрование всего тома диска.  

Процесс шифрования может занять несколько часов в зависимости от размера шифруемого диска. Если не выбрать этот параметр, выполнение последовательности задач продолжается без задержек.  



## <a name="format-and-partition-disk"></a><a name="BKMK_FormatandPartitionDisk"></a> Отформатировать диск и создать разделы

Используйте этот шаг для форматирования указанного диска конечного компьютера и создания на нем разделов.  

> [!IMPORTANT]  
> Параметры этого шага применяются только к одному указанному диску. Чтобы отформатировать и разбить на разделы другой диск на конечном компьютере, добавьте в последовательность задач дополнительный шаг **Отформатировать диск и создать разделы**.  

Этот шаг выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Диски** и **Отформатировать диск и создать разделы**.

### <a name="variables-for-format-and-partition-disk"></a>Переменные для форматирования диска и создания разделов

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDDiskIndex](task-sequence-variables.md#OSDDiskIndex)  
- [OSDGPTBootDisk](task-sequence-variables.md#OSDGPTBootDisk)  
- [OSDPartitions](task-sequence-variables.md#OSDPartitions)  
- [OSDPartitionStyle](task-sequence-variables.md#OSDPartitionStyle)  

### <a name="cmdlets-for-format-and-partition-disk"></a>Командлеты для форматирования диска и создания разделов

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepPartitionDisk](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtssteppartitiondisk?view=sccm-ps);
- [New-CMTSStepPartitionDisk](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtssteppartitiondisk?view=sccm-ps);
- [Remove-CMTSStepPartitionDisk](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtssteppartitiondisk?view=sccm-ps);
- [Set-CMTSStepPartitionDisk](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtssteppartitiondisk?view=sccm-ps).

### <a name="properties-for-format-and-partition-disk"></a>Свойства для форматирования диска и создания разделов

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="disk-number"></a>Номер диска

Номер форматируемого физического диска. Номер определяется порядком перечисления дисков Windows.  

#### <a name="disk-type"></a>Тип диска

Тип диска для форматирования. В раскрывающемся списке можно выбрать один из двух вариантов:

- **Standard (MBR)** (Стандартный MBR): основная загрузочная запись (MBR).  
- **GPT**: таблица разделов GUID.  

> [!NOTE]  
> Если вы изменяете тип диска со **Стандартный (MBR)** на **GPT** и разметка разделов содержит дополнительный раздел, последовательность задач удаляет все дополнительные и логические разделы из разметки. При изменении типа диска редактор последовательности задач выводит запрос на подтверждение.  

#### <a name="volume"></a>Том

Определенные сведения о разделе или томе, создаваемом последовательностью задач, включая следующие атрибуты:  

- Имя  
- Осталось места на диске  

Чтобы создать новый раздел, нажмите кнопку **Создать**, которая открывает диалоговое окно **Свойства раздела**. Укажите тип и размер раздела, а также является ли он загрузочным. Чтобы изменить существующий раздел, выберите его и нажмите кнопку **Свойства**. Дополнительные сведения о настройке разделов жесткого диска см. в одной из следующих статей:  

- [UEFI/GPT-based hard drive partitions](https://docs.microsoft.com/windows-hardware/manufacture/desktop/configure-uefigpt-based-hard-drive-partitions) (Разделы жесткого диска в системе, использующей UEFI и GPT)  
- [BIOS/MBR-based hard drive partitions](https://docs.microsoft.com/windows-hardware/manufacture/desktop/configure-biosmbr-based-hard-drive-partitions) (Разделы жесткого диска в системе, использующей UEFI и GPT)  

Чтобы удалить раздел, выберите его и нажмите кнопку **Удалить**.  



## <a name="install-application"></a><a name="BKMK_InstallApplication"></a> Установить приложение

Этот шаг устанавливает указанные приложения или набор приложений, указанный в динамическом списке переменных последовательности задач. Когда последовательность задач выполняет этот шаг, установка приложения начинается немедленно, не дожидаясь завершения интервала опроса политики.  

Приложение должно удовлетворять следующим критериям:  

- тип развертывания **установщик Windows** или **установщик скриптов**. Тип развертывания "Пакет приложений Windows (APPX-файл)" не поддерживается.  

- выполняться в контексте учетной записи Local System, а не учетной записи пользователя;  

- Приложения не должны взаимодействовать с рабочим столом. Программа должна запускаться без вмешательства пользователя или в автоматическом режиме.  

- Оно не должно запускать перезагрузку. Для запроса перезагрузки приложение должно использовать стандартный код перезагрузки 3010. Такое поведение гарантирует, что этот шаг правильно выполнит перезагрузку. Если приложение возвращает код выхода 3010, подсистема обработки последовательности задач перезагружает компьютер. После перезагрузки выполнение последовательности задач продолжается автоматически.  

> [!Note]
> Если приложение [проверяет выполнение исполняемых файлов](../../apps/deploy-use/deploy-applications.md#bkmk_exe-check), последовательность задач не сможет выполнить установку. Если не настроить этот шаг таким образом, чтобы выполнение продолжилось в случае ошибки, это приведет к сбою всей последовательности задач.

При запуске этого шага приложение проверяет возможность применения правил требований и метода обнаружения для типов развертывания. На основе результатов этой проверки приложение устанавливает соответствующий тип развертывания. Если тип развертывания содержит зависимости, зависимый тип развертывания оценивается и устанавливается в ходе выполнения этого шага. Зависимости приложения не поддерживаются для автономных носителей.  

> [!NOTE]  
> Для установки приложения, которое заменяет другое приложение, файлы содержимого для заменяемого приложения должны быть доступны. Иначе этот шаг последовательности задач завершается сбоем. Например, на клиенте или в записанном образе установлен Microsoft Visio 2010. Когда шаг **Установка приложения** устанавливает Microsoft Visio 2013, файлы содержимого для Microsoft Visio 2010 (заменяемого приложения) должны быть доступны в точке распространения. Если продукт Microsoft Visio не установлен на клиенте или в записанном образе, последовательность задач устанавливает Microsoft Visio 2013, не проверяя файлы содержимого Microsoft Visio 2010.  
>
> Если поддержка заменяемого приложения прекращена, а последовательность задач ссылается на новое приложение, эта последовательность не запустится.
Такое поведение реализовано намерено: для последовательности задач должны быть доступны все ссылки на приложение.<!-- SCCMDocs 1711 -->  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Программное обеспечение** и **Установить приложение**.

### <a name="variables-for-install-application"></a>Переменные для установки приложения

Используйте для этого шага следующие переменные последовательности задач:  

- [_TSAppInstallStatus](task-sequence-variables.md#TSAppInstallStatus)  
- [SMSTSMPListRequestTimeoutEnabled](task-sequence-variables.md#SMSTSMPListRequestTimeoutEnabled)  
- [SMSTSMPListRequestTimeout](task-sequence-variables.md#SMSTSMPListRequestTimeout)  
- [TSErrorOnWarning](task-sequence-variables.md#TSErrorOnWarning)  

> [!NOTE]  
> Если клиенту не удается получить список точек управления из служб обнаружения расположения, используйте переменные последовательности задач **SMSTSMPListRequestTimeoutEnabled** и **SMSTSMPListRequestTimeout**. Эти переменные задают время ожидания в миллисекундах, которое последовательность задач применяет перед повторной попыткой установки приложения. Дополнительные сведения см. в описании [переменных последовательности задач](task-sequence-variables.md).

### <a name="cmdlets-for-install-application"></a>Командлеты для установки приложения

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepInstallApplication](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepinstallapplication?view=sccm-ps);
- [New-CMTSStepInstallApplication](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepinstallapplication?view=sccm-ps);
- [Remove-CMTSStepInstallApplication](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepinstallapplication?view=sccm-ps);
- [Set-CMTSStepInstallApplication](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepinstallapplication?view=sccm-ps).

### <a name="properties-for-install-application"></a>Свойства для установки приложения

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="install-the-following-applications"></a>Установить следующие приложения

Последовательность задач устанавливает эти приложения в указанном порядке.  

Configuration Manager отфильтровывает все отключенные приложения или приложения со следующими параметрами:  

- Только после входа пользователя  
- Выполнение с правами пользователя  

Эти приложения не отображаются в диалоговом окне **Выбор приложения для установки**.

#### <a name="install-applications-according-to-dynamic-variable-list"></a>Установить приложения в соответствии со списком динамических переменных

Последовательность задач устанавливает приложения, используя базовое имя этой переменной. Это базовое имя переменной предназначено для набора переменных последовательности задач, определенного для коллекции или компьютера. Эти переменные указывают приложения, которые последовательность задач устанавливает для данной коллекции или данного компьютера. Имя переменной состоит из общего базового имени и числового суффикса, начинающегося с 01. Значение каждой переменной должно содержать имя приложения и ничего более.  

Для установки приложений с помощью последовательности задач с использованием динамического списка переменных включите следующий параметр на вкладке **Общие** **свойств** приложения: **разрешить установку этого приложения из действия последовательности задач "Установка приложения" вместо развертывания вручную**.  

> [!NOTE]  
> Установка приложений с помощью динамического списка переменных не поддерживается для развертываний с автономного носителя.  

Например, чтобы установить отдельное приложение, используя переменную последовательности задач AA01, необходимо указать следующую переменную:  

|Имя переменной|Значение переменной|  
|-------------------|--------------------|  
|AA01|Microsoft Office|  

Чтобы установить два приложения, укажите следующие переменные:  

|Имя переменной|Значение переменной|  
|-------------------|--------------------|  
|AA01|Microsoft Lync|  
|AA02|Microsoft Office|  

На приложения, установленные последовательностью задач, распространяются следующие условия:  

- Если значение переменной содержит любые данные кроме имени приложения, приложение не устанавливается и продолжается выполнение последовательности задач.  

- Если последовательности задач не удается найти переменную с указанным базовым именем и суффиксом "01", никакие приложения не устанавливаются.  

> [!Important]  
> В этих значениях учитывается регистр. Например, install отличается от Install. Если нужно изменить значение, редактор последовательности задач не обнаруживает изменения регистра. Нужно одновременно внести другую правку, например изменить описание шага.<!--509714-->

#### <a name="if-an-application-fails-continue-installing-other-applications-in-the-list"></a>В случае сбоя установки одного из приложений продолжить установку других приложений в списке

Этот параметр указывает, что выполнение шага должно продолжаться, даже если происходит сбой установки отдельного приложения. Если указан этот параметр, последовательность задач продолжит выполнение вне зависимости от наличия ошибок установки. Если этот параметр не указан и установка завершается сбоем, шаг немедленно завершается.  

#### <a name="clear-application-content-from-cache-after-installing"></a>Удаление содержимого приложения из кэша после установки

<!--4485675-->
В версии 1906 и выше нужно удалить содержимое приложения из кэша клиента после выполнения шага. Такое поведение полезно на устройствах с небольшим объемом жестких дисков или при последовательной установке большого количества больших приложений.


### <a name="options-for-install-application"></a>Параметры для установки приложения

> [!NOTE]  
> Если на вкладке **Параметры** этого шага выбран параметр **Продолжить при ошибке**, то последовательность задач продолжается после сбоя установки приложения. Если этот параметр не включен, то последовательность задач завершается со сбоем и не устанавливает остальные приложения.  

Кроме параметров по умолчанию, на вкладке **Параметры** этого шага последовательности задач можно настроить следующие дополнительные параметры:  

#### <a name="retry-this-step-if-computer-unexpectedly-restarts"></a>Повторите этот шаг при неожиданной перезагрузке компьютера

Если одна из установок приложения неожиданно перезагружает компьютер, повторите этот шаг. По умолчанию шаг включает этот параметр с двумя повторными попытками. Можно указать от одной до пяти попыток.  



## <a name="install-package"></a><a name="BKMK_InstallPackage"></a> Установить пакет

Используйте этот шаг, чтобы установить пакет программного обеспечения в рамках последовательности задач. При выполнении этого шага установка начинается немедленно, не ожидая завершения интервала опроса политики.  

Пакет должен удовлетворять следующим критериям:  

- выполняться в контексте учетной записи Local System, а не учетной записи пользователя;  

- не взаимодействовать с рабочим столом; Программа должна запускаться без вмешательства пользователя или в автоматическом режиме.  

- Оно не должно запускать перезагрузку. Программное обеспечение должно запрашивать перезагрузку, используя стандартный код перезагрузки 3010. Такое поведение гарантирует, что последовательность задач правильно выполнит перезагрузку. Если программное обеспечение возвращает код выхода 3010, подсистема обработки последовательности задач перезагружает компьютер. После перезагрузки выполнение последовательности задач продолжается автоматически.  

Программы, которые используют параметр **Запустить сначала другую программу** для установки зависимых программ, не поддерживаются при развертывании ОС. Если включен параметр **Запустить сначала другую программу** и зависимая программа уже запущена на конечном компьютере, она запускается и продолжается выполнение последовательности задач. Однако если зависимая программа еще не запущена на конечном компьютере, происходит сбой последовательности задач.  

> [!NOTE]  
> Сайт центра администрирования не имеет политики конфигурации клиентов, необходимые для включения агента распространения программного обеспечения при выполнении последовательности задач. Если при создании автономного носителя для последовательности задач на сайте центра администрирования последовательность задач включает шаг **Установить пакет** , в файле журнала CreateTsMedia.log может появиться следующее сообщение об ошибке:  
>
> `"WMI method SMS_TaskSequencePackage.GetClientConfigPolicies failed (0x80041001)"`  
>
> Для автономного носителя, включающего шаг **Установить пакет**, создайте автономный носитель на первичном сайте с включенным агентом распространения ПО. Можно также добавить шаг **Выполнить из командной строки** после шага **Настройка Windows и Configuration Manager** и перед первым шагом **Установить пакет**. Шаг **Выполнить из командной строки** выполняет команду WMIC, чтобы включить агент распространения ПО до первого шага **Установить пакет**. Используйте следующую команду в шаге **Выполнить из командной строки**:  
>
> `WMIC /namespace:\\\root\ccm\policy\machine\requestedconfig path ccm_SoftwareDistributionClientConfig CREATE ComponentName="Enable SWDist", Enabled="true", LockSettings="TRUE", PolicySource="local", PolicyVersion="1.0", SiteSettingsKey="1" /NOINTERACTIVE`  
>
> Дополнительные сведения о создании автономного носителя см. в разделе [Создание автономного носителя](../deploy-use/create-stand-alone-media.md).  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Программное обеспечение** и **Установить пакет**.

### <a name="variables-for-install-package"></a>Переменные для установки пакета

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDDoNotLogCommand](task-sequence-variables.md#OSDDoNotLogCommand) <!--1358493-->  

### <a name="cmdlets-for-install-package"></a>Командлеты для установки пакета

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepInstallSoftware](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepinstallsoftware?view=sccm-ps);
- [New-CMTSStepInstallSoftware](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepinstallsoftware?view=sccm-ps);
- [Remove-CMTSStepInstallSoftware](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepinstallsoftware?view=sccm-ps);
- [Set-CMTSStepInstallSoftware](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepinstallsoftware?view=sccm-ps).

> [!TIP]
> Используйте предварительное кэширование содержимого, чтобы скачать применимый пакет обновления ОС, прежде чем пользователь установит последовательность задач. Дополнительные сведения см. в разделе [Настройка предварительного кэширования содержимого](../deploy-use/configure-precache-content.md).

### <a name="properties-for-install-package"></a>Свойства для установки пакета

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="install-a-single-software-package"></a>Установить один пакет программного обеспечения

Этот параметр указывает пакет программного обеспечения Configuration Manager. Выполнение шага продолжается после завершения установки.  

#### <a name="install-software-packages-according-to-dynamic-variable-list"></a>Установить пакеты программного обеспечения в соответствии со списком динамических переменных

Последовательность задач устанавливает пакеты, используя базовое имя этой переменной. Это базовое имя переменной предназначено для набора переменных последовательности задач, определенного для коллекции или компьютера. Эти переменные указывают пакеты, которые последовательность задач устанавливает для данной коллекции или данного компьютера. Имя переменной состоит из общего базового имени и числового суффикса, начинающегося с 001. Значение каждой переменной должно содержать идентификатор пакета и имя программы, разделенные двоеточием.  

Для установки программного обеспечения с помощью последовательности задач с использованием динамического списка переменных включите следующий параметр на вкладке **Дополнительно** **Свойств** приложения: **Allow this application to be installed from the Install Application task sequence action instead of deploying manually** (Разрешить установку этой программы из последовательности задач "Установка пакета" без развертывания).  

> [!NOTE]  
> Установка программного обеспечения с помощью динамического списка переменных не поддерживается для развертываний с автономного носителя.  

Например, чтобы установить отдельный программный пакет, используя переменную последовательности задач AA001, необходимо указать следующую переменную:  

|Имя переменной|Значение переменной|  
|-------------------|--------------------|  
|AA001|CEN00054:Install|  

Чтобы установить три пакета программного обеспечения, необходимо указать следующие переменные:  

|Имя переменной|Значение переменной|  
|-------------------|--------------------|  
|AA001|CEN00054:Install|  
|AA002|CEN00107:Install Silent|  
|AA003|CEN00031:Install|  

На пакеты, установленные последовательностью задач, распространяются следующие условия:  

- Если значение переменной создано в неправильном формате или не указывает допустимый идентификатор и имя пакета, установка ПО завершается ошибкой.  

- Если идентификатор пакета содержит символы нижнего регистра, установка ПО завершается ошибкой.  

- Если последовательности задач не удается найти переменную с указанным базовым именем и суффиксом "001", никакие пакеты не устанавливаются. Последовательность задач продолжает выполняться.  

> [!Important]  
> В этих значениях учитывается регистр. Например, install отличается от Install. Если нужно изменить значение, редактор последовательности задач не обнаруживает изменения регистра. Нужно одновременно внести другую правку, например изменить описание шага.<!--509714-->

#### <a name="if-installation-of-a-software-package-fails-continue-installing-other-packages-in-the-list"></a>Если не удастся установить программный пакет, продолжить установку других пакетов в списке

Этот параметр указывает, что шаг продолжает работу, если установка отдельного пакета ПО завершается ошибкой. Если указан этот параметр, последовательность задач продолжит выполнение вне зависимости от наличия ошибок установки. Если этот параметр не указан и установка завершается сбоем, шаг немедленно завершается.  



## <a name="install-software-updates"></a><a name="BKMK_InstallSoftwareUpdates"></a> Установить обновления программного обеспечения

Используйте этот шаг, чтобы установить обновления ПО на конечный компьютер. На конечном компьютере не проверяется на наличие применимых обновлений программного обеспечения, пока не будет запущен этот шаг последовательности задач. В это время конечный компьютер оценивается на наличие обновлений ПО, как и любой другой клиент Configuration Manager. Чтобы этот шаг установил обновления программного обеспечения, заранее разверните их в коллекции, членом которой является целевой компьютер.  

> [!IMPORTANT]  
> Для оптимальной производительности установите последнюю версию агента обновления Windows.  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Программное обеспечение** и **Установить обновления программного обеспечения**.

### <a name="variables-for-install-software-updates"></a>Переменные для установки обновлений программного обеспечения

Используйте для этого шага следующие переменные последовательности задач:  

- [SMSInstallUpdateTarget](task-sequence-variables.md#SMSInstallUpdateTarget)  
- [SMSTSMPListRequestTimeoutEnabled](task-sequence-variables.md#SMSTSMPListRequestTimeoutEnabled)  
- [SMSTSMPListRequestTimeout](task-sequence-variables.md#SMSTSMPListRequestTimeout)  
- [SMSTSSoftwareUpdateScanTimeout](task-sequence-variables.md#SMSTSSoftwareUpdateScanTimeout)  
- [SMSTSWaitForSecondReboot](task-sequence-variables.md#SMSTSWaitForSecondReboot)  

> [!NOTE]  
> Если клиенту не удается получить список точек управления из служб обнаружения расположения, используйте переменные **SMSTSMPListRequestTimeoutEnabled** и **SMSTSMPListRequestTimeout**. Эти переменные задают время ожидания в миллисекундах, которое последовательность задач применяет перед повторной попыткой установки приложения или обновления программного обеспечения. Дополнительные сведения см. в описании [переменных последовательности задач](task-sequence-variables.md).  

### <a name="cmdlets-for-install-software-updates"></a>Командлеты для установки обновлений программного обеспечения

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepInstallUpdate](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepinstallupdate?view=sccm-ps);
- [New-CMTSStepInstallUpdate](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepinstallupdate?view=sccm-ps);
- [Remove-CMTSStepInstallUpdate](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepinstallupdate?view=sccm-ps);
- [Set-CMTSStepInstallUpdate](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepinstallupdate?view=sccm-ps).

Дополнительные рекомендации и техническая диаграмма потока для этого шага см. в руководстве по [установке обновлений программного обеспечения](install-software-updates.md).

### <a name="properties-for-install-software-updates"></a>Свойства для установки обновлений программного обеспечения

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="required-for-installation---mandatory-software-updates-only"></a>Требуется для установки — только обязательные обновления программного обеспечения

Выберите этот параметр, чтобы установить все обязательные обновления программного обеспечения в сроки, определенные администратором.  

#### <a name="available-for-installation---all-software-updates"></a>Доступно для установки — все обновления программного обеспечения

Выберите этот параметр, чтобы установить все доступные обновления программного обеспечения. Заранее разверните эти обновления в коллекции, членом которой является этот компьютер. Последовательность задач устанавливает все доступные обновления программного обеспечения на конечных компьютерах.  

#### <a name="evaluate-software-updates-from-cached-scan-results"></a>Оценка обновлений программного обеспечения на основе кэшированных результатов проверки

По умолчанию этот шаг использует кэшированные результаты проверки, выполненной агентом обновления Windows. Снимите этот флажок, чтобы агент обновления Windows всегда скачивал последнюю версию каталога с точки обновления программного обеспечения. Выберите этот параметр, если используете последовательность задач для [записи и сборки образа операционной системы](../deploy-use/create-a-task-sequence-to-capture-an-operating-system.md). В этом сценарии ожидается большое количество обновлений программного обеспечения.

Многие из них имеют зависимости. Например, потребуется установить обновление ABC, чтобы обновление XYZ появилось в списке применимых. Если снять этот флажок и начать развертывание последовательности задач на большом числе клиентов, все они одновременно подключатся к точке обновления программного обеспечения. Это может привести к проблемам с производительностью во время скачивания и обновления каталога.

В большинстве случаев следует сохранить значение по умолчанию, разрешающее кэшировать результаты проверки.

Переменная **SMSTSSoftwareUpdateScanTimeout** управляет временем ожидания для проверки обновлений программного обеспечения на этом шаге. Значение по умолчанию — 60 минут. Дополнительные сведения см. в описании [переменных последовательности задач](task-sequence-variables.md#SMSTSSoftwareUpdateScanTimeout).

### <a name="options-for-install-software-updates"></a>Параметры для установки обновлений программного обеспечения

Кроме параметров по умолчанию, на вкладке **Параметры** этого шага последовательности задач можно настроить следующие дополнительные параметры:  

#### <a name="retry-this-step-if-computer-unexpectedly-restarts"></a>Повторите этот шаг при неожиданной перезагрузке компьютера

Если одно из обновлений неожиданно перезагружает компьютер, повторите этот шаг. По умолчанию шаг включает этот параметр с двумя повторными попытками. Можно указать от одной до пяти попыток.  

> [!NOTE]  
> Настройте переменную **SMSTSWaitForSecondReboot**, чтобы указать продолжительность (в секундах) приостановки последовательности задач после перезагрузки компьютера в описанной ситуации. Дополнительные сведения см. в описании [переменных последовательности задач](task-sequence-variables.md#SMSTSWaitForSecondReboot).  



## <a name="join-domain-or-workgroup"></a><a name="BKMK_JoinDomainorWorkgroup"></a> Присоединить к домену или рабочей группе

Используйте этот шаг, чтобы добавить конечный компьютер в рабочую группу или домен.  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Присоединить к домену или рабочей группе**.

### <a name="variables-for-join-domain-or-workgroup"></a>Переменные для присоединения к домену или рабочей группе

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDJoinAccount](task-sequence-variables.md#OSDJoinAccount)  
- [OSDJoinDomainName](task-sequence-variables.md#OSDJoinDomainName)  
- [OSDJoinDomainOUName](task-sequence-variables.md#OSDJoinDomainOUName)  
- [OSDJoinPassword](task-sequence-variables.md#OSDJoinPassword)  
- [OSDJoinSkipReboot](task-sequence-variables.md#OSDJoinSkipReboot)  
- [OSDJoinType](task-sequence-variables.md#OSDJoinType)  
- [OSDJoinWorkgroupName](task-sequence-variables.md#OSDJoinWorkgroupName)  

### <a name="cmdlets-for-join-domain-or-workgroup"></a>Командлеты для присоединения к домену или рабочей группе

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepJoinDomainWorkgroup](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepJoinDomainWorkgroup?view=sccm-ps)
- [New-CMTSStepJoinDomainWorkgroup](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepJoinDomainWorkgroup?view=sccm-ps)
- [Remove-CMTSStepJoinDomainWorkgroup](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepJoinDomainWorkgroup?view=sccm-ps)
- [Set-CMTSStepJoinDomainWorkgroup](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepJoinDomainWorkgroup?view=sccm-ps)

### <a name="properties-for-join-domain-or-workgroup"></a>Свойства для присоединения к домену или рабочей группе

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="join-a-workgroup"></a>Присоединить к рабочей группе

Выберите этот параметр, чтобы присоединить конечный компьютер к указанной рабочей группе. Если сейчас компьютер является членом домена, выбор этого параметра приводит к перезагрузке компьютера.  

#### <a name="join-a-domain"></a>Присоединить к домену

Выберите этот параметр, чтобы присоединить конечный компьютер к указанному домену.  

Дополнительно введите или найдите подразделение в заданном домене, к которому требуется присоединить компьютер. Если сейчас компьютер является членом другого домена или рабочей группы, выбор этого параметра приводит к перезагрузке компьютера. Если компьютер уже является членом другого подразделения, программа установки Windows игнорирует этот параметр, поскольку доменные службы Active Directory не позволяют изменять подразделение описанным методом.  

#### <a name="enter-the-account-which-has-permission-to-join-the-domain"></a>Укажите учетную запись, которая имеет разрешение на присоединение к домену.

Нажмите кнопку **Задать**, чтобы указать имя пользователя и пароль для учетной записи, имеющей разрешения на присоединение к домену. Введите учетную запись в таком формате: `Domain\account`. Дополнительные сведения об учетной записи для присоединения к домену см. в разделе [Accounts](../../core/plan-design/hierarchy/accounts.md#task-sequence-domain-join-account) (Учетные записи).  



## <a name="prepare-configmgr-client-for-capture"></a><a name="BKMK_PrepareConfigMgrClientforCapture"></a> Подготовка клиента Configuration Manager перед снятием образа

Используйте этот шаг,чтобы удалить или настроить клиент Configuration Manager на компьютере-образце. Это действие подготавливает компьютер к записи в рамках процесса создания образа.

Этот шаг полностью удаляет клиент Configuration Manager, а не только основные сведения. Когда последовательность задач развертывает записанный образ операционной системы, она каждый раз устанавливает новый клиент Configuration Manager.  

> [!Note]  
> Подсистема последовательности задач удаляет клиент только во время последовательности задач **Создать и сохранить мастер-образ операционной системы**. При других методах записи, таких как носитель для снятия образа или настраиваемая последовательность задач, клиент не удаляется.  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Подготовка клиента Configuration Manager перед снятием образа**.

### <a name="cmdlets-for-prepare-configmgr-client-for-capture"></a>Командлеты для подготовки клиента Configuration Manager перед снятием образа

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepPrepareConfigMgrClient](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepPrepareConfigMgrClient?view=sccm-ps)
- [New-CMTSStepPrepareConfigMgrClient](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepPrepareConfigMgrClient?view=sccm-ps)
- [Remove-CMTSStepPrepareConfigMgrClient](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepPrepareConfigMgrClient?view=sccm-ps)
- [Set-CMTSStepPrepareConfigMgrClient](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepPrepareConfigMgrClient?view=sccm-ps)



## <a name="prepare-windows-for-capture"></a><a name="BKMK_PrepareWindowsforCapture"></a> Подготовка Windows перед снятием образа

Используйте этот шаг, чтобы указать параметры программы Sysprep для записи образа операционной системы на компьютере-образце. Этот шаг выполняет Sysprep и перезагружает компьютер в загрузочный образ Windows PE, указанный в параметрах последовательности задач. Это действие завершается со сбоем, если компьютер-образец присоединен к домену.  

Этот шаг выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Подготовка Windows перед снятием образа**.

### <a name="variables-for-prepare-windows-for-capture"></a>Переменные для подготовки Windows перед снятием образа

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDKeepActivation](task-sequence-variables.md#OSDKeepActivation)  
- [OSDTargetSystemRoot](task-sequence-variables.md#OSDTargetSystemRoot-output)  

### <a name="cmdlets-for-prepare-windows-for-capture"></a>Командлеты для подготовки Windows перед снятием образа

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepPrepareWindows](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepPrepareWindows?view=sccm-ps)
- [New-CMTSStepPrepareWindows](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepPrepareWindows?view=sccm-ps)
- [Remove-CMTSStepPrepareWindows](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepPrepareWindows?view=sccm-ps)
- [Set-CMTSStepPrepareWindows](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepPrepareWindows?view=sccm-ps)

### <a name="properties-for-prepare-windows-for-capture"></a>Свойства для подготовки Windows перед снятием образа

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="automatically-build-mass-storage-driver-list"></a>Автоматически создавать список драйверов запоминающих устройств

Выберите этот параметр, чтобы программа Sysprep автоматически создавала список драйверов запоминающих устройств на компьютере-образце. Этот параметр включает параметр Build Mass Storage Drivers (добавить драйверы запоминающих устройств) в файле sysprep.inf на компьютере-образце. Дополнительные сведения об этом параметре см. в документации к программе Sysprep.  

#### <a name="do-not-reset-activation-flag"></a>Не сбрасывать флаг активации

Выберите этот параметр, чтобы запретить программе Sysprep сброс флага активации продукта.  

#### <a name="shutdown-the-computer-after-running-this-action"></a>Выключить компьютер после выполнения этого действия

<!--SCCMDocs-pr issue 2695-->
Программа Sysprep при наличии этого параметра завершает работу компьютера, а не перезапускает его.

Последовательность задач [Windows Autopilot для существующих устройств](../deploy-use/windows-autopilot-for-existing-devices.md) использует этот шаг с этим параметром.

- Если требуется, чтобы последовательность задач обновляла устройство, а затем немедленно запускала OOBE для Autopilot, оставьте этот параметр отключенным.  

- Чтобы завершить работу устройства после создания образа, включите этот параметр. Затем можно передать устройство пользователю, который запустит OOBE с помощью Autopilot при первом включении устройства.  



## <a name="pre-provision-bitlocker"></a><a name="BKMK_PreProvisionBitLocker"></a> Предварительная инициализация BitLocker

Используйте этот шаг, чтобы включить BitLocker на диске из среды предустановки Windows. По умолчанию шифруется только используемое дисковое пространство, благодаря чему шифрование выполняется гораздо быстрее. Чтобы применить параметры управления ключами, настройте шаг [Включить BitLocker](#BKMK_EnableBitLocker) после установки операционной системы.

> [!IMPORTANT]
> Для предварительной подготовки BitLocker требуется, чтобы на компьютере был установлен и включен поддерживаемый доверенный платформенный модуль (TPM).

Этот шаг выполняется только в среде предустановки Windows. Он не работает в полной операционной системе.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Диски** и **Предварительная инициализация BitLocker**.

### <a name="cmdlets-for-pre-provision-bitlocker"></a>Командлеты для предварительной инициализации BitLocker

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepOfflineEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepOfflineEnableBitLocker?view=sccm-ps)
- [New-CMTSStepOfflineEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepOfflineEnableBitLocker?view=sccm-ps)
- [Remove-CMTSStepOfflineEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepOfflineEnableBitLocker?view=sccm-ps)
- [Set-CMTSStepOfflineEnableBitLocker](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepOfflineEnableBitLocker?view=sccm-ps)

### <a name="properties-for-pre-provision-bitlocker"></a>Свойства для предварительной инициализации BitLocker

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="apply-bitlocker-to-the-specified-drive"></a>Применить BitLocker к указанному диску

Укажите диск, для которого хотите включить BitLocker. BitLocker шифрует только занятое место на диске.  

#### <a name="use-full-disk-encryption"></a>Использование полного шифрования диска

<!--SCCMDocs-pr issue 2671-->
По умолчанию этот шаг шифрует только занятое место на диске. Это поведение по умолчанию является рекомендуемым из-за его быстродействия и эффективности. Включите этот параметр, если организации требуется шифровать весь диск во время программы установки. Программа установки Windows ожидает завершения шифрования всего диска, которое занимает много времени, особенно на больших дисках.

#### <a name="skip-this-step-for-computers-that-do-not-have-a-tpm-or-when-tpm-is-not-enabled"></a>Пропустите этот шаг для компьютеров, на которых доверенный платформенный модуль отсутствует или не включен.

Выберите этот параметр, чтобы пропустить шифрование диска на компьютере без поддерживаемого и включенного доверенного платформенного модуля (TPM). Например, этот параметр полезен при развертывании операционной системы на виртуальной машине.  



## <a name="release-state-store"></a><a name="BKMK_ReleaseStateStore"></a> Освободить хранилище состояний

Используйте этот шаг, чтобы уведомить точку миграции состояния о том, что действие записи или восстановления выполнено. Используйте этот шаг совместно с шагами **Запросить хранилище состояний**, **Записать пользовательское состояние** и **Восстановить пользовательское состояние**. Используйте эти шаги для переноса данных пользовательской среды с помощью точки миграции состояния и средства миграции пользовательской среды (USMT).  

Дополнительные сведения об управлении состоянием пользователей при развертывании операционных систем см. в разделе [Управление пользовательской средой](../get-started/manage-user-state.md).  

Если вы используете шаг **Запросить хранилище состояний**, чтобы запросить доступ к точке миграции состояния для *сбора* данных о пользовательской среде, этот шаг уведомляет точку миграции состояния, что процесс сбора завершен. После этого точка миграции состояния помечает данные о состоянии пользовательской среды как доступные для восстановления. Точка миграции состояния задает разрешения на доступ к данным о пользовательской среде таким образом, что восстанавливаемый компьютер может получить доступ только для чтения.  

Если вы используете шаг **Запросить хранилище состояний**, чтобы запросить доступ к точке миграции состояния для *восстановления* пользовательской среды, этот шаг уведомляет точку миграции состояния, что процесс восстановления завершен. После этого точка миграции состояния активирует настроенные для него параметры хранения.  

> [!IMPORTANT]  
> Установите параметр **Продолжать при ошибке** для всех шагов между шагами **Запросить хранилище состояний** и **Освободить хранилище состояний**. Каждый шаг **Запросить хранилище состояний** должен иметь соответствующий шаг **Освободить хранилище состояний**.  

Этот шаг выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Пользовательское состояние** и **Освободить хранилище состояний**.

### <a name="variables-for-release-state-store"></a>Переменные для освобождения хранилища состояний

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDStateStorePath](task-sequence-variables.md#OSDStateStorePath)  

### <a name="cmdlets-for-release-state-store"></a>Командлеты для освобождения хранилища состояний

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepReleaseStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepReleaseStateStore?view=sccm-ps)
- [New-CMTSStepReleaseStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepReleaseStateStore?view=sccm-ps)
- [Remove-CMTSStepReleaseStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepReleaseStateStore?view=sccm-ps)
- [Set-CMTSStepReleaseStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepReleaseStateStore?view=sccm-ps)

### <a name="properties-for-release-state-store"></a>Свойства для освобождения хранилища состояний

Для этого шага не нужно настраивать параметры на вкладке **Свойства**.



## <a name="request-state-store"></a><a name="BKMK_RequestStateStore"></a> Запросить хранилище состояний

Используйте этот шаг, чтобы запросить доступ к точке миграции состояния во время записи или восстановления состояния.  

Дополнительные сведения об управлении состоянием пользователей при развертывании операционных систем см. в разделе [Управление пользовательской средой](../get-started/manage-user-state.md).  

Используйте этот шаг совместно с шагами **Освободить хранилище состояний**, **Записать пользовательское состояние** и **Восстановить пользовательское состояние**. Используйте эти шаги для переноса состояния компьютера с помощью точки миграции состояния и средства миграции пользовательской среды (USMT).  

> [!NOTE]  
> При создании точки миграции состояния хранилище пользовательских состояний может быть недоступным до одного часа. Чтобы оно быстрее стало доступным, настройте все параметры свойств на точке миграции состояния для запуска обновления файла управления сайта.  

Этот шаг выполняется в полной операционной системе и в среде Windows PE при автономном режиме средства миграции пользовательской среды.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Пользовательское состояние** и **Запросить хранилище состояний**.

### <a name="variables-for-request-state-store"></a>Переменные для запроса хранилища состояний

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDStateFallbackToNAA](task-sequence-variables.md#OSDStateFallbackToNAA)  
- [OSDStateSMPRetryCount](task-sequence-variables.md#OSDStateSMPRetryCount)  
- [OSDStateSMPRetryTime](task-sequence-variables.md#OSDStateSMPRetryTime)  
- [OSDStateStorePath](task-sequence-variables.md#OSDStateStorePath)  

### <a name="cmdlets-for-request-state-store"></a>Командлеты для запроса хранилища состояний

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepRequestStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepRequestStateStore?view=sccm-ps)
- [New-CMTSStepRequestStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepRequestStateStore?view=sccm-ps)
- [Remove-CMTSStepRequestStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepRequestStateStore?view=sccm-ps)
- [Set-CMTSStepRequestStateStore](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepRequestStateStore?view=sccm-ps)

### <a name="properties-for-request-state-store"></a>Свойства для запроса хранилища состояний

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="capture-state-from-the-computer"></a>Захват состояния компьютера

Позволяет найти точку миграции состояния, которая удовлетворяет минимальным требованиям, заданным в параметрах точки миграции состояния. Например, в параметрах **Максимальное число клиентов** и **Минимальный объем свободного места на дискеe**. Этот параметр не гарантирует наличие достаточного места во время миграции состояния. Выбор этого параметра потребует доступа к точке миграции состояния с целью сбора данных о состоянии и параметрах пользователя на компьютере.  

Если сайт Configuration Manager имеет несколько активных точек миграции состояния, этот шаг находит точку с доступным местом на диске. Последовательность задач запрашивает у точки управления список точек миграции состояния и затем оценивает каждую из них, пока не найдет удовлетворяющую минимальным требованиям.  

#### <a name="restore-state-from-another-computer"></a>Восстановление состояния с другого компьютера

Позволяет запросить доступ к точке миграции состояния для восстановления ранее записанного состояния и параметров пользователя на конечном компьютере.  

Если присутствует несколько точек миграции состояния, этот шаг находит ту из них, которая содержит состояние для конечного компьютера.  

#### <a name="number-of-retries"></a>Число повторных попыток

Число попыток, которое выполняет этот шаг для поиска подходящей точки миграции состояния перед тем, как выдать ошибку.  

#### <a name="retry-delay-in-seconds"></a>Пауза между попытками (в секундах)

Время в секундах, которое шаг последовательности задач ожидает между повторными попытками.  

#### <a name="if-computer-account-fails-to-connect-to-a-state-store-use-the-network-access-account"></a>Если учетной записи компьютера не удается подключиться к хранилищу состояний, использовать учетную запись сетевого доступа

Если последовательности задач не удается обратиться к точке миграции состояния с помощью учетной записи компьютера, она использует для подключения данные учетной записи сетевого доступа. Этот вариант является менее защищенным, так как другие компьютеры могут использовать учетную запись сетевого доступа для доступа к сохраненному состоянию. Однако он может оказаться единственно возможным, если конечный компьютер не присоединен к домену.  



## <a name="restart-computer"></a><a name="BKMK_RestartComputer"></a> Перезагрузить компьютер

Используйте этот шаг, чтобы перезагрузить компьютер, где выполняется последовательность задач. После перезагрузки компьютер автоматически переходит к следующему шагу последовательности задач.  

Этот шаг можно выполнять в полной версии операционной системы и в Windows PE.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Перезагрузить компьютер**.

### <a name="variables-for-restart-computer"></a>Переменные для перезагрузки компьютера

Используйте для этого шага следующие переменные последовательности задач:  

- [SMSRebootMessage](task-sequence-variables.md#SMSRebootMessage)  
- [SMSRebootTimeout](task-sequence-variables.md#SMSRebootTimeout)  

### <a name="cmdlets-for-restart-computer"></a>Командлеты для перезагрузки компьютера

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepReboot](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepreboot?view=sccm-ps);
- [New-CMTSStepReboot](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepreboot?view=sccm-ps);
- [Remove-CMTSStepReboot](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepreboot?view=sccm-ps);
- [Set-CMTSStepReboot](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepreboot?view=sccm-ps);

### <a name="properties-for-restart-computer"></a>Свойства для перезагрузки компьютера

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="the-boot-image-assigned-to-this-task-sequence"></a>Образ загрузки, назначенный данной последовательности задач

Выберите этот параметр для конечного компьютера, чтобы использовать образ загрузки, назначенный последовательности задач. Последовательность задач использует этот образ загрузки для выполнения следующих шагов в среде предустановки Windows.  

#### <a name="the-currently-installed-default-operating-system"></a>Установленная по умолчанию операционная система

Выберите этот вариант, чтобы перезагрузить конечный компьютера в установленную операционную систему.  

#### <a name="notify-the-user-before-restarting"></a>Уведомлять пользователя перед перезагрузкой

Выберите этот параметр, чтобы отображать уведомление пользователю перед перезагрузкой конечного компьютера. Шаг выбирает этот параметр по умолчанию.  

#### <a name="notification-message"></a>Сообщение уведомления

Введите сообщение уведомления, отображаемого пользователю перед перезагрузкой конечного компьютера.  

#### <a name="message-display-time-out"></a>Время ожидания при отображении сообщений

Укажите период в секундах, по истечении которого конечный компьютер перезагружается. Значение по умолчанию ― 60 секунд.  



## <a name="restore-user-state"></a><a name="BKMK_RestoreUserState"></a> Восстановить пользовательское состояние

Используйте этот шаг, чтобы запустить средство миграции пользовательской среды (USMT) для восстановления параметров и пользовательской среды на конечном компьютере. Этот шаг нужно использовать совместно с шагом **Записать пользовательское состояние**.  

Дополнительные сведения об управлении состоянием пользователей при развертывании операционных систем см. в разделе [Управление пользовательской средой](../get-started/manage-user-state.md).  

Если требуется сохранить или восстановить параметры состояния на точке миграции состояния, используйте этот шаг вместе с шагами **Запросить хранилище состояний** и **Освободить хранилище состояний**. Этот вариант всегда шифрует хранилище состояний USMT с помощью ключа шифрования, созданного и управляемого Configuration Manager.  

Шаг **Восстановить пользовательское состояние** позволяет управлять ограниченным набором наиболее широко используемых параметров USMT. Укажите дополнительные параметры командной строки с помощью переменной **OSDMigrateAdditionalRestoreOptions**.  

> [!IMPORTANT]  
> Если этот шаг используется для цели, не связанной с развертывания операционной системы, добавьте шаг [Перезагрузить компьютер](#BKMK_RestartComputer) сразу после шага **Восстановить пользовательское состояние**.  

Этот шаг выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Пользовательское состояние** и **Восстановить пользовательское состояние**.

### <a name="variables-for-restore-user-state"></a>Переменные для восстановления пользовательского состояния

Используйте для этого шага следующие переменные последовательности задач:  

- [_OSDMigrateUsmtRestorePackageID](task-sequence-variables.md#OSDMigrateUsmtRestorePackageID)  
- [OSDMigrateAdditionalRestoreOptions](task-sequence-variables.md#OSDMigrateAdditionalRestoreOptions)  
- [OSDMigrateContinueOnRestore](task-sequence-variables.md#OSDMigrateContinueOnRestore)  
- [OSDMigrateEnableVerboseLogging](task-sequence-variables.md#OSDMigrateEnableVerboseLogging)  
- [OSDMigrateLocalAccounts](task-sequence-variables.md#OSDMigrateLocalAccounts)  
- [OSDMigrateLocalAccountPassword](task-sequence-variables.md#OSDMigrateLocalAccountPassword)  
- [OSDStateStorePath](task-sequence-variables.md#OSDStateStorePath)  

### <a name="cmdlets-for-restore-user-state"></a>Командлеты для восстановления пользовательского состояния

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepRestoreUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepRestoreUserState?view=sccm-ps)
- [New-CMTSStepRestoreUserState](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepRestoreUserState?view=sccm-ps)
- [Remove-CMTSStepRestoreUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepRestoreUserState?view=sccm-ps)
- [Set-CMTSStepRestoreUserState](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepRestoreUserState?view=sccm-ps)

### <a name="properties-for-restore-user-state"></a>Свойства для восстановления пользовательского состояния

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="user-state-migration-tool-package"></a>Пакет средств миграции пользовательской среды

Укажите пакет с версией USMT, которую нужно использовать в этом шаге. Для этого пакета не требуется программа. При выполнении шага последовательность задач использует версию USMT в указанном пакете. Укажите пакет, содержащий 32- или 64-разрядную версию средства миграции пользовательской среды. Архитектура USMT зависит от архитектуры операционной системы, состояние которой восстанавливает последовательность задач.

#### <a name="restore-all-captured-user-profiles-with-standard-options"></a>Восстановление всех записанных профилей пользователей со стандартными параметрами

Восстановление записанных профилей пользователей со стандартными параметрами. Чтобы указать параметры, восстанавливаемые средством USMT, выберите **Настройка записи профиля пользователя**.  

#### <a name="customize-how-user-profiles-are-restored"></a>Настройка способа восстановления профилей пользователей

Позволяет указывать файлы, которые вы хотите восстановить на целевом компьютере. Щелкните **Файлы**, чтобы указать файлы конфигурации в пакете USMT, который будет использоваться для восстановления профилей пользователей. Чтобы добавить файл конфигурации, введите имя файла в поле **Имя файла** и щелкните **Добавить**. Область "Файлы" содержит файлы конфигурации, используемые USMT. Указанный XML-файл определяет, какой файл пользователя восстанавливает USMT.  

#### <a name="restore-local-computer-user-profiles"></a>Восстановить профили локальных пользователей компьютера

Позволяет восстановить профили локальных пользователей компьютера. Эти профили не предназначены для пользователей домена. Восстановленным локальным учетным записям пользователей нужно назначить новые пароли. Средство USMT не может перенести исходные пароли. Введите новый пароль в поле **Пароль** и подтвердите пароль в поле **Подтверждение пароля** .  

#### <a name="continue-if-some-files-cannot-be-restored"></a>Продолжить операцию при невозможности восстановления некоторых файлов

Позволяет продолжить восстановление состояния и параметров пользователей, даже если USMT не удается восстановить некоторые файлы. Шаг включает этот параметр по умолчанию. Если данный параметр отключен и USMT встречает ошибку при восстановлении файлов, этот шаг немедленно прекращается. USMT не восстанавливает все файлы.

#### <a name="enable-verbose-logging"></a>Включить подробное ведение журнала

Включите этот параметр, чтобы сформировать более подробные сведения о файле журнала. При восстановлении состояния последовательность задач по умолчанию создает журнал **Loadstate.log** в своей папке журналов `%WinDir%\ccm\logs`.  



## <a name="run-command-line"></a><a name="BKMK_RunCommandLine"></a> Выполнить из командной строки

Используйте этот шаг для запуска указанной командной строки.  

Этот шаг можно выполнять в полной версии операционной системы и в Windows PE.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Выполнить из командной строки**.

### <a name="variables-for-run-command-line"></a>Переменные для выполнения из командной строки

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDDoNotLogCommand](task-sequence-variables.md#OSDDoNotLogCommand) (начиная с версии 1902)<!--3654172-->  
- [SMSTSDisableWow64Redirection](task-sequence-variables.md#SMSTSDisableWow64Redirection)  
- [SMSTSRunCommandLineUserName](task-sequence-variables.md#SMSTSRunCommandLineUserName)  
- [SMSTSRunCommandLineUserPassword](task-sequence-variables.md#SMSTSRunCommandLineUserPassword).  
- [SMSTSRunCommandLineAsUser](task-sequence-variables.md#SMSTSRunCommandLineAsUser) (начиная с версии 2002)<!-- 5573175 -->
- [WorkingDirectory](task-sequence-variables.md#WorkingDirectory)  

### <a name="cmdlets-for-run-command-line"></a>Командлеты для выполнения из командной строки

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepRunCommandLine](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepruncommandline?view=sccm-ps);
- [New-CMTSStepRunCommandLine](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepruncommandline?view=sccm-ps);
- [Remove-CMTSStepRunCommandLine](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepruncommandline?view=sccm-ps);
- [Set-CMTSStepRunCommandLine](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepruncommandline?view=sccm-ps);

### <a name="properties-for-run-command-line"></a>Свойства для выполнения из командной строки

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="command-line"></a>Командная строка

Задает командную строку, которую запускает последовательность задач. Это обязательное поле. Добавьте расширения файлов, например .vbs и .exe. Включите все требуемые файлы параметров и параметры командной строки.  

Если не указано расширение файла, Configuration Manager пытается использовать расширения COM, EXE и BAT. Если имя файла имеет расширение, не являющееся исполняемым, Configuration Manager пытается использовать локальную ассоциацию. Например, если в командной строке указано имя файла readme.gif, то Configuration Manager запускает приложение, связанное на компьютере назначения с файлами, имеющими расширение GIF.  

Примеры:  

`setup.exe /a`  

`cmd.exe /c copy Jan98.dat c:\sales\Jan98.dat`  

> [!NOTE]  
> Для успешного выполнения запустите команду **cmd.exe /c** перед действиями командной строки. К примерам таких действий относятся команды копирования, перенаправление выходных данных и передача.  

#### <a name="output-to-task-sequence-variable"></a>Вывод данных в переменную последовательности задач

<!--user story 4977616/bug 4798352-->

Начиная с версии 1910, выходные данные команды можно сохранять в пользовательскую переменную последовательности задач.

> [!Note]  
> Configuration Manager выводит последние 1000 символов выходных данных.

#### <a name="disable-64-bit-file-system-redirection"></a>Отключить перенаправление в 64-разрядной файловой системе

64-разрядные операционные системы по умолчанию используют перенаправитель файловой системы WOW64 для выполнения команд из командной строки. Это необходимо для правильного поиска 32-разрядных версий исполняемых файлов и библиотек операционной системы. Выберите этот параметр, чтобы не использовать перенаправитель файловой системы WOW64. Windows выполняет команду с использованием собственных 64-разрядных версий исполняемых файлов и библиотек операционной системы. Этот параметр никак не используется при работе в 32-разрядной операционной системе.  

#### <a name="start-in"></a>Рабочая папка

Указывает папку с исполняемым файлом программы, не более 127 символов. Эта папка может быть абсолютным путем на компьютере назначения или относительным путем к папке в точке распространения, содержащей пакет. Это поле является необязательным.  

Примеры:  

`c:\officexp`  

`i386`  

> [!NOTE]  
> Кнопка **Обзор** позволяет находить файлы и папки на локальном компьютере. Все выбираемые элементы также должны существовать на конечном компьютере. Для них должны полностью совпадать расположения, включая имена файлов и папок.  

#### <a name="package"></a>Пакет

Если вы укажете в командной строке файлы или программы, которых нет на конечном компьютере, выберите этот вариантПри указании в командной строке файлов или программ, которых еще нет на целевом компьютере, выберите этот параметр и укажите пакет Configuration Manager, содержащий нужные файлы. Для этого пакета не требуется программа. Если указанные файлы имеются на целевом компьютере, этот параметр указывать не нужно.  

#### <a name="time-out"></a>Время ожидания

Определяет время, в течение которого Configuration Manager разрешает выполнение командной строки. Допускаются значения в диапазоне от 1 до 999 минут. Значение по умолчанию — 15 минут. Этот параметр отключен по умолчанию.  

> [!IMPORTANT]  
> Если введенное значение окажется недостаточным для успешного выполнения указанной команды, этот шаг завершается с ошибкой. В зависимости от параметров шага или группы это может привести к сбою всей последовательности задач. Если время ожидания истекает, Configuration Manager завершает процесс командной строки.  

#### <a name="run-this-step-as-the-following-account"></a>Выполнить этот шаг из следующей учетной записи

Указывает, что командная строка должна выполняться из учетной записи пользователя Windows, а не через локальную системную учетную запись.  

> [!NOTE]  
> Чтобы после установки операционной системы выполнять простые скрипты или команды от имени другой учетной записи, добавьте эту учетную запись на компьютер. Для более сложных программ, таких как установщик Windows, кроме этого потребуется восстановить профили учетных записей пользователей Windows.  

#### <a name="account"></a>Учетная запись

Указывает учетную запись пользователя Windows, которую этот шаг использует для запуска командной строки. Командная строка выполняется с разрешениями указанной учетной записи. Нажмите кнопку **Задать**, чтобы указать учетную запись локального пользователя или домена. Дополнительные сведения об учетной записи, позволяющей выполнить последовательность задач от имени другого пользователя, см. в разделе [Accounts](../../core/plan-design/hierarchy/accounts.md#task-sequence-run-as-account) (Учетные записи).

> [!IMPORTANT]  
> Если этот шаг задает учетную запись пользователя и запускается в среде предустановки Windows, действие завершается со сбоем. Среду предустановки Windows нельзя присоединить к домену. Это приводит к сбою, который регистрируется в файле **smsts.log**.  

### <a name="options-for-run-command-line"></a>Параметры для выполнения из командной строки

Кроме параметров по умолчанию, на вкладке **Параметры** этого шага последовательности задач можно настроить следующие дополнительные параметры:  

#### <a name="success-codes"></a>Коды успешного завершения

Включите другие коды выхода из скрипта, которые этап должен расценивать как успешное завершение.



## <a name="run-powershell-script"></a><a name="BKMK_RunPowerShellScript"></a> Запустить сценарий PowerShell

Используйте этот шаг для запуска указанного сценария Windows PowerShell.  

Этот шаг можно выполнять в полной версии операционной системы и в Windows PE. Чтобы выполнить этот шаг в среде предустановки Windows, включите PowerShell в загрузочный образ. Компонент WinPE-PowerShell можно включить на вкладке **Дополнительные компоненты** в свойствах загрузочного образа. Дополнительные сведения об изменении образа загрузки см. в разделе [Управление загрузочным образом](../get-started/manage-boot-images.md).  

> [!NOTE]  
> По умолчанию PowerShell отключен в операционных системах Windows Embedded.  

> [!WARNING]
> Некоторое программное обеспечение для защиты от вредоносных программ может случайно активировать события для шага последовательности задач "Запустить сценарий PowerShell" в Configuration Manager. Рекомендуется исключить %windir%\temp\smstspowershellscripts, чтобы программное обеспечение для защиты от вредоносных программ не мешало выполнению этих сценариев.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Выполнить скрипт PowerShell**.

### <a name="variables-for-run-powershell-script"></a>Переменные для выполнения скрипта PowerShell

Используйте для этого шага следующие переменные последовательности задач:  

- [OSDLogPowerShellParameters](task-sequence-variables.md#OSDLogPowerShellParameters) (начиная с версии 1902)<!--3556028-->  
- [SMSTSRunPowerShellAsUser](task-sequence-variables.md#SMSTSRunPowerShellAsUser) (начиная с версии 2002)<!-- 5573175 -->
- [SMSTSRunPowerShellUserName](task-sequence-variables.md#SMSTSRunPowerShellUserName);  
- [SMSTSRunPowerShellUserPassword](task-sequence-variables.md#SMSTSRunPowerShellUserPassword).  

### <a name="cmdlets-for-run-powershell-script"></a>Командлеты для выполнения скрипта PowerShell

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepRunPowerShellScript](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtssteprunpowershellscript?view=sccm-ps);
- [New-CMTSStepRunPowerShellScript](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtssteprunpowershellscript?view=sccm-ps);
- [Remove-CMTSStepRunPowerShellScript](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtssteprunpowershellscript?view=sccm-ps);
- [Set-CMTSStepRunPowerShellScript](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtssteprunpowershellscript?view=sccm-ps).

> [!Note]  
> Используйте подписанные скрипты PowerShell в формате Юникод. Формат ANSI, который используется по умолчанию, не поддерживается для этого шага.

### <a name="properties-for-run-powershell-script"></a>Свойства для выполнения скрипта PowerShell

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="package"></a>Пакет

Укажите пакет Configuration Manager, содержащий сценарий PowerShell. Один пакет может содержать несколько сценариев PowerShell.  

#### <a name="script-name"></a>Имя сценария

Задает имя сценария PowerShell для выполнения. Это обязательное поле.  

#### <a name="enter-a-powershell-script"></a>Ввод скрипта PowerShell

<!-- 3556028 -->
Начиная с версии 1902, на этом шаге можно напрямую вводить код Windows PowerShell. Эта возможность позволяет выполнять команды PowerShell во время последовательности задач, избавляя от необходимости создавать и распространять пакет с нужным скриптом.

При вводе и редактировании скрипта окно скрипта PowerShell позволяет выполнить следующие действия:  

- изменить скрипт напрямую;  

- открыть существующий скрипт из файла;  

- найти существующий утвержденный [скрипт](../../apps/deploy-use/create-deploy-scripts.md) в Configuration Manager.

> [!Important]  
> Чтобы воспользоваться преимуществами этих новых функций Configuration Manager, после обновления сайта нужно также обновить клиенты до последней версии. Хотя новые функции появляются в консоли Configuration Manager после обновления ее и сайта, полный сценарий будет работать только с последней версией клиента.

#### <a name="parameters"></a>Параметры

Задает параметры, передаваемые в скрипт PowerShell. Здесь применяются те же параметры скрипта Windows PowerShell, что и в командной строке.  

Укажите параметры, используемые сценарием, а не для командной строки Windows PowerShell.  
В следующем примере показаны допустимые параметры:  

`-MyParameter1 MyValue1 -MyParameter2 MyValue2`  

В следующем примере показаны недопустимые параметры. Первые два элемента являются параметрами командной строки Windows PowerShell ( **-NoLogo** и **-ExecutionPolicy Unrestricted**). Скрипт не использует эти параметры.  

`-NoLogo -ExecutionPolicy Unrestricted -File MyScript.ps1 -MyParameter1 MyValue1 -MyParameter2 MyValue2`

<!-- SCCMDocs-pr issue 3561 -->
Если значение параметра включает специальный символ, используйте одинарные кавычки (`'`) вокруг значения. Двойные кавычки (`"`) могут привести к неправильной обработке параметра в шаге последовательности задач.

Пример: `-Arg1 '%TSVar1%' -Arg2 '%TSVar2%'`

Начиная с версии 2002, задайте это свойство для переменной.<!-- 5690481 --> Например, если указать `%MyScriptVariable%`, когда последовательность задач выполняет скрипт, значение этой пользовательской переменной добавляется в командную строку PowerShell.

#### <a name="powershell-execution-policy"></a>Политика выполнения PowerShell

Определяет, какие скрипты Windows PowerShell разрешено выполнять на этом компьютере. Выберите одну из следующих политик выполнения.  

- **AllSigned**: выполняются только сценарии, подписанные доверенным издателем.  

- **Не определено**: политика выполнения не определена.  

- **Обход**: загружаются все файлы конфигурации и выполняются все сценарии. Windows PowerShell не запрашивает разрешение перед запуском неподписанного скрипта, скачанного из Интернета.  

> [!IMPORTANT]  
> PowerShell 1.0 не поддерживает политики выполнения Undefined (Не определено) и Bypass (Обход).  

#### <a name="output-to-task-sequence-variable"></a>Вывод данных в переменную последовательности задач

<!-- 3556028 -->
Начиная с версии 1902, выходные данные скрипта можно сохранять в пользовательскую переменную последовательности задач.

> [!Note]  
> Начиная с версии 1910, Configuration Manager выводит последние 1000 символов выходных данных.

Пример использования этого свойства шага см. в разделе о [задании переменных](using-task-sequence-variables.md#bkmk_run-ps).

#### <a name="start-in"></a>Рабочая папка

<!-- 3556028 -->
Начиная с версии 1902, можно указать для скрипта путь к папке для запуска длиной до 127 символов. Эта папка может быть абсолютным путем на компьютере назначения или относительным путем к папке в точке распространения, содержащей пакет. Это поле является необязательным.  

> [!NOTE]  
> Кнопка **Обзор** позволяет находить файлы и папки на локальном компьютере. Все выбираемые элементы также должны существовать на конечном компьютере. Для них должны полностью совпадать расположения, включая имена файлов и папок.  

#### <a name="time-out"></a>Время ожидания

<!-- 3556028 -->
Начиная с версии 1902, можно указать значение допустимого времени для выполнения скрипта PowerShell в Configuration Manager. Допускаются значения в диапазоне от 1 до 999 минут. Значение по умолчанию — 15 минут. Этот параметр отключен по умолчанию.  

> [!IMPORTANT]  
> Если введенное значение окажется недостаточным для успешного выполнения указанного скрипта, этот шаг завершается с ошибкой. В зависимости от параметров шага или группы это может привести к сбою всей последовательности задач. Когда время ожидания истекает, Configuration Manager завершает процесс PowerShell.  

#### <a name="run-this-step-as-the-following-account"></a>Выполнить этот шаг из следующей учетной записи

<!-- 3556028 -->
Начиная с версии 1902, можно настроить выполнение скрипта PowerShell от имени учетной записи пользователя Windows, а не учетной записи Local System.  

> [!NOTE]  
> Чтобы после установки операционной системы выполнять простые скрипты или команды от имени другой учетной записи, добавьте эту учетную запись на компьютер. Кроме того, для более сложных действий может потребоваться восстановить профили учетных записей пользователей Windows.  

#### <a name="account"></a>Учетная запись

<!-- 3556028 -->
Начиная с версии 1902, можно указать учетную запись пользователя Windows, которая используется на этом шаге для запуска скрипта PowerShell. У указанной учетной записи должны быть права локального администратора в системе, так как для выполнения этого скрипта используются разрешения этой учетной записи. Нажмите кнопку **Задать**, чтобы указать учетную запись локального пользователя или домена. Дополнительные сведения об учетной записи, позволяющей выполнить последовательность задач от имени другого пользователя, см. в разделе [Accounts](../../core/plan-design/hierarchy/accounts.md#task-sequence-run-as-account) (Учетные записи).

> [!IMPORTANT]  
> Если этот шаг задает учетную запись пользователя и запускается в среде предустановки Windows, действие завершается со сбоем. Среду предустановки Windows нельзя присоединить к домену. Это приводит к сбою, который регистрируется в файле **smsts.log**.  

### <a name="options-for-run-powershell-script"></a>Параметры для выполнения скрипта PowerShell

Кроме параметров по умолчанию, на вкладке **Параметры** этого шага последовательности задач можно настроить следующие дополнительные параметры:  

#### <a name="success-codes"></a>Коды успешного завершения

<!-- 3556028 -->
Начиная с версии 1902, можно указать другие коды выхода из скрипта, которые будут расцениваться как успешное завершение на этом шаге.



## <a name="run-task-sequence"></a><a name="child-task-sequence"></a> Запуск последовательности задач

> [!Note]  
> По умолчанию в версии 1910 в Configuration Manager эта функция включена. В версии 1906 и более ранних по умолчанию в Configuration Manager эта дополнительная функция отключена. Включите ее, прежде чем пытаться использовать. Дополнительные сведения см. в разделе [Включение дополнительных функций из обновлений](../../core/servers/manage/install-in-console-updates.md#bkmk_options).

На этом шаге выполняется другая последовательность задач. При этом создается связь "родители — потомки" между последовательностями задач. С помощью дочерней последовательности задач можно создавать более модульные и многоразовые последовательности задач.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Запустить последовательность задач**.

### <a name="specifications-and-limitations-for-run-task-sequence"></a>Спецификации и ограничения для запуска последовательности задач

При добавлении в последовательность задач дочерней последовательности задач учитывайте следующие аспекты.  

- Родительская и дочерняя последовательности задач эффективно объединяются в одну политику, выполняемой на клиенте.  

- Среда является глобальной. Если родительская последовательность задач задает переменную, которую затем изменяет дочерняя последовательность задач, эта переменная сохраняет последнее значение. Если дочерняя последовательность задач создает новую переменную, она будет доступна во всей последующей части родительской последовательности задач.  

- Сообщения о состоянии отправляются для отдельной операции последовательности задач как обычно.  

- Последовательность задач регистрирует записи в файл журнала **smsts.log**, из которых очевидно, когда начинается дочерняя последовательность задач.  

<!--the following points are from SCCMdocs issue #1079-->

- Используя ссылку на образ загрузки, нельзя выбрать последовательность задач. Если для развертывания требуется образ загрузки, укажите его в родительской последовательности задач.  

- Если дочерняя последовательность задач отключена, развертывание завершится с ошибкой. Чтобы обойти это ограничение, нельзя использовать параметр **Продолжать при ошибке**.  

- Если дочерняя последовательность задач содержит шаги c *высокой степенью влияния*, Центр программного обеспечения не обнаружит это и отобразит уведомление о высокой степени влияния. Измените свойства родительской последовательности задач на вкладке "Уведомление пользователей", чтобы указать, что **это последовательность задач с высокой степенью влияния**.  

- Если в дочерней последовательности задач есть ссылка на отсутствующий пакет, при просмотре родительской последовательности задач это состояние не обнаруживается. Если изменить родительскую последовательность задач, любые отсутствующие ссылки в дочерних последовательностях задач будут обнаружены при изменении родительского элемента.  

### <a name="cmdlets-for-run-task-sequence"></a>Командлеты для запуска последовательности задач

В версии 1906 и выше для управления этим шагом используйте следующие командлеты PowerShell:<!-- 2839943, SCCMDocs#1118 -->

- **Get-CMTSStepRunTaskSequence**;
- **New-CMTSStepRunTaskSequence**;
- **Remove-CMTSStepRunTaskSequence**.
- **Set-CMTSStepRunTaskSequence**.

Дополнительные сведения см. в разделе [Новые командлеты](https://docs.microsoft.com/powershell/sccm/1906-release-notes?view=sccm-ps#new-cmdlets) в заметках о выпуске 1906.

### <a name="properties-for-run-task-sequence"></a>Свойства для запуска последовательности задач

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="select-task-sequence-to-run"></a>Выбор последовательности задач для запуска

Нажмите кнопку **Обзор**, чтобы выбрать дочернюю последовательность задач. Диалоговое окно **Выбор последовательности задач** не отображает родительскую последовательность задач.



## <a name="set-dynamic-variables"></a><a name="BKMK_SetDynamicVariables"></a> Задать динамические переменные

Используйте этот шаг для выполнения следующих действий:  

1. Соберите сведения о компьютере и его среде. Сохраните собранные сведения в соответствующие переменные последовательности задач.  

2. Оцените выполнение заданных правил. Установите дополнительные переменные последовательности задач по результатам оценки правил.  

Этот шаг можно выполнять в полной версии операционной системы и в Windows PE.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Задать динамические переменные**.

### <a name="variables-for-set-dynamic-variables"></a>Переменные для задания динамических переменных

Последовательность задач автоматически задает переменные следующей последовательности задач, доступные только для чтения.  

- [\_SMSTSMake](task-sequence-variables.md#SMSTSMake)  
- [\_SMSTSModel](task-sequence-variables.md#SMSTSModel)  
- [\_SMSTSMacAddresses](task-sequence-variables.md#SMSTSMacAddresses)  
- [\_SMSTSIPAddresses](task-sequence-variables.md#SMSTSIPAddresses)  
- [\_SMSTSSerialNumber](task-sequence-variables.md#SMSTSSerialNumber)  
- [\_SMSTSAssetTag](task-sequence-variables.md#SMSTSAssetTag)  
- [\_SMSTSUUID](task-sequence-variables.md#SMSTSUUID)  

### <a name="cmdlets-for-set-dynamic-variables"></a>Командлеты для задания динамических переменных

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepSetDynamicVariable](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepsetdynamicvariable?view=sccm-ps);
- [New-CMTSStepSetDynamicVariable](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepsetdynamicvariable?view=sccm-ps);
- [Remove-CMTSStepSetDynamicVariable](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepsetdynamicvariable?view=sccm-ps);
- [Set-CMTSStepSetDynamicVariable](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepsetdynamicvariable?view=sccm-ps).

### <a name="properties-for-set-dynamic-variables"></a>Свойства для задания динамических переменных

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="dynamic-rules-and-variables"></a>Динамические правила и переменные

Чтобы задать динамическую переменную для использования в последовательности задач, добавьте правило. Задайте значение для каждой переменной, указанной в правиле. Кроме того, добавьте одну или несколько переменных без добавления правила. При добавлении правила доступны следующие категории правил:  

- **Компьютер**: оцените значения для тега аппаратного актива, UUID, серийного номера или MAC-адреса. При необходимости задайте несколько значений. Если любое значение равно true, правило оценивается как истинное. Например, следующее правило возвращает результат TRUE, если серийный номер имеет значение 5892087, а MAC-адрес — 22-A4-5A-13-78-26.  

    `IF Serial Number = 5892087 OR MAC address = 26-78-13-5A-A4-22 THEN`  

- **Расположение** — оцените значения для сетевого шлюза по умолчанию.  

- **Марка и модель**: оцените значения для марки и модели компьютера. Чтобы правило оценивалось как истинное, и марка, и модель должны оцениваться как истинные.

    Можно использовать подстановочные знаки: звездочку (`*`) и вопросительный знак (`?`). Звездочка соответствует нескольким любым символам, а вопросительный знак соответствует — одному любому символу. Например, строка `DELL*900?` найдет значения `DELL-ABC-9001` и `DELL9009`.  

- **Переменная последовательности задач**: добавление переменной последовательности задач, условия и значения для оценки. Правило оценивается как истинное, если значение переменной удовлетворяет заданному условию.  

    Укажите одну или несколько переменных, задаваемых для правила, оценка которого дает значение true, или задайте переменные без использования правила. Выберите существующую переменную или создайте пользовательскую.  

    - **Существующие переменные последовательности задач**: выберите одну или несколько переменных из списка существующих переменных последовательности задач. Переменные массива выбирать нельзя.  

    - **Пользовательские переменные последовательности задач**: задайте пользовательскую переменную последовательности задач. Можно также указать существующую переменную последовательности задач. Это удобно для указания существующей переменной массива, такой как **OSDAdapter**, так как переменные массива не входят в список существующих переменных последовательности задач.  

Выбрав переменные для правила, предоставьте значения для каждой их них. Переменная устанавливается в указанное значение, если правило возвращает значение true. Для каждой переменной можно указать **секретное значение** , чтобы скрыть значение переменной. По умолчанию некоторые существующие переменные, например, **OSDCaptureAccountPassword**, скрывают свои значения.  

> [!IMPORTANT]  
> Configuration Manager удаляет все значения переменных с пометкой **Секретное значение** при импорте последовательности задач с помощью шага **Задать динамические переменные**. Повторно введите значение для этой динамической переменной после импорта последовательности задач.  



## <a name="set-task-sequence-variable"></a><a name="BKMK_SetTaskSequenceVariable"></a> Задать переменную последовательности задач

Используйте этот шаг, чтобы задать значение переменной, используемой с последовательностью задач.  

Этот шаг можно выполнять в полной версии операционной системы и в Windows PE.

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Общие** и **Задать переменную последовательности задач**.

### <a name="variables-for-set-task-sequence-variable"></a>Переменные для задания переменной последовательности задач

Переменные последовательности задач считываются действиями последовательности задач и определяют поведение этих действий. Дополнительные сведения о конкретных переменных последовательности задач и их использовании см. в следующих статьях:  

- [Создание переменных последовательности задач](using-task-sequence-variables.md)  
- [Переменные последовательности задач](task-sequence-variables.md)  

### <a name="cmdlets-for-set-task-sequence-variable"></a>Командлеты для задания переменной последовательности задач

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepSetVariable](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepsetvariable?view=sccm-ps);
- [New-CMTSStepSetVariable](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepsetvariable?view=sccm-ps);
- [Remove-CMTSStepSetVariable](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepsetvariable?view=sccm-ps);
- [Set-CMTSStepSetVariable](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepsetvariable?view=sccm-ps).

### <a name="properties-for-set-task-sequence-variable"></a>Свойства для задания переменной последовательности задач

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="task-sequence-variable"></a>Переменная последовательности задач

Укажите имя переменной действия или встроенной переменной последовательности задач либо задайте собственное имя переменной, определяемое пользователем.  

#### <a name="do-not-display-this-value"></a>Не отображать это значение

<!--1358330-->
Этот параметр позволяет маскировать конфиденциальные данные, хранящиеся в переменных последовательности задач. Например, при указании пароля.

> [!Note]  
> Включите этот параметр и задайте значение переменной последовательности задач. В противном случае значение переменной не будет задано, что может вызвать непредвиденное поведение при выполнении последовательности задач.<!--SCCMdocs issue #800-->

#### <a name="value"></a>Значение  

Последовательность задач присваивает переменной это значение. Присвойте этой переменной последовательности задач значение другой переменной последовательности задач, используя синтаксис `%varname%`.  



## <a name="setup-windows-and-configmgr"></a><a name="BKMK_SetupWindowsandConfigMgr"></a> Настройка Windows и Configuration Manager

Используйте этот шаг для перехода от среды предустановки Windows к новой операционной системе. Он является обязательным этапом для любого развертывания операционной системы. Он устанавливает клиент Configuration Manager в новой операционной системе и подготавливает все необходимое для выполнения последовательности задач в новой операционной системе.  

Этот шаг отвечает за переход последовательности задач с Windows PE на полнофункциональную ОС. Из-за перехода этот шаг выполняется как в Windows PE, так и в полнофункциональной ОС. Но так как переход выполняется из среды Windows PE, шаг можно добавить только в ту часть последовательности задач, которая касается Windows PE.  

Этот шаг заменяет переменные каталогов sysprep.inf или unattend.xml, такие как `%WINDIR%` и `%ProgramFiles%`, на каталог установки Windows PE (`X:\Windows`). Последовательность задач игнорирует переменные, заданные с помощью этих переменных среды.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Настройка Windows и Configuration Manager**.

### <a name="behaviors-for-setup-windows-and-configmgr"></a>Поведение для настройки Windows и Configuration Manager

Этот шаг выполняет следующие действия.  

#### <a name="preliminaries-windows-pe"></a>Предварительные действия: Windows PE  

1. Замените переменные последовательности задач в файле unattend.xml.  

2. Скачайте пакет, содержащий клиент Configuration Manager. Добавьте пакет в развертываемый образ.  

#### <a name="set-up-windows"></a>Настройка Windows  

- Установка с использованием образа  

    1. Отключите клиент Configuration Manager в образе, если он существует. Другими словами, отключите автоматический запуск для службы клиента Configuration Manager.  

    2. Обновите реестр в развертываемом образе, чтобы развернутая операционная система запускалась с диска с той же буквой, что и компьютер-образец.  

    3. Перезагрузитесь в развернутую операционную систему.  

    4. Запускается мини-установка Windows с использованием ранее указанного файла ответов sysprep.inf или unattend.xml без какого-либо взаимодействия с пользователем. Если вы используете шаг **Применить параметры сети** для присоединения к домену, то эти сведения находятся в файле ответов. Мини-установка Windows присоединяет компьютер к домену.  

- Установка с использованием файла Setup.exe. Запускает Setup.exe для выполнения обычного процесса установки Windows:  

    1. Скопируйте пакет обновления ОС, указанный в шаге **Применить операционную систему**, на жесткий диск.  

    2. Перезагрузитесь в развернутую операционную систему.  

    3. Запускается мини-установка Windows с использованием ранее указанного файла ответов sysprep.inf или unattend.xml без учета каких-либо параметров пользовательского интерфейса. Если вы используете шаг **Применить параметры сети** для присоединения к домену, то эти сведения находятся в файле ответов. Мини-установка Windows присоединяет компьютер к домену.  

#### <a name="set-up-the-configuration-manager-client"></a>Настройка клиента Configuration Manager  

1. После завершения мини-установки Windows выполнение последовательности задач будет продолжено с использованием setupcomplete.cmd. Дополнительные сведения см. в разделе о [выполнении скрипта после установки (SetupComplete.cmd)](https://docs.microsoft.com/windows-hardware/manufacture/desktop/add-a-custom-script-to-windows-setup#run-a-script-after-setup-is-complete-setupcompletecmd).  

2. Включите или отключите учетную запись локального администратора в зависимости от параметра, выбранного для шага **Применить настройки Windows**.  

3. Установите клиент Configuration Manager с использованием ранее скачанного пакета и свойств установки, заданных в этом шаге. Клиент устанавливается в "режиме подготовки". Этот режим не позволяет клиенту обрабатывать новые запросы политики, пока не завершится выполнение последовательности задач. Подробнее см. в разделе о [режиме подготовки](provisioning-mode.md).  

4. Подождите, пока клиент перейдет в рабочее состояние.  

#### <a name="the-step-completes"></a>Завершается выполнение шага

Последовательность задач продолжает выполняться со следующего шага.  

> [!Note]  
> Групповая политика Windows обычно не обрабатывается до завершения последовательности задач. Такое поведение применяется согласованно для разных версий Windows. Другие настраиваемые действия во время выполнения последовательности задач могут активировать оценку групповой политики. См. сведения о порядке операций в руководстве по [выполнению скрипта после установки (SetupComplete.cmd)](https://docs.microsoft.com/windows-hardware/manufacture/desktop/add-a-custom-script-to-windows-setup#run-a-script-after-setup-is-complete-setupcompletecmd). <!-- 2841304 -->


### <a name="variables-for-setup-windows-and-configmgr"></a>Переменные для настройки Windows и Configuration Manager

Используйте для этого шага следующие переменные последовательности задач:  

- [SMSClientInstallProperties](task-sequence-variables.md#SMSClientInstallProperties)  

### <a name="cmdlets-for-setup-windows-and-configmgr"></a>Командлеты для настройки Windows и Configuration Manager

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepSetupWindowsAndConfigMgr](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmtsstepsetupwindowsandconfigmgr?view=sccm-ps);
- [New-CMTSStepSetupWindowsAndConfigMgr](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmtsstepsetupwindowsandconfigmgr?view=sccm-ps);
- [Remove-CMTSStepSetupWindowsAndConfigMgr](https://docs.microsoft.com/powershell/module/configurationmanager/remove-cmtsstepsetupwindowsandconfigmgr?view=sccm-ps);
- [Set-CMTSStepSetupWindowsAndConfigMgr](https://docs.microsoft.com/powershell/module/configurationmanager/set-cmtsstepsetupwindowsandconfigmgr?view=sccm-ps).

### <a name="properties-for-setup-windows-and-configmgr"></a>Свойства для настройки Windows и Configuration Manager

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="client-package"></a>Пакет клиента

Нажмите кнопку **Обзор** и выберите пакет установки клиента Configuration Manager, используемый для этого шага.  

#### <a name="use-pre-production-client-package-when-available"></a>Использовать пакет подготовительной версии клиента при наличии

Если доступен пакет подготовительной версии клиента и компьютер входит в пилотную коллекцию, то этот пакет будет использован в последовательности задач вместо пакета рабочей версии клиента. Подготовительная версия клиента — это более новая версия, предназначенная для тестирования в рабочей среде. Нажмите кнопку **Обзор** и выберите пакет установки подготовительной версии клиента, используемый для этого шага.  

#### <a name="installation-properties"></a>Свойства установки

Этот шаг последовательности задач автоматически назначает сайт и конфигурацию по умолчанию. В этом поле можно указывать любые дополнительные свойства установки, которые будут выполняться при установке клиента. Чтобы ввести несколько свойств установки, разделите их пробелами.  

Укажите параметры командной строки для установки клиента. Например, введите `/skipprereq: silverlight.exe`, чтобы CCMSetup.exe не устанавливал обязательный компонент Microsoft Silverlight. Дополнительные сведения о доступных параметрах командной строки для CCMSetup.exe см. в разделе [Сведения о свойствах установки клиента в System Center Configuration Manager](../../core/clients/deploy/about-client-installation-properties.md).  

### <a name="options-for-setup-windows-and-configmgr"></a>Параметры для настройки Windows и Configuration Manager

> [!NOTE]  
> Не включайте параметр **Продолжать при ошибке** на вкладке **Параметры**. Если на этом шаге происходит сбой, последовательность задач завершается ошибкой происходит независимо от значения этого параметра.  



## <a name="upgrade-operating-system"></a><a name="BKMK_UpgradeOS"></a> Обновление операционной системы

Используйте этот шаг для обновления более старой версии Windows до более новой версии Windows 10.  

Этот шаг последовательности задач выполняется только в полнофункциональной операционной системе. Он не работает в среде предустановки Windows.  

Чтобы добавить этот шаг, в редакторе последовательности задач щелкните **Добавить**, **Образы** и **Обновить операционную систему**.

> [!TIP]
> Начиная с Windows 10 версии 1709, носитель содержит несколько выпусков. При настройке последовательности задач для использования пакета обновления операционной системы или образа ОС не забудьте выбрать [поддерживаемый выпуск](../../core/plan-design/configs/support-for-windows-10.md#windows-10-as-a-client).  
>
> Используйте предварительное кэширование содержимого, чтобы скачать применимый пакет обновления ОС, прежде чем пользователь установит последовательность задач. Дополнительные сведения см. в разделе [Настройка предварительного кэширования содержимого](../deploy-use/configure-precache-content.md).

### <a name="variables-for-upgrade-os"></a>Переменные для обновления ОС

Используйте для этого шага следующие переменные последовательности задач:  

- [_SMSTSOSUpgradeActionReturnCode](task-sequence-variables.md#SMSTSOSUpgradeActionReturnCode)  
- [SetupCompletePause](task-sequence-variables.md#SetupCompletePause)
- [OSDSetupAdditionalUpgradeOptions](task-sequence-variables.md#OSDSetupAdditionalUpgradeOptions)  

### <a name="cmdlets-for-upgrade-os"></a>Командлеты для обновления ОС

Для управления этим шагом используйте следующие командлеты PowerShell:<!-- SCCMDocs #1118 -->

- [Get-CMTSStepUpgradeOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Get-CMTSStepUpgradeOperatingSystem?view=sccm-ps)
- [New-CMTSStepUpgradeOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/New-CMTSStepUpgradeOperatingSystem?view=sccm-ps)
- [Remove-CMTSStepUpgradeOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Remove-CMTSStepUpgradeOperatingSystem?view=sccm-ps)
- [Set-CMTSStepUpgradeOperatingSystem](https://docs.microsoft.com/powershell/module/configurationmanager/Set-CMTSStepUpgradeOperatingSystem?view=sccm-ps)

### <a name="properties-for-upgrade-os"></a>Свойства для обновления ОС

На вкладке **Свойства** этого шага можно настроить параметры, описанные в этом разделе.  

#### <a name="upgrade-package"></a>Пакет обновления

Выберите этот параметр, чтобы указать пакет обновления операционной системы Windows 10, который нужно использовать для обновления.  

#### <a name="source-path"></a>Исходный путь

Указывает локальный или сетевой путь к носителю Windows 10, используемому программой установки Windows. Этот параметр соответствует параметру командной строки `/InstallFrom` для программы установки Windows.

Вы можете указать переменную, например `%MyContentPath%` или `%DPC01%`. Если для исходного пути используется переменная, значение для нее необходимо указать ранее в последовательности задач. Например, задайте переменную расположения пакета обновления операционной системы на шаге [Скачать содержимое пакета](#BKMK_DownloadPackageContent). Затем на этом шаге используйте значение переменной в качестве исходного пути.  

#### <a name="edition"></a>выпуск

Укажите выпуск на носителе операционной системы, который нужно использовать для обновления.  

#### <a name="product-key"></a>Ключ продукта

Введите ключ продукта, который нужно применить в процессе обновления.  

#### <a name="provide-the-following-driver-content-to-windows-setup-during-upgrade"></a>Укажите следующие драйверы для установщика Windows в ходе обновления

Позволяет добавить драйверы на конечный компьютер во время обновления. Драйверы должны быть совместимы с Windows 10. Этот параметр соответствует параметру командной строки `/InstallDriver` для программы установки Windows. Дополнительные сведения см. в статье [Параметры командной строки программы установки Windows](https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options#installdrivers).

Выберите один из следующих вариантов:  

- **Пакет драйверов**. Нажмите кнопку **Обзор** и выберите существующий пакет драйверов в списке.

- **Промежуточное содержимое**: Выберите этот параметр, чтобы указать расположение содержимого драйверов. Вы можете указать локальную папку, сетевой путь или переменную последовательности задач. Если для исходного пути используется переменная, значение для нее необходимо указать ранее в последовательности задач. Например, с помощью шага [Загрузить содержимое пакета](task-sequence-steps.md#BKMK_DownloadPackageContent).  

> [!TIP]
> Если требуется динамическое содержимое для различных типов оборудования, сделайте следующее.
>
> - Используйте несколько экземпляров этого шага с условиями для типов оборудования и отдельного содержимого драйвера.
>
> - Используйте несколько экземпляров шага [Загрузить содержимое пакета](task-sequence-steps.md#BKMK_DownloadPackageContent). Поместите содержимое в обычное расположение, а затем используйте параметр **Промежуточное содержимое**. Преимущество этого метода состоит в том, что последовательность задач содержит один шаг **Обновить ОС**.

#### <a name="time-out-minutes"></a>Время ожидания (минут)

Укажите период в минутах, по истечении которого Configuration Manager завершает этот шаг со сбоем. Этот параметр удобно использовать, если программа установки Windows прекращает обработку, но не завершает работу.  

#### <a name="perform-windows-setup-compatibility-scan-without-starting-upgrade"></a>Выполнять проверку совместимости программы установки Windows без запуска обновления

Позволяет проверить совместимость программы установки Windows без запуска обновления. Этот параметр соответствует параметру командной строки `/Compat ScanOnly` для программы установки Windows. Он позволяет развернуть весь пакет обновления операционной системы.

<!--SCCMDocs-pr issue 2812-->
Выбор этого параметра отменяет переход клиента Configuration Manager в режим подготовки на этом шаге. Программа установки Windows выполняется в фоновом режиме, не требуя вмешательства, а клиент продолжает работу как обычно. Подробнее см. в разделе о [режиме подготовки](provisioning-mode.md).

Программа установки возвращает код выхода в качестве результата проверки. В следующей таблице собраны самые распространенные коды выхода.  

|Код выхода|Сведения|  
|-|-|  
|MOSETUP_E_COMPAT_SCANONLY (0xC1900210)|Нет проблем совместимости ("успех").|  
|MOSETUP_E_COMPAT_INSTALLREQ_BLOCK (0xC1900208)|Проблемы функциональной совместимости.|  
|MOSETUP_E_COMPAT_MIGCHOICE_BLOCK (0xC1900204)|Выбранный вариант миграции недоступен. Например, обновление с профессионального выпуска до корпоративного.|  
|MOSETUP_E_COMPAT_SYSREQ_BLOCK (0xC1900200)|Не подходит для Windows 10.|  
|MOSETUP_E_COMPAT_INSTALLDISKSPACE_BLOCK (0xC190020E)|Недостаточно свободного места на диске.|  

Дополнительные сведения об этом параметре см. в статье [Windows Setup Command-Line Options](https://docs.microsoft.com/windows-hardware/manufacture/desktop/windows-setup-command-line-options#compat) (Параметры командной строки программы установки Windows).  

#### <a name="ignore-any-dismissible-compatibility-messages"></a>Пропускать маловажные сообщения о совместимости

Указывает, что программа установки завершит установку, игнорируя все маловажные сообщения о совместимости. Этот параметр соответствует параметру командной строки `/Compat IgnoreWarning` для программы установки Windows.  

#### <a name="dynamically-update-windows-setup-with-windows-update"></a>Динамическое обновление установки Windows в Центре обновления Windows

Позволяет программе установки выполнять операции динамического обновления, такие как поиск, скачивание и установка обновлений. Этот параметр соответствует параметру командной строки `/DynamicUpdate` для программы установки Windows. Этот параметр не совместим с обновлениями программного обеспечения Configuration Manager. Включите его при управлении обновлениями с помощью автономной версии Windows Server Update Services (WSUS) или Центра обновления Windows для бизнеса.  

#### <a name="override-policy-and-use-default-microsoft-update"></a>Переопределение политики (Центр обновления Майкрософт по умолчанию)

Временно переопределите локальную политику в режиме реального времени, чтобы выполнить операции динамического обновления. Компьютер получает обновления из центра обновления Windows.
