---
title: Установить обновления программного обеспечения
titleSuffix: Configuration Manager
description: Рекомендации по использованию этапа "Установить обновления программного обеспечения" в последовательности задач Configuration Manager.
ms.date: 05/28/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 72d1ccd5-3763-4f88-9273-e1a73e8f4286
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 6528e979222bc6ecea2a57a003ff5266b5c096c5
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81703312"
---
# <a name="install-software-updates"></a>Установить обновления программного обеспечения

*Область применения: Configuration Manager (Current Branch)*

**Установить обновления программного обеспечения** — это стандартный этап последовательности задач Configuration Manager. Во время установки или обновления ОС на этом этапе активируются компоненты обновлений программного обеспечения, которые начинают поиск и развертывание обновлений. На этом этапе у некоторых клиентов могут возникать сложности, например длительные превышения времени ожидания или пропуск обновлений. Сведения в этой статье помогут избежать распространенных проблем на этом этапе и эффективно устранять возникающие неполадки.

Дополнительные сведения об этом этапе см. в разделе [Установить обновления программного обеспечения](task-sequence-steps.md#BKMK_InstallSoftwareUpdates).



## <a name="recommendations"></a>Рекомендации

Следующие рекомендации помогут сделать этот процесс более эффективным.

- [Использование автономного обслуживания](#use-offline-servicing)
- [Один индекс](#single-index)
- [Уменьшение размера образа](#bkmk_resetbase)

### <a name="use-offline-servicing"></a>Использование автономного обслуживания

Регулярно устанавливайте соответствующие обновления программного обеспечения для файлов образов с помощью Configuration Manager. Это сокращает количество обновлений, которые устанавливаются во время последовательности задач.

Дополнительные сведения см. в разделе [Применение обновлений программного обеспечения к образу](../get-started/manage-operating-system-images.md#BKMK_OSImagesApplyUpdates).

### <a name="single-index"></a>Один индекс

Многие файлы образа содержат несколько индексов, например индексы для разных выпусков Windows. Оставьте в файле образа только один необходимый индекс. Благодаря этому установка обновлений программного обеспечения для образа займет меньше времени. Это также позволит уменьшить размер файла, как рекомендуется ниже.

Начиная с версии 1902 вы можете автоматизировать этот процесс при добавлении образа ОС на сайт. Подробнее см. в разделе о [добавлении образа операционной системы](../get-started/manage-operating-system-images.md#BKMK_AddOSImages).<!--3719699-->

### <a name="reduce-image-size"></a><a name="bkmk_resetbase"></a> Уменьшение размера образа

При применении обновлений программного обеспечения к образу можно оптимизировать результат, удалив заменяемые обновления. Используйте программу командной строки DISM, например:

``` Command
dism /Mount-Image /ImageFile:C:\Data\install.wim /MountDir:C:\Mountdir
dism /Image:C:\Mountdir /Cleanup-Image /StartComponentCleanup /ResetBase
dism /Unmount-Image /MountDir:C:\Mountdir /Commit  
```

В версии 1902 представлен новый параметр, позволяющий автоматизировать этот процесс. Дополнительные сведения см. в разделе [Оптимизированное обслуживание образов](../get-started/manage-operating-system-images.md#bkmk_resetbase).<!--3555951-->


## <a name="image-engineering-decisions"></a>Решения на этапе разработки процесса создания образа

При разработке процесса создания образа несколько параметров могут повлиять на установку обновлений программного обеспечения:

- [периодическая перезапись образа](#bkmk_goldimage);  
- [использование автономного обслуживания](#bkmk_offline);  
- [использование только образа по умолчанию](#bkmk_installwim).

### <a name="periodically-recapture-the-image"></a><a name="bkmk_goldimage"></a> Периодическая перезапись образа

Вы можете автоматически записывать пользовательский образ ОС через указанные временные промежутки. Эта последовательность задач записи устанавливает последние обновления программного обеспечения. Сюда входят накопительные, ненакопительные и другие критически важные обновления, например обновления стека обслуживания (SSU). Последовательность задач развертывания устанавливает все дополнительные обновления, которые появились с момента записи.

Дополнительные сведения об этом процессе см. в статье [Создание последовательности задач для записи операционной системы в System Center Configuration Manager](../deploy-use/create-a-task-sequence-to-capture-an-operating-system.md).

#### <a name="advantages"></a>Преимущества

- Меньше обновлений в процессе развертывания для каждого клиента, что экономит время и пропускную способность.
- Меньше перезапусков системы из-за обновлений.
- Настроенный образ для организации.
- Меньше переменных при развертывании.

#### <a name="disadvantages"></a>Недостатки

- Время на создание и запись образа, хотя это в основном и автоматический процесс.
- Больше времени на передачу образа в точки распространения, что может восприниматься как сбой для активных развертываний.
- Тестирование в подготовительных средах может занимать больше времени, чем цикл исправлений ОС, из-за чего обновленный образ может стать несоответствующим.


### <a name="use-offline-servicing"></a><a name="bkmk_offline"></a> Использование автономного обслуживания

Вы можете запланировать автоматическое применение обновлений программного обеспечения с помощью Configuration Manager.

Дополнительные сведения см. в разделе [Применение обновлений программного обеспечения к образу](../get-started/manage-operating-system-images.md#BKMK_OSImagesApplyUpdates).

#### <a name="advantages"></a>Преимущества

- Меньше обновлений в процессе развертывания для каждого клиента, что экономит время и пропускную способность.
- Меньше перезапусков системы из-за обновлений.
- Возможность запланировать обслуживание на сайте.

#### <a name="disadvantages"></a>Недостатки

- Выбор обновлений вручную.
- Больше времени на передачу образа в точки распространения.
- Поддержка только обновлений на базе CBS. Обновления Office не применяются.

> [!Tip]  
> Обновления программного обеспечения можно выбирать автоматически с помощью PowerShell. Выведите список обновлений с помощью командлета [Get-CMSoftwareUpdate](https://docs.microsoft.com/powershell/module/configurationmanager/get-cmsoftwareupdate?view=sccm-ps). Затем используйте командлет [New-CMOperatingSystemImageUpdateSchedule](https://docs.microsoft.com/powershell/module/configurationmanager/new-cmoperatingsystemimageupdateschedule?view=sccm-ps), чтобы запланировать автономное обслуживание. В следующем примере показан один из методов для автоматизации этого действия.
>
> ```PowerShell
> # Get the OS image
> $Win10Image = Get-CMOperatingSystemImage -Name "Windows 10 Enterprise"
>
> # Get the latest cumulative update for Windows 10 1809
> $OSBuild = "1809"
> $LatestUpdate = Get-CMSoftwareUpdate -Fast | Where {$_.LocalizedDisplayName -Like "*Cumulative Update for Windows 10 Version $OSBuild for x64*" -and $_.LocalizedDisplayName -notlike "*Dynamic*"} | Sort-Object ArticleID -Descending | Select -First 1
> Write-Host "Latest update for Windows 10 build" $OSBuild "is" $LatestUpdate.LocalizedDisplayName
>
> # Create a new update schedule to apply the latest update
> New-CMOperatingSystemImageUpdateSchedule -Name $Win10Image.Name -SoftwareUpdate $LatestUpdate -RunNow -ContinueOnError $True
> ```


### <a name="use-default-image-only"></a><a name="bkmk_installwim"></a> Использование только образа по умолчанию

В последовательностях задач развертывания используется образ Windows по умолчанию install.wim.

#### <a name="advantages"></a>Преимущества

- Надежный источник, который снижает риск повреждения образа.
- Отсутствие изменений образа, которые могут привести к проблемам.

#### <a name="disadvantages"></a>Недостатки

- Потенциально большое количество обновлений при развертывании.
- Больше времени на развертывание для каждого устройства.
- Из-за отсутствия необходимых настроек может понадобиться дополнительная последовательность задач.



## <a name="flowchart"></a>Блок-схема

На следующей блок-схеме показан процесс выполнения последовательности задач с этапом "Установить обновления программного обеспечения".

[Просмотреть схему в полном размере](media/ts-step-install-software-updates.svg)

![Блок-схема для этапа последовательности задач "Установить обновления программного обеспечения"](media/ts-step-install-software-updates.svg)  

1. **Начало процесса на клиенте**. Последовательность задач, запущенная на клиенте, включает этап "Установить обновления программного обеспечения".
2. **Компиляция и оценка политик**. Клиент компилирует все политики обновления программного обеспечения в пространство имен WMI RequestedConfigs. (CIAgent.log)
3. *Это первый вызов этого экземпляра?*  
    1. **Да**. Перейдите к этапу **Полная проверка**.  
    2. **Нет**. *Настроен ли этот этап для [оценки обновлений программного обеспечения на основе кэшированных результатов проверки](task-sequence-steps.md#evaluate-software-updates-from-cached-scan-results)?*
        1. **Да**. Перейдите к этапу **Проверка на основе кэшированных результатов**.
        2. **Нет**. Перейдите к этапу **Полная проверка**.
4. Процесс проверки: полная проверка или проверка на основе кэшированных результатов с параллельным мониторингом.
    1. **Полная проверка**. Подсистема выполнения последовательности задач вызывает агент обновления программного обеспечения через API проверки обновления для *полной* проверки. (WUAHandler.log, ScanAgent.log)  
        1. **Проверка агента SUM — полная**. Обычный процесс проверки через агент Центра обновления Windows, который взаимодействует с точкой обновления программного обеспечения, где запущены службы WSUS. В ходе этого процесса все применимые обновления добавляются в локальное хранилище обновлений. (WindowsUpdate.log, UpdateStore.log)
    2. **Проверка на основе кэшированных результатов**. Подсистема выполнения последовательности задач вызывает агент обновления программного обеспечения через API проверки обновления для проверки на основе кэшированных метаданных. (WUAHandler.log, ScanAgent.log)
        1. **Проверка агента SUM — кэшированные данные**. Агент Центра обновления Windows проверяет наличие необходимых обновлений среди кэшированных обновлений в локальном хранилище. (WindowsUpdate.log, UpdateStore.log)
    3. **Запуск таймера проверки**. Подсистема выполнения последовательности задач запускает таймер и ожидает. (Этот процесс идет одновременно с полной проверкой или проверкой на основе кэшированных результатов.)
        1. **Мониторинг**. Подсистема выполнения последовательности задач отслеживает состояние агента SUM.
        2. *Какой ответ получен от агента SUM?*
            - **Выполняется**. Достиг ли таймер значения, указанного в переменной последовательности задач [SMSTSSoftwareUpdateScanTimeout](task-sequence-variables.md#SMSTSSoftwareUpdateScanTimeout)? (По умолчанию — 1 час.)
                - **Да**. Шаг завершился с ошибкой.
                - **Нет**. Перейдите к этапу **Мониторинг**.
            - **Ошибка**: Шаг завершился с ошибкой.
            - **Завершено** — Перейдите к этапу **Составление списка обновлений**.
5. **Составление списка обновлений**. Агент SUM выводит список обновлений по результатам проверки, определяя доступные и обязательные обновления.
6. *Есть ли обновления в списке результатов проверки?*
    - **Да**. Перейдите к этапу **Установка обновлений**.
    - **Нет**. Нет обновлений для установки. Этап завершен.
7. Процесс развертывания. Процесс установки обновлений протекает параллельно с процессом мониторинга развертывания.
    1. **Установка обновлений**. Подсистема выполнения последовательности задач вызывает агент SUM через API проверки обновления для установки всех доступных или только обязательных обновлений. Это зависит от выбранных настроек этапа: **Обязательные — только обязательные обновления ПО** или **Доступные — все обновления программного обеспечения**. Это поведение также можно определить с помощью переменной [SMSInstallUpdateTarget](task-sequence-variables.md#SMSInstallUpdateTarget).
        1. **Установка агента SUM**. Обычный процесс установки с использованием существующего кэшированного списка обновлений и стандартной загрузкой содержимого. Установка обновлений через агент Центра обновления Windows. (UpdatesDeployment.log, UpdatesHandler.log, WuaHandler.log, WindowsUpdate.log)
    2. **Запуск таймера развертывания и отображение хода выполнения**. Подсистема выполнения последовательности задач запускает таймер установки, отображает ход выполнения с интервалами 10 % в соответствующем интерфейсе и ожидает.
        1. **Мониторинг**. Подсистема выполнения последовательности задач запрашивает состояние агента SUM.
        2. *Какой ответ получен от агента SUM?*
            - **Выполняется**. *Был ли процесс установки неактивным в течение 8 часов?*
                - **Да**. Шаг завершился с ошибкой.
                - **Нет**. Перейдите к этапу **Мониторинг**.
            - **Ошибка**: Шаг завершился с ошибкой.
            - **Завершено** — Перейдите к шагу *Настроен ли этот этап для **оценки обновлений программного обеспечения на основе кэшированных результатов проверки**?*


### <a name="timeouts"></a>Время ожидания

На схеме показаны две переменные времени ожидания, которые касаются этого этапа. На процесс могут влиять другие стандартные таймеры других компонентов.

- Время ожидания проверки обновлений: 1 час (smsts.log)  
- Время ожидания запроса расположения: 1 час (LocationServices.log, CAS.log)  
- Время ожидания загрузки содержимого: 1 час (DTS.log)  
- Время ожидания неактивной точки распространения: 1 час (LocationServices.log, CAS.log)  
- Время ожидания пребывания установки в неактивном состоянии: 8 часов (smsts.log)  



## <a name="troubleshooting"></a>Устранение неполадок

Для устранения неполадок на этом этапе используйте следующие ресурсы и дополнительные сведения:

- Развертывания обновлений программного обеспечения должны быть нацелены на ту же коллекцию, что и развертывание последовательности задач.  

- Группы границ должны включать точки обновления программного обеспечения. Дополнительные сведения см. в этой [статье на веб-сайте технической поддержки Майкрософт](https://support.microsoft.com/help/4041012/1702-clients-do-not-get-software-updates-from-configuration-manager).  

- Для устранения неполадок, возникающих в процессе управления обновлением программного обеспечения, см. [это руководство](https://support.microsoft.com/help/10680/software-update-management-troubleshooting-in-configuration-manager).  

- Чтобы улучшить общую производительность, уменьшите размер каталога обновлений программного обеспечения. Пример.  

    - Удалите ненужные классификации, продукты и языки. Дополнительные сведения см. в статье [Настройка классификаций и продуктов для синхронизации](../../sum/get-started/configure-classifications-and-products.md).  

    - Повторно индексируйте базу данных сайта и повторно соберите статистику. Дополнительные сведения см. в техническом документе [Configuration Manager Perf and Scale Guidance Whitepaper](https://gallery.technet.microsoft.com/Configuration-Manager-ba55428e) (Руководство по повышению производительности и масштабированию Configuration Manager).  

    - Отклоните ненужные обновления, например:
        - заменяемые (Начиная с версии 1810, Configuration Manager делает это автоматически. Дополнительные сведения см. в разделе [Поведение очистки WSUS, начиная с версии 1810](../../sum/deploy-use/software-updates-maintenance.md#wsus-cleanup-behavior-starting-in-version-1810).);
        - Itanium;
        - Бета;
        - Version Next;
        - ARM
        - версии Windows, которые вы не развертываете.
