---
title: Использование переменных последовательности задач
titleSuffix: Configuration Manager
description: Сведения об использовании переменных для последовательности задач Configuration Manager.
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: bc7de742-9e5c-4a70-945c-df4153a61cc3
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: c043cfabc411dbd5ae4984110fc2904d37669300
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81700212"
---
# <a name="how-to-use-task-sequence-variables-in-configuration-manager"></a>Использование переменных последовательности задач в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

 Подсистема выполнения последовательности задач в функции развертывания операционной системы Configuration Manager использует много переменных для управления поведением развертывания. Эти переменные позволяют настроить следующее:

- задать условия для шагов;  
- изменить поведение отдельных шагов;  
- контролировать более сложные действия при использовании в составе скриптов.  

Все доступные переменные последовательности задач перечислены в справочнике [Task sequence variables in Configuration Manager](task-sequence-variables.md) (Переменные последовательности задач в Configuration Manager).

## <a name="types-of-variables"></a><a name="bkmk_types"></a> Типы переменных

Существует несколько типов переменных:  

- [встроенные](#bkmk_built-in);  
- [Действие](#bkmk_action)  
- [Пользовательский](#bkmk_custom)  
- [только для чтения](#bkmk_read-only);  
- [массив](#bkmk_array).  

### <a name="built-in-variables"></a><a name="bkmk_built-in"></a> Встроенные переменные

Встроенные переменные содержат сведения о среде, в которой выполняется последовательность задач. Их значения доступны в любом месте последовательности задач. Обычно подсистема выполнения последовательности задач инициализирует встроенные переменные до того, как начнет выполнять шаги.

Например, встроенная переменная среды `_SMSTSLogPath` указывает путь для записи файлов журналов из компонентов Configuration Manager. Эта переменная среды доступна любому шагу последовательности задач.

Последовательность задач оценивает некоторые переменные перед каждым шагом. Например, `_SMSTSCurrentActionName` содержит имя текущего шага.

### <a name="action-variables"></a><a name="bkmk_action"></a> Переменные действия

Переменные действия в последовательности задач содержат параметры конфигурации для определенного шага последовательности задач. По умолчанию каждый шаг инициализирует свои параметры перед выполнением. Эти параметры доступны только во время выполнения соответствующего шага последовательности задач. Последовательность задач добавляет значение переменной действия в среду перед выполнением соответствующего шага. После завершения шага последовательность задач удаляет это значение из среды.

Предположим, вы добавили в последовательность задач шаг **Выполнить из командной строки**. Этот шаг включает свойство **Рабочая папка**. Последовательность задач сохраняет значение по умолчанию для этого свойства в переменной `WorkingDirectory`. Последовательность задач инициализирует это значение перед выполнением шага **Выполнить из командной строки**. Пока этот шаг выполняется, значение переменной **Рабочая папка** можно получить из свойства `WorkingDirectory`. После завершения этого шага последовательность задач удаляет значение переменной `WorkingDirectory` из среды. Если последовательность задач включает еще один шаг **Выполнить из командной строки**, она инициализирует новую переменную `WorkingDirectory`. В этот момент последовательность задач присвоит этой переменной начальное значение для текущего шага. Дополнительные сведения см. в описании [WorkingDirectory](task-sequence-variables.md#WorkingDirectory).  

Значение *по умолчанию* для переменной действия существует, пока выполняется соответствующий шаг. Если вы определите для нее *новое* значение, оно будет доступно для нескольких шагов последовательности задач. В случае переопределения новое значение сохраняется в среде. Это новое значение переопределяет также значение по умолчанию, указанное для других шагов в последовательности задач. Например, вы можете добавить шаг **Задать переменную последовательности задач** в качестве первого шага последовательности задач. Этот шаг позволяет задать для переменной `WorkingDirectory` значение `C:\`. Теперь любой шаг **Выполнить из командной строки** в этой последовательности задач будет использовать новое значение рабочей папки.  

Некоторые шаги последовательности задач маркируют определенные переменные действия как *выходные*. Эти переменные считываются на последующих шагах последовательности задач.

> [!Note]  
> Не все шаги последовательности задач используют переменные действия. Например, для действия **Включить BitLocker** переменные определены, а для действия **Отключить BitLocker** — нет.  

### <a name="custom-variables"></a><a name="bkmk_custom"></a> Пользовательские переменные

Сюда относятся все переменные, которые не создает Configuration Manager. Вы можете использовать собственные переменные в качестве условий, параметров командной строки или значений для скриптов.

При указании имени новой переменной последовательности задач следует соблюдать определенные правила.  

- Имя переменной последовательности задач может содержать буквы, цифры, символ подчеркивания (`_`) и дефис (`-`).  

- Имена переменных последовательности задач могут иметь длину от 1 до 256 символов.  

- Определяемые пользователем переменные должны начинаться с буквы (`A-Z` или `a-z`).  

- Имена определяемых пользователем переменных не могут начинаться с символа подчеркивания. Символ подчеркивания в начале имени обозначает переменные последовательности задач, доступные только для чтения.  

- В именах переменных последовательности задач регистр не учитывается. Например, имена `OSDVAR` и `osdvar` обозначают одну и ту же переменную последовательности задач.  

- Имена переменных последовательности задач не могут начинаться или заканчиваться пробелом. Также пробелы не могут содержаться внутри имени. Последовательность задач игнорирует любые пробелы перед именем переменной или после него.  

Не существует ограничений на количество создаваемых переменных последовательности задач. Однако количество переменных ограничено размером среды последовательности задач. Общий размер среды последовательности задач ограничен объемом 32 МБ.  

### <a name="read-only-variables"></a><a name="bkmk_read-only"></a> Переменные только для чтения

Некоторые переменные используются только для чтения, то есть вы не можете изменить их значения. Имена таких переменных обычно начинаются с символа подчеркивания (`_`). Последовательность задач использует их для своих операций. Переменные только для чтения доступны в среде последовательности задач.

Эти переменные можно использовать в скриптах или командной строке. Например, можно запустить командную строку и направить ее вывод в файл журнала, расположенный в папке `_SMSTSLogPath`, где хранятся другие файлы журнала.

> [!NOTE]  
> Переменные последовательности задач только для чтения могут считываться шагами последовательности задач, но не могут быть изменены. Например, переменную только для чтения можно включить в командную строку для шага **Выполнить из командной строки**. Нельзя задать значение переменной только для чтения с помощью шага **Задать переменную последовательности задач**.  

### <a name="array-variables"></a><a name="bkmk_array"></a> Переменные массива

Последовательность задач сохраняет некоторые переменные в виде массивов. Каждый элемент массива содержит параметры для одного объекта. Эти переменные удобны в тех ситуациях, когда на устройстве нужно настроить несколько объектов. Переменные массива используются в следующих шагах последовательности задач:

- [Применить параметры сети](task-sequence-steps.md#BKMK_ApplyNetworkSettings)  

- [Отформатировать диск и создать разделы](task-sequence-steps.md#BKMK_FormatandPartitionDisk)  

## <a name="how-to-set-variables"></a><a name="bkmk_set"></a> Присвоение переменным значений

Для пользовательских переменных и любых других переменных, кроме предназначенных только для чтения, есть несколько способов инициализировать и присвоить значения.  

- Шаг [Задать переменную последовательности задач](#bkmk_set-ts-step)
- Шаг [Настройка динамических переменных](#bkmk_set-dyn-step)
- Шаг [Запуск скрипта PowerShell](#bkmk_run-ps)
- [Переменные коллекции и устройства](#bkmk_set-coll-var)  
- [COM-объект TSEnvironment](#bkmk_set-com)  
- [Команда перед запуском](#bkmk_set-prestart)  
- [Мастер создания последовательности задач](#bkmk_set-tswiz)
- [Мастер носителя последовательности задач](#bkmk_set-media)  

Чтобы удалить переменную из среды, используйте те же методы, что и для ее создания. Чтобы удалить переменную, присвойте ей в качестве значения пустую строку.  

В рамках одной последовательности вы можете комбинировать разные методы присвоения значений переменным. Например, можно задать значения по умолчанию с помощью редактора последовательности задач, а затем настроить пользовательские значения с помощью скрипта.

Если для одной переменной используется несколько методов присвоения значений, подсистема последовательности задач использует следующий алгоритм:  

1. Сначала проверяются переменные коллекции.  

2. Переменные конкретного устройства переопределяют переменные с теми же именами, заданные в коллекции.  

3. Переменные, заданные любым методом во время выполнения последовательности задач, переопределяют значения, заданные в коллекции или для устройства.  

### <a name="general-limitations-for-task-sequence-variable-values"></a>Общие ограничения для значений переменных последовательности задач

- Общая длина значений переменных последовательности задач не может превышать 4000 символов.  

- Нельзя изменять значение переменных последовательности задач, предназначенных только для чтения. Имена переменных только для чтения начинаются с символа подчеркивания (`_`).  

- В зависимости от того, как используются переменные последовательности задач, в их значениях может учитываться регистр. В большинстве случаев регистр не учитывается. Регистр всегда учитывается для переменных, в которые хранятся значения паролей.  

### <a name="set-task-sequence-variable"></a><a name="bkmk_set-ts-step"></a> Задать переменную последовательности задач

Используйте этот шаг в последовательности задач, чтобы присвоить одной переменной одно значение.

Дополнительные сведения см. в разделе [Задать переменную последовательности задач](task-sequence-steps.md#BKMK_SetTaskSequenceVariable).

### <a name="set-dynamic-variables"></a><a name="bkmk_set-dyn-step"></a> Задать динамические переменные

Этот шаг последовательности задач позволяет задать значения для одной или нескольких переменных последовательности задач. На этом шаге можно определить правила использования переменных и их значений.

Дополнительные сведения см. в разделе [Задать динамические переменные](task-sequence-steps.md#BKMK_SetDynamicVariables).

### <a name="run-powershell-script"></a><a name="bkmk_run-ps"></a> Запустить сценарий PowerShell

<!-- 6315548 -->

Этот шаг в последовательности задач позволяет задать значение для переменной последовательности задач с помощью скрипта PowerShell.

На этом шаге можно указать имя скрипта из пакета или сразу ввести скрипт PowerShell. Затем используя свойство шага **Вывод в переменную последовательности задач**, сохраните выходные данные скрипта в пользовательскую переменную последовательности задач.

См. сведения о шаге [Запуск скрипта PowerShell](task-sequence-steps.md#BKMK_RunPowerShellScript).

> [!NOTE]
> С помощью скрипта PowerShell можно также задать одну или несколько переменных, используя объект **TSEnvironment**. Дополнительные сведения см. в статье [How to Use Task Sequence Variables in a Running Configuration Manager Task Sequence](../../develop/osd/how-to-use-task-sequence-variables-in-a-running-task-sequence.md) (Использование переменных при выполнении последовательности задач в Configuration Manager) из набора документации по пакету SDK для Configuration Manager.

#### <a name="example-scenario-with-run-powershell-script-step"></a>Пример сценария с использованием шага "Запуск скрипта PowerShell"

В вашей среде есть пользователи из нескольких стран, поэтому вам нужно запросить значение языка операционной системы (ОС), чтобы использовать его в качестве условия на нескольких зависящих от языка шагах **Применение ОС**.

1. В последовательность задач добавьте экземпляр шага **Запуск скрипта PowerShell** перед шагами **Применение ОС**.

1. Используйте параметр шага **Ввод скрипта PowerShell**, чтобы указать следующую команду:

    ```powershell
    (Get-Culture).TwoLetterISOLanguageName
    ```

    См. сведения о командлете [Get-Culture](https://docs.microsoft.com/powershell/module/microsoft.powershell.utility/get-culture). См. сведения о двухбуквенных кодах названий языков по стандарту ISO в [списке кодов ISO 639-1](https://wikipedia.org/wiki/List_of_ISO_639-1_codes).

1. Для параметра шага **Вывод в переменную последовательности задач** укажите значение `CurrentOSLanguage`.

    ![Снимок экрана с примером использования шага "Запуск скрипта PowerShell"](media/run-powershell-script-example-language.png)

1. На шаге **Применение ОС** для англоязычной версии образа создайте такое условие: `Task Sequence Variable CurrentOSLanguage equals "en"`

    ![Снимок экрана с примером условия на шаге "Применение ОС"](media/condition-custom-task-sequence-variable.png)

    > [!TIP]
    > См. сведения о создании условия на шаге в инструкциях по [получению доступа к переменным](#bkmk_access-condition).

1. Сохраните и разверните последовательность задач.

Если шаг **Запуск скрипта PowerShell** выполняется на устройстве с англоязычной версией Windows, команда возвращает значение `en`. Затем это значение сохраняется в пользовательской переменной. Если шаг **Применение ОС** для англоязычной версии образа, выполняется на том же устройстве, условие принимает значение true. При наличии нескольких экземпляров шага **Применение ОС** для разных языков, последовательность задач динамически выполняет шаг, соответствующий языку ОС.

### <a name="collection-and-device-variables"></a><a name="bkmk_set-coll-var"></a> Переменные коллекции и устройства

Для устройств и коллекций можно задать настраиваемые переменные последовательности задач. Переменные, которые вы определяете для устройства, называются переменными последовательности задач для устройства. Переменные, определенные для коллекции, называются переменными последовательности задач для коллекции. При возникновении конфликта переменные для устройства имеют приоритет над переменными для коллекции. Это означает, что переменные последовательности задач, автоматически назначенные определенному устройству, имеют более высокий приоритет, чем переменные, назначенные коллекции, содержащей устройство.  

Например устройство XYZ является членом коллекции ABC. Вы назначили коллекции ABC переменную MyVariable со значением 1. Также вы назначили устройству XYZ переменную MyVariable со значением 2. Переменная, назначенная устройству XYZ, имеет более высокий приоритет, чем та, которая назначена коллекции ABC. Когда последовательность задач, использующая эту переменную, выполняется на устройстве XYZ, MyVariable принимает значение 2.

Вы можете скрыть переменные для устройства и для коллекции, чтобы они не отображались в консоли Configuration Manager. Если выбран параметр **Не показывать это значение на консоли Configuration Manager**, значение переменной не отображается в консоли. Переменная может по-прежнему использоваться последовательностью задач при запуске. Если вы хотите, чтобы переменные перестали быть скрытыми, сначала удалите их. Затем переопределите эти переменные, не указывая параметр, отвечающий за скрытие.  

> [!WARNING]  
> Параметр **Не показывать это значение на консоли Configuration Manager** применяется только к консоли Configuration Manager. Значения переменных по-прежнему отображаются в файле журнала последовательности задач (**smsts.log**).

Управление переменными для устройства может осуществляться на первичном сайте или на сайте центра администрирования. Configuration Manager не поддерживает назначение более 1000 переменных одному устройству.  

> [!IMPORTANT]  
> При использовании переменных коллекции для последовательностей задач необходимо иметь в виду следующие особенности.  
>
> - Изменения в коллекциях всегда реплицируются в рамках всей иерархии. Изменения, вносимые в переменные коллекции, применяются не только к членам текущего сайта, но и ко всем членам коллекции в иерархии.  
>  
> - При удалении коллекции также удаляются переменные последовательности задач, настроенные для этой коллекции.  

#### <a name="create-task-sequence-variables-for-a-device"></a>Создание переменных последовательности задач для *устройства*

1. В консоли Configuration Manager перейдите в рабочую область **Активы и соответствие** и выберите узел **Устройства**.  

2. Выберите целевое устройство и щелкните **Свойства**.  

3. В диалоговом окне **Свойства** перейдите на вкладку **Переменные**.  

4. Для каждой переменной, которую нужно создать, щелкните значок **Создать**. Укажите **имя** и **значение** для переменной последовательности задач. Если хотите, чтобы переменные были скрытыми, то есть не отображались на консоли Configuration Manager, установите флажок **Не показывать это значение на консоли Configuration Manager**.  

5. Завершив добавление переменных в свойства устройства, щелкните **ОК**.  

#### <a name="create-task-sequence-variables-for-a-collection"></a>Создание переменных последовательности задач для *коллекции*

1. В консоли Configuration Manager перейдите в рабочую область **Активы и соответствие** и выберите узел **Коллекции устройств**. Выберите целевую коллекцию и щелкните **Свойства**.  

2. В диалоговом окне **Свойства** перейдите на вкладку **Переменные коллекции**.  

3. Для каждой переменной, которую нужно создать, щелкните значок **Создать**. Укажите **имя** и **значение** для переменной последовательности задач. Если хотите, чтобы переменные были скрытыми, то есть не отображались на консоли Configuration Manager, установите флажок **Не показывать это значение на консоли Configuration Manager**.  

4. При желании можно указать приоритет, который Configuration Manager будет применять при оценке переменных последовательности задач.  

5. Завершив добавление переменных в свойства коллекции, щелкните **ОК**.  

### <a name="tsenvironment-com-object"></a><a name="bkmk_set-com"></a> COM-объект TSEnvironment

Для работы с переменными из скрипта используйте объект **TSEnvironment**.

Дополнительные сведения см. в статье [How to Use Task Sequence Variables in a Running Configuration Manager Task Sequence](../../develop/osd/how-to-use-task-sequence-variables-in-a-running-task-sequence.md) (Использование переменных при выполнении последовательности задач в Configuration Manager) из набора документации по пакету SDK для Configuration Manager.

### <a name="prestart-command"></a><a name="bkmk_set-prestart"></a> Команда перед запуском

Командой перед запуском называется скрипт или исполняемый файл, который выполняется в среде Windows PE перед тем, как пользователь выберет последовательность задач. Команда перед запуском может получать значения переменных или запрашивать сведения у пользователя, чтобы сохранить сведения в среде. Используйте COM-объект [TSEnvironment](#bkmk_set-com) для чтения и записи переменных из команды перед запуском.

Дополнительные сведения см. в статье [Предварительные команды для носителя с последовательностью задач](prestart-commands-for-task-sequence-media.md).

### <a name="task-sequence-wizard"></a><a name="bkmk_set-tswiz"></a> Мастер создания последовательности задач

Начиная с версии 1906 после выбора последовательности задач в окне "Мастер создания последовательности задач" страница изменения переменных в последовательности задач включает кнопку **Изменить**. Доступны сочетания клавиш для изменения переменных. Это изменение помогает в случаях, когда мышь недоступна.<!-- 4668846 -->

### <a name="task-sequence-media-wizard"></a><a name="bkmk_set-media"></a> Мастер носителя последовательности задач

Определите переменные для последовательностей задач, выполняемых с носителя. Если для развертывания операционной системы используется съемный носитель, необходимые переменные последовательности задач и их значения добавляются при создании носителя. Все эти переменные и их значения хранятся на самом носителе.  

> [!NOTE]  
> Последовательности задач хранятся на автономном носителе. Однако все другие типы носителей, такие как предварительно подготовленный носитель, получают последовательности задач с точки управления.  

Для последовательности задач, выполняемой с носителя, переменную можно добавить на странице **Настройка** мастера.

Используйте переменные носителей вместо переменных коллекции или переменных компьютера. Если последовательность задач выполняется с носителя, переменные компьютера и коллекции не определяются и не используются.  

> [!TIP]  
> Последовательность задач записывает идентификатор пакета и строку, выполняющую команду перед запуском, в файл журнала **CreateTSMedia.log** на компьютере, где запущена консоль Configuration Manager. В этот журнал сохраняются значения всех переменных последовательности задач. Просмотрите этот файл журнала, чтобы проверить значения переменных последовательности задач.  

Дополнительные сведения см. в статье [Создание носителя последовательности задач в System Center Configuration Manager](../deploy-use/create-task-sequence-media.md).

## <a name="how-to-access-variables"></a><a name="bkmk_access"></a> Доступ к переменным

После того как вы создадите переменную и значение для нее с помощью любого из описанных выше методов, ее можно использовать в последовательностях задач. Например, можно считывать значения по умолчанию из встроенных переменных последовательности задач или использовать условия для выполнения шагов в зависимости от значения переменной.  

Используйте следующие методы для доступа к значениям переменных в среде последовательности задач:

- [Использование на шаге](#bkmk_access-step)  
- [Условие шага](#bkmk_access-condition)  
- [Пользовательский скрипт](#bkmk_access-script)  
- [Файл ответов программы установки Windows](#bkmk_access-answer)  
  
### <a name="use-in-a-step"></a><a name="bkmk_access-step"></a> Использование на шаге

Укажите значение переменной в параметре для шага последовательности задач. В редакторе последовательности задач внесите изменения в шаг, указав имя переменной в качестве значения поля. Заключите имя переменной в символы процента (`%`).

Например, имя переменной можно включить в поле **Командная строка** для шага **Выполнить из командной строки**. Следующая команда записывает имя компьютера в текстовый файл.

`cmd.exe /c %_SMSTSMachineName% > C:\File.txt`

### <a name="step-condition"></a><a name="bkmk_access-condition"></a> Условие шага

Используйте встроенные или пользовательские переменные последовательности задач в составе условия для шага или группы. Последовательность задач вычисляет значение переменной перед выполнением этого шага или группы.

Чтобы добавить условие, оценивающее значение переменной, выполните следующие действия.  

1. В редакторе последовательности задач выберите шаг или группу, к которым вы хотите добавить условие.  

2. Перейдите на вкладку **Параметры** для этого шага или группы. Щелкните **Добавить условие** и выберите **Переменная последовательности задач**.  

3. В диалоговом окне **Переменная последовательности задач** введите следующие параметры.  

    - **Переменная** — имя переменной. Например, `_SMSTSInWinPE`.  

    - **Условие** — условие проверки значения переменной. Например, **равно**.  

    - **Значение**. значение, с которым будет сравниваться текущее значение переменной. Например, `false`.  

Три представленных выше примера вместе составляют типичное условие, которое проверяет, выполняется ли последовательность задач из образа загрузки в Windows PE:

> **Переменная последовательности задач** `_SMSTSInWinPE equals "false"`

Это условие можно найти в группе **Сбор файлов и параметров** в шаблоне последовательности задач по умолчанию для установки существующего образа операционной системы.

См. дополнительные сведения об [условиях](task-sequence-editor.md#bkmk_conditions) в руководстве по использованию редактора последовательности задач.

### <a name="custom-script"></a><a name="bkmk_access-script"></a> Пользовательский скрипт

Во время выполнения последовательности задач значения переменных можно считывать и записывать с помощью COM-объекта **Microsoft.SMS.TSEnvironment**.

Следующий пример Windows PowerShell запрашивает у переменной **_SMSTSLogPath** текущее расположение журналов. Сценарий также задает пользовательскую переменную.

```PowerShell
# Create an object to access the task sequence environment
$tsenv = New-Object -ComObject Microsoft.SMS.TSEnvironment

# Query the environment to get an existing variable
# Set a variable for the task sequence log path
$LogPath = $tsenv.Value("_SMSTSLogPath")

# Or, convert all of the variables currently in the environment to PowerShell variables
$tsenv.GetVariables() | % { Set-Variable -Name "$_" -Value "$($tsenv.Value($_))" }

# Write a message to a log file
Write-Output "Hello world!" | Out-File -FilePath "$_SMSTSLogPath\mylog.log" -Encoding "Default" -Append

# Set a custom variable "startTime" to the current time
$tsenv.Value("startTime") = (Get-Date -Format HH:mm:ss) + ".000+000"
```

### <a name="windows-setup-answer-file"></a><a name="bkmk_access-answer"></a> Файл ответов программы установки Windows

Вы можете создать файл ответов программы установки Windows со встроенными переменными последовательности задач. Используйте формат `%varname%`, где *varname* обозначает имя переменной. Шаг **Настройка Windows и Configuration Manager** заменяет строку имени переменной фактическим значением этой переменной. Эти встроенные переменные последовательности задач нельзя использовать в полях файла ответов unattend.xml, предназначенных для числовых значений.

Дополнительные сведения см. в разделе [Настройка Windows и Configuration Manager](task-sequence-steps.md#BKMK_SetupWindowsandConfigMgr).

## <a name="see-also"></a>См. также

- [Шаги последовательности задач](task-sequence-steps.md)

- [Переменные последовательности задач](task-sequence-variables.md)

- [Вопросы планирования для автоматизации задач](../plan-design/planning-considerations-for-automating-tasks.md)

- [Редактор последовательности задач](task-sequence-editor.md)
