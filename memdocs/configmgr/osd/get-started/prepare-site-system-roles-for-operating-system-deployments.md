---
title: Подготовка ролей системы сайта к развертыванию операционной системы
titleSuffix: Configuration Manager
description: Настройте роли системы сайта перед развертыванием операционных систем в Configuration Manager.
ms.date: 07/30/2018
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 0ef5f3ce-b0e4-4775-b5c2-b245e45b4194
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 1beec2f5ef7b6da9f1f093300ec6c2b239e7396e
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81708802"
---
# <a name="prepare-site-system-roles-for-os-deployments-with-configuration-manager"></a>Подготовка ролей системы сайта к развертываниям операционной системы с помощью Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Для развертывания операционных систем в Configuration Manager необходимо сначала подготовить следующие роли системы сайта, для которых требуются определенные конфигурации и соображения.



##  <a name="distribution-points"></a><a name="BKMK_DistributionPoints"></a> точки распространения;  

Роль системы сайта точки распространения содержит исходные файлы, которые загружаются клиентами. Это содержимое предназначено для приложений, обновлений программного обеспечения, образов операционной системы, образов загрузки и пакетов драйверов. Для контроля распространения содержимого можно использовать параметры пропускной способности, регулирования и планирования.  

Важно иметь достаточное количество точек распространения для поддержки развертывания операционных систем на компьютерах. Также важно спланировать размещение этих точек распространения в вашей иерархии. Дополнительные сведения см. в разделе [Управление содержимым и инфраструктурой содержимого](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md). В этой статье описываются некоторые другие аспекты планирования для точек распространения, связанные с развертыванием операционной системы.  


###  <a name="additional-planning-considerations-for-distribution-points"></a><a name="BKMK_AdditionalPlanning"></a> Дополнительные аспекты планирования для точек распространения  

Ниже приведены дополнительные аспекты планирования для точек распространения.  

#### <a name="how-can-i-prevent-unwanted-os-deployments"></a>Как предотвратить нежелательные развертывания ОС?  
Configuration Manager не отличает серверы сайта от других конечных компьютеров в коллекции. При развертывании нужной последовательности задач в коллекции с сервером сайта выполнение последовательности на этом сервере ничем не будет отличаться от ее выполнения на любом другом компьютере в коллекции. Убедитесь, что в развертывании ОС используется коллекция, включающая нужных клиентов.  

Вы можете управлять поведением развертываний последовательности задач с высоким риском. Развертывание с высоким риском автоматически устанавливается на клиенте и потенциально может привести к нежелательным результатам. Например, это последовательность задач с целью "Обязательно", которая выполняет развертывание ОС. Чтобы снизить вероятность нежелательного развертывания с высоким риском, можно настроить параметры проверки развертывания. Дополнительные сведения см. в разделе [Параметры для управления развертываниями с высоким риском](../../core/servers/manage/settings-to-manage-high-risk-deployments.md).  

#### <a name="how-many-computers-can-receive-an-os-image-at-one-time-from-a-single-distribution-point"></a>Сколько компьютеров могут одновременно получить образ ОС из одной точки распространения?  
Чтобы оценить необходимое число точек распространения, учтите следующие переменные:  
- Скорость обработки точки распространения
- Скорость диска точки распространения
- Пропускная способность сети
- Размер пакета образа   
  
Например, если не учитывать другие серверные ресурсы, максимальное число компьютеров, способных обработать пакет с образом размером 4 ГБ за один час в сети Ethernet со скоростью передачи данных 100 Мбит/с, будет равно 11.  

`100 megabits/sec = 12.5 megabytes/sec = 750 megabytes/min = 45 gigabytes/hour = 11 images @ 4 GB per image`  

Если нужно выполнить развертывание ОС на определенное число компьютеров в течение заданного промежутка времени, пакет с образом следует распределить по достаточному количеству точек распространения.  

#### <a name="can-i-deploy-an-os-to-a-distribution-point"></a>Можно ли развернуть образ ОС на точке распространения?  
Вы можете развернуть ОС на точке распространения, но этот образ ОС должен быть получен из другой точки распространения.  


###  <a name="configuring-distribution-points-to-accept-pxe-requests"></a><a name="BKMK_PXEDistributionPoint"></a> Настройка точек распространения для приема PXE-запросов  

Чтобы развернуть операционные системы в клиентах Configuration Manager, отправляющих PXE-запросы загрузки, необходимо настроить одну или несколько точек распространения на прием PXE-запросов. После настройки точка распространения будет отвечать на PXE-запросы загрузки и сможет определить и предпринять нужные действия развертывания. Дополнительные сведения см. в разделе [Установка или изменение точки распространения](../../core/servers/deploy/configure/install-and-configure-distribution-points.md#bkmk_config-pxe).  


###  <a name="customize-the-ramdisk-tftp-block-and-window-sizes-on-pxe-enabled-distribution-points"></a><a name="BKMK_RamDiskTFTP"></a> Настройка размеров блока и окна RamDisk TFTP в точках распространения с поддержкой PXE  

Вы можете настроить размеры блока и окна RamDisk TFTP в точках распространения с поддержкой PXE. Если изменить настройки сети, слишком большой размер блока или окна может привести к тому, что при скачивании образа загрузки произойдет ошибка тайм-аута. Настройка размеров блока и окна RamDisk TFTP позволяет оптимизировать трафик TFTP при использовании PXE для соответствия определенным требованиям сети. Чтобы определить наиболее эффективный вариант конфигурации, необходимо протестировать измененные параметры в среде пользователя.  

-   **Размер блока TFTP**. Размер блока — это размер пакетов данных, отправляемых сервером клиенту, который загружает файл. Больший размер блока позволяет серверу отправлять меньшее число пакетов, поэтому между сервером и клиентом возникает меньше задержек кругового пути. Однако большие размеры блока приводят к фрагментации пакетов, которую не поддерживает большинство реализаций PXE-клиента.  

-   **Размер окна TFTP**. TFTP требуется пакет подтверждения (ACK) для каждого передаваемого блока данных. Сервер не отправляет следующий блок в последовательности, пока не получит пакет ACK для предыдущего блока. Управление окнами TFTP позволяет определять, сколько блоков данных требуется для заполнения окна. Сервер отправляет блоки данных один за другим до заполнения окна, а затем клиент отправляет пакет ACK. Увеличение размера этого окна уменьшает число задержек кругового пути между клиентом и сервером, а также уменьшает общее время, необходимое для скачивания образа загрузки.  
  

#### <a name="modify-the-ramdisk-tftp-window-size"></a>Изменение размера окна RamDisk TFTP  
Чтобы настроить размер окна RamDisk TFTP, добавьте следующий раздел реестра в точках распространения с поддержкой PXE:  

- **Расположение**: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP`  
- **Имя** — RamDiskTFTPWindowSize  
- **Тип**: REG_DWORD  
- **Значение** (измененный размер окна):  
    - Значение по умолчанию — **1** (один блок данных заполняет окно).  

#### <a name="modify-the-ramdisk-tftp-block-size"></a>Изменение размера блока RamDisk TFTP  
Чтобы настроить размер окна RamDisk TFTP, добавьте следующий раздел реестра в точках распространения с поддержкой PXE:  

- **Расположение**: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP`  
- **Имя** — RamDiskTFTPBlockSize  
- **Тип** — REG_DWORD  
- **Значение** (измененный размер блока):  
    - Значение по умолчанию — **4096**.  

> [!Note]  
> Службы развертывания Windows и служба отвечающего устройства PXE Configuration Manager поддерживают эти конфигурации TFTP.  


###  <a name="configure-distribution-points-to-support-multicast"></a><a name="BKMK_DPMulticast"></a> Настройка точек распространения для поддержки многоадресной рассылки  

Многоадресная рассылка — это метод оптимизации сети. Используйте этот метод на точках распространения, когда несколько клиентов с высокой вероятностью будут скачивать один и тот же образ ОС одновременно. При использовании многоадресной рассылки несколько компьютеров могут одновременно скачивать образ ОС, поскольку он рассылается точкой распространения по нескольким адресам. Без многоадресной рассылки точка распространения отправляет копию данных каждому клиенту по отдельному каналу. Дополнительные сведения см. в разделе [Использование многоадресной рассылки для развертывания Windows по сети](../deploy-use/use-multicast-to-deploy-windows-over-the-network.md).  

Перед развертыванием ОС необходимо настроить точку распространения и обеспечить поддержку многоадресной рассылки. Дополнительные сведения см. в разделе [Установка и настройка точек распространения](../../core/servers/deploy/configure/install-and-configure-distribution-points.md#bkmk_config-multicast).



##  <a name="state-migration-point"></a><a name="BKMK_StateMigrationPoints"></a> Точка миграции среды  

Точка миграции состояния хранит данные пользовательской среды, собираемые средством миграции пользовательской среды на одном компьютере и затем восстанавливаемые на другом. Следует учитывать, что при сборе параметров пользователей для развертывания ОС на одном компьютере (например, при обновлении Windows на конечном компьютере) данные можно сохранить как на этом же компьютере с помощью жестких связей, так и в точке миграции состояния. В некоторых случаях (при создании в процессе развертывания хранилища состояний) Configuration Manager автоматически создает связь между хранилищем и конечным компьютером. При планировании точки миграции состояния следует учитывать следующие факторы.    


### <a name="user-state-size"></a>Размер данных пользовательской среды  

Размер данных пользовательской среды оказывает самое непосредственное влияние на дисковое пространство, используемое на точке миграции состояния, и нагрузку на сеть при миграции. Следует учесть размер данных пользовательской среды и число обрабатываемых компьютеров. Следует также решить, что именно будет переноситься с компьютеров в ходе миграции. Например, если резервная копия папки **Мои документы** уже создана на сервере, то скорее всего ее не потребуется переносить в ходе развертывания образа. Исключение из процесса ненужных операций переноса будет способствовать уменьшению общего размера данных пользовательской среды и снижению его влияния на производительность сети и дисковое пространство на точке миграции состояния.  


### <a name="user-state-migration-tool"></a>Средство миграции пользовательской среды  

Для сбора данных пользовательской среды и их восстановления в ходе развертывания операционных систем необходимо использовать пакет средства миграции пользовательской среды (USMT), указывающий на исходные файлы этого средства. Configuration Manager автоматически создает этот пакет в консоли Configuration Manager в области **Библиотека программного обеспечения** > **Управление приложениями** > **Пакеты**. Configuration Manager использует USMT 10 для сбора данных о пользовательском состоянии из одной ОС и восстановления их в другой. Комплект средств для развертывания и оценки Windows (Windows ADK) для Windows 10 включает USMT 10.

Различные сценарии миграции для USMT 10 рассмотрены в статье [Распространенные сценарии миграции](https://docs.microsoft.com/windows/deployment/usmt/usmt-common-migration-scenarios) в документации Windows.  


### <a name="retention-policy"></a>Политика хранения  

При настройке точки миграции состояния необходимо указать период времени, в течение которого следует сохранять данные пользовательского состояния, хранимые в ней. Длительность этого периода будет зависеть от двух факторов:  

-   Влияния хранимых данных на дисковое пространство.  

-   Требований, связанных с возможной повторной миграцией этих же данных.  
  
  
Миграция состояния состоит из двух этапов: сбора данных и их восстановления. В ходе сбора данные пользовательской среды сохраняются в точке миграции состояния. При восстановлении данные пользовательской среды извлекаются из точки миграции состояния, записываются на конечный компьютер и затем "освобождаются" шагом **Освободить хранилище состояний** последовательности задач. После "освобождения" данных запускается таймер хранения. Если было указано немедленно удалять данные, успешно обработанные процессом миграции, такие данные пользовательского состояния будут удаляться сразу же после "освобождения". Если же было указано хранить данные в течение определенного периода времени, данные будут удаляться по истечение этого периода (его началом считается "освобождение" данных пользовательской среды). Чем дольше период хранения, тем больше дискового пространства может потребоваться.  


### <a name="select-drive-to-store-user-state-migration-data"></a>Выбор диска для хранения данных миграции пользовательской среды  

При настройке точки миграции состояния необходимо выбрать диск на сервере, на котором будут храниться переносимые данные пользовательской среды. Выбор осуществляется из фиксированного списка дисков. Следует учитывать, что в список могут входить и устройства, не поддерживающие запись (например, дисковод компакт-дисков), или диски, не являющиеся общими (подключенными к сети). Некоторые буквы дисков могут быть вообще не связаны с какими бы то ни было дисками или устройствами на компьютере. Для точки миграции состояния должен быть указан общий диск, поддерживающий запись.  


### <a name="configure-a-state-migration-point"></a>Настройка точки миграции состояния  

Ниже приведены способы настройки точки миграции состояния для хранения данных пользовательской среды:  

-   создание нового сервера системы сайта для точки миграции состояния с помощью **мастера создания сервера системы сайта** ;  

-   добавление точки миграции среды на существующий сервер с помощью **мастера добавления ролей системы сайта** .  

При использовании этих мастеров потребуется указать для точки миграции состояния следующие сведения:  

-   папки для хранения данных пользовательской среды;  

-   максимальное число клиентов, которые могут сохранять данные на точке миграции состояния;  

-   минимальный объем свободного пространства для хранения данных пользовательской среды на точке миграции состояния;  

-   политику удаления для роли Вы можете задать немедленное удаление данных пользовательской среды после восстановления на компьютере или указать интервал удаления (в днях) после восстановления данных пользователя на компьютере.  

-   будет ли точка миграции состояния отвечать только на запросы восстановления данных о пользовательской среде. Если выбрать этот вариант, точку миграции состояния нельзя будет использовать для сохранения данных пользовательской среды.  

Инструкции по установке роли системы сайта см. в разделе [Добавление ролей системы сайта](../../core/servers/deploy/configure/add-site-system-roles.md).  
