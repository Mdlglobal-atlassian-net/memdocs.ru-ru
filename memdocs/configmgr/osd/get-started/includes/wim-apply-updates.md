---
author: aczechowski
ms.author: aaroncz
ms.prod: configuration-manager
ms.topic: include
ms.date: 05/28/2019
ms.openlocfilehash: e5c15556a7a8dd91db3ae2c4aa4f9830abc8e430
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81708882"
---
## <a name="apply-software-updates-to-an-image"></a><a name="BKMK_OSImagesApplyUpdates"></a> Применение обновлений программного обеспечения к образу

> [!Note]  
> Этот раздел относится и к **образам ОС**, и к **пакетам обновления ОС**. Термин "образ" означает файл образа Windows (WIM). Оба этих объекта имеют WIM, который содержит файлы установки Windows. Обновления программного обеспечения применимы к этим файлам в обоих объектах. Этот процесс происходит одинаково в обоих объектах.  

Каждый месяц выходят обновления программного обеспечения, применимые к образу. Перед применением обновлений программного обеспечения к нему вам потребуется следующее:

- Инфраструктура обновлений программного обеспечения  
- Успешно синхронизированные обновления программного обеспечения  
- Скачанные обновления программного обеспечения в библиотеке содержимого на сервере сайта  

Дополнительные сведения о см. в разделе [Развертывание обновлений программного обеспечения](../../../sum/deploy-use/deploy-software-updates.md).  

Обновления программного обеспечения можно применять к образу по указанному расписанию. Этот процесс иногда называется *автономным обслуживанием*. По расписанию Configuration Manager применяет выбранные обновления программного обеспечения к образу. Он может также распространять обновленный образ в точки распространения.

> [!Important]  
> Хотя вы можете выбрать любое обновление программного обеспечения, применимое к образу в зависимости от версии, DISM может применять к образу только определенные типы обновлений. В файле **OfflineServicingMgr.log** отображается следующая запись: `Not applying this update binary, it is not supported`.<!-- SCCMDocs issue 1324 -->

Информация об образе операционной системы хранится в базе данных сайта, включая обновления ПО, которые были установлены на момент импорта. Обновления программного обеспечения, которые были применены к образу с момента первоначального добавления, также сохраняются в базе данных сайта. При запуске мастера для применения обновлений программного обеспечения он извлекает список обновлений программного обеспечения, которые сайт еще не применил к образу. Configuration Manager копирует обновления программного обеспечения, которые вы выбрали из библиотеки содержимого на сервере сайта. Затем он применяет обновления ПО к образу.  

### <a name="servicing-process"></a>Процесс обслуживания

1. В консоли Configuration Manager перейдите к рабочей области **Библиотека программного обеспечения**, разверните узел **Операционные системы** и выберите **Образы ОС** или **Пакеты обновления ОС**.  

2. Выберите объект, к которому будут применяться обновления программного обеспечения.  

3. На ленте выберите **Запланировать обновления** для запуска мастера.  

4. На странице **Выбор обновлений** выберите обновления программного обеспечения, которые следует применить к образу. Может пройти некоторое время, пока обновится список обновлений, отображаемых в мастере. Используйте **Фильтр** для поиска строк в метаданных. Используйте раскрывающийся список **Архитектура системы** для фильтрации по **X86**, **X64** или **всем** архитектурам. Вы можете выбрать одно, несколько или все обновления в списке. Закончив выбирать обновления, нажмите **Далее**.  

5. На странице **установки расписания** укажите следующие параметры и нажмите кнопку **Далее**.  

    1. **Расписание**. Укажите расписание, в соответствии с которым обновления программного обеспечения должны применяться сайтом к образу.  

    2. **Продолжать при ошибке**. Выберите этот параметр, чтобы обновления программного обеспечения применялись к образу даже при появлении ошибки.  

    3. **Обновлять образ в точках распространения**. Выберите этот параметр, чтобы обновлять образ в точках распространения после применения обновлений программного обеспечения сайтом.  

6. Завершите мастер обновления программного обеспечения.  

> [!NOTE]  
> Чтобы минимизировать объем полезных данных, при обслуживании пакетов обновления ОС и образов ОС старая версия удаляется.  

### <a name="servicing-operations"></a>Операции обслуживания

В консоли Configuration Manager откройте узел **Образы ОС** или **Пакеты обновления ОС** и добавьте следующие столбцы в представление:

- **Запланированная дата обновления**: это свойство показывает следующее расписание, которое вы определили.  
- **Состояние запланированного обновления**: это свойство показывает состояние. Например, **Успех** или **В работе**.  

Выберите объект определенного образа и перейдите на вкладку **Состояние обновления** в области сведений. На этой вкладке отображается список обновлений образа.

Выберите конкретный объект образа и щелкните **Свойства** на ленте. На вкладке **Установленные обновления** отображается список обновлений образа. Вкладка **Обслуживание** — доступное только для чтения представление текущего расписания обслуживания и обновления, которое вы запланировали для применения.

Если указано состояние **В работе**, можно выбрать команду **Отмена запланированных обновлений** на ленте. Это действие отменяет активный процесс обслуживания.

Чтобы устранить неполадки в этом процессе, просмотрите файлы **OfflineServicingMgr.log** и **dism.log** на сервере сайта. Дополнительные сведения см. в [файлах журнала](../../../core/plan-design/hierarchy/log-files.md).

### <a name="specify-the-drive-for-offline-os-image-servicing"></a><a name="bkmk_servicing-drive"></a> Выбор диска для автономного обслуживания образов ОС

<!--1358924-->

Начиная с версии 1810 теперь доступна возможность указывать диск, который Configuration Manager будет использовать в процессе автономного обслуживания образов ОС. Этот процесс может занять большой объем места на диске временными файлами. Этот параметр обеспечивает гибкость при выборе диска для использования.

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Конфигурация сайта** и выберите узел **Сайты**. На ленте нажмите кнопку **Настройка компонентов сайта** и выберите пункт **Развертывание операционной системы**.  

2. Перейдите на вкладку **Автономное обслуживание** и укажите значение для параметра **Локальный диск, который будет использоваться при автономном обслуживании образов**.  

По умолчанию для этого параметра задано значение **Автоматически**. Если задано это значение, диспетчер Configuration Manager выбирает диск, на котором он установлен.

Если выбрать диск, которого не существует на сервере сайта, Configuration Manager работает так же, как при выборе **автоматического** варианта.

Во время автономного обслуживания Configuration Manager хранит временные файлы в папке `<drive>:\ConfigMgr_OfflineImageServicing`. Образ ОС также подключается в этой папке.

### <a name="optimized-image-servicing"></a><a name="bkmk_resetbase"></a> Оптимизированное обслуживание образов

<!--3555951-->

Начиная с версии 1902 при применении обновлений программного обеспечения к образу ОС теперь есть возможность оптимизировать результат, удалив заменяемые обновления. Оптимизация автономного обслуживания применима только к образам с одним индексом.

Когда вы планируете на сайте применение обновлений ПО к образу ОС, используется программа командной строки Windows "Система обслуживания образов развертывания и управления ими" (DISM). В результате нововведения в процесс обслуживания добавлены два дополнительных этапа.  

- Процесс выполняет программу DISM для подключенного автономного образа с параметрами `/Cleanup-Image /StartComponentCleanup /ResetBase`. Если выполнить эту команду не удается, текущий процесс обслуживания завершается сбоем. Изменения в образ не вносятся.  

- После того как система Configuration Manager фиксирует изменения в образе и отключает его от файловой системы, он экспортирует образ в другой файл. На этом шаге используется параметр DISM `/Export-Image`. Он предписывает удалить ненужные файлы из образа, благодаря чему его размер уменьшается.  

Корпорация Майкрософт рекомендует регулярно применять обновления к автономным образам. Этот параметр не требуется использовать при каждом обслуживании образа. Максимальный эффект можно получить, применяя его раз в месяц. Дополнительные сведения см. в разделе [рекомендаций по установке обновления программного обеспечения](../../understand/install-software-updates.md#recommendations).

Хотя этот параметр позволяет уменьшить общий размер обслуживаемого образа, процесс занимает больше времени. Чтобы запланировать обслуживание на подходящее время, воспользуйтесь мастером. Кроме того, требуется дополнительное место на сервере сайта. Вы можете настроить альтернативное расположение для сайта. Дополнительные сведения см. в разделе [Выбор диска для автономного обслуживания образов ОС](#bkmk_servicing-drive).

#### <a name="process-to-optimize-image-servicing"></a>Процедура оптимизации обслуживания образов

1. Запустите [процесс обслуживания](#servicing-process).  

2. На странице **Установить расписание** выберите параметр **Remove superseded updates after the image is updated** (Удалить замененные обновления после обновления образа). По умолчанию он не включен. Если образ имеет несколько индексов, использовать этот параметр невозможно.  

3. Чтобы запланировать обслуживание образа, следуйте указаниям мастера.  

Следить за процессом и проверять состояние можно с помощью файла **OfflineServicing.log**.
