---
title: Создание предварительно подготовленного носителя
titleSuffix: Configuration Manager
description: Сведения об использовании предварительно подготовленного носителя в Configuration Manager, что упрощает развертывание Windows в ряде сценариев.
ms.date: 05/02/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: ff6e7267-302a-4563-815e-cdc0d1a4b60f
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: d5219b518d46ccca174c7aa3fef62fe3334def35
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81690722"
---
# <a name="create-prestaged-media"></a>Создание предварительно подготовленного носителя

*Область применения: Configuration Manager (Current Branch)*

Предварительно подготовленный носитель Configuration Manager представляет собой WIM-файл с образом Windows. Он может быть установлен на компьютер без операционной системы производителем или корпоративным центром подготовки даже без подключения к окружению Configuration Manager. Предварительно подготовленный носитель содержит загрузочный образ, используемый для запуска конечного компьютера, и образ операционной системы, который применяется к конечному компьютеру. Вы также можете указать приложения, пакеты и пакеты драйверов, включаемые в состав предварительно подготовленного носителя. Последовательность задач, которая развертывает операционную систему, не содержится на этом носителе. Предварительно подготовленный носитель применяется к жесткому диску компьютера перед тем, как компьютер будет отправлен конечному пользователю.

Используйте предварительно подготовленный носитель в следующих сценариях развертывания операционной системы:  

- [Создание образа для изготовителей оборудования в фабрике или локальном хранилище](create-an-image-for-an-oem-in-factory-or-a-local-depot.md)  

- [Установка новой версии Windows на новом компьютере (без операционной системы)](install-new-windows-version-new-computer-bare-metal.md)  

- [Развертывание Windows to Go](deploy-windows-to-go.md)  


## <a name="usage"></a>Использование

Когда компьютер впервые запускается после применения предварительно подготовленного носителя, открывается среда предустановки Windows. Компьютер подключается к точке управления и ищет нужную последовательность задач для завершения развертывания ОС. При развертывании последовательности задач с использованием предварительно подготовленного носителя клиент сначала проверяет локальный кэш последовательности задач на наличие допустимого содержимого. Если содержимое не найдено или было изменено, оно загружается из точки распространения или с кэширующего узла.  


## <a name="prerequisites"></a>Предварительные условия

Перед созданием предварительно подготовленного носителя с помощью мастера создания носителя последовательности задач убедитесь, что выполнены все указанные условия.

### <a name="boot-image"></a>Образ загрузки

Примите во внимание следующие особенности, связанные с загрузочным образом, который вы будете использовать в последовательности задач для развертывания операционной системы.

- Архитектура загрузочного образа должна соответствовать архитектуре конечного компьютера. Например, конечный компьютер с 64-разрядной операционной системой может загружать и выполнять загрузочный образ с архитектурой x86 или x64. Однако конечный компьютер с архитектурой x86 может загружать и выполнять только 32-разрядный загрузочный образ (x86).
- Убедитесь, что загрузочный образ содержит драйверы для сетевых карт и запоминающих устройств, необходимые для подготовки конечного компьютера.

### <a name="create-a-task-sequence-to-deploy-an-os"></a>Создание последовательности задач для развертывания ОС

На предварительно подготовленном носителе создайте последовательность задач для развертывания ОС. Дополнительные сведения см. в статье [о создании последовательности задач для установки операционной системы](create-a-task-sequence-to-install-an-operating-system.md).

### <a name="distribute-all-content-associated-with-the-task-sequence"></a>Распространение всего содержимого, связанного с последовательностью задач

Разместите все содержимое, необходимое для последовательности задач, хотя бы в одной точке распространения. Сюда входят загрузочный образ, образ ОС и другие связанные с ними файлы. При создании предварительно подготовленного носителя мастер получает это содержимое из точки распространения.

Используемая учетная запись пользователя должна обладать по меньшей мере правами на **чтение** из библиотеки содержимого в точке распространения. Дополнительные сведения см. в разделе [Распространение содержимого](../../core/servers/deploy/configure/deploy-and-manage-content.md#bkmk_distribute).

### <a name="hard-drive-on-the-destination-computer"></a>Жесткий диск конечного компьютера

Прежде чем помещать носитель на жесткий диск конечного компьютера, этот жесткий диск необходимо отформатировать. Если жесткий диск не отформатировать, то при применении носителя произойдет сбой последовательности задач, развертывающей операционную систему, когда она попытается запустить конечный компьютер.

> [!NOTE]  
> Мастер создания носителя с последовательностью задач задает следующее условие переменной последовательности задач на носителе: **_SMSTSMediaType = OEMMedia**. Это же условие вы можете использовать в последовательности задач.  


## <a name="process"></a>Процесс

 > [!NOTE]  
 > Для сред PKI, так как корневой ЦС указан на первичном сайте, убедитесь, что предварительно подготовленный носитель создан на первичном сайте. На сайте CAS отсутствуют сведения о корневом ЦС для правильного создания предварительно подготовленного носителя.

1. В консоли Configuration Manager перейдите к рабочей области **Библиотека программного обеспечения**, разверните узел **Операционные системы** и выберите **Последовательности задач**.  

2. На вкладке **Главная** в ленте в группе **Создать** выберите **Создать носитель с файлом последовательности задач**. Это действие запускает мастер создания носителя с последовательностью задач.  

3. На странице **Выбор типа носителя** настройте следующие параметры:  

    - Выберите **Предварительно подготовленный носитель**.  

    - Если вам нужно лишь разрешить развертывание операционной системы без взаимодействия с пользователем, установите флажок **Разрешить автоматическое развертывание операционной системы**.  

        > [!IMPORTANT]  
        > Если этот флажок установлен, пользователю не будет предложено ввести сведения о конфигурации сети или выбрать последовательность задач. Если для носителя настроена защита паролем, пользователю может потребоваться ввести пароль.  

4. На странице **Управление носителями** выберите один из следующих вариантов:  

    - **Динамический носитель**: точка управления сможет перенаправлять носитель в другую точку управления (в зависимости от расположения клиента в границах сайта).  

    - **Носитель на основе сайта**: носитель подключается только к указанной точке управления.  

5. На странице **Свойства носителя** укажите следующие сведения:  

    - **Кем создано**. Укажите, кто создал носитель.  

    - **Версия**. Укажите номер версии носителя.  

    - **Комментарий**. Введите уникальное описание, указав, для чего предназначен носитель.  

    - **Файл носителя**. Укажите имена выходных файлов и путь к ним. Мастер запишет выходные файлы в это расположение. Пример: `\\servername\folder\outputfile.wim`  

    - **Промежуточная папка**.<!--1359388-->: Процесс создания носителя может потребовать много места на временном диске. По умолчанию это расположение аналогично следующему пути: `%UserProfile%\AppData\Local\Temp`. Начиная с версии 1902, вы получаете возможность гибко менять место для хранения этих временных файлов, указывая в этом параметре другой диск и путь.  

6. На странице **Безопасность** укажите следующие параметры:  

    - **Включить поддержку неизвестных компьютеров**. Допускает развертывание операционной системы с носителя на компьютер, который не находится под управлением Configuration Manager. База данных Configuration Manager не содержит записей об этих компьютерах. Дополнительные сведения см. в разделе [Подготовка развертываний на неизвестные компьютеры](../get-started/prepare-for-unknown-computer-deployments.md).  

    - **Защитить носитель паролем**. Введите надежный пароль, который поможет защитить носитель от несанкционированного доступа. Если вы укажете пароль, пользователь должен будет ввести его, чтобы воспользоваться предварительно подготовленным носителем.  

        > [!IMPORTANT]  
        > Для обеспечения дополнительной безопасности следует всегда назначать пароль, чтобы защитить содержимое предварительно подготовленного носителя.  
 
    - Для взаимодействий по протоколу HTTP выберите **Создать самозаверяющий сертификат носителя**. Затем укажите даты начала и окончания срока действия сертификата.  
    
        > [!NOTE] 
        > Если выбран этот параметр, точки управления HTTPS не будут доступны для выбора на странице **Загрузочный образ** мастера.

    - Для взаимодействий по протоколу HTTPS выберите **Импортировать сертификат PKI**. Затем укажите импортируемый сертификат и пароль для него.  

        Дополнительные сведения о сертификатах клиентов, которые используются для образов загрузки, см. в статье [о требованиях к PKI-сертификатам](../../core/plan-design/network/pki-certificate-requirements.md).  

    - **Сопоставление пользователей и устройств**. Чтобы включить поддержку управления, ориентированного на пользователей в Configuration Manager, укажите способ, который будет использоваться носителем для связывания пользователей с конечным компьютером. Дополнительные сведения о поддержке сопоставления пользователей и устройств при развертывании операционных систем см. в статье [Сопоставление пользователей с конечным компьютером в Configuration Manager](../get-started/associate-users-with-a-destination-computer.md).  

        - **Разрешить сопоставление пользователей и устройств (утверждение предоставляется автоматически)** . Носитель автоматически связывает пользователей с конечным компьютером. Эта функция основана на действиях последовательности задач, которая развертывает операционную систему. В этом сценарии последовательность задач при развертывании операционной системы на конечном компьютере создает отношение между указанными пользователями и конечным компьютером.  

        - **Разрешить сопоставление пользователей и устройств (требуется утверждение администратором)** . Носитель связывает пользователей с конечным компьютером после предоставления разрешения. Эта функция основана на области действия последовательности задач, которая развертывает операционную систему. В этом сценарии последовательность задач создает отношение между указанными пользователями и конечным компьютером, но дожидается утверждения администратора, прежде чем развертывать операционную систему.  

        - **Запретить сопоставление пользователей и устройств**. Носитель не связывает пользователей с конечным компьютером. В этом сценарии последовательность задач не связывает пользователей с конечным компьютером во время развертывания операционной системы.  

7. На странице **Последовательность задач** выберите последовательность, которая выполняется на конечном компьютере. Проверьте список содержимого, на которое есть ссылки в последовательности задач.  

    - **Обнаружить зависимости приложения и добавить их на этот носитель**: добавьте содержимое на носитель для зависимостей приложений.  

        > [!TIP]  
        > Если здесь не отображаются зависимости приложения, которые вы ожидаете увидеть, отмените выбор и повторно выберите этот параметр для обновления списка.  

8. На странице **Загрузочный образ** настройте следующие параметры:  

    > [!IMPORTANT]  
    > Архитектура распространяемого загрузочного образа должна соответствовать архитектуре конечного компьютера. Например, конечный компьютер с 64-разрядной операционной системой может загружать и выполнять загрузочный образ с архитектурой x86 или x64. Однако конечный компьютер с архитектурой x86 может загружать и выполнять только 32-разрядный загрузочный образ (x86).  

    - **Образ загрузки**. Выберите образ загрузки для запуска конечного компьютера.  

    - **Точка распространения**. Выберите точку распространения, в которой размещен этот загрузочный образ. Мастер получает загрузочный образ с точки распространения и записывает его на носитель.  

        > [!NOTE]  
        > Используемая учетная запись пользователя должна обладать по меньшей мере разрешениями на **чтение** из библиотеки содержимого в точке распространения.  

    - **Точка управления**: только для *носителя на основе сайта*. Укажите здесь точку управления из первичного сайта.  

    - **Связанные точки управления**: только для *динамического носителя*. Укажите здесь точки управления на первичном сайте, которые предполагается использовать, и их приоритеты при первом подключении.  

        > [!NOTE]  
        > Точки управления с поддержкой HTTPS будут отображаться только в том случае, если на странице **Безопасность** этого мастера указан PKI-сертификат.  

9. На странице **Образы** укажите следующие параметры:  

    - **Пакет образа**. Укажите образ операционной системы для использования. Дополнительные сведения см. в разделе [Управление образами операционных систем](../get-started/manage-operating-system-images.md).  

    - **Индекс образа**. Если пакет содержит несколько образов операционных систем, укажите порядковый номер образа для развертывания.  

    - **Точка распространения**. Укажите точку распространения, в которой размещен пакет образа ОС. Мастер получает образ ОС из точки распространения и записывает его на носитель.  

10. На странице **выбора приложения** выберите дополнительные приложения, чтобы добавить их в файл предварительно подготовленного носителя.  

11. На странице **выбора пакета** выберите дополнительные пакеты, чтобы добавить их в файл предварительно подготовленного носителя.  

12. На странице **выбора пакета драйверов** выберите дополнительные пакеты драйверов, чтобы добавить их в файл предварительно подготовленного носителя.  

13. На странице **точек распространения** выберите одну или несколько точек распространения, из которых будет извлекаться содержимое.  

    Configuration Manager отображает только те точки распространения, в которых есть содержимое. Прежде чем продолжить, все содержимое, связанное с последовательностью задач, необходимо распространить по меньшей мере в одну точку распространения. После распространения содержимого обновите список точек распространения. Удалите все точки распространения, уже выбранные на этой странице, вернитесь на предыдущую страницу, а затем — на страницу **Точки распространения**. Вы можете также перезапустить мастер. Дополнительные сведения см. в статьях [Распространение содержимого, на которое ссылается последовательность задач](manage-task-sequences-to-automate-tasks.md#BKMK_DistributeTS) и [Управление содержимым и инфраструктурой содержимого](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md).  

14. На странице **Настройка** укажите следующие параметры:  

    - Добавьте все переменные, которые используются последовательностью задач.  

    - **Включить команду, выполняемую перед запуском**. Укажите выполняемые перед запуском команды, которые будут выполняться перед запуском последовательности задач. Команды перед запуском — это скрипты или исполняемые файлы, которые могут взаимодействовать с пользователем в среде предустановки Windows перед запуском последовательности задач. Дополнительные сведения см. в статье [Предварительные команды для носителя с последовательностью задач](../understand/prestart-commands-for-task-sequence-media.md).  

        > [!TIP]  
        > Во время создания носителя последовательность задач записывает идентификатор пакета и командную строку, выполняемую перед запуском, включая значения всех переменных последовательности задач, в файл журнала **CreateTSMedia.log** на том компьютере, где запущена консоль Configuration Manager. В этом файле журнала можно проверить значения переменных последовательности задач.  

        Если для выполнения команды перед запуском требуется содержимое, установите флажок **Добавить файлы для выполнения команды перед запуском**.  

15. Завершите работу мастера.  


## <a name="next-steps"></a>Дальнейшие шаги

[Создание образа для изготовителей оборудования в фабрике или локальном хранилище](create-an-image-for-an-oem-in-factory-or-a-local-depot.md)
