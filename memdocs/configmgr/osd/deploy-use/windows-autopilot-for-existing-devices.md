---
title: Windows Autopilot для имеющихся устройств
titleSuffix: Configuration Manager
description: Используйте последовательность задач Configuration Manager для пересоздания образов и подготовки устройства Windows 7 к режиму Windows Autopilot под управлением пользователя.
ms.date: 03/23/2020
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 2e96f847-5b5a-4da9-8e8f-6aa488838508
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: e9f2ddf106c641c4433ddd1d09a2457900f670e8
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81709022"
---
# <a name="windows-autopilot-for-existing-devices"></a>Windows Autopilot для имеющихся устройств
<!--3607717, fka 1358333-->

*Область применения: Configuration Manager (Current Branch)*

[Windows Autopilot](https://docs.microsoft.com/windows/deployment/windows-autopilot/windows-autopilot) позволяет организациям поставлять новые, ненастроенные устройства под управлением Windows 10 непосредственно пользователям и определить поток подготовки ресурсов, который должен выполнить пользователь, чтобы обеспечить безопасность и эффективную работу устройств Windows 10. Устройство регистрируется в службе Windows Autopilot, чтобы вы могли назначить необходимый профиль Windows Autopilot. Этот профиль позволяет определить параметры запуска при первом включении (OOBE) для этого устройства. 

[Windows Autopilot для существующих устройств](https://techcommunity.microsoft.com/t5/Windows-IT-Pro-Blog/New-Windows-Autopilot-capabilities-and-expanded-partner-support/ba-p/260430) предоставляется в Windows 10 версии 1809 или более поздней. Эта функция позволяет пересоздать образ и подготовить устройство Windows 7 к [режиму Windows Autopilot под управлением пользователя](https://docs.microsoft.com/windows/deployment/windows-autopilot/user-driven) с помощью одной встроенной последовательности задач Configuration Manager. 



## <a name="prerequisites"></a>Предварительные условия

- Получите установочный носитель Windows 10 версии 1809 или более поздней. Затем создайте образ операционной системы Configuration Manager Дополнительные сведения см. в разделе [Управление образами операционных систем](../get-started/manage-operating-system-images.md).

- В Microsoft Intune создайте профили для Windows Autopilot. Дополнительные сведения см. в статье [Регистрация устройств в Intune с помощью Windows Autopilot](https://docs.microsoft.com/intune/enrollment-autopilot).

- Устройство еще не зарегистрировано в службе Windows Autopilot. Если устройство уже зарегистрировано, приоритет имеет назначенный профиль. Служба "Автопилот" применяется для существующего профиля устройства только по истечении времени ожидания интерактивного профиля.



## <a name="create-the-configuration-file"></a>Создание файла конфигурации

1. На устройстве Windows с подключением к Интернету откройте командное окно PowerShell от имени администратора и выполните следующие команды:  

    1. Чтобы продолжить, установите необходимые модули и примите запросы.  
        ``` PowerShell  
        Install-Module AzureAD
        Install-Module WindowsAutopilotIntune 
        Import-Module WindowsAutopilotIntune 
        ```

    2. Войдите в Intune, указав учетные данные администратора.  
        ``` PowerShell  
        connect-msgraph 
        ```

    3. Получите все профили Windows Autopilot, связанные с вашим клиентом Intune.  
        ``` PowerShell  
        $AutopilotProfile = Get-AutopilotProfile
        ```

    4. Создайте файл конфигурации для каждого профиля. Файлу присваивается отображаемое имя профиля, и он сохраняется на рабочем столе текущего пользователя.<!--PowerShell example courtesy of GitHub user treestryder from SCCMDocs issue #1196-->  
        ``` PowerShell  
        $AutopilotProfile | ForEach-Object { $_ | ConvertTo-AutoPilotConfigurationJSON | Set-Content -Encoding Ascii "~\Desktop\$($_.displayName).json" }
        ```  

        > [!Note]  
        > Файл конфигурации может содержать только один профиль. Имя каждого профиля должно быть указано в фигурных скобках `{}`.  

2. Сохраните один из профилей в файл с кодировкой ANSI, присвоив ему имя **AutopilotConfigurationFile.json**. Расположение этого файла должно позволять использовать его как источник пакетов для Configuration Manager.  

    > [!Tip]  
    > Если вы используете командлет PowerShell **Out-File** для перенаправления выходных данных JSON в файл, по умолчанию он использует кодировку Юникод. Этот командлет также может усекать длинные строки. Используйте параметр **Set-Content** с параметром `-Encoding ASCII`, чтобы задать правильную кодировку текста.   
    > 
    > Блокнот Windows по умолчанию использует кодировку ANSI.  

3. Создайте пакет Configuration Manager, который содержит этот файл. Для этого не требуется программа. Дополнительные сведения см. в руководстве по [созданию пакета](../../apps/deploy-use/packages-and-programs.md#create-a-package-and-program).  

    > [!NOTE]  
    > В Windows требуется, чтобы этот файл назывался **AutopilotConfigurationFile.json**. Чтобы использовать несколько профилей Autopilot, создайте отдельные пакеты Configuration Manager.  



## <a name="create-the-task-sequence"></a>Создание последовательности задач

1. В консоли Configuration Manager перейдите к рабочей области **Библиотека программного обеспечения**, разверните узел **Операционные системы** и выберите **Последовательности задач**. Выберите на ленте **Создать последовательность задач**.  

2. На странице **Создание очереди задач** выберите соответствующий пункт, чтобы **развернуть Windows Autopilot для существующих устройств**.  

3. На странице **Сведения о последовательности задач** укажите имя, при желании добавьте описание, а также выберите образ загрузки. Дополнительные сведения о версиях поддерживаемых образов загрузки см. на странице [поддержки для Windows 10](../../core/plan-design/configs/support-for-windows-10.md#windows-10-adk).  

4. На странице **Установка Windows** выберите **пакет с образом** операционной системы Windows 10. Затем настройте следующие параметры:  

    - **Индекс образа**. Выберите выпуск "Корпоративная", для образовательных учреждений или "Профессиональная" согласно требованиям вашей организации.  

    - Установите флажок **Создать разделы и выполнить форматирование на конечном компьютере перед установкой операционной системы**.  

    - **Настроить последовательность задач для использования с BitLocker**. Если вы установите этот флажок, последовательность задач будет содержать шаги, необходимые для включения Bitlocker.  

    - **Ключ продукта**. Если необходимо указать ключ продукта для активации Windows, введите его здесь.  

    - Выберите один из следующих параметров для настройки учетной записи локального администратора в Windows 10:  
        - **Задать пароль локального администратора случайным образом и отключить учетную запись локального администратора на всех поддерживаемых платформах (рекомендуется)**
        - **Включить учетную запись локального администратора и задать пароль**

5. На странице **Настройка сети** выберите параметр **Присоединить к рабочей группе**. В этой последовательности задач используется средство подготовки системы Windows (sysprep). Если устройство присоединено к домену, sysprep не будет работать.  

6. На странице **Установка Configuration Manager** добавьте все нужные свойства для вашей среды.  

    > [!Tip]  
    > Для последовательности задач требуются эти сведения только в случае, если нужно использовать клиентские компоненты Configuration Manager при выполнении последовательности задач перед запуском sysprep. Например, это требуется для установки обновлений программного обеспечения или приложений. Если вы не выполняете такие действия, клиент не требуется. Клиент нужно удалить, прежде чем в последовательности задач запустится sysprep.  

7. На странице **Включить обновления** по умолчанию установлен вариант **Не устанавливать обновления программного обеспечения**.  

    > [!Tip]  
    > Примените автономное обслуживание образа, чтобы поддерживать его в актуальном состоянии с последними исправлениями для Windows 10. Дополнительные сведения см. в руководстве по [применению обновлений программного обеспечения к образу операционной системы](../get-started/manage-operating-system-images.md#BKMK_OSImagesApplyUpdates).  

8. На странице **Установка приложений** можно выбрать приложения для установки в рамках последовательности задач. Но мы рекомендуем в этом сценарии использовать обычный подход к образам. После подготовки устройств в Autopilot примените все приложения и конфигурации из системы совместного управления Microsoft Intune или Configuration Manager. Этот процесс обеспечивает согласованную работу для пользователей, получающих новые устройства и применяющих Windows Autopilot для существующих устройств.  

8. На странице **Подготовка системы** выберите пакет, содержащий файл конфигурации Autopilot. По умолчанию последовательность задач перезагружает компьютер после выполнения Windows Sysprep. Можно также выбрать вариант **Shutdown computer after this task sequence completes** (Завершить работу компьютера после завершения этой последовательности задач). Он позволяет подготовить устройства и передать его пользователю, сохраняя согласованный режим взаимодействия с Autopilot.  

9. Завершите работу мастера.  

В режиме редактирования последовательности задач вы можете заметить, что она очень похожа на стандартную последовательность задач, которая применяет существующий образ операционной системы. Но наша последовательность задач включает дополнительные шаги.  

- **Применить конфигурацию Windows Autopilot**. На этом шаге применяется файл конфигурации Autopilot из указанного пакета. Это не новый тип действия, а действие **Выполнить из командной строки** для копирования файла.  

- **Подготовка Windows перед снятием образа**. На этом шаге запускается программа Sysprep для Windows, а также устанавливается параметр **Выключить компьютер после выполнения этого действия**. Дополнительные сведения см. в разделе [Подготовка Windows перед снятием образа](../understand/task-sequence-steps.md#BKMK_PrepareWindowsforCapture).  

Результатом последовательности задач "Windows Autopilot для существующих устройств" является присоединение устройства к Azure Active Directory (Azure AD). 

> [!NOTE]  
> В Windows 10 версий 1903 и 1909 для Автопилота есть известные проблемы, из-за которых программа Sysprep удаляет файл **AutopilotConfigurationFile.json**. Если вы используете этот метод для развертывания Windows 10 версий 1903 или 1909, измените эту последовательность задач и внесите следующие изменения:
>
> 1. Отключите шаг **Подготовка Windows перед снятием образа**.
> 2. Сразу после шага отключения **Подготовки Windows перед снятием образа** добавьте новый шаг **Выполнить из командной строки**. Настройте это для запуска следующей командной строки: `c:\windows\system32\sysprep\sysprep.exe /oobe /reboot`
>
> Дополнительные сведения см. в статье [Windows Autopilot — известные проблемы](https://docs.microsoft.com/windows/deployment/windows-autopilot/known-issues).

Используйте [перенос известных папок](https://docs.microsoft.com/onedrive/redirect-known-folders) в OneDrive для бизнеса, чтобы проверить, созданы ли резервные копии данных пользователя перед обновлением Windows 10.



## <a name="next-steps"></a>Дальнейшие шаги

Используйте совместное управление, чтобы расширить возможности управления устройствами Windows 10. Вторая последовательность действий для совместного управления представляет собой современную подготовку с помощью Windows Autopilot. Дополнительные сведения см. в следующих статьях:

- [Что такое совместное управление?](../../comanage/overview.md)
- [Paths to co-management](../../comanage/quickstart-paths.md) (Последовательности действий для совместного управления)
- [Windows Autopilot with co-management](../../comanage/quickstart-autopilot.md) (Windows Autopilot и совместное управление)

## <a name="see-also"></a>См. также

- [Регистрация устройств в Intune с помощью Windows Autopilot](https://docs.microsoft.com/intune/enrollment-autopilot)
