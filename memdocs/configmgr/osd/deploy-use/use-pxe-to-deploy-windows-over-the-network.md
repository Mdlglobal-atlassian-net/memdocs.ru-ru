---
title: Использование PXE для развертывания ОС по сети
titleSuffix: Configuration Manager
description: Для обновления ОС компьютера или установки новой версии Windows на новом компьютере можно использовать развертывания ОС по протоколу PXE.
ms.date: 02/26/2020
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: da5f8b61-2386-4530-ad54-1a5c51911f07
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: cff249bf5289ebcf354851258b5c9d598314ce3b
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81709062"
---
# <a name="use-pxe-to-deploy-windows-over-the-network-with-configuration-manager"></a>Использование PXE для развертывания Windows по сети с помощью Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Развертывания ОС, инициированные протоколом удаленной загрузки (PXE) в Configuration Manager, позволяют клиентам запрашивать и развертывать операционные системы по сети. В этом сценарии развертывания вы отправляете образ ОС и образы загрузки в точку распространения с поддержкой PXE.

> [!NOTE]  
> Когда вы создаете развертывание ОС, предназначенной только для 64-разрядных компьютеров с BIOS, в точке распространения должны быть доступны образы загрузки операционных систем обоих семейств (х64 и х86).

Вы можете использовать развертывания ОС, инициированные PXE, в следующих сценариях:

- [Обновление существующего компьютера до новой версии Windows](refresh-an-existing-computer-with-a-new-version-of-windows.md)  

- [Установка новой версии Windows на новом компьютере (без операционной системы)](install-new-windows-version-new-computer-bare-metal.md)  

Выполните шаги, указанные для одного из сценариев развертывания ОС, а затем подготовьтесь к развертываниям, инициируемым PXE, с помощью этой статьи.

> [!WARNING]
> При использовании PXE-развертываний и настройке оборудования устройства с помощью сетевого адаптера в качестве первого загрузочного устройства эти устройства могут автоматически запускать последовательность задач развертывания ОС без вмешательства пользователя. Проверка развертывания не управляет этой конфигурацией. Хотя такая конфигурация может упростить процесс и сократить взаимодействие с пользователем, она повышает риск случайного пересоздания образа.

## <a name="configure-at-least-one-distribution-point-to-accept-pxe-requests"></a><a name="BKMK_Configure"></a> Настройка по меньшей мере одной точки распространения для приема PXE-запросов

Чтобы развернуть операционные системы в клиентах Configuration Manager, отправляющих PXE-запросы загрузки, необходимо настроить одну или несколько точек распространения на прием PXE-запросов. После настройки точка распространения будет отвечать на PXE-запросы загрузки и сможет определить и предпринять нужные действия развертывания. Дополнительные сведения см. в разделе [Установка или изменение точки распространения](../../core/servers/deploy/configure/install-and-configure-distribution-points.md#bkmk_config-pxe).  

> [!NOTE]  
> При настройке отдельной точки распространения, для которой включен PXE, для поддержки нескольких подсетей использование параметров DHCP невозможно. Настройте вспомогательные службы IP на маршрутизаторах, чтобы разрешить пересылку PXE-запросов на точки распространения, где включен PXE.
>
> В версии 1810 использование отвечающего устройства PXE без WDS на серверах, на которых также работает DHCP-сервер, не поддерживается.
>
> Начиная с версии 1902, при включении отвечающего устройства PXE в точке распространения без службы развертывания Windows оно может находиться на одном сервере со службой DHCP.<!--3734270, SCCMDocs-pr #3416--> Для поддержки этой конфигурации добавьте указанные ниже параметры.  
>
> - Установите параметр **DoNotListenOnDhcpPort** типа DWord в значение `1` в следующем разделе реестра: `HKLM\Software\Microsoft\SMS\DP`.
> - Установите параметр DHCP 60 в значение `PXEClient`.  
> - Перезапустите службы SCCMPXE и DHCP на сервере.  

## <a name="prepare-a-pxe-enabled-boot-image"></a>Подготовка загрузочного образа с поддержкой PXE

Чтобы использовать PXE для развертывания ОС, необходимо иметь загрузочные образы x86 и x64 с поддержкой PXE, передаваемые на одну или несколько точек распространения с поддержкой PXE. Используйте приведенные сведения, чтобы включить PXE для образа загрузки и распространить образ в точки распространения:

- Чтобы включить PXE в образе загрузки, выберите параметр **Раз. загрузочный образ из точки распр., поддерживающей PXE** на вкладке **Источник данных** в свойствах образа загрузки.

- Если вы изменяете свойства образа загрузки, обновите и повторно распространите этот образ в точки распространения. Дополнительные сведения см. в разделе [Распространение содержимого](../../core/servers/deploy/configure/deploy-and-manage-content.md#bkmk_distribute).

## <a name="manage-duplicate-hardware-identifiers"></a>Управление повторяющимися идентификаторами оборудования

Configuration Manager может распознавать несколько компьютеров как одно устройство, если они имеют повторяющиеся атрибуты SMBIOS или вы используете общий сетевой адаптер. Устраните эти проблемы путем управления повторяющимися идентификаторами оборудования в параметрах иерархии. Подробные сведения см. в разделе [Управление повторяющимися идентификаторами оборудования](../../core/clients/manage/manage-clients.md#manage-duplicate-hardware-identifiers).

## <a name="create-an-exclusion-list-for-pxe-deployments"></a><a name="BKMK_PXEExclusionList"></a> Создание списка исключений для PXE-развертываний

> [!Note]  
> В некоторых случаях процесс [управления повторяющимися идентификаторами оборудования](../../core/clients/manage/manage-clients.md#manage-duplicate-hardware-identifiers) может оказаться проще.<!-- SCCMDocs issue 802 -->
>
> Поведение каждого из них может приводить к разным результатам в некоторых сценариях. Список исключений никогда и ни при каких условиях не позволяет загрузить клиент с MAC-адресом, включенным в список.
>
> Список повторяющихся идентификаторов не использует MAC-адреса для поиска политик последовательности задач для клиента. Клиент будет загружен, даже если есть совпадение с идентификатором SMBIOS или существует политика последовательности задач для неизвестных компьютеров.

При использовании PXE для развертывания операционных систем вы можете создать список исключений для каждой точки распространения. Добавьте MAC-адреса в список исключений компьютеров, которые будут игнорироваться точкой распространения. Включенные в список компьютеры не будут получать последовательности задач развертывания, которые Configuration Manager использует для развертывания PXE.

### <a name="process-to-create-the-exclusion-list"></a>Процесс создания списка исключений

1. На точке распространения, поддерживающей PXE, создайте текстовый файл. Например, этому файлу можно назначить имя **pxeExceptions.txt**.  

2. Используйте обычный текстовый редактор, например Блокнот. Внесите в список MAC-адреса компьютеров, которые будут игнорироваться точкой распространения с поддержкой PXE. MAC-адреса в списке необходимо разделять двоеточием и вводить каждый адрес с новой строки. Пример: `01:23:45:67:89:ab`  

3. Сохраните текстовый файл на сервере системы сайта точки распространения, поддерживающем PXE. Текстовый файл можно сохранить в любом расположении на сервере.  

4. Измените реестр точки распространения с поддержкой PXE, чтобы создать раздел реестра **MACIgnoreListFile**. Добавьте строковое значение полного пути к текстовому файлу на сервере системы сайта точки распространения с поддержкой PXE. Используйте приведенные ниже пути реестра.  

    `HKLM\Software\Microsoft\SMS\DP`  

    > [!WARNING]  
    > При неправильном использовании редактора реестра могут возникнуть серьезные проблемы, из-за которых может понадобиться переустановить Windows. Корпорация Майкрософт не гарантирует, что вы сможете решить проблемы, вызванные неправильным использованием редактора реестра. Вся ответственность за использование редактора реестра ложится на пользователя.  

5. После внесения изменений в реестр перезапустите службу WDS или службу ответчика PXE. Перезапуск сервера не требуется.<!--512129-->  

## <a name="ramdisk-tftp-block-size-and-window-size"></a><a name="BKMK_RamDiskTFTP"></a>Размер блока и размер окна RamDisk TFTP

Вы можете настроить размеры блока и окна RamDisk TFTP в точках распространения с поддержкой PXE. Если изменить настройки сети, слишком большой размер блока или окна может привести к тому, что при скачивании образа загрузки произойдет ошибка тайм-аута. Настройка размеров блока и окна RamDisk TFTP позволяет оптимизировать трафик TFTP при использовании PXE для соответствия определенным требованиям сети. Чтобы определить наиболее эффективный вариант конфигурации, необходимо протестировать измененные параметры в среде пользователя. Дополнительные сведения см. в разделе [Настройка размеров блока и окна RamDisk TFTP в точках распространения с поддержкой PXE](../get-started/prepare-site-system-roles-for-operating-system-deployments.md#BKMK_RamDiskTFTP).

## <a name="configure-deployment-settings"></a>Настройка параметров развертывания

Чтобы использовать инициируемое PXE развертывание ОС, необходимо настроить его на предоставление запросам на загрузку PXE доступа к ОС. Настройте доступные операционные системы на вкладке **Параметры развертывания** в свойствах развертывания. Для параметра **Сделать доступной для** выберите один из следующих вариантов:

- Клиенты Configuration Manager, носители и PXE

- Только носители и PXE

- Только носители и PXE (скрытые)

## <a name="deploy-the-task-sequence"></a><a name="BKMK_Deploy"></a> Развертывание последовательности задач

Разверните ОС в коллекции целевых объектов. Дополнительные сведения см. в статье [Deploy a task sequence](deploy-a-task-sequence.md). При развертывании операционных систем с помощью PXE можно настроить, является ли это развертывание обязательным или доступным.

- **Обязательное развертывание**. Обязательные развертывания используют PXE без вмешательства пользователя. Пользователь не может обойти загрузку PXE. Но если пользователь отменит загрузку PXE до получения ответа от точки распространения, ОС не будет развернута.

- **Доступное развертывание**. Доступные развертывания требуют присутствия пользователя на конечном компьютере. Чтобы продолжить процесс загрузки PXE, пользователь должен нажать клавишу **F12**. Если пользователь отсутствует и не может нажать клавишу **F12**, то компьютер загрузится с использованием текущей ОС или со следующего доступного загрузочного устройства.

Чтобы повторно развернуть обязательное развертывание PXE, можно очистить состояние последнего развертывания PXE, назначенного компьютеру или коллекции Configuration Manager. Дополнительные сведения о действии **Очистить необходимые развертывания PXE** см. в разделе [Управление клиентами](../../core/clients/manage/manage-clients.md#BKMK_ManagingClients_DevicesNode) или [Управление коллекциями](../../core/clients/manage/collections/manage-collections.md#bkmk_device). Такое действие сбрасывает состояние этого развертывания и выполняет повторную установку последних обязательных развертываний.

> [!IMPORTANT]  
> Протокол PXE не является безопасным. PXE-сервер и клиент PXE должны находиться в физически защищенной сети (например, в центре обработки данных). Это позволит избежать несанкционированного доступа к сайту.

## <a name="how-the-boot-image-is-selected-for-pxe"></a>Процесс выбора загрузочного образа для PXE

Когда клиент загружается с помощью PXE, Configuration Manager предоставляет клиенту загрузочный образ. Configuration Manager использует образ загрузки, архитектура которого точно соответствует архитектуре клиента. Если образ загрузки с такой архитектурой недоступен, Configuration Manager использует образ загрузки с совместимой архитектурой.

Ниже приведены сведения о порядке выбора загрузочного образа для клиентов, загрузка которых выполняется с помощью PXE.  

1. Configuration Manager выполняет в базе данных сайта поиск системной записи, соответствующей MAC-адресу или имени SMBIOS загружаемого клиента.  

    > [!NOTE]  
    > Если компьютер, назначенный сайту, загружается с помощью PXE для другого сайта, политики будут недоступны для этого компьютера. Например, если клиент уже назначен сайту А, точка управления и точка распространения для сайта Б не будут иметь доступ к политикам с сайта А. Следовательно, клиент не загрузится с помощью PXE.  

2. Configuration Manager ищет последовательности задач, которые развертываются для системной записи, найденной в шаге 1.  

3. В списке последовательностей задач, найденных в шаге 2, Configuration Manager ищет загрузочный образ, соответствующий архитектуре клиента, который пытается выполнить загрузку. При обнаружении загрузочного образа с нужной архитектурой он используется для загрузки клиента.  

    Если он обнаружит более одного загрузочного образа, то выбирает из них один с *самым большим* значением идентификатора развертывания последовательности задач, то есть самый свежий. В иерархии с несколькими сайтами приоритет отдается сайту, имя которого располагается *дальше* в отсортированном по алфавиту списке. Например, при равенстве остальных условий развертывание годичной давности с сайта ZZZ будет более приоритетным, чем развертывание с сайта AAA, выполнявшееся вчера.<!-- SCCMDocs issue 877 -->  

4. Если загрузочный образ с той же архитектурой не найден, Configuration Manager ищет загрузочный образ, совместимый с архитектурой клиента. Поиск выполняется в списке последовательностей задач, найденных на шаге 2. Например, 64-разрядный клиент BIOS/MBR совместим с 32- и 64-разрядными загрузочными образами. 32-разрядный клиент BIOS/MBR совместим только с 32-разрядными загрузочными образами. Клиенты UEFI считаются совместимыми только при совпадении архитектуры. 64-разрядный клиент UEFI совместим только с 64-разрядными загрузочными образами, а 32-разрядный клиент UEFI совместим только с 32-разрядными загрузочными образами.
