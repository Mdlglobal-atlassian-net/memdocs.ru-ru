---
title: Создание последовательности задач для записи образа ОС
titleSuffix: Configuration Manager
description: Последовательность задач сборки и записи для создания компьютера-образца, который может содержать специальные драйверы и обновления программного обеспечения вместе с операционной системой.
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 25e4ac68-0e78-4bbe-b8fc-3898b372c4e8
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: ceb63560c6000b1a76116d0791c98219a66066b8
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81707392"
---
# <a name="create-a-task-sequence-to-capture-an-os"></a>Создание последовательности задач для записи образа ОС

*Область применения: Configuration Manager (Current Branch)*

При использовании последовательности задач для развертывания ОС на компьютере в Configuration Manager компьютер устанавливает образ ОС, указанный в последовательности задач. Образ ОС можно настроить таким образом, чтобы он включал определенные драйверы, приложения и обновления программного обеспечения. Сначала используйте последовательность задач сборки и записи, чтобы создать компьютер-образец. Затем запишите образ ОС с этого компьютера-образца. Если у вас уже есть доступный для записи компьютер-образец, можно создать настраиваемую последовательность задач для записи операционной системы.

## <a name="about-the-build-and-capture-task-sequence"></a><a name="BKMK_BuildCaptureTS"></a> Сведения о последовательности задач сборки и записи

Последовательность задач сборки и записи:

- Создает разделы и форматирование на компьютере-образце
- Устанавливает ОС
- Устанавливает клиент Configuration Manager
- Устанавливает приложения
- Применяет обновления программного обеспечения
- Записывает ОС с компьютера-образца

Перед развертыванием последовательности задач создания и записи в точках распространения должны быть доступны пакеты, связанные с последовательностью задач, например приложения.

## <a name="requirements"></a><a name="BKMK_CreatePackages"></a> Требования

Перед созданием последовательности задач для установки ОС должны быть установлены следующие компоненты:  

### <a name="required"></a>Обязательное

- [Образ загрузки](../get-started/manage-boot-images.md)

- [Образ ОС](../get-started/manage-operating-system-images.md)

### <a name="required-if-used"></a>Обязательно (если используется)

- [Пакеты драйверов](../get-started/manage-drivers.md), содержащие необходимые драйверы Windows для поддержки оборудования на компьютере-образце. Дополнительные сведения о шагах последовательности задач для управления драйверами см. в статье [Использование последовательностей задач для установки драйверов устройств](../get-started/manage-drivers.md#BKMK_TSDrivers).

- [Обновления программного обеспечения](../../sum/get-started/synchronize-software-updates.md)

- [Приложения](../../apps/deploy-use/create-applications.md)

## <a name="create-a-build-and-capture-task-sequence"></a><a name="BKMK_CreateBuildCaptureTS"></a> Создание последовательности задач создания и записи

Используйте следующую процедуру, чтобы воспользоваться последовательностью задач для создания компьютера-образца и записи операционной системы.

1. В консоли Configuration Manager перейдите к рабочей области **Библиотека программного обеспечения**, разверните узел **Операционные системы** и выберите **Последовательности задач**.  

1. В группе **Создать** вкладки **Главная** на ленте выберите команду **Создать последовательность задач**, чтобы запустить мастер создания последовательности задач.  

1. На странице **Создание новой последовательности задач** щелкните **Создать и сохранить мастер-образ операционной системы**.  

1. На странице **Сведения о последовательности задач** настройте следующие параметры.  

    - **Имя последовательности задач**. Укажите имя последовательности задач.  

    - **Описание**. Укажите необязательное описание для последовательности задач. Например, опишите ОС, создаваемую последовательностью задач.

    - **Образ загрузки**. Укажите загрузочный образ для использования с этой последовательностью задач.  

        > [!IMPORTANT]  
        > Архитектура загрузочного образа должна быть совместимой с архитектурой оборудования конечного компьютера.  

1. На странице **Установка Windows** настройте следующие параметры:  

    - **Пакет образа**. Укажите пакет образа ОС, который содержит файлы, необходимые для установки ОС.  

    - **Индекс образа**. Укажите индекс ОС для установки в образе. Если образ операционной системы содержит несколько версий, выберите версию, которую необходимо установить.  

    - **Ключ продукта**. При необходимости введите ключ продукта для устанавливаемой ОС Windows. Можно указать зашифрованные ключи многократной установки или стандартные ключи продукта. Если вы используете незашифрованный ключ продукта, каждая группа из пяти символов должна быть разделена дефисом (`-`). Пример: `XXXXX-XXXXX-XXXXX-XXXXX-XXXXX`  

    - **Режим лицензирования сервера**. Если необходимо, выберите режим лицензирования сервера **Для каждого рабочего места**, **Для каждого сервера** или не указывайте лицензию. В случае использования варианта **Для каждого сервера**следует также указать максимальное число подключений.  

    - Укажите способ настройки учетной записи администратора для развернутой ОС:  

        - **Задать пароль локального администратора случайным образом и отключить учетную запись локального администратора на всех поддерживаемых платформах**. Создайте случайный пароль для локальной учетной записи администратора. Отключите учетную запись при настройке Windows.

        - **Включить учетную запись локального администратора и задать пароль**. Используйте тот же пароль для учетной записи локального администратора на всех компьютерах, на которых развертывается эта ОС.

1. На странице **Настроить сеть** настройте следующие параметры.

    - **Присоединить к рабочей группе**. Укажите, следует ли добавлять конечный компьютер к рабочей группе при развертывании операционной системы.  

    - **Присоединить к домену**. Укажите, следует ли добавлять конечный компьютер к домену при развертывании операционной системы. Укажите имя домена в разделе **Домен**.  

        > [!IMPORTANT]  
        > Для поиска доменов можно выполнить обзор локального леса. Укажите доменное имя для удаленного леса.

        Можно также указать подразделение (OU). Это необязательный параметр, содержащий уникальное имя подразделения в каталоге LDAP X.500, куда добавляется учетная запись компьютера, если она еще не создана.  

    - **Учетная запись**. Введите имя пользователя и пароль учетной записи, которая может присоединиться к выбранному домену. Например: `domain\user` или `%variable%`.  

        > [!IMPORTANT]  
        > Введите надлежащие учетные данные домена, если вы планируете перенести параметры домена или рабочей группы во время развертывания.  

1. На странице **Установка Configuration Manager** укажите пакет клиента Configuration Manager. Этот пакет содержит исходные файлы, необходимые для установки клиента Configuration Manager. Также укажите дополнительные свойства, необходимые для установки клиента.  

    Дополнительные сведения см. в разделе [о свойствах установки клиентов](../../core/clients/deploy/about-client-installation-properties.md).

1. На странице **Включить обновления** укажите, следует ли устанавливать только обязательные обновления ПО, все обновления или не устанавливать их вообще. Если выбран вариант установки обновлений программного обеспечения, Configuration Manager устанавливает только те обновления ПО, которые относятся к коллекциям, в которые входит конечный компьютер.  

1. На странице **Установить приложения** укажите приложения, которые необходимо установить на конечный компьютер. Если задано несколько приложений, можно настроить продолжение выполнения последовательности задач в случае сбоя установки определенного приложения.  

    > [!NOTE]
    > Страница **Подготовка системы** появляется в мастере, но больше не используется. Нажмите кнопку **Далее**, чтобы продолжить.

1. На странице **Свойства образа** укажите следующие параметры образа ОС:

    - **Кем создано**. Укажите имя пользователя, который будет создателем образа ОС.  

    - **Версия**. Укажите номер версии, связанный с образом ОС. Этот атрибут не обязательно должен быть версией ОС, так как сайт хранит это значение отдельно.

    - **Описание**. Укажите описание образа ОС.  

1. На странице **Запись образа** укажите следующие параметры:

    - **Путь**. Укажите общую сетевую папку, в которой Configuration Manager должен хранить выходной файл изображения (WIM). Этот файл содержит образ ОС, основанный на указанных в мастере параметрах. Если задать папку, уже имеющую WIM-файл, он будет перезаписан.  

    - **Учетная запись**. Укажите учетную запись Windows, имеющую разрешения на доступ к общей сетевой папке, где хранится образ.  

1. Завершите работу мастера.  

Чтобы добавить дополнительные шаги в последовательность задач, выберите ее и щелкните **Изменить**. Дополнительные сведения об изменении последовательности задач см. в статье [Использование редактора последовательности задач](../understand/task-sequence-editor.md).  

Разверните последовательность задач на компьютере-образце одним из следующих способов:  

- Если компьютер-образец уже является клиентом Configuration Manager, разверните последовательность задач сборки и записи в коллекцию, содержащую компьютер-образец. Дополнительные сведения см. в статье [Deploy a task sequence](deploy-a-task-sequence.md).

- Если компьютер-образец не является клиентом Configuration Manager или необходимо вручную выполнить последовательность задач на компьютере-образце, запустите **мастер создания носителя с последовательностью задач**, чтобы создать загрузочный носитель. Дополнительные сведения см. в разделе [Создание загрузочного носителя](create-bootable-media.md).  

После записи образа его можно развернуть на других компьютерах. Дополнительные сведения о развертывании образа записанной ОС см. в статье [Создание последовательности задач для установки ОС](create-a-task-sequence-to-install-an-operating-system.md).  

## <a name="capture-from-an-existing-reference-computer"></a><a name="BKMK_CaptureExistingRefComputer"></a> Запись с существующего компьютера-образца

После подготовки компьютера-образца к записи можно создать последовательность задач, которая только записывает операционную систему с компьютера-образца. Шаг последовательности задач **Записать образ операционной системы** используется для записи одного или нескольких образов с компьютера-образца. Затем эти образы сохраняются в файл образа (WIM) в указанной сетевой папке. Запустите компьютер-образец в Windows PE с помощью загрузочного образа. Последовательность задач записывает каждый жесткий диск на компьютере-образце в виде отдельного образа в WIM-файле. Если компьютер-образец включает несколько дисков, получившийся WIM-файл содержит отдельный образ для каждого тома. Он поддерживает запись только томов с файловыми системами NTFS или FAT32. Тома с другими форматами файловых систем или тома USB пропускаются.  

Используйте следующую процедуру для записи образа операционной системы с существующего компьютера-образца.

1. В консоли Configuration Manager перейдите к рабочей области **Библиотека программного обеспечения**, разверните узел **Операционные системы** и выберите **Последовательности задач**.  

1. На вкладке **Главная** на ленте в группе **Создать** выберите **Создать последовательность задач**. Это действие запускает мастер создания последовательности задач.  

1. На странице **Создание новой последовательности задач** выберите команду **Создание новой последовательности задач**.  

1. На странице **Сведения о последовательности задач** укажите имя последовательности задач. Укажите необязательное описание для последовательности задач.  

1. Укажите образ загрузки для последовательности задач. Configuration Manager использует этот образ загрузки для запуска компьютера-образца с помощью Windows PE. Дополнительные сведения см. в разделе [Управление загрузочными образами](../get-started/manage-boot-images.md).  

1. Завершите работу мастера.  

1. В узле **Последовательности задач** выберите новую последовательность задач. Затем на вкладке **Главная** в ленте выберите в группе **Последовательность задач** действие **Редактировать**. Это действие открывает редактор последовательности задач.  

1. Если на компьютере-образце установлен клиент Configuration Manager:

    Перейдите в меню **Добавить**, выберите **Образы**, а затем выберите [Подготовить клиент Configuration Manager для записи](../understand/task-sequence-steps.md#BKMK_PrepareConfigMgrClientforCapture). Этот шаг подготавливает к использованию клиент Configuration Manager на компьютере-образце.

    > [!Note]  
    > Последовательность задач не поддерживает удаление клиента Configuration Manager.

1. Перейдите в меню **Добавить**, выберите **Образы**, а затем выберите [Подготовить Windows для записи](../understand/task-sequence-steps.md#BKMK_PrepareWindowsforCapture). Этот шаг выполняет Sysprep и перезагружает компьютер в загрузочный образ Windows PE, указанный в параметрах последовательности задач. Для успешного выполнения этого действия не присоединяйте компьютер-образец к домену.

1. Перейдите в меню **Добавить**, выберите **Образы**, а затем выберите [Записать образ операционной системы](../understand/task-sequence-steps.md#BKMK_CaptureOperatingSystemImage). Этот шаг выполняется только из Windows PE для записи жестких дисков на компьютере-образце. Настройте следующие параметры.

    - **Имя** и **Описание**. При необходимости можно изменить имя шага последовательности и указать описание.  

    - **Назначение**. Укажите общую сетевую папку для хранения выходного WIM-файла. Этот файл содержит образ ОС, основанный на параметрах, указанных в мастере. Если задать папку, уже имеющую WIM-файл, он будет перезаписан.  

    - **Описание**, **Версия** и **Автор**. При необходимости укажите сведения о записываемом образе.  

    - **Учетная запись для записи образа операционной системы**. Укажите учетную запись Windows, имеющую разрешения на запись в указанную сетевую папку. Нажмите кнопку **Задать**, чтобы указать имя этой учетной записи Windows.  

Нажмите кнопку **ОК**, чтобы сохранить изменения и закрыть редактор последовательности задач.  

Разверните последовательность задач на компьютере-образце одним из следующих способов:  

- Если компьютер-образец уже является клиентом Configuration Manager, разверните последовательность задач записи в коллекцию, содержащую компьютер-образец. Дополнительные сведения см. в статье [Deploy a task sequence](deploy-a-task-sequence.md).

- Если компьютер-образец не является клиентом Configuration Manager или необходимо вручную выполнить последовательность задач на компьютере-образце, запустите **мастер создания носителя с последовательностью задач**, чтобы создать носитель записи. Дополнительные сведения см. в разделе [Создание носителя для снятия образа](create-capture-media.md).  

После записи образа его можно развернуть на других компьютерах. Дополнительные сведения о развертывании образа записанной ОС см. в статье [Создание последовательности задач для установки ОС](create-a-task-sequence-to-install-an-operating-system.md).

## <a name="example-task-sequence"></a><a name="BKMK_BuildandCaptureTSExample"></a> Пример последовательности задач

Приведенная ниже таблица представляет собой руководство, на которое можно опираться при создании последовательности задач, выполняющей создание образа операционной системы. Таблица поможет при выработке общей структуры шагов последовательности задач и объединении их в логические группы. Создаваемая вами последовательность задач может отличаться от этого примера. Она может содержать больше или меньше шагов и групп.

> [!NOTE]  
> Для создания подобных последовательностей задач всегда используйте мастер создания последовательности задач.
>
> Мастер добавляет шаги в последовательность задач с именами, которые немного отличаются от тех,которые вы видите при добавлении тех же шагов вручную.

### <a name="group-build-the-reference-machine"></a>Группа: построить исходный компьютер

В этой группе содержатся действия, необходимые для построения компьютера-образца.

|Шаг последовательности задач|Описание:|  
|-------------------------------|---------------|  
|**Перезапустить в Windows PE**|Перезапустите конечный компьютер, чтобы использовать образ загрузки, назначенный последовательности задач. На этом шаге пользователь увидит сообщение, информирующее, что для продолжения установки компьютер будет перезагружен.<br /><br />Этим шагом используется переменная последовательности задач `_SMSTSInWinPE`, доступная только для чтения. Если связанное значение — `false`, выполнение последовательности задач будет продолжено.|
|**Создать разделы на диске 0 — BIOS**|Создание разделов и форматирование жесткого диска на конечном компьютере в режиме BIOS. По умолчанию это диск номер `0`.<br /><br />Этот шаг использует несколько переменных последовательности задач только для чтения. Например, он выполняется только в том случае, если кэш клиента Configuration Manager не существует, и не выполняется, если компьютер настроен для UEFI.|
|**Создать разделы на диске 0 — UEFI**|Создание разделов и форматирование жесткого диска на конечном компьютере в режиме UEFI. По умолчанию это диск номер `0`.<br /><br />Этот шаг использует несколько переменных последовательности задач только для чтения. Например, он выполняется только в том случае, если кэш клиента Configuration Manager не существует и компьютер настроен для UEFI.|
|**Применить операционную систему**|Установите указанный образ ОС на конечный компьютер. Сначала этот шаг удаляет все файлы на этом томе, за исключением файлов элементов управления, относящихся к Configuration Manager. Затем он применяет все образы томов, которые содержатся в WIM-файле, к соответствующему последовательному тому диска на конечном компьютере.|
|**Применить настройки Windows**|Настройка параметров Windows для конечного компьютера.|
|**Применить параметры сети**|Указание сведений о конфигурации сети или рабочей группы для конечного компьютера.|
|**Применить драйверы устройств**|Поиск и установка драйверов в процессе развертывания ОС. Дополнительные сведения см. в разделе [Автоматическое применение драйверов](../understand/task-sequence-steps.md#BKMK_AutoApplyDrivers).<br /><br />Этим шагом используется переменная последовательности задач `_SMSTSMediaType`, доступная только для чтения. Если связанное значение не равно `FullMedia`, этот шаг не выполняется.|
|**Установка Windows и Configuration Manager**|Установка программного обеспечения клиента Configuration Manager. Configuration Manager устанавливает и регистрирует GUID клиента Configuration Manager. Включите все необходимые **свойства установки**.|
|**Установка обновлений**|Указывает, как обновления программного обеспечения устанавливаются на конечный компьютер. На конечном компьютере не проверяется наличие применимых обновлений программного обеспечения, пока не будет запущен этот шаг. На этом этапе вычисление аналогично любому другому клиенту, управляемому Configuration Manager. Дополнительные сведения см. в разделе [Установить обновления программного обеспечения](../understand/install-software-updates.md).<br /><br />Этим шагом используется переменная последовательности задач `_SMSTSMediaType`, доступная только для чтения. Если связанное значение не равно `FullMedia`, этот шаг не выполняется.|
|**Установка приложений**|Указывает все приложения, устанавливаемые на компьютере-образце.|

### <a name="group-capture-the-reference-machine"></a>Группа: Сделать образ с эталонного компьютера

В этой группе содержатся шаги, необходимые для подготовки компьютера-образца и сбора с него данных.

|Шаг последовательности задач|Описание:|  
|-------------------------------|---------------|  
|**Подготовить клиент Configuration Manager**|Подготавливает к использованию клиент Configuration Manager на компьютере-образце.|
|**Подготовить ОС**|Запускает средство Sysprep для подготовки Windows к использованию. Затем он перезапускает компьютер в загрузочный образ Windows PE, указанный в параметрах последовательности задач.|
|**Записать компьютер-образец**|Записывает образ в указанную общую сетевую папку и WIM-файл.|

> [!IMPORTANT]
> После записи образа с компьютера-образца не записывайте другой образ операционной системы с эталонного компьютера. Записи реестра создаются во время начальной настройки. Для создания каждого образа операционной системы используйте новый компьютер-образец. Если вы планируете использовать тот же компьютер для создания других образов ОС, сначала удалите и переустановите клиент Configuration Manager.

## <a name="next-steps"></a>Дальнейшие шаги

[Методы развертывания операционных систем предприятия](methods-to-deploy-enterprise-operating-systems.md)
