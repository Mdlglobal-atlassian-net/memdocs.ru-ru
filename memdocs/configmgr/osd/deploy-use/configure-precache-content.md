---
title: Настройка предварительного кэширования содержимого
titleSuffix: Configuration Manager
description: Узнайте, как клиенты могут загружать содержимое развертывания ОС, прежде чем пользователь установит последовательность задач.
ms.date: 02/26/2020
ms.prod: configuration-manager
ms.technology: configmgr-osd
ms.topic: conceptual
ms.assetid: 9d1e8252-99e3-48aa-bfa5-0cf4cd6637b2
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 184bdc58ac6dc0e311875cc1ddab8c605d8eec32
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81704212"
---
# <a name="configure-pre-cache-content-for-task-sequences"></a>Настройка предварительного кэширования содержимого для последовательностей задач

*Область применения: Configuration Manager (Current Branch)*

<!--1021244-->
Функция предварительного кэширования для доступных развертываний последовательностей задач позволяет клиентам скачивать только необходимое содержимое, прежде чем пользователь установит последовательность задач. Клиент может предварительно кэшировать содержимое для последовательностей задач, которые [обновляют ОС](create-a-task-sequence-to-upgrade-an-operating-system.md) или [устанавливают образ ОС](create-a-task-sequence-to-install-an-operating-system.md).

> [!Note]  
> По умолчанию в версии 1910 в Configuration Manager эта функция включена. В версии 1906 и более ранних по умолчанию в Configuration Manager эта дополнительная функция отключена. Перед использованием ее необходимо включить. Дополнительные сведения см. в разделе [Включение дополнительных функций из обновлений](../../core/servers/manage/install-in-console-updates.md#bkmk_options).<!--505213-->  

Например, вам требуется применить только одну последовательность задач обновления на месте для всех пользователей, а в среде есть несколько архитектур и языков. В предыдущих версиях содержимое начинает скачиваться, когда пользователь устанавливает доступное развертывание последовательности задач из центра программного обеспечения. Из-за этого момент, когда установка может начаться, откладывается еще на некоторое время. Загружается все содержимое, указанное в последовательности задач. К нему относятся пакеты обновления операционной системы для всех языков и архитектур. Так как каждый пакет обновления занимает около 3 ГБ, размер всего содержимого очень велик.

Предварительное кэширование содержимого позволяет дать клиенту возможность скачивать применимое содержимое, а также все остальное содержимое сразу при выполнении развертывания. При нажатии кнопки **Установить** в центре программного обеспечения содержимое уже готово. Установка начинается быстро, так как содержимое находится на локальном жестком диске.

В Configuration Manager версии 1902 и более ранних это поведение относится только к *пакету обновления ОС*. Этот пакет является единственным содержимым, для которого можно указать соответствующий язык или архитектуру. Например, если последовательность задач также ссылается на несколько пакетов драйверов, клиент скачивает их все. Подсистема выполнения последовательности задач оценивает условия для шагов при выполнении последовательности задач, а не заранее. Клиент использует теги в свойствах пакета, чтобы определить, какое содержимое было предварительно кэшировано.

Начиная с версии 1906<!--4224642--> Вы можете использовать предварительное кэширование, чтобы уменьшить потребление пропускной способности для следующего типа содержимого:

- Пакеты обновления ОС
- Образы ОС
- пакеты драйверов,
- пакеты,

## <a name="configure-pre-caching"></a>Настройка предварительного кэширования

Для настройки функции предварительного кэширования необходимо выполнить три действия:

1. [Создание и настройка пакетов приложений](#bkmk_createpkg)
2. [Создание последовательности задач с условными шагами](#bkmk_createts)
3. [Развертывание последовательности задач и включение предварительного кэширования](#bkmk_deploy)


### <a name="1-create-and-configure-the-packages"></a><a name="bkmk_createpkg"></a> 1. Создание и настройка пакетов приложений

Клиент оценивает атрибуты пакетов, чтобы определить, какое содержимое он скачивает во время предварительного кэширования.  

#### <a name="os-upgrade-package"></a>Пакет обновления ОС

Создайте [пакеты обновления ОС](../get-started/manage-operating-system-upgrade-packages.md) для определенных архитектур и языков. Укажите **архитектуру** и **язык** на вкладке свойств пакета **Источник данных**.

#### <a name="os-image"></a>Образ ОС

Создайте [образы ОС](../get-started/manage-operating-system-images.md) для определенных архитектур и языков. Укажите **архитектуру** и **язык** на вкладке свойств пакета **Источник данных**.

#### <a name="driver-package"></a>Пакет драйвера

Создайте [пакет драйверов](../get-started/manage-drivers.md#BKMK_ManagingDriverPackages) для определенных моделей оборудования. Укажите **модель** на вкладке **Общие** свойств.

Чтобы определить, какой пакет драйверов скачивается во время предварительного кэширования, клиент оценивает модель по свойству **Name** класса WMI **Win32_ComputerSystemProduct**.

> [!TIP]
> Фактический запрос использует инструкцию `LIKE` с подстановочными знаками: `select * from win32_computersystemproduct where name like "%yourstring%"`. Например, если в качестве модели указать `Surface`, запрос будет соответствовать всем моделям, включающим эту строку.<!-- 6315551 -->

#### <a name="package"></a>Пакет

Создайте [пакеты](../../apps/deploy-use/packages-and-programs.md) для определенных архитектур и языков. Укажите **архитектуру** и **язык** на вкладке свойств пакета **Общие**.


### <a name="2-create-a-task-sequence"></a><a name="bkmk_createts"></a> 2. Создание последовательности задач

Создайте последовательность задач с условными шагами для разных языков и архитектур или разных моделей оборудования для пакетов драйверов.

|Content|Шаг|
|---------|---------|
|Пакет обновления ОС|[Обновление операционной системы](../understand/task-sequence-steps.md#BKMK_UpgradeOS)|
|Образ ОС|[Применение образа ОС](../understand/task-sequence-steps.md#BKMK_ApplyOperatingSystemImage)|
|Пакет драйвера|[Применение пакета драйвера](../understand/task-sequence-steps.md#BKMK_ApplyDriverPackage)|
|Пакет|[Установить пакет](../understand/task-sequence-steps.md#BKMK_InstallPackage)|

Например, следующий шаг **Обновление ОС** использует версию на английском языке:  

![В редакторе последовательности задач отображается несколько шагов обновления ОС для языков ENU, DEU и JPN.](../media/precacheproperties2.png)

![В редакторе последовательности задач на вкладке "Параметры" отображается WQL-запрос WMI для языкового стандарта и архитектуры ОС.](../media/precacheoptions2.png)  

> [!Tip]
> Для английского языка (США) в ОС и 64-разрядной архитектуре рекомендуется использовать следующий запрос WMI:
>
> ```WMI
> SELECT * FROM Win32_OperatingSystem WHERE OSArchitecture LIKE '%64%' AND OSLanguage='1033'
> ```
>
> Сначала добавьте язык, выбрав условие **Язык операционной системы**. Затем измените запрос WMI, включив в него предложение архитектуры.


### <a name="3-deploy-the-task-sequence"></a><a name="bkmk_deploy"></a> 3. Развертывание последовательности задач

[Разверните последовательность задач](deploy-a-task-sequence.md). Для функции предварительного кэширования настройте указанные ниже значения.  

- На вкладке **Общие** выберите **Предварительно скачивать содержимое для этой последовательности задач**.  

- На вкладке **Параметры развертывания** настройте последовательность задач как **Доступную**.  

- На вкладке **Планирование** укажите текущее выбранное время для параметра **Запланируйте время доступности этого развертывания**. Клиент запускает предварительное кэширование содержимого в доступное время развертывания. Когда целевой клиент получает эту политику, доступное время находится в прошлом, поэтому скачивание предварительного кэширования начинается немедленно. Если клиент получает эту политику, но доступное время относится к будущему, клиент не запускает предварительное кэширование содержимого до тех пор, пока не наступит доступное время.  

- На вкладке **Точки развертывания** настройте **Параметры развертывания**. Если содержимое не было предварительно кэшировано перед началом установки, клиент использует эти параметры.  

    > [!Important]  
    > Для последовательности задач, которая устанавливает образ ОС, не используйте вариант развертывания **Загружать содержимое локально, если это требуется для выполняющейся последовательности задач**. Когда последовательность задач очищает диск до того, как применить образ ОС, она удаляет кэш клиента. Так как содержимое отсутствует, последовательность задач завершается ошибкой.<!-- SCCMDocs-PR #1338 -->


## <a name="user-experience"></a>Взаимодействие с пользователем

- Когда клиент получает политику развертывания, он начинает предварительно кэшировать содержимое после времени доступности развертывания. Это содержимое включает все связанные пакеты, но только пакет обновления операционной системы соответствует атрибутам архитектуры и языка для пакета.  

- Когда клиент предоставляет доступ к развертыванию пользователям, выводится уведомление, сообщающее пользователям о новом развертывании. Теперь последовательность задач отображается в центре программного обеспечения. Пользователь может перейти в центр программного обеспечения и нажать кнопку **Установить**, чтобы начать установку.  

- Если клиент не выполнил полное предварительное кэширование содержимого перед установкой последовательности задач пользователем, будут использованы параметры, указанные на вкладке развертывания **Параметры развертывания**.  


## <a name="see-also"></a>См. также

- [Создание последовательности задач для обновления ОС](create-a-task-sequence-to-upgrade-an-operating-system.md)
- [Сценарий обновления Windows до последней версии](upgrade-windows-to-the-latest-version.md)
