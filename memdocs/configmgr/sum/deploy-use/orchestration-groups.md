---
title: Группы оркестрации
titleSuffix: Configuration Manager
description: Создавайте группы оркестрации и развертывайте в них обновления.
ms.date: 04/01/2020
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.topic: conceptual
ms.assetid: cddbebea-b418-4839-b0a8-7809486c8a4c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: d9998f298cee24e9f10b3fd8c5e58d7b76200485
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81702982"
---
# <a name="orchestration-groups-in-configuration-manager"></a>Группы оркестрации в Configuration Manager
<!--3098816-->
*Область применения: Configuration Manager (Current Branch)*

Начиная с Configuration Manager версии 2002, можно создавать группы оркестрации. Создайте группу оркестрации, чтобы эффективнее управлять развертыванием обновлений программного обеспечения на устройствах. Многие администраторы сервера должны внимательно управлять обновлениями для конкретных рабочих нагрузок и автоматизировать поведение между ними.

Группа оркестрации обеспечивает гибкие возможности обновления устройств на основе процента, определенного числа или явного порядка. Вы также можете запустить скрипт PowerShell до и после того, как устройства запускают развертывание обновлений.

Членами группы оркестрации может быть любой клиент Configuration Manager, а не только серверы. Правила группы оркестрации применяются к устройствам для всех развертываний обновлений программного обеспечения в любой коллекции, в которой содержится участник группы оркестрации. Другие поведения развертывания применяются по-прежнему. Например, периоды обслуживания и расписания развертывания.

> [!NOTE]
> В этой версии Configuration Manager группы оркестрации являются функцией предварительного выпуска. Сведения о ее включении см. в разделе [Функции предварительной версии](../../core/servers/manage/pre-release-features.md).  
>
> Функция **Группы оркестрации** — это эволюция функции [Группы серверов](service-a-server-group.md). Группа оркестрации — это объект в Configuration Manager.

## <a name="orchestration-group-usage-example"></a>Пример использования групп оркестрации.

- Администратор обновлений программного обеспечения управляет всеми обновлениями в организации.
- У вас есть крупная коллекция для всех серверов и крупная коллекция для всех клиентов. Все обновления развертываются в рамках этих коллекций.
- Администраторы SQL должны управлять всем программным обеспечением, установленным на серверах SQL Server. Им требуется обновить пять серверов в определенном порядке. Текущий процесс заключается в ручном отключении определенных служб перед установкой обновлений и последующем перезапуске служб.
- Создайте группу оркестрации и добавьте все пять серверов SQL Server. Добавьте также предварительные и последующие скрипты с помощью скриптов PowerShell, предоставленных администраторами SQL.
- Во время следующего цикла обновления вы создадите и развернете обновления программного обеспечения для большой коллекции серверов как обычно. Администраторы SQL запускают развертывание, а группа оркестрации автоматизирует порядок и службы.

## <a name="prerequisites"></a>Предварительные условия

### <a name="site-server-and-permission-prerequisites"></a>Предварительные условия для сервера сайта и разрешения
- Чтобы просмотреть все группы оркестрации и обновления для этих групп, ваша учетная запись должна иметь роль **Полный администратор**.
   - Ролевое администрирование для групп оркестрации в настоящее время недоступно.
- Включите функцию **Группы оркестрации**. Дополнительные сведения см. в разделе [Включение дополнительных функций из обновлений](../../core/servers/manage/install-in-console-updates.md#bkmk_options).
   - При включении функции **Группы оркестрации** сайт отключает функцию **Группы серверов**. Такое поведение позволяет избежать конфликтов между двумя функциями.

### <a name="client-prerequisites"></a>Требования к клиенту

- Обновите целевые устройства до последней версии клиента Configuration Manager.
- Члены группы оркестрации должны быть назначены одному и тому же сайту.
- Устройство можно добавить только в одну группу оркестрации.
   - Устройства, которые уже находятся в группе оркестрации, не будут доступны для выбора при добавлении новых членов.


## <a name="limitations"></a>Ограничения

- В группу оркестрации можно добавить не более 1000 членов.
- Группы оркестрации не работают в режиме взаимодействия. Дополнительные сведения см. в статье [Взаимодействие различных версий Configuration Manager](../../core/plan-design/hierarchy/interoperability-between-different-versions.md#bkmk_mixed). <!--6389000-->
- Если обновления инициируются пользователями из центра программного обеспечения, то оркестрация будет обходиться. <!--6362887-->

## <a name="server-groups-are-automatically-updated-to-orchestration-groups"></a>Группы серверов автоматически обновляются до групп оркестрации

Функция **Группы оркестрации** — это эволюция функции [Группы серверов](service-a-server-group.md). При установке Configuration Manager версии 2002 или более поздней, если включены группы серверов, они автоматически перемещаются в группы оркестрации.

## <a name="create-an-orchestration-group"></a>Создать группу оркестрации

1. В консоли Configuration Manager перейдите к рабочей области **Активы и соответствие** и выберите узел **Группа оркестрации**.

1. На ленте выберите **Создать группу оркестрации**, чтобы открыть **мастер создания групп оркестрации**.

1. На странице **Общие сведения** укажите группу оркестрации, **имя** и **описание** (необязательно). Укажите значения для следующих элементов.
   - **Время ожидания группы оркестрации (в минутах)** . Ограничение времени для всех членов группы на завершение установки обновления.
   - **Время ожидания члена группы оркестрации (в минутах)** . Ограничение времени для одного устройства в группе на завершение установки обновления.

1. На странице **Выбор пользователя** сначала укажите **код сайта**. Затем нажмите кнопку **Добавить**, чтобы добавить ресурсы устройства в качестве членов этой группы оркестрации. **Выполните поиск** устройств по имени, а затем **добавьте** их. Вы также можете отфильтровать поиск по одной коллекции, используя **Поиск в коллекции**.  Добавив устройства в список выбранных ресурсов, нажмите кнопку **ОК**.
   - При выборе ресурсов для группы отображаются только допустимые клиенты. Выполняются проверки кода сайта, установки клиента и отсутствия дублирующихся ресурсов.

1. На странице **Выбор правил** выберите один из следующих параметров:

   - **Разрешите одновременное обновление компьютеров в процентах**, а затем выберите или введите число процента. Используйте этот параметр, чтобы обеспечить гибкость размера группы оркестрации в будущем. Например, в группе оркестрации содержится 50 устройств и вы указываете значение 10. Во время развертывания обновлений программного обеспечения Configuration Manager позволит запускать развертывание пяти устройствам одновременно. Если позже вы увеличите размер группы оркестрации до 100 устройств, то одновременно будут обновляться 10 устройств.

   - **Разрешите одновременное обновление нескольких компьютеров**, а затем выберите или введите определенное число. Используйте этот параметр, чтобы постоянно ограничивать выборку до определенного количества устройств, независимо от общего размера группы оркестрации.

   - **Укажите последовательность обслуживания**, а затем отсортируйте выбранные ресурсы в правильном порядке. Используйте этот параметр, чтобы явно указать порядок, в котором устройства запускают развертывание обновлений программного обеспечения.

1. На странице **Сценарий предварительного выполнения** введите скрипт PowerShell для запуска на каждом устройстве *перед* выполнением развертывания. Скрипт должен возвращать значение `0` для успешного выполнения или `3010` для успешного выполнения при перезапуске.

1. На странице **Сценарий последующего выполнения** введите скрипт PowerShell для запуска на каждом устройстве *после* выполнения развертывания. В противном случае поведение будет совпадать с PreScript.

1. Завершите работу мастера.

> [!WARNING]
> Убедитесь, что сценарии предварительного и последующего выполнения проверяются перед их использованием для групп оркестрации. Для сценариев предварительного и последующего выполнения не предусмотрен тайм-аут, поэтому они будут выполняться до тех пор, пока не будет достигнуто время ожидания члена группы оркестрации.

## <a name="view-orchestration-groups-and-members"></a>Просмотр групп и членов оркестрации

В рабочей области **Активы и соответствие** выберите узел **Группа оркестрации**. Чтобы просмотреть члены, выберите группу оркестрации и **Показать члены** на ленте. Дополнительные сведения о доступных столбцах для узлов см. в разделах ["Мониторинг групп оркестрации" и "Мониторинг членов группы оркестрации"](#bkmk_orch_monitor).

## <a name="edit-or-delete-an-orchestration-group"></a>Изменение или удаление группы оркестрации

Чтобы удалить группу оркестрации, выберите ее и нажмите **Удалить** на ленте или в контекстном меню. Чтобы изменить группу оркестрации, выберите ее и нажмите **Свойства** на ленте или в контекстном меню. Измените параметры на следующих вкладках.

   - **Общие** 
      - **Имя** — имя группы оркестрации.
      - **Описание**. Описание группы оркестрации (необязательно)
      - **Время ожидания группы оркестрации (в минутах)** . Ограничение времени для всех членов группы на завершение установки обновления.
      - **Время ожидания члена группы оркестрации (в минутах)** . Ограничение времени для одного устройства в группе на завершение установки обновления.

  - **Выбор члена**.
     - **Код сайта**. Код сайта группы оркестрации.
     - **Участники**. Нажмите **Добавить**, чтобы выбрать дополнительные устройства для группы оркестрации. Нажмите **Удалить**, чтобы удалить выбранное устройство.

   - **Выбор правил**.
      - **Разрешите одновременное обновление компьютеров в процентах**, а затем выберите или введите число процента. Используйте этот параметр, чтобы обеспечить гибкость размера группы оркестрации в будущем. Например, в группе оркестрации содержится 50 устройств и вы указываете значение 10. Во время развертывания обновлений программного обеспечения Configuration Manager позволит запускать развертывание пяти устройствам одновременно. Если позже вы увеличите размер группы оркестрации до 100 устройств, то одновременно будут обновляться 10 устройств.
      - **Разрешите одновременное обновление нескольких компьютеров**, а затем выберите или введите определенное число. Используйте этот параметр, чтобы постоянно ограничивать выборку до определенного количества устройств, независимо от общего размера группы оркестрации.
      - **Указать последовательность обслуживания**. Сортировка выбранных ресурсов в правильном порядке. Используйте этот параметр, чтобы явно указать порядок, в котором устройства запускают развертывание обновлений программного обеспечения.

   - **Сценарий предварительного выполнения**. 
       - Введите скрипт PowerShell для запуска на каждом устройстве *перед* выполнением развертывания. Скрипт должен возвращать значение `0` для успешного выполнения или `3010` для успешного выполнения при перезапуске.
       
   - **Сценарий последующего выполнения**.
      - Введите скрипт PowerShell для запуска на каждом устройстве *после* выполнения развертывания. Скрипт должен возвращать значение `0` для успешного выполнения или `3010` для успешного выполнения при перезапуске.
   > [!WARNING]
   > Убедитесь, что сценарии предварительного и последующего выполнения проверяются перед их использованием для групп оркестрации. Для сценариев предварительного и последующего выполнения не предусмотрен тайм-аут, поэтому они будут выполняться до тех пор, пока не будет достигнуто время ожидания члена группы оркестрации.


## <a name="start-orchestration"></a>Запуск оркестрации

1. [Разверните обновления программного обеспечения](deploy-software-updates.md) в коллекцию, содержащую участников группы оркестрации.

1. Оркестрация запускается, когда любой клиент в группе пытается установить обновление программного обеспечения в крайний срок или в течение периода обслуживания. Она начинается для всей группы и гарантирует, что устройства обновляются, следуя правилам группы оркестрации.
1. Вы можете запустить оркестрацию вручную, выбрав ее из узла **Группа оркестрации**, а затем выбрав **Начать оркестрацию** на ленте или в контекстном меню.
1. Если группа оркестрации находится в состоянии *Сбой*, сделайте следующее.
   1. Определите причину сбоя оркестрации и устраните проблемы.
   1. [Сбросьте состояние оркестрации для членов группы](#bkmk_reset).
   1. В узле **Группа оркестрации** нажмите кнопку **Начать оркестрацию**, чтобы перезапустить оркестрацию.
    Сбросьте его состояние с помощью кнопки **Начать оркестрацию**.  
   [![Начать оркестрацию ](./media/3098816-start-orchestration.png)](./media/3098816-start-orchestration.png#lightbox)


> [!TIP]
> - Группы оркестрации применяются только к развертываниям обновлений программного обеспечения. Они не применяются к другим развертываниям.
> - Вы можете щелкнуть правой кнопкой мыши член группы оркестрации и выберите **Reset Orchestration Group Member** (Сбросить члена группы оркестрации). Это позволяет повторно запустить оркестрацию.


## <a name="monitor-orchestration-groups"></a><a name="bkmk_orch_monitor"></a> Мониторинг групп оркестрации

В рабочей области **Активы и соответствие** выберите узел **Группа оркестрации**. Добавьте следующие столбцы, чтобы получить сведения о группах.

- **Имя оркестрации**. Имя группы оркестрации.
- **Код сайта**. Код сайта для группы.
- **Тип оркестрации**. Может иметь один из следующих типов:
   - Число
   - Процент
   - Последовательность

- **Значение оркестрации**. Количество элементов или процент членов, которые могут одновременно получить блокировку. **Значение оркестрации** заполняется только в том случае, если **типом оркестрации** является *число*, или *процент*.  
- **Состояние оркестрации**. Выполняется во время оркестрации. Бездействие — если не выполняется.
- **Время начала оркестрации**. Дата и время начала оркестрации.
- **Текущий порядковый номер**. Показывает, для кого из членов группы активна оркестрация. Это число соответствует **порядковому номеру** для члена.  
- **Время ожидания оркестрации (в минутах)** . Значение **Время ожидания группы оркестрации (в минутах)** устанавливается на странице **Общие** при создании группы или на вкладке **Общие** при редактировании группы.
- **Время ожидания члена группы оркестрации (в минутах)** . Значение **Время ожидания члена группы оркестрации (в минутах)** устанавливается на странице **Общие** при создании группы или на вкладке **Общие** при редактировании группы.
- **Идентификатор группы оркестрации**. Идентификатор группы, который используется в журналах и базе данных.
- **Уникальный идентификатор группы оркестрации**. Уникальный идентификатор группы, который используется в журналах и базе данных.

## <a name="monitor-orchestration-group-members"></a>Мониторинг членов группы оркестрации

В узле **Группа оркестрации** выберите группу оркестрации. На ленте щелкните **Показать участников**. Вы увидите участников группы и состояние их оркестрации. Добавьте следующие столбцы, чтобы получить сведения о членах.

- **Имя** — Имя устройства члена группы оркестрации.
- **Текущее состояние** — предоставляет состояние устройства члена.
   - **Выполняется** во время оркестрации.
   - **Ожидание** — показывает, что клиент ждет своей очереди на установку обновлений.
   - **Бездействие**, когда оркестрация завершена или не запущена.
- **Код состояния**. Вы можете щелкнуть правой кнопкой мыши член группы оркестрации и выбрать **Reset Orchestration Group Member** (Сбросить члена группы оркестрации). Этот сброс позволяет повторно запустить оркестрацию. Типы статусов: 
   - Бездействие
   - Устройство ожидает свою очередь
   - Выполняется установка обновления
   - Failed
   - Ожидается перезагрузка
- **Время получения блокировки**. Блокировки запрашиваются клиентом на основании его политики. Как только клиент получит блокировку, на нем будет активирована оркестрация.  
-**Время, когда был получен отчет о состоянии**. Время, когда член в последний раз сообщал о состоянии.
- **Порядковый номер**. Расположение клиента в очереди на установку обновлений.
- **Код сайта**. Код сайта для члена.
- **Активность клиента**. Сообщает, активен ли клиент.
- **Основные пользователи**. Какие пользователи являются основными для устройства.
- **Тип клиента**. Тип устройства, на котором находится клиент.
- **Текущий вошедший в систему пользователь**. Какой пользователь в данный момент вошел в систему на устройстве.
- **Идентификатор OG**. Идентификатор группы оркестрации, к которой принадлежит член.
- **Уникальный идентификатор OG**. Уникальный идентификатор группы оркестрации, к которой принадлежит член.
- **Идентификатор ресурса**. Идентификатор ресурса устройства.

## <a name="reset-the-orchestration-state-for-a-group-member"></a><a name="bkmk_reset"></a> Сброс состояния оркестрации для члена группы

Если необходимо повторно запустить оркестрацию для члена группы, можно очистить его состояние, например *Завершено* или *Сбой*. Для этого щелкните правой кнопкой мыши на члена группы оркестрации и выберите **Reset Orchestration Group Member** (Сбросить члена группы оркестрации). Можно также щелкнуть **Reset Orchestration Group Member** (Сбросить члена группы оркестрации) на ленте. Перед сбросом состояния следует проверить клиент, чтобы узнать причину сбоя и устранить найденные проблемы.
   [![Сброс члена группы оркестрации](./media/3098816-reset-group-member.png)](./media/3098816-reset-group-member.png#lightbox)

## <a name="log-files"></a>Файлы журнала

Используйте следующие файлы журналов на сервере сайта для помощи при мониторинге и устранении неполадок:

### <a name="site-server"></a>Сервер сайтов

- **Policypv.log** — указывает, что сайт назначается группе оркестрации клиентам.
- **SMS_OrchestrationGroup.log** — указывает поведение группы оркестрации.

### <a name="client"></a>Клиент

- **MaintenanceCoordinator.log**. Показывает процесс получения блокировки, установку обновлений, предварительные и последующие сценарии, а также процесс снятия блокировки.
- **UpdateDeployment.log**. Показывает процесс установки обновлений.
- **PolicyAgent.log**. Проверяет, находится ли клиент в группе оркестрации.

## <a name="next-steps"></a>Дальнейшие шаги

[Развертывание обновлений программного обеспечения](deploy-software-updates.md)