---
title: Оптимизация доставки обновлений Windows 10
titleSuffix: Configuration Manager
description: Узнайте, как использовать Configuration Manager для управления содержимым обновления, чтобы поддерживать актуальность Windows 10.
ms.date: 04/21/2020
ms.prod: configuration-manager
ms.technology: configmgr-sum
ms.topic: conceptual
ms.assetid: b670cfaf-96a4-4fcb-9caa-0f2e8c2c6198
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: f7edd05a7b1ce105e81fd4f594d95c9dfb45f472
ms.sourcegitcommit: 568f8f8c19fafdd0f4352d0682f1ca7a4d665d25
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/22/2020
ms.locfileid: "81771375"
---
# <a name="optimize-windows-10-update-delivery-with-configuration-manager"></a>Оптимизация доставки обновлений Windows 10 с помощью Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Для многих клиентов успешное получение ежемесячных обновлений и поддержание актуальности Windows 10 начинается с создания эффективной стратегии распределения содержимого с помощью Configuration Manager. Размер ежемесячных исправлений может создавать проблемы для больших организаций. Существует несколько технологий, которые позволяют снизить нагрузку на пропускную способность и сеть, чтобы оптимизировать доставку обновлений. В этой статье приводятся описания этих технологий, сравнение их возможностей и ряд рекомендаций, которые помогут вам выбрать одну из них.  
 
Для Windows 10 предоставляются обновления нескольких разных типов. Дополнительные сведения см. в статье [Развертывание обновлений с помощью Центра обновления Windows для бизнеса](/windows/deployment/update/waas-manage-updates-wufb#types-of-updates-managed-by-windows-update-for-business). Эта статья посвящена применению *исправлений* для Windows 10 с помощью Configuration Manager. 


## <a name="express-update-delivery"></a>Быстрая доставка обновлений

Объем скачиваемых файлов для исправлений Windows 10 может быть довольно большим. Каждый пакет содержит все ранее выпущенные исправления, чтобы поддерживать согласованность и простоту установки. Корпорация Майкрософт смогла уменьшить размер содержимого обновлений Windows 10, которое скачивает каждый клиент, с помощью функции экспресс-обновлений. Сейчас этот механизм, позволяющий значительно сократить объем загрузки, используется миллионами устройств, которые получают обновления напрямую из службы Центра обновления Windows. Преимущества этой функции доступны и тем клиентам, которые не могут скачивать обновления напрямую из службы Центра обновления Windows. 

В Configuration Manager версии 1702 добавлена поддержка [файлов экспресс-установки](manage-express-installation-files-for-windows-10-updates.md) для исправлений Windows 10. Тем не менее для оптимальных результатов мы рекомендуем использовать Configuration Manager версии 1802 или более поздней. Для достижения максимальной скорости загрузки лучше всего использовать Windows 10 и версию Configuration Manager не ниже 1703. 

> [!NOTE]  
> Объем содержимого экспресс-обновлений значительно больше, чем в версии с полными файлами. Файлы экспресс-установки содержат все возможные варианты для каждого файла, для обновления которых он предназначен. Это приводит к тому, что при включении экспресс-обновлений в Configuration Manager увеличивается требуемое для обновлений место на диске в источнике пакетов обновления и в точках распространения. Несмотря на то что в точках распространения обновления занимают больше места на диске, размер содержимого, которое клиенты скачивают из этих точек распространения, уменьшается. Клиенты скачивают только те элементы, которые им нужны (разностное обновление), но не полный объем обновления.


## <a name="peer-to-peer-content-distribution"></a>Одноранговое распространение содержимого

Хотя клиенты скачивают только нужные части содержимого, вы можете дополнительно ускорить обновление Windows в своей среде за счет однорангового распространения содержимого. Использование одноранговых источников для скачивания исправлений может быть очень удобно в средах, где удаленные офисы не имеют локальных точек распространения. Такая схема избавит от необходимости загружать на каждый клиент содержимое из удаленной точки распространения по медленному каналу глобальной сети. Одноранговые источники также полезны в тех ситуациях, когда клиенты используют службу Центра обновления Windows в качестве резервного источника. В этой ситуации достаточно, чтобы один узел скачал содержимое из облака и сделал его доступным для других устройств.

Configuration Manager поддерживает многие технологии одноранговой связи, в том числе:
- оптимизацию доставки Windows;
- Одноранговый кэш Configuration Manager
- Windows BranchCache  

В следующих разделах приводятся дополнительные сведения об этих технологиях.

### <a name="windows-delivery-optimization"></a>Оптимизация доставки Windows

[Оптимизация доставки](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization) — это основная технология скачивания и однорангового распространения, встроенная в Windows 10. Клиенты Windows 10 могут получать содержимое от других устройств в локальной сети, которые уже загрузили аналогичные обновления. С помощью [параметров Windows для оптимизации доставки](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization-reference#delivery-optimization-options) вы можете объединить клиенты в группы. Такая группировка позволяет организации определить устройства, которые будут лучшими кандидатами на выполнение запросов на одноранговое распространение. Оптимизация доставки значительно снижает общую нагрузку на пропускную способность сети, что позволяет поддерживать актуальное состояние устройств и тратить меньше времени на скачивание.

> [!NOTE]  
> Оптимизация доставки — это решение, управляемое из облака. Доступ через Интернет к облачной службе оптимизации доставки является обязательным условием для работы функции одноранговой доставки. Дополнительные сведения о необходимых конечных точках Интернета см. в разделе [Часто задаваемые вопросы по оптимизации доставки](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization#frequently-asked-questions). 

Чтобы получить наилучшие результаты, может потребоваться настроить [режим загрузки](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization-reference#download-mode) оптимизации доставки для **группы (2)** и определить *идентификаторы групп*. В групповом режиме допускается пиринг через границы внутренних подсетей между устройствами, которые принадлежат к одной группе, включая устройства в удаленных офисах. Используйте [параметр идентификатора группы](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization-reference#select-the-source-of-group-ids), чтобы создать пользовательские группы, независимые от доменов и сайтов в доменных службах Active Directory. Режим групповой загрузки рекомендуется для большинства организаций, которые заинтересованы в оптимизации пропускной способности при оптимизации доставки.

Настройка идентификаторов групп вручную довольно сложна, если клиенты могут перемещаться между несколькими сетями. В Configuration Manager версии 1802 добавлена новая функция, упрощающая управление этим процессом путем [интеграции групп границ с оптимизацией доставки](../../core/plan-design/hierarchy/fundamental-concepts-for-content-management.md#delivery-optimization). Когда клиент выходит из спящего режима, он обращается к точке управления и получает от нее политики, а также предоставляет информацию о своей сети и группе границ. Configuration Manager создает уникальный идентификатор для каждой группы границ. Сайт использует сведения о расположении клиента для автоматической настройки идентификатора группы для оптимизации доставки, используя идентификатор границы Configuration Manager. Когда клиент перемещается в другую группу границ, он обменивается данными с соответствующей точкой управления и автоматически переключается на новый идентификатор группы границ. Благодаря такому методу интеграции функция оптимизации доставки может использовать сведения о группах границ Configuration Manager для поиска одноранговых источников для скачивания обновлений.

### <a name="delivery-optimization-starting-in-version-1910"></a><a name="bkmk_DO-1910"></a> Оптимизация доставки, начиная с версии 1910
<!--4699118-->
Начиная с версии Configuration Manager 1910, службу оптимизации доставки можно использовать для распространения всего содержимого Центра обновления Windows для клиентов под управлением Windows 10 версии 1709 или более поздней, а не только файлов экспресс-установки.

Чтобы использовать службу оптимизации доставки для всех файлов установки Центра обновления Windows, установите следующие [параметры клиента обновлений программного обеспечения](../../core/clients/deploy/about-client-settings.md#software-updates):

- Установите для параметра **Разрешить установку файлов экспресс-установки на клиенты** значение **Да**.
- Установите для параметра **Порт, используемый клиентами для получения запросов на разностное содержимое** значение 8005 (по умолчанию) или настраиваемый номер порта.

> [!IMPORTANT]
> - Служба "Оптимизация доставки" должна быть включена (по умолчанию). Нужно отключить ее обход. См. сведения об [оптимизации доставки Windows](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization-reference).
> - Проверьте [параметры клиента для оптимизации доставки](../../core/clients/deploy/about-client-settings.md#delivery-optimization), когда изменяете [параметры клиента обновлений программного обеспечения](../../core/clients/deploy/about-client-settings.md#software-updates) для разностного содержимого.
> - Оптимизацию доставки нельзя использовать для обновлений клиента Office 365, если включена поддержка Office COM. Office COM позволяет Configuration Manager управлять обновлениями для клиентов Office 365. Вы можете отменить регистрацию Office COM, чтобы разрешить использование оптимизации доставки для обновлений Office 365. При отключении Office COM обновлениями программного обеспечения для Office 365 по умолчанию управляет запланированная задача автоматического обновления Office 2.0. Это означает, что Configuration Manager не контролирует и не отслеживает установку обновлений Office 365. Configuration Manager и дальше получает данные инвентаризации оборудования, чтобы заполнить ими панель мониторинга для управления клиентами Office 365 в консоли. Сведения об отмене регистрации Office COM, см. в разделе о том, как [разрешить клиентам Office 365 получать обновления от Office CDN вместо Configuration Manager](https://docs.microsoft.com/deployoffice/manage-office-365-proplus-updates-with-configuration-manager#enable-office-365-clients-to-receive-updates-from-the-office-cdn-instead-of-configuration-manager).
> - При использовании шлюза управления облачными клиентами для хранилища содержимого содержимое для сторонних обновлений не будет скачиваться на клиенты, если включен [параметр клиента](../../core/clients/deploy/about-client-settings.md#allow-clients-to-download-delta-content-when-available) **Скачивать разностное содержимое, если оно доступно**. <!--6598587-->


### <a name="configuration-manager-peer-cache"></a>Одноранговый кэш Configuration Manager

[Одноранговый кэш](../../core/plan-design/hierarchy/client-peer-cache.md) — это компонент Configuration Manager, который позволяет клиентам делиться содержимым с другими клиентами непосредственно из своего локального кэша Configuration Manager. Одноранговый кэш не заменяет собой другие решения однорангового кэширования, такие как Windows BranchCache. Он работает параллельно с ними, предоставляя дополнительные возможности, помимо традиционных методов развертывания содержимого, таких как точки распространения. Одноранговый кэш не зависит от BranchCache. Одноранговый кэш будет работать даже при отключенном BranchCache.

> [!NOTE]  
> Клиенты могут скачивать содержимое только с клиентов однорангового кэша, находящихся в одной с ними группе границ.  


### <a name="windows-branchcache"></a>Windows BranchCache
[BranchCache](https://docs.microsoft.com/windows-server/networking/branchcache/branchcache) — это технология Windows для оптимизации пропускной способности. Каждый клиент имеет собственный кэш и выполняет роль дополнительного источника содержимого. Устройства в той же сети могут обратиться за этим содержимым. [Configuration Manager может использовать BranchCache](../../core/plan-design/configs/support-for-windows-features-and-networks.md#bkmk_branchcache), чтобы разрешить одноранговым узлам обращаться друг к другу за содержимым, вместо того чтобы каждый раз подключаться к точке распространения. Если используется BranchCache, файлы кэшируются на каждом отдельном клиенте и другие клиенты могут получать их по мере необходимости. Такой подход распределяет кэш, не создавая единую точку извлечения. Это значительно снижает нагрузку на пропускную способность, сокращая время получения запрошенного содержимого клиентами.



## <a name="selecting-the-right-peer-caching-technology"></a>Выбор подходящей технологии для однорангового кэширования

Выбор технологии однорангового кэширования для файлов экспресс-установки зависит от условий и требований среды. Несмотря на то что Configuration Manager поддерживает все описанные выше одноранговые технологии, следует использовать те из них, которые лучше всего подходят для вашей среды. Для большинства клиентов вполне подходит встроенная технология однорангового кэширования Windows 10, при условии, что все клиенты соответствуют требованиям по доступу к Интернету для оптимизации доставки. Если клиенты не отвечают этим требованиям, рекомендуем использовать одноранговый кэш Configuration Manager. Если вы сейчас используете BranchCache с Configuration Manager, и он полностью соответствует вашим потребностям, то файлы экспресс-обновления через BranchCache будут для вас идеальным вариантом. 

### <a name="peer-cache-comparison-chart"></a>Схема сравнения систем однорангового кэша


| функциональное назначение;  | Оптимизация доставки  | Одноранговый кэш  | BranchCache  |
|---------|---------|---------|---------|
| Поддержка работы между подсетями | Да | Да | Нет |
| Регулирование полосы пропускания | Да (собственные функции) | Да (через BITS) | Да (через BITS) |
| Неполная поддержка содержимого | Да, для всех поддерживаемых типов содержимого, перечисленных в следующей строке этого столбца. | Только для Office 365 и экспресс-обновлений | Да, для всех поддерживаемых типов содержимого, перечисленных в следующей строке этого столбца. |
| Поддерживаемые типы содержимого | **Через ConfigMgr:** </br> – экспресс-обновления; </br> – все обновления Windows (начиная с версии 1910). Это не относится к обновлениям Office.</br> </br> **Через Microsoft Cloud:**</br> – Обновления Windows и обновления безопасности</br> – Драйверы</br> – Приложения магазина Windows</br> – Приложения Магазина Windows для бизнеса | Все типы содержимого ConfigMgr, включая образы загрузки в [Windows PE](../../osd/get-started/prepare-windows-pe-peer-cache-to-reduce-wan-traffic.md) | Все типы содержимого ConfigMgr, за исключением образов |
| Управление размером кэша на диске | Да | Да | Да |
| Обнаружение одноранговых источников | Автоматически | Вручную (через параметр агента клиента) | Автоматически |
| Обнаружение одноранговых источников | Через облачную службу оптимизации доставки (требуется доступ в Интернет) | Через точку управления (с учетом клиентских групп границ) | Многоадресная рассылка |
| Отчеты | Да (с помощью портала "Аналитика компьютеров") | Панель мониторинга ConfigMgr для клиентских источников данных | Панель мониторинга ConfigMgr для клиентских источников данных |
| Управление использованием глобальной сети | Да (собственные функции с возможностью контроля через параметры групповой политики) | Группы границ | Только поддержка подсетей |
| Управление через ConfigMgr | Частичное (через параметр агента клиента) | Да (через параметр агента клиента) | Да (через параметр агента клиента) |



## <a name="conclusion"></a>Заключение

Корпорация Майкрософт рекомендует оптимизировать доставку исправлений для Windows 10 с помощью Configuration Manager, файлов экспресс-установки и технологии однорангового кэширования по мере необходимости. Такой подход призван решить проблемы, связанные с загрузкой объемного содержимого на устройства Windows 10 для установки исправлений. Также рекомендуется поддерживать актуальность устройств Windows 10, ежемесячно развертывая исправления. Такой подход позволяет сократить объем разностных исправлений, необходимых для устройства ежемесячно. Уменьшение объема дельта-обновлений позволяет уменьшить размер содержимого, скачиваемого из точек распространения или одноранговых источников. 

Файлы экспресс-установки устроены так, что размер их содержимого значительно больше, чем размер традиционных независимых файлов. Этот размер увеличивает время загрузки обновлений из службы Центра обновления Windows на сервер сайта Configuration Manager. Объем дискового пространства, необходимого для сервера сайта и точек распространения, также увеличивается. Общее время, необходимое для скачивания и распространения исправлений, может также оказаться больше. Но при этом преимущества для конкретных устройств будут заметны в процессе скачивания и установки исправлений на устройствах Windows 10. Дополнительные сведения см. в разделе об [использовании файлов экспресс-установки](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc708456(v=ws.10)?#using-express-installation-files).

Если недостатки крупных обновлений на стороне сервера являются помехой для внедрения экспресс-обновлений, но преимущества на стороне устройства крайне важны для вашего бизнеса и среды, корпорация Майкрософт рекомендует использовать [Центр обновления Windows для бизнеса](integrate-windows-update-for-business-windows-10.md) и Configuration Manager. Центр обновления Windows для бизнеса предоставляет все преимущества экспресс-обновлений, избавляя от необходимости скачивать, хранить и распространять файлы экспресс-установки в вашей среде. Клиенты скачивают содержимое напрямую из службы Центра обновления Windows, а значит могут использовать преимущества оптимизации доставки.



## <a name="frequently-asked-questions"></a><a name="bkmk_faq"></a> Часто задаваемые вопросы

#### <a name="how-do-windows-express-downloads-work-with-configuration-manager"></a>Как работают экспресс-обновления Windows с Configuration Manager?

Агент обновления Windows сначала запрашивает согласие на экспресс-обновления. Если экспресс-обновление завершается сбоем, используется резервная возможность полного обновления.  

1. Клиент Configuration Manager передает в WUA запрос на скачивание содержимого обновления. Когда WUA активирует экспресс-обновление, сначала скачивается заглушка (например, `Windows10.0-KB1234567-<platform>-express.cab`), входящая в пакет экспресс-обновления.  

2. WUA передает эту заглушку в установщик обновлений Windows, действующий на основе компонентной модели (CBS). CBS использует заглушку для составления списка локального оборудования, выполняя разностное сравнение файлов на устройстве с компонентами, необходимыми для получения новейшей версии предлагаемого файла.  

3. Затем CBS передает в WUA запрос на скачивание требуемых диапазонов из одного или нескольких PSF-файлов экспресс-обновления.  

4. Оптимизация доставки при взаимодействии с Configuration Manager скачивает эти диапазоны из локальной точки распространения или одноранговых узлов, если они доступны. Если вы отключите оптимизацию доставки, фоновая интеллектуальная служба передачи (BITS) выполняет аналогичные функции, координируя источники однорангового кэша, как и Configuration Manager. Оптимизация доставки или BITS передает диапазоны для WUA, что позволяет CBS применить и установить их.  


#### <a name="why-are-the-express-files-psf-so-large-when-stored-on-configuration-manager-peer-sources-in-the-ccmcache-folder"></a>Почему файлы экспресс-установки (PSF) имеют такой большой объем в папке ccmcache в источниках однорангового кэша Configuration Manager?

Файлы экспресс-установки (PSF) представляют собой разреженные файлы. Чтобы определить фактический объем пространства, которое такой файл занимает на диске, проверьте свойство **Размер на диске** для этого файла. Значение свойства "Размер на диске" обычно существенно меньше, чем значение размера.  


#### <a name="does-configuration-manager-support-express-installation-files-with-windows-10-feature-updates"></a>Поддерживает ли Configuration Manager файлы экспресс-установки для обновления компонентов Windows 10?

Нет, Configuration Manager сейчас поддерживает файлы экспресс-установки только для исправлений Windows 10.  


#### <a name="how-much-disk-space-is-needed-per-quality-update-on-the-site-server-and-distribution-points"></a>Сколько нужно места на диске сервера сайта и (или) точки распространения для каждого исправления?

Это зависит от нескольких условий. Для каждого исправления на сервере сохраняются версии для экспресс-установки и с полными файлами. Исправления Windows 10 являются накопительными, поэтому размер этих файлов увеличивается каждый месяц. Учтите, что на каждое обновление потребуется не менее 5 ГБ для каждого используемого языка. 


#### <a name="do-configuration-manager-clients-still-benefit-from-express-installation-files-when-falling-back-to-the-windows-update-service"></a>Сохраняют ли клиенты Configuration Manager преимущества файлов экспресс-установки, когда используют службу Центра обновления Windows?

Да. Если вы используете описанный ниже вариант развертывания обновлений для программного обеспечения, ваши клиенты смогут использовать экспресс-установку и оптимизацию доставки даже при откате к облачной службе.  

**Если обновления программного обеспечения недоступны в точке распространения в текущей и соседней группах или группе сайта, содержимое скачивается из Центра обновления Майкрософт.**


#### <a name="why-is-express-file-content-not-downloaded-for-existing-updates-after-i-enable-express-file-support"></a>Почему содержимое файлов экспресс-обновлений не скачивается для существующих обновлений, когда я включаю поддержку экспресс-установки? 

Изменения применяются только к новым обновлениям, которые синхронизируются и развертываются после включения поддержки.


#### <a name="is-there-any-way-to-see-how-much-content-is-downloaded-from-peers-using-delivery-optimization"></a>Есть ли возможность увидеть, какой объем содержимого скачивается из одноранговых узлов через службу оптимизации доставки?
Windows 10 версии 1703 (и более поздние версии) включает два новых командлета PowerShell: **Get-DeliveryOptimizationPerfSnap** и **Get-DeliveryOptimizationStatus**. Эти командлеты предоставляют некоторые сведения об использовании оптимизации доставки и кэша. См. дополнительные сведения об [оптимизации доставки для обновлений Windows 10](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization#the-cloud-service-doesnt-see-other-peers-on-the-network).


#### <a name="how-do-clients-communicate-with-delivery-optimization-over-the-network"></a>Как клиенты взаимодействуют по сети со службой оптимизации доставки?
Сведения об используемых сетевых портах, требованиях к прокси-серверам и именах узлов для настройки брандмауэров см. в разделе [Вопросы и ответы](https://docs.microsoft.com/windows/deployment/update/waas-delivery-optimization#frequently-asked-questions).

## <a name="log-files"></a>Файлы журнала

Для мониторинга скачивания разностных обновлений используйте следующие файлы журналов:

- WUAHandler.log
- DeltaDownload.log

## <a name="next-steps"></a>Дальнейшие шаги

- [Развертывание обновлений программного обеспечения](deploy-software-updates.md)
- [Автоматическое развертывание обновлений программного обеспечения](automatically-deploy-software-updates.md)
