---
title: Устранение неполадок интеграции MSfB
titleSuffix: Configuration Manager
description: Предоставляет рекомендации и способы устранения некоторых распространенных проблем, связанных с интеграцией Microsoft Store для бизнеса и образования.
ms.date: 04/24/2020
ms.prod: configuration-manager
ms.technology: configmgr-app
ms.topic: conceptual
ms.assetid: 09929057-ecf2-4d49-aee0-709916932b14
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 694083bbce34b9e1b62f77a1d18cf79663704b2a
ms.sourcegitcommit: af8a3efd361a7f3fa6e98e5126dfb1391966ff76
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/24/2020
ms.locfileid: "82149122"
---
# <a name="troubleshoot-the-microsoft-store-for-business-and-education-integration-with-configuration-manager"></a>Устранение неполадок интеграции Microsoft Store для бизнеса и образования с помощью Configuration Manager

Эта статья содержит ключевые советы по устранению неполадок и исправления для некоторых основных проблем, которые могут возникнуть при интеграции Microsoft Store для бизнеса и образования (MSfB) с Configuration Manager.

Дополнительные сведения об использовании Microsoft Store для бизнеса и образования с Configuration Manager см. в статье [Управление приложениями из Microsoft Store для бизнеса и образования в Configuration Manager](manage-apps-from-the-windows-store-for-business.md).

## <a name="monitor"></a>Монитор

### <a name="component-status"></a>Состояние компонента

В консоли Configuration Manager перейдите в рабочую область **Мониторинг**, разверните раздел **Состояние системы** и выберите узел **Состояние компонента**. Отслеживать состояние следующих компонентов:

- SMS_BUSINESS_APP_PROCESS_MANAGER
- SMS_CLOUDCONNECTION

### <a name="sync-status"></a>Состояние синхронизации

В консоли Configuration Manager в рабочей области **Администрирование** разверните узел **Облачные службы** и выберите узел **Магазин Майкрософт для бизнеса**. Проверьте столбец **Состояние последней синхронизации**.

### <a name="view-synchronized-apps"></a>Просмотр синхронизированных приложений

В консоли Configuration Manager в рабочей области **Библиотека программного обеспечения** разверните узел **Управление приложениями** и выберите узел **Информация о лицензиях для приложений из Магазина**.


## <a name="log-files"></a>Файлы журнала

### <a name="wsfbsyncworkerlog"></a>WSfBSyncWorker.log

Этот файл журнала находится в точке подключения службы в папке `\Logs` в каталоге установки Configuration Manager. В него записываются сведения о коммуникации с облачной службой. Эти сведения включают метаданные, значки, пакеты и получение файлов лицензий.

Чтобы изменить уровень ведения журнала, присвойте параметру `LoggingLevel` значение `0` в разделе реестра `HKLM\SOFTWARE\Microsoft\SMS\Tracing\SMS_CLOUDCONNECTION`. Дополнительные сведения см. в разделе [Настройка параметров ведения журнала](../../core/plan-design/hierarchy/about-log-files.md#bkmk_reg-site).

### <a name="sms_cloudconnectionlog"></a>SMS_CLOUDCONNECTION.log

Этот файл журнала находится в точке подключения службы в папке `\Logs` в каталоге установки Configuration Manager. Если служба WSfBSyncWorker не запущена или постоянно запускается и останавливается, проверьте записи в этом файле журнала.

> [!NOTE]
> Этот файл журнала используется совместно с другими функциями.

### <a name="businessappprocessworkerlog"></a>BusinessAppProcessWorker.log

Этот файл журнала находится на сервере сайта для сайта верхнего уровня в иерархии. Он находится в папке `\Logs` в каталоге установки Configuration Manager. В него записываются сведения о следующих процессах.

- Вставка сведений о метаданных, синхронизированных компонентом BusinessAppProcessWorker, в базу данных
- Обработка файлов в `\InstallDir\inboxes\businessappprocess.box`

### <a name="sms_business_app_process_managerlog"></a>SMS_BUSINESS_APP_PROCESS_MANAGER.log

Этот файл журнала находится на сервере сайта для сайта верхнего уровня в иерархии. Он находится в папке `\Logs` в каталоге установки Configuration Manager. Если служба BusinessAppProcessWorker не запущена или постоянно запускается и останавливается, проверьте записи в этом файле журнала.



## <a name="last-sync-failed"></a>Последняя синхронизация завершилась сбоем

Если в результате последней синхронизации произошел *сбой*, начните с просмотра следующих [файлов журналов](#log-files) для поиска симптомов.

- WSfBSyncWorker.log
- SMS_CLOUDCONNECTION.log

Затем ознакомьтесь с одним из следующих разделов для решения распространенных проблем.

- [Ошибка авторизации](#bkmk_fail-symptom1)
- [Секретный ключ недействителен](#bkmk_fail-symptom2)
- [Ошибка при получении токена приложения](#bkmk_fail-symptom3)
- [Расположение содержимого не существует или разрешения предоставлены неправильно](#bkmk_fail-symptom4)
- [Произошла ошибка при вызове метода "GET" HTTP-запроса](#bkmk_fail-symptom5)
- [Не удается записать в буфер больше байтов](#bkmk_fail-symptom6)

### <a name="authorization-error"></a><a name="bkmk_fail-symptom1"></a> Ошибка авторизации

#### <a name="cause"></a>Причина

Эта проблема может возникать, если настроенное приложение Azure Active Directory (Azure AD) не имеет разрешений на управление Microsoft Store для бизнеса и образования для этого клиента.

#### <a name="workaround"></a>Обходной путь

1. Войдите в систему с правами администратора на портале Microsoft Store для бизнеса и образования.
1. Перейдите в раздел **Параметры** и выберите **Средства управления**.
1. Если приложение отсутствует в списке, выберите **Добавить средство управления**. Затем выполните поиск по имени и выберите приложение Azure AD, связанное с тем же идентификатором ClientID, что и Configuration Manager.
1. Если в поле состояние не отображается **Активно**, выберите **Активировать** в разделе **Действие**.
1. В консоли Configuration Manager в рабочей области **Администрирование** разверните узел **Облачные службы** и выберите узел **Магазин Майкрософт для бизнеса**. Выполните синхронизацию с хранилищем или дождитесь следующего интервала синхронизации.

> [!Tip]
> Чтобы найти ClientID в Configuration Manager, выполните следующие действия.
>
> 1. В консоли Configuration Manager в рабочей области **Администрирование**, разверните узел **Облачные службы** и выберите узел **Клиенты Azure Active Directory**.
> 1. Выберите клиент, который вы используете для интеграции Microsoft Store для бизнеса и образования.
> 1. В области результатов найдите соответствующее приложение и посмотрите сведения в столбце **Идентификатор клиента**.

### <a name="the-secret-key-is-invalid"></a><a name="bkmk_fail-symptom2"></a> Секретный ключ недействителен

#### <a name="cause"></a>Причина

Эта проблема может возникать, если истек срок действия секретного ключа в приложении Azure AD для конфигурации Microsoft Store для бизнеса и образования.

#### <a name="resolution"></a>Решение

Продлите секретный ключ для приложения Azure AD. Дополнительные сведения см. в статье [Настройка служб Azure для использования с Configuration Manager](../../core/servers/deploy/configure/azure-services-wizard.md#bkmk_renew).

### <a name="error-getting-application-token"></a><a name="bkmk_fail-symptom3"></a> Ошибка при получении токена приложения

#### <a name="cause"></a>Причина

Эта проблема может возникать, если подключенное приложение больше не существует в Azure AD.

#### <a name="resolution"></a>Решение

Удалите и повторно создайте подключение к Microsoft Store для бизнеса и образования.

1. В консоли Configuration Manager в рабочей области **Администрирование** разверните узел **Облачные службы** и выберите узел **Магазин Майкрософт для бизнеса**.
1. Выберите существующее подключение.
1. На ленте выберите **Удалить**.

Затем повторно создайте соединитель. Дополнительные сведения см. в следующих статьях:

- [Настройка служб Azure](../../core/servers/deploy/configure/azure-services-wizard.md)
- [Настройка синхронизации с Microsoft Store для бизнеса и образования](manage-apps-from-the-windows-store-for-business.md#bkmk_setup)

### <a name="content-location-doesnt-exist-or-incorrect-permissions"></a><a name="bkmk_fail-symptom4"></a> Расположение содержимого не существует или разрешения предоставлены неправильно

#### <a name="cause"></a>Причина

При настройке подключения Microsoft Store для бизнеса и образования необходимо указать общую сетевую папку для хранения синхронизированного содержимого. Эта проблема может возникать, если эта общая папка не существует или имеет неверные разрешения. Учетная запись компьютера для точки подключения службы должна быть владельцем этого каталога и всех его подкаталогов.<!-- memdocs#146 --> В противном случае появится примерно такое сообщение об ошибке:

```
Failed to download package d788cc1b-ab00-bb5f-1548-f2dfe717583b-X86-Arm for product 9WZDNCRFJ3PS\0015.
System.IO.IOException: This security ID may not be assigned as the owner of this object.
```

Чтобы просмотреть настроенное расположение, выполните следующие действия.

1. В консоли Configuration Manager в рабочей области **Администрирование** разверните узел **Облачные службы** и выберите узел **Магазин Майкрософт для бизнеса**.

1. Выберите учетную запись и откройте ее **свойства**.

1. Переключитесь на вкладку **Конфигурация**. Параметр **Расположение** показывает сетевой путь для хранения содержимого приложения, скачанного из Microsoft Store для бизнеса и образования.

#### <a name="workaround"></a>Обходной путь

1. Создайте общую папку, если она еще не создана.

1. Проверьте разрешения NTFS для папки и разрешения на сетевую папку. Предоставьте учетной записи компьютера точки подключения службы разрешения на **чтение** и **запись**.

Если вы хотите изменить расположение, удалите и повторно создайте подключение с новым расположением содержимого.

### <a name="error-occurred-making-http-request-calling-get-method"></a><a name="bkmk_fail-symptom5"></a> Произошла ошибка при вызове метода "GET" HTTP-запроса

#### <a name="cause"></a>Причина

Эта проблема может возникать, если синхронизация приложений из магазина происходила так долго, что срок действия URL-адреса содержимого истек.

#### <a name="workaround"></a>Обходной путь

Повторите процесс синхронизации

1. В консоли Configuration Manager в рабочей области **Администрирование** разверните узел **Облачные службы** и выберите узел **Магазин Майкрософт для бизнеса**.
1. Выберите подключение. На ленте выберите **Синхронизация из Магазина Майкрософт для бизнеса**.

С каждым разом процесс должен продвигаться вперед. В зависимости от следующих параметров может потребоваться несколько повторных попыток.

- Количество автономных приложений
- Размер пакетов
- Скорость сети

После каждой попытки ошибка должна отображаться меньшее количество раз. Если количество ошибок не уменьшается, возникает другая проблема.

### <a name="cannot-write-more-bytes-to-the-buffer"></a><a name="bkmk_fail-symptom6"></a> Не удается записать в буфер больше байтов

#### <a name="cause"></a>Причина

Эта проблема может возникать, если размер пакета приложения превышает 500 МБ. Configuration Manager поддерживает только автоматическую синхронизацию автономных приложений с пакетами размером менее 500 МБ.

#### <a name="workaround"></a>Обходной путь

Вы не можете автоматически синхронизировать эти приложения, но можете скачать содержимое и вручную создать приложение.

1. Получите идентификатор сбойного приложения из следующей строки в файле **WSfbSynWorker.log**.

    `Error(s) syncing or downloading application <ApplicationID> from the Microsoft Store for Business.`

1. Войдите в систему с правами администратора на портале Microsoft Store для бизнеса и образования. Найдите страницу этого приложения.

    > [!Tip]
    > URL-адрес страницы выглядит примерно так: `https://businessstore.microsoft.com/en-us/store/p/app/ApplicationID`

    1. Выберите параметр **Автономное**, если он еще не выбран. Затем выберите **Управление**.

    1. Создайте отдельную папку в общем ресурсе содержимого приложения для всех поддерживаемых платформ.

    1. Загрузите пакет в папку пакета.

    1. Загрузите закодированный файл лицензии в виде файла `.bin` в папку пакета.

    1. Скачайте все необходимые платформы в папку пакета.

1. В консоли Configuration Manager перейдите в рабочую область **Библиотека программного обеспечения**, разверните узел **Управление приложениями** и щелкните **Приложения**.

1. [Создайте приложение](create-applications.md), указав сведения о приложении вручную.

    1. Создайте тип развертывания для каждой поддерживаемой платформы, которую вы загрузили ранее.

    1. Введите: **Пакет приложения Windows (\*.appx, \*.appxbundle)**

    1. Задайте параметр appx/appxbundle для фактического пакета приложения, а не требуемого пакета зависимостей.

Подтвердите следующие сведения на итоговой странице **импорта сведений**.

- **Файл лицензии**. Указывает на файл `.bin`. Этот файл лицензии необходим для автономных приложений.
- **Зависимости приложений Windows**. Убедитесь, что для этого пакета скачаны все необходимые зависимости.


## <a name="sync-doesnt-run"></a>Синхронизация не выполняется

В этом разделе рассматриваются следующие проблемы синхронизации.

- Вы вручную запускаете процесс синхронизации, но он не выполняется
- Сайт не синхронизируется автоматически каждый день

Начните с просмотра следующих [файлов журнала](#log-files) для поиска симптомов.

- BusinessAppProcessWorker.log
- SMS_BUSINESS_APP_PROCESS_MANAGER.log
- WsfbSyncWorker.log
- SMS_CLOUDCONNECTION.log

Затем ознакомьтесь с одним из следующих разделов для решения распространенных проблем.

- [Синхронизация вручную не запускается](#bkmk_sync-symptom1)
- [Автоматическая ежедневная синхронизация не выполняется и в файле SMS_BUSINESS_APP_PROCESS_MANAGER.log появляется ошибка "shutting down # workers" (завершена работа # рабочих процессов)](#bkmk_sync-symptom2)

### <a name="manual-sync-doesnt-start"></a><a name="bkmk_sync-symptom1"></a> Синхронизация вручную не запускается

#### <a name="cause"></a>Причина

Эта проблема может возникать, если после предыдущей синхронизации прошло менее 10 минут. Нельзя выполнять синхронизацию чаще, чем каждые 10 минут.

#### <a name="resolution"></a>Решение

Подождите 10 минут, прежде чем запускать следующую синхронизацию.

### <a name="automatic-daily-sync-doesnt-run-and-shutting-down--workers-error-in-sms_business_app_process_managerlog"></a><a name="bkmk_sync-symptom2"></a>Автоматическая ежедневная синхронизация не выполняется и в файле SMS_BUSINESS_APP_PROCESS_MANAGER.log появляется ошибка "shutting down # workers" (завершена работа # рабочих процессов)

#### <a name="cause"></a>Причина

Эта проблема может возникать, если компонент SMS_BUSINESS_APP_PROCESS_MANAGER останавливает поток WsfbSyncWorker. Эта ошибка может указывать на `2` либо `4` рабочих процессов.

#### <a name="workaround"></a>Обходной путь

Перезапустите службу **SMS_EXECUTIVE**.

Если вы не можете перезапустить основную службу, завершите работу обоих компонентов с рабочими процессами MSfB, а затем снова запустите их.

1. Откройте реестр Windows на сервере, где запущена точка подключения службы.

1. Перейдите на страницу `HKLM\SOFTWARE\Microsoft\SMS\COMPONENTS\SMS_EXECUTIVE\Threads\SMS_CLOUDCONNECTION`.

    1. Выполните для запрошенной операции команду **Остановить**.

    1. Обновите и проверьте, что текущее состояние имеет значение **Остановлено**.

1. Перейдите на страницу `HKLM\SOFTWARE\Microsoft\SMS\COMPONENTS\SMS_EXECUTIVE\Threads\SMS_BUSINESS_APP_PROCESS_MANAGER`.

    1. Выполните для запрошенной операции команду **Остановить**.

    1. Обновите и проверьте, что текущее состояние имеет значение **Остановлено**.

1. В **SMS_CLOUDCONNECTION** выполните для запрошенной операции команду **Запустить**.

1. В **SMS_BUSINESS_APP_PROCESS_MANAGER** выполните для запрошенной операции команду **Запустить**.


## <a name="language-related-issues"></a>Проблемы, связанные с языком

В этом разделе рассматриваются следующие распространенные проблемы.

- [Выбор языка не применяется](#bkmk_lang-symptom1)
- [Не все выбранные языки имеются для всех сведений о лицензии](#bkmk_lang-symptom2)

### <a name="language-selection-changes-arent-applied"></a><a name="bkmk_lang-symptom1"></a> Выбор языка не применяется

#### <a name="cause"></a>Причина

Эта проблема может возникать, если выбор языка кэшируется и не удаляется после изменения значений свойств.

#### <a name="workaround"></a>Обходной путь

Чтобы устранить эту проблему, перезапустите службу **SMS_Executive**.

### <a name="not-all-selected-languages-are-present-for-all-license-information"></a><a name="bkmk_lang-symptom2"></a> Не все выбранные языки имеются для всех сведений о лицензии

#### <a name="cause"></a>Причина

Эта проблема может возникать, если сведения о лицензии Microsoft Store для бизнеса и образования не содержат локализованных данных для указанного языка.

#### <a name="workaround"></a>Обходной путь

Вручную добавьте любые отсутствующие языки для созданных приложений.


## <a name="offline-applications"></a>Автономные приложения

В этом разделе рассматриваются следующие распространенные проблемы.

- [Не удалось создать автономное приложение, так как содержимое не может быть проверено](#bkmk_off-symptom1)
- [Не удалось установить приложение, созданное из автономной информации о лицензиях](#bkmk_off-symptom2)

### <a name="fail-to-create-offline-application-because-content-cant-be-verified"></a><a name="bkmk_off-symptom1"></a> Не удалось создать автономное приложение, так как содержимое не может быть проверено

#### <a name="cause"></a>Причина

Эта проблема может возникать, если синхронизированное содержимое для автономного приложения повреждено или изменено.

#### <a name="workaround"></a>Обходной путь

Запустите новую синхронизацию. После завершения синхронизации необходимо проверить и скачать все неправильные файлы содержимого.

### <a name="fail-to-install-application-created-from-offline-license-information"></a><a name="bkmk_off-symptom2"></a> Не удалось установить приложение, созданное из автономной информации о лицензиях

#### <a name="cause"></a>Причина

Эта проблема может возникнуть при развертывании приложения на клиенте под управлением более ранней версии Windows 10, чем версия 1511. Автономные лицензированные приложения из Microsoft Store для бизнеса и образования поддерживаются только в Windows 10 версии 1511 и более поздних.

#### <a name="resolution"></a>Решение

Установите последнюю версию Windows 10.


## <a name="next-steps"></a>Дальнейшие шаги

Дополнительные сведения см. в разделе [Поиск справочных материалов по использованию Configuration Manager](../../core/understand/find-help.md).
