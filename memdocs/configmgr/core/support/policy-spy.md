---
title: Policy Spy
titleSuffix: Configuration Manager
description: Использование Policy Spy для просмотра и устранения неполадок системы политики на клиентах Configuration Manager.
ms.date: 07/30/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 1012ec24-27d9-4193-8236-918d283c7448
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 6038a3332c63a58d1f3c423491b1aa17aa28b080
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81707552"
---
# <a name="policy-spy"></a>Policy Spy

*Область применения: Configuration Manager (Current Branch)*

Policy Spy является одним из [средств Configuration Manager](tools.md). Оно используется для просмотра и устранения неполадок системы политики на клиентах Configuration Manager. Запустите **PolicySpy.exe**, чтобы открыть пользовательский интерфейс. Дополнительные сведения об использовании командной строки см. в разделе [Синтаксис командной строки](#bkmk_policyspy-syntax).

> [!Important]  
> Policy Spy следует запускать от имени администратора. Если команду **Запуск от имени администратора** не выполнить, в разделе сведений о клиенте появится следующая ошибка:  
> `There is no client installed on this machine. Connection to client policy failed with error 80041003`


## <a name="command-line-syntax"></a><a name="bkmk_policyspy-syntax"></a> Синтаксис командной строки

Средство Policy Spy в основном предназначено для использования через его пользовательский интерфейс. Оно предоставляет ограниченный набор параметров командной строки для поддержки автоматизации и пакетной обработки.

`PolicySpy.exe [/export <ExportFilename> [<computername>]]`

### <a name="option-export"></a>Параметр: `/export`
Этот параметр автоматически экспортирует политику локального или удаленного компьютера. `<ExportFilename>` — это имя файла, в который программа сохраняет экспортированную политику в формате XML. Если параметр `<computername>` указан, Policy Spy экспортирует политику этого, а не локального компьютера.

> [!Note]  
> Этот параметр командной строки не позволяет указывать учетные данные пользователя. Чтобы использовать альтернативные учетные данные для доступа к удаленному компьютеру, выполните команду **runas** для открытия новой командной строки с помощью нужных учетных данных безопасности.  


## <a name="usage"></a>Использование

### <a name="tools-menu"></a>Меню "Сервис"

В меню **Сервис** доступны приведенные ниже действия.  

- **Открыть удаленный**: подключение к политике клиента Configuration Manager на удаленном компьютере. Используйте диалоговое окно "Подключение" для получения имени удаленного компьютера и дополнительных учетных данных пользователя. Если подключение выполнить не удается, в области сведений о клиенте отображается сообщение об ошибке. Если подключение снова завершается ошибкой, попробуйте подключиться, выбрав в меню **Правка** пункт **Обновить** или нажав клавишу F5.  

- **Открыть файл**: открытие файла экспорта политики (XML), созданного с помощью параметра **Экспортировать политику**. Средство отображает экспортированную политику точно так же, как динамическую политику. Оно отключает некоторые функции, которые применяются только при подключении к фактическому клиенту.  

- **Request Machine Assignments** (Запрос назначений компьютеров): запуск запроса назначений политик компьютера на конечном компьютере. Эта функция отключена при просмотре экспортированной политики.  

- **Evaluate Machine Policies** (Оценка политик компьютеров): запуск оценки политики компьютера на конечном компьютере. Эта функция отключена при просмотре экспортированной политики.  

- **Request User Assignments** (Запрос назначений пользователя): запуск запроса назначений политик для текущего пользователя, вошедшего в систему. Эта функция доступна только при просмотре политики на локальном компьютере.  

- **Evaluate User Policy** (Оценка политики пользователя): запуск оценки политики для текущего пользователя, вошедшего в систему. Эта функция доступна только при просмотре политики на локальном компьютере.  

- **Reset Policy** (Сброс политики): удаление всех настроенных политик (кроме политики по умолчанию) и сброс файлов cookie политики для сайта. Затем инициируется запрос для назначений политик компьютера. Эта функция отключена при просмотре экспортированной политики.  

- **Export Policy** (Экспорт политики): экспорт политики конечного компьютера в XML-файл. Этот файл можно посматривать на любом компьютере с Policy Spy. Чтобы открыть файл экспорта, в меню **Сервис** выберите пункт **Открыть файл**. Эта функция отключена при просмотре экспортированной политики.  


### <a name="edit-menu"></a>Меню "Правка"

В меню **Правка** доступны приведенные ниже действия.  

- **Удалить**: удаление экземпляра, выбранного на панели результатов. Это действие поддерживается только для экземпляров политики. Если вы попытаетесь удалить что-то, кроме экземпляров политики, средство отображает сообщение об ошибке. Эта функция отключена при просмотре экспортированной политики.  

- **Обновление**. Обновление всех результатов для просмотра последних сведений. После этого автоматически разворачиваются все узлы дерева, которые были развернуты до обновления. Если средству Policy Spy не удалось подключиться к политике конечного компьютера, он пытается подключиться еще раз. Эта функция отключена при просмотре экспортированной политики.  

- **Очистить события**: удаление всех элементов на вкладке "События".  



## <a name="results-pane"></a>Панель "Результаты"

На панели результатов отображаются различные представления системы политики на конечном компьютере. Чтобы перейти к этим представлениям, откройте одну из следующих четырех вкладок: 
- [Фактические](#bkmk_policyspy-actual)
- [Запрошенные](#bkmk_policyspy-requested)
- [По умолчанию](#bkmk_policyspy-default)
- [События](#bkmk_policyspy-events)


### <a name="actual"></a><a name="bkmk_policyspy-actual"></a> Фактические

На этой вкладке отображается текущая политика клиента. Текущая политика определяет поведение клиента и поведение его агентов клиента, такое как инвентаризация и распространение программного обеспечения. На вкладке отображаются результаты в виде дерева с корневым узлом для пространства имен компьютера и пространств имен, соответствующих пользователям. Разверните узел пространства имен для отображения списка классов. Разверните класс, чтобы вывести список его экземпляров. В список классов входят только классы, имеющие экземпляры.


### <a name="requested"></a><a name="bkmk_policyspy-requested"></a> Запрошенные

На этой вкладке отображаются назначения политик, полученные клиентом с назначенного ему сайта. На вкладке отображаются результаты в виде дерева с корневым узлом для пространства имен компьютера и пространств имен, соответствующих пользователям. Разверните узел пространства имен, чтобы отобразить следующие узлы.  

- **Конфигурация**: отображается список классов конфигурации, производных от CCM_Policy_Config, включая объект политики, назначения и прочее.  

- **Параметры**: отображаются все активные параметры, созданные политиками. Параметры отображаются в узле "Конфигурация". 

> [!Note]   
> Так клиент не объединил эти параметры в окончательный результирующий набор, может существовать несколько экземпляров с одним именем. Policy Spy отображает экземпляры в этом узле с помощью свойств RealKey, а не действительных ключей политики. Сопоставьте эти экземпляры с результирующим набором, отображаемым на "Фактические".  


### <a name="default"></a><a name="bkmk_policyspy-default"></a> По умолчанию

На этой вкладке отображаются те же сведения, что и на вкладке **Запрошенные**. Здесь также находится содержимое пространств имен DefaultMachine и DefaultUser.


### <a name="events"></a><a name="bkmk_policyspy-events"></a> События

На этой вкладке отображаются события агента политики по мере их возникновения. Представление создает подписку на события WMI для всех событий, производных от CCM_PolicyAgent_Event. В представлении отображается максимум 200 событий. При необходимости самые старые события удаляются из верхней части списка. Если выбран последний элемент в списке, при добавлении новых событий список автоматически прокручивается вниз. В противном случае представление сохраняет свое текущее положение, поэтому чтобы просмотреть новые события, необходимо прокрутить вниз или нажать клавишу End. При просмотре экспортированной политики это представление всегда остается пустым.



## <a name="client-info-pane"></a>Панель "Сведения о клиенте"
На панели "Сведения о клиенте" отображается список свойств для конечного компьютера. Если доступны, отображаются следующие свойства.  
- Имя
- ID
- Версия
- Сайт
- Назначенная ТУ
- Локальная ТУ
- Прокси-ТУ
- Состояние прокси



## <a name="details-pane"></a>Область сведений
На панели "Подробности" отображаются подробные сведения о текущем выборе. Если активный выбор отсутствует, выводятся сведения о средстве Policy Spy, включая его версию. В противном случае отображается MOF-представление выбранного элемента.

Policy Spy использует собственную процедуру создания MOF-файла для формирования более понятного отображения в формате HTML, чем текстовый MOF-файл, созданный WMI. Это позволяет Policy Spy добавлять следующие функции для повышения удобочитаемости MOF-файла.  

- Выделение синтаксиса  

- Объекты и массивы с отступом  

- Свойства упорядочиваются в группы — системные, наследуемые и локальные. По умолчанию системные и унаследованные группы свернуты. Вы можете быстро просмотреть свойства, которые использует экземпляр.  

- Копирование MOF-файла или простого текстового MOF-файла в буфер обмена. Эта функция полезна для вставки MOF-файла в другие приложения путем прямого вызова средства MofComp.  

Для экземпляров объектов политики, производных от CCM_Policy_Policy, на панели "Подробности" текст политики отображается под MOF-файлом. Если клиент не загрузил текст политики, Policy Spy отображает гиперссылку. Щелкните ссылку, чтобы загрузить текст политики непосредственно из точки управления клиента. После успешной загрузки текста политики средство заменяет гиперссылку содержимым ответа. В противном случае Policy Spy обновляет отображение, что указывает, что запрос завершился ошибкой.

