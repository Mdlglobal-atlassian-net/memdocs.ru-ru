---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: include
ms.date: 02/13/2020
ms.openlocfilehash: 767174ccbb63287ecc595d6e0c47ebc604e8103a
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81693092"
---
## <a name="improvements-to-orchestration-groups"></a><a name="bkmk_orch"></a> Улучшения в группах оркестрации
<!--3098816-->
Создайте группы оркестрации, чтобы эффективнее управлять развертыванием обновлений программного обеспечения на устройствах. Группа оркестрации обеспечивает гибкие возможности обновления устройств на основе процента, определенного числа или явного порядка. Вы также можете запустить скрипт PowerShell до и после того, как устройства запускают развертывание обновлений.

Группы оркестрации — это эволюция функции "Группы серверов". Впервые они были представлены в [технической версии Configuration Manager версии 1909](../../../2019/technical-preview-1909.md). Мы улучшили группы оркестрации в [технической версии 2001](../../technical-preview-2001.md#bkmk_orch) и [технической версии 2001.2](../../technical-preview-2001-2.md#bkmk_orch). В этой технической версии мы добавили следующие усовершенствования в группы оркестрации:

- Очистите состояние, например **Завершено* или *Сбой*, для члена группы оркестрации, чтобы повторно запустить оркестрацию.
   - Щелкните правой кнопкой мыши член группы оркестрации и выберите **Reset Orchestration Group Member** (Сбросить члена группы оркестрации).
- Запустите некоторые основные операции, такие как **обозреватель ресурсов** и **Запись подробных сведений в журнал** для выбранных членов.
- Обновления, нуждающиеся в перезапусках, теперь работают с оркестрацией.


[![Сброс члена группы оркестрации](../../media/3098816-reset-og-member.png)](../../media/3098816-reset-og-member.png#lightbox)


### <a name="try-it-out"></a>Попробуйте!

Попробуйте выполнить следующие задачи, а после этого [поделитесь с нами своим мнением](../../../../understand/find-help.md#product-feedback) об этой функции.

#### <a name="prerequisites"></a>Предварительные условия

- Чтобы просмотреть все группы оркестрации и обновления для этих групп, ваша учетная запись должна иметь роль **Полный администратор**.
- Включите функцию **Группы оркестрации**. Дополнительные сведения см. в разделе [Включение дополнительных функций из обновлений](../../../../servers/manage/install-in-console-updates.md#bkmk_options).

    > [!NOTE]
    > При включении функции **Группы оркестрации** сайт отключает функцию **Группы серверов**. Такое поведение позволяет избежать конфликтов между двумя функциями.

#### <a name="create-an-orchestration-group"></a>Создать группу оркестрации

1. В консоли Configuration Manager перейдите к рабочей области **Активы и соответствие** и выберите узел **Группа оркестрации**.

1. На ленте выберите **Создать группу оркестрации**, чтобы открыть **мастер создания групп оркестрации**.

1. На странице **Общие сведения** укажите группу оркестрации, **имя** и **описание** (необязательно). Укажите значения для следующих элементов.
   - **Время ожидания группы оркестрации (в минутах)** . Ограничение времени для всех членов группы на завершение установки обновления.
   - **Время ожидания члена группы оркестрации (в минутах)** . Ограничение времени для одного устройства в группе на завершение установки обновления.


1. На странице **Выбор пользователя** сначала укажите **код сайта**. Затем нажмите кнопку **Добавить**, чтобы добавить ресурсы устройства в качестве членов этой группы оркестрации. **Выполните поиск** устройств по имени, а затем **добавьте** их. Вы также можете отфильтровать поиск по одной коллекции, используя **Поиск в коллекции**.  Добавив устройства в список выбранных ресурсов, нажмите кнопку **ОК**.
   - При выборе ресурсов для группы отображаются только допустимые клиенты. Выполняются проверки кода сайта, установки клиента и отсутствия дублирующихся ресурсов.

1. На странице **Выбор правил** выберите один из следующих параметров:

   - **Разрешите одновременное обновление компьютеров в процентах**, а затем выберите или введите число процента. Используйте этот параметр, чтобы обеспечить гибкость размера группы оркестрации в будущем. Например, в группе оркестрации содержится 50 устройств и вы указываете значение 10. Во время развертывания обновлений программного обеспечения Configuration Manager позволит запускать развертывание пяти устройствам одновременно. Если позже вы увеличите размер группы оркестрации до 100 устройств, то одновременно будут обновляться 10 устройств.

   - **Разрешите одновременное обновление нескольких компьютеров**, а затем выберите или введите определенное число. Используйте этот параметр, чтобы постоянно ограничивать выборку до определенного количества устройств, независимо от общего размера группы оркестрации.

   - **Укажите последовательность обслуживания**, а затем отсортируйте выбранные ресурсы в правильном порядке. Используйте этот параметр, чтобы явно указать порядок, в котором устройства запускают развертывание обновлений программного обеспечения.

1. На странице **PreScript** введите скрипт PowerShell для запуска на каждом устройстве *перед* выполнением развертывания. Скрипт должен возвращать значение `0` для успешного выполнения или `3010` для успешного выполнения при перезапуске. Укажите значение **времени ожидания скрипта (в секундах)** , которое не позволяет выполнить скрипт по истечении указанного времени.

1. На странице **PostScript** введите скрипт PowerShell для запуска на каждом устройстве *после* выполнения развертывания и значение **времени ожидания скрипта (в секундах)** . В противном случае поведение будет совпадать с PreScript.

1. Завершите работу мастера.
1. Для изменения параметров существующей группы оркестрации можно использовать диалоговое окно **Свойства** для группы. 
1. Чтобы удалить группу оркестрации, выберите ее и щелкните **Удалить** на ленте.

#### <a name="view-orchestration-groups-and-members"></a>Просмотр групп и членов оркестрации

В рабочей области **Активы и соответствие** выберите узел **Группа оркестрации**. Чтобы просмотреть члены, выберите группу оркестрации и **Показать члены** на ленте. Дополнительные сведения о доступных столбцах для узлов см. в разделах ["Мониторинг групп оркестрации" и "Мониторинг членов группы оркестрации"](#bkmk_orch_monitor).


#### <a name="start-orchestration"></a>Запуск оркестрации

- [Разверните обновления программного обеспечения](../../../../../sum/deploy-use/deploy-software-updates.md) в коллекцию, содержащую участников группы оркестрации.
   - Оркестрация запускается, когда любой клиент в группе пытается установить обновление программного обеспечения в крайний срок или в течение периода обслуживания. Она начинается для всей группы и гарантирует, что устройства обновляются, следуя правилам группы оркестрации.
- Вы можете запустить оркестрацию вручную, выбрав ее из узла **Группа оркестрации**, а затем выбрав **Начать оркестрацию** на ленте или в контекстном меню.  

> [!TIP]
> - Группы оркестрации применяются только к развертываниям обновлений программного обеспечения. Они не применяются к другим развертываниям.
> - Вы можете щелкнуть правой кнопкой мыши член группы оркестрации и выберите **Reset Orchestration Group Member** (Сбросить члена группы оркестрации). Это позволяет повторно запустить оркестрацию.

#### <a name="monitoring"></a><a name="bkmk_orch_monitor"></a> Мониторинг
Отслеживайте группы и члены оркестрации с помощью консоли Configuration Manager и [файлов журналов](#log-files).

##### <a name="monitor-orchestration-groups"></a>Мониторинг групп оркестрации

В рабочей области **Активы и соответствие** выберите узел **Группа оркестрации**. Добавьте следующие столбцы, чтобы получить сведения о группах.

- **Имя оркестрации**. Имя группы оркестрации.
- **Код сайта**. Код сайта для группы.
- **Тип оркестрации**. Может иметь один из следующих типов:
   - Число
   - Процент
   - Последовательность

- **Значение оркестрации**. Количество элементов или процент членов, которые могут одновременно получить блокировку. **Значение оркестрации** заполняется только в том случае, если **типом оркестрации** является *число*, или *процент*.  
- **Состояние оркестрации**. Выполняется во время оркестрации. Бездействие — если не выполняется.
- **Время начала оркестрации**. Дата и время начала оркестрации.
- **Текущий порядковый номер**. Показывает, для кого из членов группы активна оркестрация. Это число соответствует **порядковому номеру** для члена.  
- **Время ожидания оркестрации (в минутах)** . Значение **Время ожидания группы оркестрации (в минутах)** устанавливается на странице **Общие** при создании группы или на вкладке **Общие** при редактировании группы.
- **Время ожидания члена группы оркестрации (в минутах)** . Значение **Время ожидания члена группы оркестрации (в минутах)** устанавливается на странице **Общие** при создании группы или на вкладке **Общие** при редактировании группы.
- **Идентификатор группы оркестрации**. Идентификатор группы, который используется в журналах и базе данных.
- **Уникальный идентификатор группы оркестрации**. Уникальный идентификатор группы, который используется в журналах и базе данных.

##### <a name="monitor-orchestration-group-members"></a>Мониторинг членов группы оркестрации

В узле **Группа оркестрации** выберите группу оркестрации. На ленте щелкните **Показать участников**. Вы увидите участников группы и состояние их оркестрации. Добавьте следующие столбцы, чтобы получить сведения о членах.

- **Имя** — Имя устройства члена группы оркестрации.
- **Текущее состояние** — предоставляет состояние устройства члена. 
   - **Выполняется** во время оркестрации.
   - **Ожидание** — показывает, что клиент ждет своей очереди на установку обновлений. 
   - **Бездействие**, когда оркестрация завершена или не запущена.
- **Код состояния**. Вы можете щелкнуть правой кнопкой мыши член группы оркестрации и выбрать **Reset Orchestration Group Member** (Сбросить члена группы оркестрации). Этот сброс позволяет повторно запустить оркестрацию. Типы статусов: 
   - Бездействие
   - Устройство ожидает свою очередь
   - Выполняется установка обновления
   - Failed
   - Ожидается перезагрузка
- **Время получения блокировки**. Блокировки запрашиваются клиентом на основании его политики. Как только клиент получит блокировку, на нем будет активирована оркестрация.  
-**Время, когда был получен отчет о состоянии**. Время, когда член в последний раз сообщал о состоянии.
- **Порядковый номер**. Расположение клиента в очереди на установку обновлений.
- **Код сайта**. Код сайта для члена.
- **Активность клиента**. Сообщает, активен ли клиент.
- **Основные пользователи**. Какие пользователи являются основными для устройства.
- **Тип клиента**. Тип устройства, на котором находится клиент.
- **Текущий вошедший в систему пользователь**. Какой пользователь в данный момент вошел в систему на устройстве.
- **Идентификатор OG**. Идентификатор группы оркестрации, к которой принадлежит член. 
- **Уникальный идентификатор OG**. Уникальный идентификатор группы оркестрации, к которой принадлежит член.
- **Идентификатор ресурса**. Идентификатор ресурса устройства.

#### <a name="log-files"></a>Файлы журнала
Используйте следующие файлы журналов на сервере сайта для помощи при мониторинге и устранении неполадок:

##### <a name="site-server"></a>Сервер сайтов
- **Policypv.log** — указывает, что сайт назначается группе оркестрации клиентам.
- **SMS_OrchestrationGroup.log** — указывает поведение группы оркестрации.

##### <a name="client"></a>Клиент

- **MaintenanceCoordinator.log**. Показывает процесс получения блокировки, установку обновлений, предварительные и последующие сценарии, а также процесс снятия блокировки.
- **UpdateDeployment.log**. Показывает процесс установки обновлений.
- **PolicyAgent.log**. Проверяет, находится ли клиент в группе оркестрации. 

#### <a name="orchestration-group-known-issues"></a>Известные проблемы групп оркестрации

- Не добавляйте компьютер в несколько групп оркестрации.

