---
author: mestew
ms.author: mstewart
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: include
ms.date: 09/26/2019
ms.openlocfilehash: 67f1dbfad2b32c97639e811ac59a8a6eae81cf6c
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81697692"
---
## <a name="extend-and-migrate-an-on-premises-site-to-microsoft-azure"></a><a name="bkmk_Azure-migration"></a> Расширение и миграция локального сайта в Microsoft Azure

<!--3556022-->

Это новое средство позволяет программно создавать виртуальные машины Azure для Configuration Manager. Оно может выполнять установку с использованием параметров по умолчанию роли сайта, таких как пассивный сервер сайта, точки управления и точки распространения. После проверки новых ролей используйте их в качестве дополнительных систем сайта для обеспечения высокой доступности. Вы также можете удалить локальную роль системы сайта и оставить только роль виртуальной машины Azure.

### <a name="prerequisites"></a>Предварительные условия

- Подписка Azure.

- Виртуальная сеть Azure со шлюзом ExpressRoute.

<!-- - A standalone primary site. A hierarchy with a central administration site isn't currently supported. can comment this out because TP only supports a standalone primary!-->

- Учетная запись пользователя должна иметь роль полного администратора **Configuration Manager** и права администратора на сервере первичного сайта.

- Чтобы добавить пассивный сервер, первичный сайт должен соответствовать требованиям к высокой доступности для [сервера сайта](../../../../servers/deploy/configure/site-server-high-availability.md#prerequisites). Например, требуется использование [удаленной библиотеки содержимого](../../../../plan-design/hierarchy/the-content-library.md#bkmk_remote).

### <a name="try-it-out"></a>Попробуйте!

Попробуйте выполнить следующие задачи, а после этого [поделитесь с нами своим мнением](../../../../understand/find-help.md#product-feedback) об этой функции.

1. Войдите на сервер первичного сайта и запустите следующее средство в каталоге установки Configuration Manager: `Cd.Latest\SMSSETUP\TOOLS\ExtendMigrateToAzure\ExtendMigrateToAzure.exe`

1. Просмотрите сведения на вкладке **Общие**, а затем перейдите на вкладку **Azure Information**.

1. На вкладке **Azure Information** выберите **среду Azure**, а затем **выполните вход**.
  
    > [!TIP]
    > Чтобы правильно выполнить вход, может потребоваться добавить `https://*.microsoft.com` в список надежных веб-сайтов.

    ![Вкладка Azure Information в средстве расширения и миграции](../../media/3556022-azure-information-tab.png)

1. После входа выберите свой **идентификатор подписки** и **виртуальную сеть**. Средство отображает только сети со шлюзом ExpressRoute.

#### <a name="site-server-high-availability"></a>Высокая доступность сервера сайта

1. На вкладке **Высокая доступность сервера сайта** выберите **Проверить**, чтобы оценить готовность сайта.

    Если какая-либо из проверок не пройдена, выберите **More detail** (Подробности), чтобы определить, как устранить проблему. Дополнительные сведения о предварительных сведениях см. в [этом разделе](../../../../servers/deploy/configure/site-server-high-availability.md#prerequisites).

2. Если вы хотите расширить или перенести сервер сайта в Azure, щелкните **Create a site server in Azure** (Создать сервер сайта в Azure). Затем заполните следующие поля:

    |Имя|Описание:|
    |---|---|
    |**Подписка**|Только чтение. Отображает имя и идентификатор подписки.|
    |**Группа ресурсов**| Выводит список доступных групп ресурсов. Если необходимо создать группу ресурсов, используйте [портал Azure](https://portal.azure.com), а затем запустите это средство повторно.|
    |**Расположение**| Только чтение. Определяется расположением виртуальной сети|
    |**Размер виртуальной машины**|Выберите размер в соответствии с рабочей нагрузкой. Корпорация Майкрософт рекомендует **Standard_DS3_v2**.|
    |**Операционная система**|Только чтение. Средство использует Windows Server 2019.|
    |**Тип диска**|Только чтение. Для лучшей производительности средство использует SSD (цен. категория "Премиум").|
    |**Виртуальная сеть**|Только чтение.|
    |**Подсеть**|Выберите подсеть для использования. Если необходимо создать подсеть, используйте [портал Azure](https://portal.azure.com).|
    |**Имя компьютера**|Введите имя виртуальной машины пассивного сервера сайта в Azure. Это то же имя, которое отображается на [портале Azure](https://portal.azure.com).|
    |**Local admin username** (Имя пользователя локального администратора)|Введите имя локального пользователя с правами администратора, созданное виртуальной машиной Azure перед присоединением к домену.|
    |**Local admin password** (Пароль локального администратора)|Пароль локального пользователя с правами администратора. Чтобы защитить пароль во время развертывания Azure, сохраните его в качестве секрета в [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview). Затем используйте ссылку. При необходимости создайте пароль на [портале Azure](https://portal.azure.com).|
    |**Domain FQDN** (Полное доменное имя)|Полное доменное имя для присоединяемого домена Active Directory. По умолчанию средство получает это значение от текущего компьютера.|
    |**Имя пользователя домена**|Имя пользователя домена, которому разрешено присоединиться к домену. По умолчанию средство использует имя пользователя, выполнившего вход.|
    |**Пароль домена**|Пароль пользователя домена, которому разрешено присоединиться к домену. Средство проверяет его после нажатия кнопки **Запуск**. Чтобы защитить пароль во время развертывания Azure, сохраните его в качестве секрета в [Azure Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-overview). Затем используйте ссылку. При необходимости создайте пароль на [портале Azure](https://portal.azure.com).|
    |**Domain DNS IP** (IP-адрес DNS домена)|Используется для присоединения к домену. По умолчанию средство использует DNS от текущего компьютера.|
    |**Тип**|Только чтение. В нем отображается тип *Пассивный сервер сайта*.|

    1. Чтобы начать подготовку виртуальной машины Azure, нажмите кнопку **Запуск**. Чтобы отслеживать состояние развертывания, перейдите на вкладку **Deployments in Azure** (Развертывания в Azure). Чтобы получить последнее состояние, щелкните **Refresh deployment status** (Обновить состояние развертывания).

        > [!TIP]
        > Для проверки состояния, поиска ошибок и определения возможных исправлений можно также использовать [портал Azure](https://portal.azure.com).

    1. После завершения развертывания перейдите к серверам SQL и предоставьте разрешения для новой виртуальной машины Azure. Дополнительные сведения о предварительных требованиях для высокой доступности сервера сайта см. в [этой статье](../../../../servers/deploy/configure/site-server-high-availability.md#prerequisites).

3. Чтобы добавить виртуальную машину Azure в качестве сервера сайта в пассивном режиме, выберите **Add site server in passive mode** (Добавить сервер сайта в пассивном режиме).

Когда на сайте будет добавлен сервер сайта в пассивном режиме, на вкладке **Высокая доступность сервера сайта** появится состояние.

![Пассивный сервер сайта добавлен на вкладку "Высокая доступность сервера сайта"](../../media/3556022-site-server-passive-mode.png)

Затем перейдите на вкладку [Deployments in Azure](#bkmk_deploy-azure) (Развертывания в Azure), чтобы завершить развертывание.

#### <a name="site-database"></a>База данных сайта

В настоящее время у этого средства нет задач для миграции базы данных из локальной среды в Azure. Вы можете переместить базу данных с локального сервера SQL Server на виртуальную машину Azure SQL Server. Это средство содержит следующие статьи на вкладке **База данных сайта**, которые помогут выполнить следующие действия:

- [Архивация сайта Configuration Manager](../../../../servers/manage/backup-and-recovery.md)
- [Изменения, относящиеся к резервному копированию сайта](../../../../servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database.md#changes-for-site-backup)
- [Migrate a SQL Server database to SQL Server in an Azure VM](/azure/virtual-machines/windows/sql/virtual-machines-windows-migrate-sql) (Перенос базы данных SQL Server на SQL Server на виртуальной машине Azure)

#### <a name="site-system-roles"></a>Роли систем сайта

1. Перейдите на вкладку **Системные роли сайта**. Чтобы назначить новую роль системы сайта с параметрами по умолчанию, нажмите кнопку **Создать**. Сейчас поддерживаются роли точки управления, точки распространения и точки обновления программного обеспечения. В настоящее время в средстве доступны не все роли.

    ![Вкладка "Системные роли сайта" в средстве расширения и миграции](../../media/3556022-site-system-roles-tab.png)

1. В окне подготовки заполните поля, чтобы подготовить виртуальную машину роли сайта в Azure. Эти сведения похожи на приведенный выше список для сервера сайта.

1. Чтобы начать подготовку виртуальной машины Azure, нажмите кнопку **Запуск**. Чтобы отслеживать состояние развертывания, перейдите на вкладку **Deployments in Azure** (Развертывания в Azure). Чтобы получить последнее состояние, щелкните **Refresh deployment status** (Обновить состояние развертывания).

    > [!TIP]
    > Для проверки состояния, поиска ошибок и определения возможных исправлений можно также использовать [портал Azure](https://portal.azure.com).

Повторите эту процедуру для добавления других ролей системы сайта.

Затем перейдите на вкладку [Deployments in Azure](#bkmk_deploy-azure) (Развертывания в Azure), чтобы завершить развертывание.

После завершения развертывания перейдите в консоль Configuration Manager, чтобы внести дополнительные изменения в роль сайта.

#### <a name="deployments-in-azure"></a><a name="bkmk_deploy-azure"></a> Развертывания в Azure

1. Когда Azure создаст виртуальную машину, перейдите на вкладку **Deployments in Azure** (Развертывания в Azure) в средстве. Щелкните **Развернуть**, чтобы настроить роль с параметрами по умолчанию.

1. Нажмите кнопку **Запустить**, чтобы запустить скрипт PowerShell.

    ![Разверните роли сайта, выполнив созданный скрипт PowerShell.](../../media/3556022-run-powershell-script-deployment.png)

Повторите эти действия для настройки других ролей.
