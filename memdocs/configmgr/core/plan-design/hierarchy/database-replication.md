---
title: репликацию базы данных
titleSuffix: Configuration Manager
description: Узнайте, как репликация базы данных Configuration Manager использует SQL Server для передачи данных в иерархию.
ms.date: 08/09/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 8b495b02-c966-4eb3-92b9-52ebbf5c38ae
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: d1a2c8baa349e6499aa483f947d94f7459357be4
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81703602"
---
# <a name="database-replication"></a>репликацию базы данных

*Область применения: Configuration Manager (Current Branch)*

Репликация базы данных Configuration Manager использует SQL Server для передачи данных. Он использует этот метод для объединения изменений в базе данных своего сайта с информацией из базы данных других сайтов в иерархии.

Обратите внимание на следующие особенности репликации базы данных:

- Все сайты совместно используют одни и те же данные.  

- В ходе установки сайта в иерархии Configuration Manager автоматически создает канал репликации базы данных между родительским сайтом и новым сайтом.  

- По завершении установки сайта репликация базы данных запускается автоматически.  

При добавлении нового узла в иерархию Configuration Manager создает универсальную базу данных на этом новом сайте. Родительский сайт создает моментальный снимок соответствующих данных в своей базе данных. Затем он передает моментальный снимок на новый сайт, используя [файловую репликацию](file-based-replication.md). После этого новый сайт использует программу массового копирования (BCP) SQL Server для загрузки данных в свою локальную копию базы данных Configuration Manager. По завершении загрузки моментального снимка каждый сайт выполняет репликацию базы данных на другой сайт.  

Для репликации данных между сайтами Configuration Manager использует собственную службу репликации базы данных. Служба репликации базы данных использует функцию отслеживания изменений SQL Server для мониторинга изменений локальной базы данных сайта. Затем с помощью SQL Server Service Broker (SSB) она реплицирует эти изменения на другие сайты. По умолчанию этот процесс использует TCP-порт 4022.  


## <a name="replication-groups"></a>Группы репликации

Configuration Manager группирует данные, реплицируемые с помощью репликации базы данных, в различные группы репликации. Каждая группа репликации может иметь отдельное фиксированное расписание репликации. Сайт использует это расписание, чтобы определить, как часто он реплицирует изменения на другие сайты.  

Например, изменение конфигурации ролевого администрирования быстро реплицируется на другие сайты. Такое поведение гарантирует, что другой сайт сможет быстро применить эти изменения. Изменение конфигурации с более низким приоритетом, например запрос на установку нового вторичного сайта, реплицируется не так быстро. Поэтому запрос на установку нового сайта поступает на конечный первичный сайт только через несколько минут.  


## <a name="settings"></a>"Настройки"

Вы можете изменить следующие параметры для репликации базы данных.  

- **Каналы репликации базы данных**. Позволяют управлять временем передачи конкретного трафика по сети.  

- **Распределенные представления**. Когда сайт центра администрирования (CAS) запрашивает данные выбранного сайта, он может получить доступ к данным непосредственно из базы данных дочернего первичного сайта.  

- **Расписания**. Укажите время использования канала репликации и задайте время репликации других типов данных сайта.  

- **Сводки**. Измените параметры формирования сводных данных о сетевом трафике, проходящем по каналам репликации. По умолчанию формирование сводных данных происходит каждые 15 минут. Эти данные используются для составления отчетов о репликации базы данных.  

- **Пороговые значения репликации базы данных**. Определяют, когда сайт сообщает о поврежденных или неработоспособных каналах. Кроме того, вы можете настроить отправку оповещений из Configuration Manager о наличии каналов репликации в состоянии сниженной работоспособности или отказа.  


## <a name="types-of-data"></a>Типы данных

Configuration Manager в первую очередь классифицирует реплицируемые данные как *глобальные данные* или *данные сайта*. При репликации базы данных, сайт передает изменения в глобальные данные и данные сайта по каналу репликации базы данных. Глобальные данные могут реплицироваться на родительский или дочерний сайт. Данные сайта реплицируются только на родительский сайт. Третий тип данных, называемый *локальными данными*, не реплицируется на другие сайты. В локальные данные входят сведения, которые не требуются для других сайтов.  

### <a name="global-data"></a>Глобальные данные

Глобальные данные — это набор созданных администратором объектов, которые реплицируются на все сайты в пределах иерархии. Вторичные сайты получают только подмножество глобальных данных, таких как глобальные прокси-данные. Глобальные данные создаются на сайте центра администрирования и первичных сайтах. Этот тип включает в себя следующие данные:

- Развертывания программного обеспечения
- Обновления программного обеспечения
- Определения коллекций.
- Области безопасности ролевого администрирования

### <a name="site-data"></a>Данные сайта

Данные сайта являются операционными сведениями, создаваемыми первичными сайтами Configuration Manager и назначенными им клиентами. Данные сайта реплицируются на сайт центра администрирования, но не на другие первичные сайты. Данные сайта доступны только для просмотра на сайте центра администрирования и на первичном сайте, откуда исходят данные. Изменить данные сайта можно лишь на том первичном сайте, на котором эти данные были созданы. Этот тип включает в себя следующие данные:

- Инвентаризация оборудования
- Сообщения о состоянии
- Предупреждения
- Результаты запросов на основе коллекций.

Все данные сайта реплицируются на сайт центра администрирования. Сайт центра администрирования выполняет администрирование и создание отчетов для всей иерархии сайта.  


## <a name="database-replication-links"></a><a name="bkmk_Dblinks"></a> Каналы репликации базы данных

В ходе установки нового сайта в иерархии Configuration Manager автоматически создает канал репликации базы данных между родительским сайтом и новым сайтом. Для соединения двух сайтов создается отдельный канал.  

Для управления переносом данных по каналу репликации, измените параметры для каждой ссылки. Каждый канал репликации поддерживает отдельные конфигурации. Существуют следующие возможности управления каналами репликации базы данных:  

- Остановите репликацию данных выбранного сайта с первичного сайта на сайт центра администрирования. Это действие приводит к тому, что центр администрирования получает доступ к этим данным непосредственно из базы данных первичного сайта.  

- Запланируйте передачу данных выбранного сайта с дочернего первичного сайта на сайт центра администрирования.

- Задайте параметры, определяющие состояние канала репликации базы данных: снижение работоспособности или отказ.

- Задайте время отображения оповещений об отказе канала репликации.

- Укажите периодичность, с которой Configuration Manager будет формировать сводку данных о трафике репликации для канала. Он использует эти данные в отчетах.

Чтобы настроить канал репликации базы данных, перейдите в рабочую область **Мониторинг**в консоли Configuration Manager. Выберите узел **Репликация базы данных** и измените свойства ссылки. Этот узел также находится в рабочей области **Администрирование** в узле **Конфигурация иерархии**. Измените канал репликации в родительском или дочернем сайте канала репликации.  

> [!TIP]  
> Каналы репликации базы данных можно изменять в узле **Репликация базы данных** любой из указанных рабочих областей. Однако при использовании узла **Репликация базы данных** в рабочей области **Мониторинг** можно также просмотреть состояние репликации базы данных. Здесь также предоставляется доступ к средству [Replication Link Analyzer](../../servers/manage/monitor-replication.md#BKMK_RLA). Оно поможет вам изучать проблемы с репликацией базы данных.  

Сведения о настройке каналов репликации см. в разделе [Элементы управления репликацией базы данных сайта](#BKMK_DBRepControls). Дополнительные сведения о мониторинге репликации см. в разделе [Мониторинг репликации базы данных](../../servers/manage/monitor-replication.md).  


## <a name="distributed-views"></a><a name="bkmk_distviews"></a> Распределенные представления  

Распределенные представления позволяют обеспечить для запросов данных выбранного сайта, создаваемых на сайте центра администрирования, доступ к данным этого сайта непосредственно из базы данных дочернего первичного сайта. Такой прямой доступ устраняет необходимость в репликации запрашиваемых данных сайта с первичного сайта на сайт центра администрирования. Так как каждый канал репликации не зависит от других каналов репликации, вы можете использовать распределенные представления для выбранных каналов репликации. Распределенные представления нельзя использовать при взаимодействии между первичным и вторичным сайтом.  

Распределенные представления предоставляют следующие преимущества:  

- Уменьшение нагрузки на ЦП при обработке изменений баз данных сайта центра администрирования и первичных сайтов.

- Уменьшение объема данных, передаваемых по сети сайту центра администрирования.

- Повышение производительности SQL Server, на котором размещена база данных центра администрирования

- Уменьшение дискового пространства, используемого базой данных сайта центра администрирования.

Распределенные представления рекомендуется использовать в тех случаях, когда первичный сайт расположен в сети непосредственной близости от сайта центра администрирования, а также если оба сайта всегда активны и подключены к сети. При распределенных представлениях вместо репликации выбранных данных между сайтами используются прямые соединения между серверами SQL Server на каждом сайте. Сайт центра администрирования устанавливает прямое соединение каждый раз, когда вы запрашиваете эти данные.

Сайт запрашивает данные распределенного представления в следующих примерах сценариев:

- При выполнении отчетов или запросов.
- При просмотре сведений в обозревателе ресурсов.
- Оценка коллекций с учетом правил на основе данных сайта.

По умолчанию распределенные представления отключены для каждого канала репликации. При включении распределенных представлений необходимо выбрать данные сайта, которые не будут реплицироваться на сайт центра администрирования с помощью этого канала. В таком случае сайт центра администрирования получает доступ к этим данным напрямую из базы данных дочернего первичного сайта, использующего этот же канал. Для распределенных представлений можно настроить следующие типы данных сайтов:  

- Данные по **инвентаризации оборудования**, получаемые от клиентов.
- Данные **инвентаризации программного обеспечения и контроля использования**, получаемые от клиентов.
- Получаемые от клиентов **сообщения о состоянии** первичного сайта и всех вторичных сайтов.

С операционной точки зрения распределенные представления невидимы для пользователя, просматривающего данные в консоли Configuration Manager или в отчетах. При запросе данных, разрешенных для отображения в распределенных представлениях, сервер базы данных сайта центра администрирования напрямую соединяется с базой данных дочернего первичного сайта для получения этих данных.

Например, вы используете консоль Configuration Manager, подключенную к центру администрирования. Вы запрашиваете сведения о инвентаризации оборудования из двух первичных сайтов: ABC и XYZ. Вы только включили инвентаризацию оборудования для распределенных представлений на сайте ABC. Центр администрирования получает данные инвентаризации для клиентов XYZ из собственной базы данных. Центр администрирования получает данные инвентаризации для клиентов ABC непосредственно из базы данных на сайте ABC. Эта информация появляется в консоли Configuration Manager или в отчете безотносительно ее источника.  

Если для канала репликации разрешено использование конкретного типа данных в распределенных представлениях, дочерний первичный сайт не реплицирует эти данные на сайт центра администрирования. При отключении распределенных представлений для конкретных типов данных, дочерний первичный сайт возобновляет обычную репликацию данных в центр администрирования. Прежде чем эти данные окажутся доступными на сайте центра администрирования, группы репликации этих данных должны выполнить повторную инициализацию для поддержки взаимодействия между первичным сайтом и сайтом центра администрирования. После удаления первичного сайта, для которого включены распределенные представления, центр администрирования должен завершить повторную инициализацию своих данных, прежде чем можно будет получить доступ к данным, которые включены для распределенных представлений в центре администрирования.  

> [!IMPORTANT]  
> При использовании распределенных представлений совместно с любым каналом репликации в иерархии сайтов необходимо отключить распределенные представления для всех каналов репликации перед удалением каких-либо первичных сайтов. Дополнительные сведения см. в статье [Удаление первичного сайта, использующего распределенные представления](../../servers/deploy/install/uninstall-sites-and-hierarchies.md#bkmk_distviews).  

### <a name="prerequisites-and-limitations-for-distributed-views"></a>Предварительные условия и ограничения для распределенных представлений  

- Используйте только распределенные представления для каналов репликации между центром администрирования и первичным сайтом.

- Центр администрирования должен использовать выпуск SQL Server Enterprise. К первичному сайту это требование не относится.

- Центр администрирования может иметь только один экземпляр поставщика SMS. Установите этот единственный экземпляр на сервере базы данных сайта. Эта конфигурация поддерживает аутентификацию Kerberos. Серверу SQL Server на сайте центра администрирования требуется Kerberos для доступа к SQL Server на дочернем первичном сайте. На поставщика SMS, работающего на дочернем первичном сайте, не распространяются никакие ограничения.

- В Центре администрирования может быть установлена только одна точка обслуживания. Установите службы отчетов SQL Server на сервере базы данных сайта. Эта конфигурация поддерживает аутентификацию Kerberos. Серверу SQL Server на сайте центра администрирования требуется Kerberos для доступа к SQL Server на дочернем первичном сайте.

- Вы не можете разместить базу данных сайта в [кластере SQL Server](../../servers/deploy/configure/use-a-sql-server-cluster-for-the-site-database.md).

- В версии 1902 и более ранних версиях нельзя размещать базу данных сайта в [группе доступности SQL Server Always On](../../servers/deploy/configure/sql-server-alwayson-for-a-highly-available-site-database.md). Для поддержки этой конфигурации обновите ее до версии 1906 или более поздней.<!-- SCCMDocs-pr#3792 -->

- Учетная запись компьютера сервера базы данных Центра администрирования требует разрешения на **Чтение** для базы данных первичного сайта.

> [!IMPORTANT]  
> Распределенные представления и [расписания](#BKMK_schedules) репликации данных являются взаимоисключающими для канала репликации баз данных.  


## <a name="schedule-transfers-of-site-data"></a><a name="BKMK_schedules"></a> График передачи данных сайта

В целях контроля пропускной способности сети, которая используется для репликации данных сайта с дочернего первичного сайта на Центр администрирования, запланируйте использование канала репликации. Затем укажите, когда реплицируются разные типы данных сайта. Можно управлять временем репликации сообщений о состоянии, инвентаризации и данных учета на первичном сайте. Каналы репликации баз данных из вторичных сайтов не поддерживают расписания для данных сайта. Вы не можете запланировать передачу глобальных данных.  

При настройке расписания для канала репликации базы данных можно ограничить передачу данных выбранного сайта с первичного сайта на сайт центра администрирования. Вы также можете настроить разное время для репликации различных типов данных сайта.  

> [!IMPORTANT]  
> [Распределенные представления](#bkmk_distviews) и расписания репликации данных являются взаимоисключающими конфигурациями для канала репликации баз данных.  


## <a name="summarization-of-traffic"></a><a name="BKMK_SummarizeDBReplication"></a> Сводные данные о трафике  

Каждый сайт периодически формирует сводные данные о сетевом трафике, проходящем по каналам репликации баз данных. Сайт использует обобщенные данные в отчетах для репликации базы данных. Оба сайта в канале репликации формируют сводные данные обо всем сетевом трафике, который проходит через канал репликации. Сервер базы данных сайта обобщает данные. После обобщения данных информация реплицируется на другие сайты в виде глобальных данных.  

По умолчанию формирование сводных данных происходит каждые 15 минут. Частоту формирования сводных данных о сетевом трафике можно изменить, отредактировав параметр **Интервал формирования сводных данных** в свойствах канала репликации баз данных. Частота формирования сводных данных влияет на информацию, доступную для просмотра в отчетах о репликации баз данных. Вы можете выбрать интервал от 5 до 60 минут. Увеличение частоты формирования сводных данных приводит к увеличению вычислительной нагрузки на сервер SQL Server на каждом сайте канала репликации.  

## <a name="database-replication-thresholds"></a><a name="BKMK_DBRepThresholds"></a> Пороговые значения репликации базы данных

Пороговые значения репликации базы данных определяют, когда Configuration Manager сообщает о состоянии снижения работоспособности или отказе канала репликации базы данных. По умолчанию он устанавливает для канала состояние *сниженная работоспособность*, когда какой-либо одной группе репликации не удается завершить репликацию в течение 12 последовательных попыток. Он устанавливает для канала состояние *отказ*, какой-либо одной группе репликации не удается завершить репликацию в течение 24 последовательных попыток.  

Вы можете указать пользовательские значения для состояний: сниженная работоспособность или отказ. Если вы измените эти значения, можно более точно отслеживать работоспособность репликации базы данных по каналам.  

Одна или несколько групп репликации могут не выполнить репликацию, в то время как другие группы репликации продолжают успешно реплицировать. Запланируйте проверку статуса репликации канала, когда она впервые сообщает о снижении работоспособности.

Попробуйте изменить значения повторных попыток для состояния снижения работоспособности или отказа канала в следующих ситуациях:

- Существуют повторяющиеся задержки для определенных групп репликации, и их задержка не является проблемой

- Сетевой канал между сайтами имеет низкую доступную пропускную способность

После увеличения числа повторных попыток, прежде чем сайт установит для канал состояния снижения работоспособности или отказа, можно исключить ложные предупреждения об известных проблемах. Это действие позволяет более точно отслеживать статус канала.  

Чтобы понять, как часто происходит репликация этой группы, рассмотрите интервал синхронизации репликации для каждой группы репликации. Чтобы просмотреть **интервал синхронизации** для групп репликации, перейдите в рабочую область **Мониторинг** в консоли Configuration Manager. В узле **Репликация базы данных** выберите вкладку **Сведения о репликации** канала репликации.  

Дополнительные сведения о том, как отслеживать репликацию базы данных, в том числе о том, как просматривать состояние репликации, см. в разделе [Мониторинг репликации базы данных](../../servers/manage/monitor-replication.md).  


## <a name="site-database-replication-controls"></a><a name="BKMK_DBRepControls"></a> Элементы управления репликацией базы данных сайта  

Можно изменить параметры базы данных каждого сайта, чтобы упростить регулировку пропускной способности сети, используемой для репликации баз данных. Параметры применяются только к базе данных сайта, где их можно настроить. Они используются всегда, когда сайт реплицирует любые данные на другой сайт с помощью репликации баз данных.  

Следующие элементы управления репликацией доступны для каждой базы данных сайта.  

- SSB-порт.  

- Период ожидания, по истечении которого сбои репликации вызывают повторную инициализацию сайтом своей копии базы данных сайта.  

- Сжатие данных, которые реплицирует сайт. Он сжимает данные только для передачи между сайтами, а не для хранения в базе данных сайта на каком-либо сайте.  

Чтобы изменить параметры для элементов управления репликацией базы данных сайта, необходимо изменить свойства базы данных сайта в узле **Репликация баз данных** консоли Configuration Manager. Этот узел отображается в узле **Конфигурация иерархии** в рабочей области **Администрирование**, а также в рабочей области **Мониторинг**. Чтобы изменить свойства базы данных сайта, выберите канал репликации между сайтами, а затем откройте окно **Свойства родительской базы данных** или **Свойства дочерней базы данных**.  

> [!TIP]  
> Элементы управления репликацией базы данных можно настроить в узле **Репликация базы данных** в любой из этих рабочих областей. Однако, при использовании узла **Репликация базы данных** в рабочей области **Мониторинг**, также можно просмотреть состояние репликации базы данных для канала репликации и получить доступ к инструменту Replication Link Analyzer, способного помочь исследовать проблемы с репликацией.  


## <a name="see-also"></a>См. также

[Монитор репликации](../../servers/manage/monitor-replication.md)

[Устранение неполадок репликации SQL](../../servers/manage/replication/overview.md)
