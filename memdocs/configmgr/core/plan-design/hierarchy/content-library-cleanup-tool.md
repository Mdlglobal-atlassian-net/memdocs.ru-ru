---
title: Средство очистки библиотеки содержимого
titleSuffix: Configuration Manager
description: Используйте средство очистки библиотеки содержимого для удаления содержимого, которое больше не связано с развертыванием Configuration Manager.
ms.date: 07/30/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 226cbbb2-9afa-4e2e-a472-be989c0f0e11
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 8b1b415d5c24800f003f730426216ac7cf190a4f
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81703632"
---
# <a name="content-library-cleanup-tool"></a>Средство очистки библиотеки содержимого

*Область применения: Configuration Manager (Current Branch)*

Используйте средство командной строки для очистки содержимого библиотеки, чтобы удалить содержимое, которое уже не связано с пакетом или с приложением, из точки распространения. Такой тип содержимого называется *потерянным содержимым*. Это средство заменяет старые версии аналогичных средств, выпущенных для предыдущих версий Configuration Manager.  

Это средство влияет только на содержимое в точке распространения, которую вы указываете при запуске средства. Средство не удаляет содержимое из библиотеки содержимого, расположенной на сервере сайта.

Найдите **ContentLibraryCleanup.exe** в `CD.Latest\SMSSETUP\TOOLS\ContentLibraryCleanup` на сервере сайта.



## <a name="requirements"></a>Requirements (Требования)  

- Средство можно запускать только для одной точки распространения с течением времени.  

- Запускайте его непосредственно на компьютере, на котором размещается точка распространения, которую нужно очистить, или удаленно с другого компьютера.  

- Учетная запись, используемая для запуска средства, должна иметь те же разрешения, что и у роли безопасности **Полный администратор** в Configuration Manager.  



## <a name="modes-of-operation"></a>Режимы работы

Средство можно запустить в одном из двух режимов: [Что если](#what-if-mode) и [Удалить](#delete-mode).

> [!Tip]  
> Начните с режима *Что если*. Когда вы будете удовлетворены результатами, запустите средство в режиме *Удалить*.  


### <a name="what-if-mode"></a>Режим "Что если"   

Если вы не указали параметр `/delete`, средство запускается в режиме "Что если". Этот режим определяет содержимое, которое следует удалить из точки распространения.

- При работе в этом режиме средство не удаляет данные.  

- Средство записывает в файл журнала сведения о файлах, которые необходимо удалить. Подтверждать удаление каждого файла не нужно.  


### <a name="delete-mode"></a>Режим удаления   

Если вы запустите средство с параметром `/delete`, оно будет работать в режиме удаления.

- В этом режиме утерянное содержимое, обнаруженное в указанной точке распространения, будет удалено из библиотеки содержимого точки распространения.  

- Перед удалением каждого файла подтвердите, что его необходимо удалить. Выберите **Y** для удаления, **N** для отмены удаления или **Да для всех**, чтобы запросы больше не выводились и все потерянное содержимое удалялось автоматически.  


### <a name="log-file"></a>Файл журнала

При запуске средства в любом из режимов оно автоматически создает журнал. Имя файла журнала содержит следующую информацию: 
- Режим, в котором запущено средство  
- Имя точки распространения  
- Дата и время операции  

По завершении работы средства файл журнала автоматически открывается в Windows. 

По умолчанию файл журнала записывается в папку temp того пользователя, от имени которого запущено средство. Это расположение находится на том компьютере, на котором вы запускаете средство. Это расположение не всегда является целевым расположением средства. С помощью параметра `/log` вы можете перенаправить файл журнала в другое место, в том числе на общий сетевой ресурс.



## <a name="run-the-tool"></a>Запуск программы

Вот как запустить средство: 

1. Откройте командную строку как администратор. Перейдите в папку, содержащую файл **ContentLibraryCleanup.exe**.  

2. Введите команду, содержащую обязательные [параметры командной строки](#bkmk_params), а также необходимые дополнительные параметры.



## <a name="command-line-parameters"></a><a name="bkmk_params"></a> Параметры командной строки  

Параметры командной строки можно использовать в любом порядке.   

### <a name="required-parameters"></a>Необходимые параметры

|Параметр|Сведения|
|---------|-------|
| `/dp <distribution point FQDN>`  | Укажите полное доменное имя точки распространения, которую нужно очистить. |
| `/ps <primary site FQDN>` | Этот параметр *обязателен* только при очистке содержимого в точке распространения на вторичном сайте. Средство подключается к родительскому первичному сайту для выполнения запросов к SMS_Provider. Эти запросы позволяют средству определить, какое содержимое должно находиться в точке распространения. Затем средство сможет определить потерянное содержимое, которое необходимо удалить. Это подключение к родительскому первичному сайту должно выполняться для точек распространения на вторичном сайте, так как нужные сведения недоступны непосредственно со вторичного сайта.|
| `/sc <primary site code>`  | Этот параметр *обязателен* только при очистке содержимого в точке распространения на вторичном сайте. Укажите код сайта родительского первичного сайта. |

#### <a name="example-scan-and-log-what-content-it-would-delete-what-if"></a>Пример: просканировать и записать в журнал содержимое, которое нужно удалить (режим "что если")
`ContentLibraryCleanup.exe /dp server1.contoso.com`

#### <a name="example-scan-and-log-content-for-a-dp-at-a-secondary-site"></a>Пример: просканировать и записать в журнал содержимое для точки распространения на вторичном сайте
`ContentLibraryCleanup.exe /dp server1.contoso.com /ps siteserver1.contoso.com /sc ABC` 


### <a name="optional-parameters"></a>Необязательные параметры

|Параметр|Сведения|
|---------|-------|
|`/delete`| Используйте этот параметр, если необходимо удалить содержимое из точки распространения. Перед удалением содержимого выдается запрос на подтверждение. </br></br> Если вы не используете этот параметр, средство записывает в журнал сведения о содержимом, которое было бы удалено. Если этот параметр не указан, фактическое содержимое из конечной точки не удаляется. |
| `/q` | Этот параметр запускает средство в тихом режиме, в котором все запросы подавляются. В число этих запросов входят запросы на удаление содержимого. Файл журнала также не открывается автоматически. |
| `/ps <primary site FQDN>` | Этот параметр необязателен только при очистке содержимого в точке распространения на первичном сайте. Укажите полное доменное имя первичного сайта, которому принадлежит точка распространения. |
| `/sc <primary site code>` | Этот параметр необязателен только при очистке содержимого в точке распространения на первичном сайте. Укажите код первичного сайта, которому принадлежит точка распространения. |
| `/log <log file directory>` | Укажите расположение, в которое средство будет записывать файл журнала. Это расположение может находиться на локальном диске или общем сетевом ресурсе.</br></br> Если вы не используете этот параметр, средство помещает файл журнала во временный каталог пользователя на компьютере, на котором запущено средство.|

#### <a name="example-delete-content"></a>Пример: удаление содержимого 
`ContentLibraryCleanup.exe /dp server1.contoso.com /delete`

#### <a name="example-delete-content-without-prompts"></a>Пример: удаление содержимого без дополнительных запросов
`ContentLibraryCleanup.exe /q /dp server1.contoso.com /delete` 

#### <a name="example-log-to-local-drive"></a>Пример: запись журнала на локальный диске
`ContentLibraryCleanup.exe /dp server1.contoso.com /log C:\Users\Administrator\Desktop` 

#### <a name="example-log-to-network-share"></a>Пример: запись журнала на общий сетевой ресурс
`ContentLibraryCleanup.exe /dp server1.contoso.com /log \\server\share`


### <a name="known-issue"></a>Известная проблема

При возникновении сбоя для любого пакета или развертывания или если этот пакет или развертывание выполняются, средство может возвратить следующую ошибку: `System.InvalidOperationException: This content library cannot be cleaned up right now because package <packageID> is not fully installed.`

Решение для этой проблемы отсутствует. Средство не может надежно определять потерянные файлы, если развертывание содержимого выполняется или завершилось сбоем. Вы не сможете очистить содержимое с помощью средства до тех пор, пока не устраните эту проблему.
