---
title: Связь между конечными точками
titleSuffix: Configuration Manager
description: Сведения о взаимодействии компонентов и систем сайта Configuration Manager в сети.
ms.date: 10/25/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 68fe0e7e-351e-4222-853a-877475adb589
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 0f60d268e1f9bfad9c062041e810be2092da5508
ms.sourcegitcommit: b7e5b053dfa260e7383a9744558d50245f2bccdc
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "82587239"
---
# <a name="communications-between-endpoints-in-configuration-manager"></a>Связь между конечными точками в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

В этой статье описано взаимодействие клиентов и систем сайта Configuration Manager в сети. Она включает следующие разделы:  

- [Обмен данными между системами сайтов](#Planning_Intra-site_Com)  
  - [Передача данных с сервера сайта в точку распространения](#bkmk_site2dp)  

- [Обмен данными между клиентами и системами сайтов и службами](#Planning_Client_to_Site_System)  
  - [Обмен данными между клиентом и точкой управления](#bkmk_client2mp)  
  - [Обмен данными между клиентом и точкой распространения](#bkmk_client2dp)  
  - [Рекомендации по взаимодействию с клиентами из Интернета или недоверенного леса](#BKMK_clientspan)  

- [Обмен данными между лесами Active Directory](#Plan_Com_X-Forest)  
  - [Поддержка компьютеров домена в лесу, который не является доверенным для леса сервера сайта](#bkmk_noforesttrust)  
  - [Поддержка компьютеров в рабочей группе](#bkmk_workgroup)  
  - [Сценарии, поддерживающие сайт или иерархию, которая охватывает несколько доменов и лесов](#bkmk_span)  

## <a name="communications-between-site-systems-in-a-site"></a><a name="Planning_Intra-site_Com"></a> Обмен данными между системами сайтов  

Когда системы сайта или компоненты Configuration Manager обмениваются данными по сети с другими системами сайта или компонентами, они используют один из следующих протоколов в зависимости от настроек сайта:  

- Блок сообщений сервера (SMB)  

- HTTP  

- HTTPS  

За исключением передачи данных с сервера сайта на точку распространения, этот обмен информацией между серверами может произойти в любое время. Эти взаимодействия не используют механизмы управления пропускной способностью сети. Контролировать обмен данными между системами сайта невозможно, поэтому убедитесь в том, что серверы системы сайта установлены с надежным подключением к быстрым сетям.  

### <a name="site-server-to-distribution-point"></a><a name="bkmk_site2dp"></a> Передача данных с сервера сайта в точку распространения

Для управления передачей содержимого с сервера сайта в точки распространения можно использовать следующие стратегии.  

- Настройте точку распространения для управления пропускной способностью сети и планированием. Эти средства управления схожи с конфигурациями, которые используются межсайтовыми адресами. Зачастую можно использовать такую конфигурацию вместо установки еще одного сайта Configuration Manager, если передача содержимого в удаленные сетевые расположения является непростой задачей с точки зрения пропускной способности сети.  

- Можно установить точку распространения в виде предварительно подготовленной точки распространения. Предварительно подготовленная точка распространения дает возможность использовать содержимое, вручную размещенное на сервере точки распространения, и устраняет необходимость в передаче файлов с этим содержимым через сеть.  

Дополнительные сведения см. в разделе [Управление пропускной способностью сети для управления содержимым](manage-network-bandwidth.md).

## <a name="communications-from-clients-to-site-systems-and-services"></a><a name="Planning_Client_to_Site_System"></a> Обмен данными между клиентами и системами сайтов и службами

Клиенты инициируют взаимодействие с ролями системы сайта, доменными службами Active Directory и веб-службами. Чтобы разрешить такое взаимодействие, брандмауэры должны пропускать сетевой трафик между клиентами и конечной точкой их взаимодействия. Подробные сведения о портах и протоколах, используемых клиентами при взаимодействии с этими конечными точками, см. в разделе [Порты, используемые в Configuration Manager](ports.md).  

Прежде чем клиент сможет связаться с ролью системы сайта, он использует обнаружение службы для поиска роли, которая поддерживает клиентский протокол (HTTP или HTTPS). По умолчанию клиенты используют наиболее безопасный из доступных методов. Дополнительные сведения см. в статье [Пояснения о том, как клиенты находят ресурсы и службы сайта](understand-how-clients-find-site-resources-and-services.md).  

Чтобы использовать HTTPS, настройте один из следующих параметров:  

- Используйте инфраструктуру открытых ключей (PKI) и установите PKI-сертификаты на клиентах и серверах. Сведения о том, как использовать сертификаты, см. в разделе [Требования к PKI-сертификатам](../network/pki-certificate-requirements.md).  

- Начиная с версии 1806 можно установить на сайте параметр **Использовать сертификаты, созданные с помощью Configuration Manager, для систем сайтов HTTP**. Подробнее см. в разделе [Улучшенный протокол HTTP](enhanced-http.md).  

При развертывании роли системы сайта, использующей службы IIS и поддерживающей взаимодействие с клиентами, необходимо указать, по какому протоколу клиенты подключаются к системе сайта — HTTP или HTTPS. При использовании HTTP необходимо настроить параметры подписывания и шифрования. Дополнительные сведения см. в статье [Планирование подписывания и шифрования](../security/plan-for-security.md#BKMK_PlanningForSigningEncryption).  

### <a name="client-to-management-point-communication"></a><a name="bkmk_client2mp"></a> Обмен данными между клиентом и точкой управления

Клиент подключается к точке управления в два этапа: проверка подлинности (транспортировка) и авторизация (сообщение). Этот процесс зависит от следующих факторов:

- Конфигурация сайта: Только HTTPS; разрешено HTTP и HTTPS; разрешено HTTP и HTTPS с включенным улучшенным протоколом HTTP
- Конфигурация точки управления: HTTPS или HTTP
- Удостоверение устройства для сценариев, ориентированных на устройства.
- Удостоверение пользователя для сценариев, ориентированных на пользователя.

В следующей таблице объяснен этот процесс.  

| Тип точки управления  | Проверка подлинности клиента  | Авторизация клиента<br>Удостоверение устройства  | Авторизация клиента<br>Удостоверение пользователя  |
|----------|---------|---------|---------|
| HTTP     | Анонимная<br>С улучшенным протоколом HTTP сайт проверяет токен *пользователя* или *устройства* в Azure AD. | Запрос расположения: Анонимная<br>Пакет клиента: Анонимная<br>Регистрация с помощью одного из следующих методов для подтверждения удостоверения устройства:<br> — Анонимно (утверждение вручную).<br> — Проверка подлинности, встроенная в Windows.<br> — Токен *устройства* в Azure AD (улучшенный HTTP).<br>После регистрации клиент использует подпись сообщений для подтверждения удостоверения устройства. | Для сценариев, ориентированных на пользователя, для подтверждения личности пользователя используется один из следующих методов:<br> — Проверка подлинности, встроенная в Windows.<br> — Токен *пользователя* в Azure AD (улучшенный HTTP). |
| HTTPS    | Использование одного из следующих методов:<br> — PKI-сертификат.<br> — Проверка подлинности, встроенная в Windows.<br> — Токен *пользователя* или *устройства* в Azure AD. | Запрос расположения: Анонимная<br>Пакет клиента: Анонимная<br>Регистрация с помощью одного из следующих методов для подтверждения удостоверения устройства:<br> — Анонимно (утверждение вручную).<br> — Проверка подлинности, встроенная в Windows.<br> — PKI-сертификат.<br> — Токен *пользователя* или *устройства* в Azure AD.<br>После регистрации клиент использует подпись сообщений для подтверждения удостоверения устройства. | Для сценариев, ориентированных на пользователя, для подтверждения личности пользователя используется один из следующих методов:<br> — Проверка подлинности, встроенная в Windows.<br> — Токен *пользователя* в Azure AD. |

> [!Tip]  
> Дополнительные сведения о конфигурации точки управления для различных типов удостоверений устройств и с помощью шлюза управления облачными клиентами см. в разделе [Включение точки управления для использования протокола HTTPS](../../clients/manage/cmg/certificates-for-cloud-management-gateway.md#bkmk_mphttps).  

### <a name="client-to-distribution-point-communication"></a><a name="bkmk_client2dp"></a> Обмен данными между клиентом и точкой распространения

Когда клиент взаимодействует с точкой распространения, он проходит проверку подлинности только перед загрузкой содержимого. В следующей таблице объяснен этот процесс.

| Тип точки распространения  | Проверка подлинности клиента  |
|----------|---------|
| HTTP     | — Анонимно, если разрешено.<br>— Встроенная проверка подлинности Windows с учетной записью компьютера или учетной записью доступа к сети.<br> — Токен доступа к содержимому (улучшенный HTTP). |
| HTTPS    | — PKI-сертификат.<br> — Встроенная проверка подлинности Windows с учетной записью компьютера или учетной записью доступа к сети.<br> — Токен доступа к содержимому. |

### <a name="considerations-for-client-communications-from-the-internet-or-an-untrusted-forest"></a><a name="BKMK_clientspan"></a> Рекомендации по взаимодействию с клиентами из Интернета или недоверенного леса

Дополнительные сведения см. в следующих статьях:

- [Планирование шлюза управления облаком](../..//clients/manage/cmg/plan-cloud-management-gateway.md)

- [Планирование управления клиентами через Интернет](../../clients/manage/plan-internet-based-client-management.md)

##  <a name="communications-across-active-directory-forests"></a><a name="Plan_Com_X-Forest"></a> Обмен данными между лесами Active Directory  

Configuration Manager поддерживает сайты и иерархии, которые охватывают леса Active Directory. Он также поддерживает компьютеры домена, которые находятся не в одном с сервером сайта лесу Active Directory, и компьютеры, входящие в рабочие группы.  

### <a name="support-domain-computers-in-a-forest-thats-not-trusted-by-your-site-servers-forest"></a><a name="bkmk_noforesttrust"></a> Поддержка компьютеров домена в лесу, который не является доверенным для леса сервера сайта

- Установить роли системы сайта в этом ненадежном лесу с возможностью публикации информации сайта в этот лес Active Directory  

- Управлять этими компьютерами как компьютерами рабочей группы  

При установке серверов системы сайта в недоверенном лесу Active Directory обмен данными между клиентом и сервером происходит в пределах клиентского леса, и Configuration Manager может проверять подлинность компьютера с помощью Kerberos. При публикации информации сайта в клиентском лесу преимущество для клиентов состоит в получении информации сайта, такой как список доступных точек управления, из своего леса Active Directory вместо скачивания этой информации из своей назначенной точки управления.  

> [!NOTE]  
> Если требуется управлять устройствами, находящимися в Интернете, можно установить интернет-роли систем сайта в сети периметра, когда серверы систем сайта находятся в лесу Active Directory. В этом сценарии не требуется двустороннее доверие между сетью периметра и лесом сервера сайта.  

### <a name="support-computers-in-a-workgroup"></a><a name="bkmk_workgroup"></a> Поддержка компьютеров в рабочей группе  

- Вручную утвердить компьютеры рабочей группы при использовании HTTP-подключения клиента к ролям системы сайта. Configuration Manager не может проверить подлинность этих компьютеров с помощью протокола Kerberos.  

- Настроить на клиентах рабочей группы учетную запись доступа к сети, чтобы эти компьютеры могли извлекать содержимое из точек распространения.  

- Предоставить клиентам рабочей группы другой механизм для поиска точек управления. Используйте публикацию DNS, WINS или прямой доступ к точке управления. Эти клиенты не могут получить сведения о сайте из доменных служб Active Directory.  

Дополнительные сведения см. в следующих статьях:  

- [Управление конфликтующими записями](../../clients/manage/manage-clients.md#BKMK_ConflictingRecords)  

- [Учетная запись доступа к сети](fundamental-concepts-for-content-management.md#accounts-used-for-content-management)  

- [Установка клиентов Configuration Manager на компьютерах в составе рабочей группы](../../clients/deploy/deploy-clients-to-windows-computers.md#BKMK_ClientWorkgroup)  

### <a name="scenarios-to-support-a-site-or-hierarchy-that-spans-multiple-domains-and-forests"></a><a name="bkmk_span"></a> Сценарии, поддерживающие сайт или иерархию, которая охватывает несколько доменов и лесов  

#### <a name="scenario-1-communication-between-sites-in-a-hierarchy-that-spans-forests"></a>Сценарий 1. Взаимодействие между сайтами в иерархии, охватывающее леса

В этом сценарии требуется двустороннее доверие между лесами, которое поддерживает проверку подлинности Kerberos.  Если двустороннее доверие между лесами, которое поддерживает проверку подлинности Kerberos, отсутствует, то Configuration Manager не поддерживает размещение подчиненного сайта в удаленном лесу.  

Configuration Manager поддерживает установку дочернего сайта в удаленном лесу, где имеется необходимое двустороннее доверие с лесом родительского сайта. Например, вы можете разместить вторичный сайт в другом лесу, отличном от первичного родительского сайта, если существует нужное отношение доверия.  

> [!NOTE]  
> Дочерний сайт может быть первичным сайтом (если сайт центра администрирования является родительским) или вторичным сайтом.  

Межсайтовое взаимодействие в Configuration Manager использует репликацию базы данных и передачи файлов. При установке сайта необходимо указать учетную запись для установки сайта на конечном сервере. Эта учетная запись также устанавливает и поддерживает взаимодействие между сайтами. После того как успешно установленный сайт начнет передачу файлов и репликацию базы данных, дополнительные настройки выполнять не требуется.  

При наличии двустороннего доверия между лесами Configuration Manager не требует дополнительных действий по настройке.  

По умолчанию при установке нового дочернего сайта Configuration Manager настраивает следующие компоненты:  

- Маршрут межсайтовой файловой репликации на каждом сайте, который использует учетную запись компьютера сервера сайта. Добавляет учетную запись каждого компьютера в группу **SMS_SiteToSiteConnection_ &lt;код_сайта\>** на конечном компьютере.  

- Репликация базы данных между SQL Server на каждом сайте.  

Также настройте следующие конфигурации:  

- Промежуточные брандмауэры и сетевые устройства должны разрешать передачу сетевых пакетов, необходимых Configuration Manager.  

- Между лесами должно выполняться разрешение имен.  

- Чтобы установить сайт или роль системы сайта, необходимо задать учетную запись с правами локального администратора на указанном компьютере.  

#### <a name="scenario-2-communication-in-a-site-that-spans-forests"></a>Сценарий 2. Взаимодействие на сайте, охватывающем леса

В этом сценарии двустороннее доверие между лесами не требуется.  

Первичные сайты поддерживают установку ролей системы сайта на компьютерах в удаленных лесах.  

- Единственным исключением является точка веб-службы каталога приложений.  Она поддерживается только в одном лесу с сервером сайта.  

- Если роль системы сайта принимает подключения из Интернета, следует принять во внимание рекомендации по обеспечению безопасности и установить эти роли систем сайта в таком расположении, где граница леса обеспечивает защиту сервера сайта (например, в сети периметра).  

При установке роли системы сайта на компьютере в лесу без доверия:  

- Укажите значение **Учетная запись установки системы сайта**, используемое для установки роли системы сайта. (Для подключения у этой учетной записи должны быть права администратора.) Затем установите роли системы сайта на указанном компьютере.  

- Выберите параметр системы сайта **Сервер сайта должен инициировать подключения к этой системе сайта**. Этот параметр вынуждает сервер сайта устанавливать подключения к серверу системы сайта для передачи данных. С этой конфигурацией компьютер в расположении, не имеющем доверия, не сможет подключаться к серверу сайта, расположенному в доверенной сети. Эти соединения используют значение **Учетная запись установки системы сайта**.  

При использовании роли системы сайта в лесу без доверия брандмауэры должны разрешать прохождение сетевого трафика, даже если сервер сайта инициирует передачу данных.  

Кроме того, следующим ролям системы сайта требуется прямой доступ к базе данных сайта. Поэтому брандмауэры должны разрешать прохождение соответствующего трафика из ненадежного леса на сервер SQL Server сайта:  

- точка синхронизации каталога аналитики активов;  

- Точка Endpoint Protection  

- Точка регистрации  

- Точка управления  

- Точка служб отчетов  

- точка миграции состояния,  

Дополнительные сведения см. в статье [Порты, используемые в Configuration Manager](ports.md).  

Возможно, вам потребуется настроить доступ точки управления и точки регистрации к базе данных сайта.

- По умолчанию, если эти роли систем сайта установлены, Configuration Manager настраивает учетную запись компьютера нового сервера системы сайта в качестве учетной записи подключения для роли системы сайта. Затем он добавляет ее к соответствующей роли базы данных SQL Server.  

- При установке этих ролей систем сайта в домене, не имеющем доверия, учетную запись подключения роли системы сайта необходимо настроить для получения сведений из базы данных.  

При настройке учетной записи пользователя домена в качестве учетной записи подключения для этих ролей системы сайта следует убедиться, что учетная запись имеет соответствующий доступ к базе данных SQL Server на этом сайте.  

- Точка управления: **учетная запись подключения к базе данных точки управления**  

- Точка регистрации: **учетная запись подключения точки регистрации**  

При планировании ролей систем сайта в других лесах примите во внимание следующие дополнительные сведения.  

- При использовании брандмауэра Windows применимые профили брандмауэра следует настроить для передачи данных между сервером базы данных сайта и компьютерами, на которых установлены роли удаленной системы сайта.

- Если точка управления интернет-клиентами доверяет лесу, содержащему учетные записи пользователей, поддерживаются политики пользователей. Если доверие отсутствует, поддерживаются только политики компьютеров.  

#### <a name="scenario-3-communication-between-clients-and-site-system-roles-when-the-clients-arent-in-the-same-active-directory-forest-as-their-site-server"></a>Сценарий 3: Взаимодействие между клиентами и ролями систем сайта, если клиенты и сервер сайта находятся в разных лесах Active Directory

Configuration Manager поддерживает для клиентов, находящихся в разных лесах с сервером их сайта, следующие сценарии:  

- Между лесом клиента и лесом сервера сайта существует двустороннее доверие.  

- Сервер роли системы сайта расположен в одном лесу с клиентом.  

- Клиент находится на компьютере домена, не имеющем двустороннего отношения доверия между лесами с сервером сайта, и роли систем сайта не установлены в лесу клиента.  

- Клиент находится на компьютере рабочей группы.  

Клиенты на компьютере, присоединенном к домену, могут использовать доменные службы Active Directory для поиска служб, когда их сайт публикуется в их лесу Active Directory.  

Для публикации данных сайта в другой лес Active Directory необходимо:  

- Указать лес, а затем включить публикацию в этом лесу в узле **Леса Active Directory** рабочей области **Администрирование** .  

- Настроить каждый сайт, который будет публиковать свои данные в доменных службах Active Directory. Такая конфигурация позволяет клиентам в этом лесу извлекать информацию сайта и обнаруживать точки управления. Для клиентов, которые не могут использовать доменные службы Active Directory для поиска служб, можно применять DNS, WINS или назначенную точку управления клиента.  

#### <a name="scenario-4-put-the-exchange-server-connector-in-a-remote-forest"></a><a name="bkmk_xchange"></a> Сценарий 4. Размещение коннектора Exchange Server в удаленном лесу  

Для этого сценария убедитесь, что между лесами существует разрешение имен. Например, настройте пересылки DNS. При настройке коннектора Exchange Server укажите полное доменное имя интрасети Exchange Server. Дополнительные сведения см. в статье [Управление мобильными устройствами с помощью System Center Configuration Manager и Exchange](../../../mdm/deploy-use/manage-mobile-devices-with-exchange-activesync.md).  

## <a name="see-also"></a>См. также

- [Планирование безопасности](../security/plan-for-security.md)  

- [Безопасность и конфиденциальность клиентов Configuration Manager](../../clients/deploy/plan/security-and-privacy-for-clients.md)  
