---
title: Библиотека содержимого
titleSuffix: Configuration Manager
description: Сведения о библиотеке содержимого, используемой Configuration Manager для уменьшения общего объема распространяемого содержимого.
ms.date: 07/31/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 65c88e54-3574-48b0-a127-9cc914a89dca
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: d7432b3522d5292e2c2afc1dac6b8db3382cca12
ms.sourcegitcommit: 4c129bb04ea4916c78446e89fbff956397cbe828
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/13/2020
ms.locfileid: "83343173"
---
# <a name="the-content-library-in-configuration-manager"></a>Библиотека содержимого в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Библиотека содержимого — это хранилище единственных копий содержимого в Configuration Manager. Сайт использует ее, чтобы уменьшить общий размер распространяемого содержимого. В библиотеке содержимого хранятся все файлы содержимого для развертываний ПО, например обновлений ПО, приложений и развертываний ОС.  

- Сайт автоматически создается и сохраняет копию библиотеки содержимого на каждом сервере сайта и в каждой точке распространения.  

- Перед тем как Configuration Manager добавляет файлы содержимого на сервер сайта или копирует их в точки распространения, он проверяет, не находятся ли эти файлы в библиотеке содержимого.  

- Если файл содержимого доступен, Configuration Manager не копирует его. Вместо этого существующий файл содержимого связывается с приложением или пакетом.  

На серверах точек распространения можно настроить следующие параметры:

- Один или несколько дисков, на которых требуется создать библиотеку содержимого.  

- Приоритет для каждого используемого диска.  

Configuration Manager копирует файлы содержимого на диск с самым высоким приоритетом до тех пор, пока на нем доступно пространство достаточного объема.  

- Параметры диска настраиваются во время установки точки распространения.  

- Вы не можете настроить параметры диска в свойствах точки распространения после завершения установки.  

Дополнительные сведения о настройке параметров диска для точки распространения см. в статье [Управление содержимым и инфраструктурой содержимого](../../servers/deploy/configure/manage-content-and-content-infrastructure.md).  

> [!IMPORTANT]
> Чтобы переместить библиотеку содержимого в другое расположение в точке распространения после установки, используйте средство **переноса библиотеки содержимого** в наборе средств Configuration Manager. Дополнительные сведения см. в статье [Средство переноса библиотеки содержимого](../../support/content-library-transfer.md).  


## <a name="about-the-content-library-on-the-central-administration-site"></a>Сведения о библиотеке содержимого на сайте центра администрирования

По умолчанию Configuration Manager создает библиотеку содержимого на сайте центра администрирования, где установлен сайт. Библиотека контента размещается на диске сервера сайта с наибольшим свободным пространством на диске. Так как вы не можете установить точку распространения на сайте центра администрирования, вы не можете указать приоритеты дисков, используемых для библиотеки содержимого. Как и для библиотеки контента на других серверах сайта и в точках распространения, если на диск с библиотекой контента заканчивается свободное место, библиотека автоматически начинает использовать следующий доступный диск.  

Configuration Manager использует библиотеку содержимого на сайте центра администрирования в следующих случаях:  

- при создании содержимого на сайте центра администрирования;  

- при переносе содержимого с другого сайта Configuration Manager и назначении сайта центра администрирования сайтом, который будет управлять этим содержимым.  

> [!NOTE]  
> При создании содержимого на первичном сайте и последующем распространении на другой первичный сайт или вторичный сайт другого первичного сайта это содержимое временно сохраняется в папке "Входящие" планировщика на сайте центра администрирования, но не добавляется в библиотеку содержимого на этом сайте.  

Используйте следующие параметры для управления библиотекой контента на сайте центра администрирования.  

- Чтобы библиотека содержимого не устанавливалась на определенных дисках, создайте пустой файл с именем **no_sms_on_drive.sms**. Перед созданием библиотеки содержимого скопируйте его в корневую папку диска.  

- После создания библиотеки содержимого воспользуйтесь средством **переноса библиотеки содержимого** из набора средств Configuration Manager, чтобы задать расположение библиотеки. Дополнительные сведения см. в статье [Средство переноса библиотеки содержимого](../../support/content-library-transfer.md).  

> [!Note]  
> Облачные точки распространения не используют хранилище единственных копий. Сайт зашифровывает пакеты перед их отправкой в Azure, и каждый пакет имеет уникальный зашифрованный ключ. Даже если два файла идентичны, их зашифрованные версии различаются.  


## <a name="configure-a-remote-content-library-for-the-site-server"></a><a name="bkmk_remote"></a> Настройка библиотеки удаленного содержимого на сервере сайта

<!--1357525-->
Начиная с версии 1806, чтобы настроить [высокий уровень доступности сервера сайта](../../servers/deploy/configure/site-server-high-availability.md) или освободить место на жестком диске на первичном сервере сайта или сервере центра администрирования, переместите библиотеку содержимого в другое место хранения. Переместить библиотеку содержимого можно на другой диск на сервере сайта, на отдельный сервер или отказоустойчивые диски в сети хранения данных (SAN). Рекомендуется использовать сеть SAN, так как она обладает высоким уровнем доступности и обеспечивает эластичное хранение, которое со временем растет или сжимается для удовлетворения изменяющихся требований к содержимому. Дополнительные сведения см. в статье [Способы обеспечения высокой доступности](../../servers/deploy/configure/site-server-high-availability.md).

Библиотека удаленного содержимого является предварительным условием для обеспечения [высокой доступности сервера сайта](../../servers/deploy/configure/site-server-high-availability.md).

> [!Note]  
> Это действие перемещает на сервер сайта только библиотеку содержимого. Это не влияет на расположение библиотеки содержимого в точках распространения. 

> [!Tip]  
> Кроме того, спланируйте управление содержимым источников пакетов, которое является внешним по отношению к библиотеке содержимого. Каждый объект программного обеспечения в Configuration Manager имеет источник пакета в сетевой папке. Все источники можно централизованно хранить в одной общей папке, однако она должна обладать избыточностью и высокой доступностью.
>
> Если вы перемещаете библиотеку содержимого в тот же том хранения, что и источники пакетов, этот том нельзя пометить как подлежащий дедупликации данных. Библиотека содержимого поддерживает дедупликацию данных, однако том источников пакетов нет. Дополнительные сведения см. в разделе [Дедупликация данных](../configs/support-for-windows-features-and-networks.md#bkmmk_datadedup).<!--SCCMDOcs issue #831-->  

### <a name="prerequisites"></a>Предварительные условия  

- Учетной записи компьютера сервера сайта необходимы разрешения на **полный доступ** для сетевого пути, по которому перемещается библиотека содержимого. Это разрешение применяется к общей папке и файловой системе. В удаленной системе компоненты не установлены.

- Сервер сайта не может иметь роль точки распространения. Точка распространения также использует библиотеку содержимого, и эта роль не поддерживает библиотеку удаленного содержимого. После перемещения библиотеки содержимого роль точки распространения невозможно добавить на сервер сайта.  

- Удаленная система для библиотеки содержимого должна находиться в доверенном домене.

> [!Important]  
> Не используйте одну и ту же общую сетевую папку для нескольких сайтов. Например, не используйте один и тот же путь как для сайта центра администрирования, так и для дочернего первичного сайта. Такая конфигурация может привести к повреждению библиотеки содержимого, из-за чего ее потребуется создать повторно.<!--SCCMDocs-pr issue 2764-->  

### <a name="process-to-manage-the-content-library"></a>Процесс управления библиотекой содержимого

1. Создайте в сетевой папке конечную папку для библиотеки содержимого. Например, `\\server\share\folder`.  

    > [!Warning]  
    > Не используйте повторно существующую папку с содержимым. Например, не используйте папку, в которой находятся источники пакетов. Перед копированием библиотеки содержимого Configuration Manager удаляет содержимое из указанной папки.  

2. В консоли Configuration Manager перейдите в рабочую область **Администрирование**. Разверните узел **Конфигурация сайта**, выберите узел **Сайты** и выберите сайт. На вкладке **Сводка** в нижней части области сведений обратите внимание на новый столбец для **библиотеки содержимого**.  

3. На ленте нажмите кнопку **Управление библиотекой содержимого**.  

4. В окне "Управление библиотекой содержимого" в поле **Текущее расположение** показаны локальный диск и путь. Введите допустимый сетевой путь в поле **Новое расположение**. Этот путь — это место, куда сайт перемещает библиотеку содержимого. Он должен включать имя папки, которая уже существует в общей папке, например `\\server\share\folder`. Нажмите кнопку **OK**.  

5. Обратите внимание на значение **Состояние** в столбце "Библиотека содержимого" на вкладке "Сводка" области сведений. Оно обновляется, показывая процесс перемещения библиотеки содержимого сайта.  

   - Во **время выполнения** значение **Ход выполнения перемещения (%)** показывает процент завершения.  

        > [!Note]  
        > Если у вас большая библиотека содержимого, некоторое время в консоли может отображаться ход выполнения `0%`. Например, при наличии библиотеки размером 1 ТБ ход выполнения `1%` появится только после того, как скопируется 10 ГБ. Просмотрите файл **distmgr.log**, в котором отображается количество скопированных файлов и байтов. Начиная с версии 1810 в файле журнала также отображается расчетное оставшееся время.

   - При возникновении состояния ошибки отображается ошибка. К распространенным ошибкам относятся **Нет доступа** или **Диск заполнен**.  

   - По завершении отображается состояние **Завершено**.  

     Подробные сведения см. в файле **distmgr.log**. Дополнительные сведения см. в разделе [Журналы сервера сайта и сервера системы сайта](log-files.md#BKMK_SiteSiteServerLog).  

Дополнительные сведения об этом процессе см. в разделе [Блок-схема управления библиотекой содержимого](manage-content-library-flowchart.md).

Сайт фактически *копирует* файлы библиотеки содержимого в удаленное расположение. При этом файлы библиотеки содержимого не удаляются из исходного расположения на сервере сайта. Чтобы освободить место, администратор должен вручную удалить эти исходные файлы.

Если исходная библиотека содержимого занимает два диска, она будет объединена в одной папке в новом месте назначения.

Начиная с версии 1810, во время копирования компоненты **Деспулер** и **Диспетчер распространения** не обрабатывают новые пакеты. Это действие гарантирует, что содержимое не добавляется в библиотеку при перемещении. В любом случае следует запланировать это изменение на период обслуживания системы.

Если нужно переместить библиотеку содержимого обратно на сервер сайта, повторите этот процесс, но введите локальный диск и путь в поле **Новое расположение**. Путь должен включать имя папки, которая уже существует на диске, например `D:\SCCMContentLib`. Если исходное содержимое все еще существует, конфигурация быстро переносится в расположение, являющееся локальным по отношению к серверу сайта.

> [!Tip]  
> Чтобы переместить содержимое на другой диск на сервере сайта, используйте средство **переноса библиотеки содержимого**. Дополнительные сведения см. в статье [Средство переноса библиотеки содержимого](../../support/content-library-transfer.md).  


## <a name="inside-the-content-library"></a>Строение библиотеки содержимого

> [!Warning]  
> Следующий раздел служит только в информационных целях. Не изменяйте, не добавляйте и не удаляйте файлы и папки в библиотеке содержимого. Это может привести к повреждению пакетов, содержимого или библиотеки содержимого в целом. Если есть подозрение на то, что данные отсутствуют, повреждены или недопустимы, используйте функцию проверки в консоли Configuration Manager для выявления таких проблем. Затем повторно распространите затронутое содержимое, чтобы устранить проблемы.

По умолчанию библиотека содержимого хранится в корне диска в папке **SCCMContentLib**. По умолчанию к этой папке открыт общий доступ по имени **SCCMContentLib$** . Разрешения на доступ к папке и общей папке ограничены во избежание случайного повреждения. Все изменения необходимо вносить из консоли Configuration Manager. В этой папке находятся следующие объекты:  

- библиотека пакетов (папка **PkgLib**): сведения о пакетах, имеющихся в точке распространения;  

- библиотека данных (папка **DataLib**): сведения об исходной структуре пакетов;  

- библиотека файлов (папка **FileLib**): исходные файлы в пакете; именно эта папка обычно занимает большую часть места в хранилище.  

![Общая схема библиотеки содержимого Configuration Manager](media/content-library-overview.png)

> [!Tip]  
> Для просмотра содержимого в библиотеке содержимого используйте средство **Обозреватель библиотеки содержимого** из набора средств Configuration Manager. Изменять содержимое с помощью этого средства невозможно. Оно предоставляет информацию об имеющемся содержимом, а также позволяет проверять и повторно распространять его. Дополнительные сведения см. в статье [Обозреватель библиотеки содержимого](../../support/content-library-explorer.md).  

### <a name="package-library"></a>Библиотека пакетов

Папка библиотеки пакетов, **PkgLib**, содержит по одному файлу для каждого пакета, переданного в точку распространения. Имя файла совпадает с идентификатором пакета, например `ABC00001.INI`. В этом файле в разделе `[Packages]` приводится список идентификаторов содержимого, которые являются частью пакета, а также другие сведения, например версия. Например, **ABC00001** — это устаревший пакет версии **1**. Идентификатор содержимого в этом файле — `ABC00001.1`.

### <a name="data-library"></a>Библиотека данных

Папка библиотеки данных, **DataLib**, содержит по одному файлу и одной папке для каждого содержимого в каждом пакете. Например, файл и папка могут иметь имена `ABC00001.1.INI` и `ABC00001.1` соответственно. Файл содержит сведения для проверки. В папке воссоздается структура папок из исходного пакета.

Файлы в библиотеке данных заменяются файлами INI с именами исходных файлов в пакете. Например, `MyFile.exe.INI`. Эти файлы содержат сведения об исходных файлах, такие как размер, время изменения и хэш. Найти исходный файл в библиотеке файлов можно по первым четырем символам хэша. Например, хэш в файле MyFile.exe.INI — **DEF98765**, а первые четыре символа — **DEF9**.

### <a name="file-library"></a>Библиотека файлов

Если библиотека содержимого охватывает несколько дисков, файлы пакетов могут находиться в папке библиотеки файлов (**FileLib**) на любом из этих дисков.

Найти определенный файл можно по первым четырем символам хэша из библиотеки данных. В папке библиотеки файлов много папок, имя каждой из которых состоит из четырех символов. Найдите папку, соответствующую первым четырем символам хэша. В найденной папке будут содержаться один или несколько наборов из трех файлов. Эти файлы имеют одинаковые имена, но один из них имеет расширение INI, другой — расширение SIG, а третий не имеет расширения имени файла. Исходный файл — этот тот, имя которого совпадает с хэшем из библиотеки данных, но который не имеет расширения имени файла.

Например, папка **DEF9** содержит файлы `DEF98765.INI`, `DEF98765.SIG` и `DEF98765`. `DEF98765` — это исходный файл `MyFile.exe`. INI-файл содержит список пользователей или идентификаторов содержимого из одного файла. Файл удаляется с сайта только при удалении всего содержимого.

### <a name="drive-spanning"></a>Размещение на нескольких дисках

Библиотека содержимого может размещаться на нескольких дисках. Диски выбираются при создании точки распространения. По умолчанию Configuration Manager автоматически выбирает диски при размещении библиотеки содержимого на нескольких дисках.

При выборе дисков необходимо задать основной и дополнительный диски. Сайт сохраняет все метаданные на основном диске. На дополнительном диске размещается только библиотека файлов. Имя общей папки на дополнительных дисках включает в себя букву диска. Например, если D: и E: — это дополнительные диски для библиотеки содержимого, имена общих папок — **SCCMContentLibD$** и **SCCMContentLibE$** .

Если выбран параметр **Автоматически**, Configuration Manager выбирает в качестве основного диск с наибольшим объемом свободного места. На этом диске сохраняются все метаданные. На дополнительных дисках размещается только библиотека файлов.

Во время настройки указывается объем резервного пространства. Configuration Manager пытается использовать дополнительный диск, когда на самом доступном диске остается свободным только этот объем. Каждый раз, когда для использования выбирается новый диск, выбирается диск с наибольшим объемом свободного места.

Точку распространения невозможно настроить так, чтобы она использовала все диски, кроме определенного набора. Чтобы реализовать такую возможность, создайте пустой файл с именем `NO_SMS_ON_DRIVE.SMS` в корне диска. Это необходимо сделать до того, как Configuration Manager выберет диск для использования. Если Configuration Manager обнаружит этот файл в корне диска, диск не будет использоваться для размещения библиотеки содержимого.


## <a name="troubleshooting"></a>Устранение неполадок

Приведенные ниже советы могут помочь в устранении неполадок, связанных с библиотекой содержимого.  

- Просмотрите журналы на сервере сайта (**distmgr.log** и **PkgXferMgr.log**) и в точке распространения (**smsdpprov.log**) и попытайтесь найти в них признаки сбоев.  

- Используйте средство [Обозреватель библиотеки содержимого](../../support/content-library-explorer.md).  

- Проверьте наличие блокировок файлов другими процессами, например антивирусной программой. Исключите библиотеку содержимого и каталог временного размещения (**SMS_DP$** ) на всех дисках из автоматических антивирусных проверок.  

- Чтобы определить, нет ли расхождений хэша, проверьте пакет в консоли Configuration Manager.  

- В качестве последней меры повторно распространите содержимое. Это должно решить большинство проблем.  

Дополнительные сведения см. в статье [Основные сведения о распространении содержимого в Configuration Manager и устранение соответствующих неполадок](https://support.microsoft.com/help/4482728/understand-troubleshoot-content-distribution-in-configuration-manager).
