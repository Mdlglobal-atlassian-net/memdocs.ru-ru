---
title: Развертывание клиентов в Windows
titleSuffix: Configuration Manager
description: Сведения о развертывании клиентов Configuration Manager на компьютерах Windows.
ms.date: 09/04/2019
ms.prod: configuration-manager
ms.technology: configmgr-client
ms.topic: conceptual
ms.assetid: 341f0d0b-f907-44cf-9e10-e1b41fc15f82
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 07c5488b0ea28f37f7f8a07b532c67fb64aad810
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81694012"
---
# <a name="how-to-deploy-clients-to-windows-computers-in-configuration-manager"></a>Развертывание клиентов на компьютерах Windows в Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

В статье приводятся сведения о развертывании клиентов Configuration Manager на компьютерах Windows. Дополнительные сведения о планировании и подготовке для развертывания клиентов см. в следующих статьях:

- [Методы установки клиента](plan/client-installation-methods.md)  
- [Необходимые условия для развертывания клиентов на компьютерах с Windows](prerequisites-for-deploying-clients-to-windows-computers.md)
- [Безопасность и конфиденциальность клиентов Configuration Manager](plan/security-and-privacy-for-clients.md)  
- [Рекомендации по развертыванию клиентов](plan/best-practices-for-client-deployment.md)  


## <a name="client-push-installation"></a><a name="BKMK_ClientPush"></a> Принудительная установка клиента

Существует три основных способа для принудительной установки клиента:  

- При настройке принудительной установки клиентов для сайта установка клиента автоматически запускается на компьютерах, обнаруженных сайтом. Область действия этого метода задается настроенными границами сайта, которые настроены как группа границ.  

- Инициируйте принудительную установку клиентов, запустив мастер принудительной установки клиентов для определенной коллекции или для определенного ресурса в составе коллекции.  

- С помощью мастера принудительной установки клиента установите клиент Configuration Manager, который позволяет [запросить](../../servers/manage/introduction-to-queries.md) результаты. Для успешной установки один из элементов, возвращенных запросом, должен являться атрибутом **Идентификатор ресурса** класса **Системный ресурс**.

Если серверу сайта не удается связаться с клиентским компьютером или запустить процесс установки, он автоматически повторяет попытку установки через каждый час. Сервер продолжает попытки в течение семи дней.  

Чтобы отслеживать процесс установки клиентов, установите резервную точку состояния перед установкой клиентов. Если установлена резервная точка состояния, она автоматически назначается клиентам при их принудительной установке. Для отслеживания хода установки клиентов просматривайте отчеты о развертывании и назначении клиентов.

Файлы журналов клиентов содержат более подробные сведения для устранения неполадок. Этот способ не требует резервной точки состояния. Например, в файле CCM.log на сервере сайта регистрируются все неполадки при подключении сервера сайта к компьютеру. В файле CCMSetup.log на стороне клиента регистрируется процесс установки.  

> [!IMPORTANT]  
> Принудительная установка клиента выполняется только при выполнении всех предварительных условий. Дополнительные сведения см. в разделе [Зависимости метода установки](prerequisites-for-deploying-clients-to-windows-computers.md#installation-method-dependencies).

### <a name="configure-the-site-to-automatically-use-client-push-for-discovered-computers"></a>Настройка сайта для автоматической принудительной установки клиентов на обнаруженных компьютерах

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Конфигурация сайта** и выберите узел **Сайты**.  

2. Выберите сайт, для которого требуется настроить автоматическую принудительную установку клиента в масштабе сайта.  

3. На вкладке **Главная** на ленте в группе **Параметры** выберите **Параметры установки клиента**, а затем — **Принудительная установка клиента**.  

4. На вкладке **Общие** в окне "Свойства принудительной установки клиента" выберите параметр **Разрешить автоматическую принудительную установку клиента в пределах всего сайта**.

5. Начиная с версии 1806 при обновлении сайта включается проверка Kerberos для принудительной установки клиента. Параметр **Разрешить возврат подключения к протоколу NTLM** включен по умолчанию, что обеспечивает совместимость с предыдущим поведением. Если сайт не может проверить подлинность клиента с использованием Kerberos, он повторяет попытку соединения с помощью NTLM. Для повышения безопасности мы советуем отключить этот параметр, что потребует обязательного использования Kerberos без возврата к NTLM.<!--1358204-->  

    > [!NOTE]  
    > При использовании принудительной установки клиента Configuration Manager сервер сайта создает удаленное подключение к клиенту. Начиная с версии 1806 сайт может потребовать взаимную проверку подлинности Kerberos, не допуская возврата к NTLM перед установкой подключения. Такое улучшение позволяет защитить обмен данными между сервером и клиентом.  
    >
    > В зависимости от политик безопасности в вашей среде, возможно, использование Kerberos уже сейчас является обязательным или предпочтительным по сравнению со старым стандартом проверки подлинности NTLM. Дополнительные сведения о безопасности этих протоколов проверки подлинности см. в разделе [Вопросы безопасности](https://docs.microsoft.com/windows/security/threat-protection/security-policy-settings/network-security-restrict-ntlm-outgoing-ntlm-traffic-to-remote-servers#security-considerations).  
    >
    > Чтобы использовать эту возможность, клиенты должны находиться в доверенном лесу Active Directory. Kerberos в Windows использует Active Directory для взаимной проверки подлинности.  

6. Выберите типы систем, на которые Configuration Manager будет принудительно устанавливать клиентское ПО. Выберите, следует ли устанавливать клиент на контроллерах домена.  

7. На вкладке **Учетные записи** укажите одну или несколько учетных записей, которые Configuration Manager будет использовать при подключении к целевому компьютеру. Щелкните значок **Создать**, введите данные в полях **Имя пользователя** и **Пароль** (не более 38 символов), подтвердите пароль и нажмите кнопку **ОК**. Укажите хотя бы одну учетную запись принудительной установки клиентов. Эта учетная запись должна иметь права локального администратора на целевом компьютере для установки клиента. Если не указать учетную запись для принудительной установки клиента, Configuration Manager попытается использовать учетную запись компьютера системы сайта. При использовании учетной записи компьютера системы сайта происходит сбой принудительной установки клиентов в нескольких доменах.  

    > [!NOTE]  
    > Для принудительной установки клиента на вторичном сайте укажите учетную запись на вторичном сайте, которая инициирует принудительную установку.  
    >
    > Дополнительные сведения об учетной записи принудительной установки клиентов см. в разделе [Использование мастера принудительной установки клиентов](#use-the-client-push-installation-wizard).  

8. Укажите необходимые свойства на вкладке **Свойства установки**.

    Если схема Active Directory расширена для Configuration Manager, сайт публикует указанные [свойства установки клиента](about-client-installation-properties.md) в доменных службах Active Directory. Когда CCMSetup выполняется без параметров установки, он считывает их из Active Directory.  

    > [!NOTE]  
    > При включении функции принудительной установки клиента на вторичном сайте установите в качестве значения свойства **SMSSITECODE** задан код родительского первичного сайта Configuration Manager. Если схема Active Directory расширена для Configuration Manager, то для того,чтобы поиск назначения соответствующего сайта выполнялся автоматически, установите для этого свойства значение **AUTO**.

### <a name="use-the-client-push-installation-wizard"></a>Использование мастера принудительной установки клиентов

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Конфигурация сайта** и выберите узел **Сайты**.  

2. Выберите сайт, для которого требуется настроить автоматическую принудительную установку клиента в масштабе сайта.  

3. На вкладке **Главная** на ленте в группе **Параметры** выберите **Параметры установки клиента**, а затем — **Принудительная установка клиента**.  

4. Укажите необходимые свойства на вкладке **Свойства установки**.  

    Если схема Active Directory расширена для Configuration Manager, сайт публикует указанные [свойства установки клиента](about-client-installation-properties.md) в доменных службах Active Directory. Когда CCMSetup выполняется без параметров установки, он считывает их из Active Directory.

5. В консоли Configuration Manager перейдите в рабочую область **Активы и соответствие**.  

6. В узле **Устройства** выберите один или несколько компьютеров. Или выберите коллекцию компьютеров в узле **Коллекции устройств**.  

7. На вкладке **Главная** на ленте выполните одно из следующих действий:  

    - Для принудительной установки клиента на одно или несколько устройств в группе **Устройства** выберите **Установить клиент**.  

    - Для принудительной установки клиента на коллекцию устройств в группе **Коллекция** выберите **Установить клиент**.  

8. На странице **Перед началом работы** в мастере установки клиента Configuration Manager просмотрите данные, а затем нажмите кнопку **Далее**.  

9. Выберите соответствующие параметры на странице **Параметры установки**.  

10. Проверьте параметры установки и завершите работу мастера.  

> [!NOTE]  
> Используйте мастер для установки клиентов, даже если сайт не настроен для принудительной установки клиентов.  

## <a name="software-update-based-installation"></a><a name="BKMK_ClientSUP"></a> Установка путем обновления программного обеспечения  

При установке клиента на основе обновления программного обеспечения происходит публикация клиента в точке обновления в виде обновления программного обеспечения. Этот метод можно использовать для первоначальной установки или обновления.  

Если на компьютере установлен клиент Configuration Manager, компьютер получает политику клиента с сайта. Эта политика включает имя сервера точки обновления программного обеспечения и порт для получения обновлений ПО.

> [!IMPORTANT]  
> Для использования установки на базе обновления программного обеспечения используйте один и тот же сервер WSUS для установки клиента и обновлений. Этот сервер должен быть активной точкой обновления программного обеспечения на первичном сайте. Дополнительные сведения см. в статье [Установка точки обновления программного обеспечения](../../../sum/get-started/install-a-software-update-point.md).

Если на компьютере не установлен клиент Configuration Manager, настройте и назначьте объект групповой политики. Эта групповая политика указывает имя сервера точки обновления программного обеспечения.  

При установке клиентов на основе обновлений программного обеспечения добавлять свойства командной строки невозможно. Если схема Active Directory расширена для Configuration Manager, клиент автоматически запрашивает свойства установки в доменных службах Active Directory.  

Если схема Active Directory не расширена, используйте групповую политику для распространения параметров установки. Эти параметры автоматически применяются к любой установке клиента на основе обновления программного обеспечения. Дополнительные сведения см. в разделе [Настройка свойств установки клиента](#BKMK_Provision) и в статье [Назначение клиентов сайту](assign-clients-to-a-site.md).  

Используйте следующие процедуры для настройки компьютеров без клиента Configuration Manager для использования точки обновления программного обеспечения. Существует также процедура для публикации клиентского программного обеспечения в точке обновления.  

> [!TIP]  
> Если компьютеры находятся в состоянии ожидания перезагрузки после установки программного обеспечения, установка клиента на основе обновления программного обеспечения может вызвать перезагрузку компьютера.  

### <a name="configure-a-group-policy-object-to-specify-the-software-update-point"></a>Настройка объекта групповой политики для указания точки обновления программного обеспечения  

1. В **консоли управления групповыми политиками** откройте новый или имеющийся объект групповой политики.  

2. Выберите **Конфигурация компьютера**, **Административные шаблоны** и **Компоненты Windows**, а затем щелкните **Центр обновления Windows**.  

3. Откройте окно свойств параметра **Указать размещение службы обновлений Майкрософт в интрасети** и выберите **Включен**.  

4. **Укажите службу обновлений в интрасети для поиска обновлений**. Укажите имя и порт сервера точки обновления ПО.  

    - Если система сайта Configuration Manager использует полное доменное имя (FQDN), укажите имя в этом формате.  

    - Если система сайта Configuration Manager не использует полное доменное имя (FQDN), используйте короткое имя.

    > [!TIP]  
    > Сведения об определении номера порта см. в разделе [Определение параметров портов, используемых WSUS](../../../sum/plan-design/plan-for-software-updates.md).

    Пример в формате полного доменного имени: `http://server1.contoso.com:8530`  

5. **Укажите сервер статистики в интрасети**. Этот параметр обычно настраивается с именем того же сервера.

6. Назначьте объект групповой политики компьютерам, на которых нужно установить клиент и получать обновления программного обеспечения.  

### <a name="publish-the-configuration-manager-client-to-the-software-update-point"></a>Публикация клиента Configuration Manager в точке обновления  

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Конфигурация сайта** и выберите узел **Сайты**.  

2. Выберите сайт, для которого нужно настроить установку клиентов с помощью обновления.  

3. На вкладке **Главная** на ленте в группе **Параметры** выберите **Параметры установки клиента**, а затем щелкните **Установка клиента на основе обновления программного обеспечения**.  

4. Выберите параметр **Разрешить установку клиента на основе обновления программного обеспечения**.  

5. Если версия клиентского ПО на сайте является более поздней по сравнению с версией в точке обновления, то откроется диалоговое окно **Обнаружена более поздняя версия пакета клиента**. Нажмите кнопку **Да**, чтобы опубликовать наиболее позднюю версию.  

    > [!NOTE]  
    > Если клиентское ПО еще не опубликовано в точке обновления ПО, это диалоговое окно будет пустым.

Обновление программного обеспечения клиента Configuration Manager не будет выполняться автоматически при наличии новой версии. При обновлении сайта повторите эту процедуру для обновления клиента.  

## <a name="group-policy-installation"></a><a name="BKMK_ClientGP"></a> Установка с использованием групповой политики

Используйте групповую политику в доменных службах Active Directory, чтобы публиковать или назначать клиент Configuration Manager. Клиент будет установлен при запуске компьютера. При использовании групповой политики клиент отображается в компоненте панели управления **Установка и удаление программ**. Пользователь может установить его оттуда.  

Используйте пакет установщика Windows CCMSetup.msi для установки на основе групповой политики. Этот файл находится в папке `<ConfigMgr installation directory>\bin\i386` на сервере сайта. В этот файл невозможно добавить свойства, чтобы изменить поведение установки.  

> [!IMPORTANT]  
> Необходимо иметь права администратора для доступа к установочным файлам клиента.  

- Если схема Active Directory расширена для Configuration Manager и вы выбрали домен на вкладке **Публикация** диалогового окна **Свойства сайта**, клиентские компьютеры автоматически выполняют поиск свойств установки в доменных службах Active Directory. Дополнительные сведения см. в статье [О свойствах установки клиента, публикуемых в доменных службах Active Directory](about-client-installation-properties-published-to-active-directory-domain-services.md).  

- Если схема Active Directory еще не расширена, сведения о хранении свойств установки в реестре Windows на компьютерах см. в [этом разделе](#BKMK_Provision). Клиент использует эти свойства при установке.  

Дополнительные сведения см. в статье [How to use Group Policy to remotely install software in Windows Server 2008 and in Windows Server 2003](https://support.microsoft.com/help/816102/how-to-use-group-policy-to-remotely-install-software-in-windows-server) (Использование групповой политики для удаленной установки программного обеспечения в Windows Server 2008 и Windows Server 2003).  

## <a name="manual-installation"></a><a name="BKMK_Manual"></a> Установка вручную

Установите клиентское программное обеспечение на компьютерах вручную с помощью программы CCMSetup.exe. Эта программа и ее вспомогательные файлы находятся в папке Client внутри папки установки Configuration Manager на сервере сайта. Сайт предоставляет общий доступ к этой папке по следующему пути:  

`\\<site server name>\SMS_<site code>\Client\`  

`<site server name>` — имя сервера первичного сайта, а `<site code>` — код первичного сайта, который назначен клиенту. Чтобы запустить CCMSetup.exe в командной строке на клиенте, подключитесь к этому расположению в сети и выполните команду.  

> [!IMPORTANT]  
> Необходимо иметь права администратора для доступа к установочным файлам клиента.  

Программа CCMSetup.exe копирует все необходимые компоненты на клиентский компьютер и вызывает пакет установщика Windows (Client.msi) для установки клиента. Запустить файл Client.msi напрямую невозможно.  

Чтобы изменить поведение установки клиента, укажите параметры командной строки для CCMSetup.exe и Client.msi. Убедитесь в том, что заданы параметры CCMSetup (параметры, начинающиеся с `/`), прежде чем определять параметры Client.msi. Пример.  

`CCMSetup.exe /mp:SMSMP01 /logon SMSSITECODE=AUTO FSP=SMSFP01`

В этом примере клиент устанавливается с помощью следующих параметров:  

|Параметр|Описание:|  
|--------------|-----------------|  
|`/mp:SMSMP01`|Этот параметр CCMSetup указывает точку управления SMSMP01 для загрузки файлов, необходимых для установки клиента.|  
|`/logon`|Этот параметр CCMSetup указывает, что установка должна прекратиться, если на компьютере уже существует клиент Configuration Manager.|  
|`SMSSITECODE=AUTO`|Это свойство Client.msi указывает, что клиент пытается обнаружить код сайта Configuration Manager для использования, например с помощью доменных служб Active Directory.|  
|`FSP=SMSFP01`|Это свойство Client.msi указывает, что резервная точка состояния с именем SMSFP01 будет использоваться для получения сообщений о состоянии, отправленных клиентским компьютером.|  

Дополнительные сведения см. в разделе [Сведения о параметрах и свойствах установки клиента](about-client-installation-properties.md).  

> [!TIP]  
> Процедуры установки клиента Configuration Manager на современных устройствах Windows 10 с помощью удостоверения Azure Active Directory (Azure AD) см. в статье [Установка и назначение клиентов Configuration Manager для Windows 10 с проверкой подлинности при помощи Azure AD](deploy-clients-cmg-azure.md). Эта процедура используется для клиентов в интрасети или в Интернете.  

### <a name="manual-installation-examples"></a>Примеры установки вручную

Эти примеры предназначены для клиентов в интрасети, присоединенных к Active Directory. В примерах используются следующие значения.  

- **MPSERVER**. Сервер, на котором размещается точка управления.
- **FSPSERVER**. Сервер, на котором размещается резервная точка состояния.  
- **ABC**. Код сайта.  
- **contoso.com**. Имя домена.  

Предположим, что вы настроили все серверы системы сайта с полным доменным именем в интрасети, а данные сайта опубликованы в Active Directory.  

Сначала выполните приведенные ниже действия на клиентском компьютере:  

1. Войдите под учетной записью локального администратора.  
2. Подключите диск Z: к папке `\\MPSERVER\SMS_ABC\Client`.  
3. В окне командной строке перейдите на диск Z:.  

Введите одну из следующих команд:  

#### <a name="manual-example-1"></a>Ручная установка. Пример 1  

`CCMSetup.exe`  

Эта команда устанавливает клиент без дополнительных параметров и свойств. Для клиента автоматически настраиваются свойства установки, опубликованные в доменных службах Active Directory, включая следующие параметры:  

- Код сайта: этот параметр требует включения сетевого расположения клиента в группу границ, настроенную для назначения клиента.  
- Точка управления.
- Резервная точка состояния.
- Связь только по протоколу HTTPS.  

Дополнительные сведения см. в статье [О свойствах установки клиента, публикуемых в доменных службах Active Directory](about-client-installation-properties-published-to-active-directory-domain-services.md).  

#### <a name="manual-example-2"></a>Ручная установка. Пример 2  

`CCMSetup.exe /MP:mpserver.contoso.com /UsePKICert SMSSITECODE=ABC CCMHOSTNAME=server05.contoso.com CCMFIRSTCERT=1 FSP=server06.constoso.com`
  
Эта команда переопределяет автоматическую конфигурацию, предоставленную доменными службами Active Directory. Для этого не требуется включение сетевого расположения клиента в группу границ, настроенную для назначения клиента. Вместо этого установка задает следующие параметры:

- Код сайта
- точку управления в интрасети;
- интернет-точка управления;
- резервную точку состояния, принимающую подключения из интрасети;
- Использование сертификата инфраструктуры открытых ключей (PKI) клиента (при наличии) с максимальным сроком действия

## <a name="logon-script-installation"></a><a name="BKMK_ClientLogonScript"></a> Установка сценария входа

Configuration Manager поддерживает сценарии входа в систему для установки клиентского ПО Configuration Manager. Используйте файл программы CCMSetup.exe в сценарии входа, чтобы запустить установку клиента.  

Установка с помощью сценария входа использует такие же методы, которые применяются при установке вручную. Укажите параметр установки `/logon` для CCMSsetup.exe. Если на компьютере уже существует любая другая версия клиента, этот параметр запрещает установку клиента. Этот режим дает возможность избежать повторной установки клиента при каждом запуске сценария входа.  

Если источник установки не указан с помощью параметра `/Source` и точка управления для получения установки не указана с помощью параметра `/MP`, программа CCMSetup.exe обнаруживает точку управления, выполнив поиск в доменных службах Active Directory. Такое поведение возникает только в том случае, если схема была расширена для Configuration Manager, а сайт опубликован в доменных службах Active Directory. Клиент также может использовать DNS или WINS для поиска точек управления.  

## <a name="package-and-program-installation"></a><a name="BKMK_ClientApp"></a> Установка пакетов и программ

Используйте Configuration Manager для создания и развертывания пакета и программы, которые обновляют клиентское ПО на выбранных устройствах. Вместе с Configuration Manager поставляется файл определения пакета, заполняющий свойства пакета типовыми значениями. Настройте поведение установки клиентов, указав дополнительные параметры и свойства командной строки.  

> [!NOTE]  
> Обновить клиенты Configuration Manager 2007 с помощью этого метода невозможно. Вместо него используйте автоматическое обновление клиента, при котором автоматически создается и развертывается пакет, содержащий последнюю версию клиента. См. дополнительные сведения об [обновлении клиентов](../manage/upgrade/upgrade-clients.md).  
>
> Дополнительные сведения о миграции из прежних версий клиента Configuration Manager см. в статье [Планирование стратегии миграции клиентов](../../migration/planning-a-client-migration-strategy.md).  

### <a name="create-a-package-and-program-for-the-client-software"></a>Создание пакета и программы с клиентским программным обеспечением  

Используйте описанную ниже процедуру, чтобы создать пакет и программу Configuration Manager для развертывания на клиентских компьютерах Configuration Manager с целью обновления клиентского ПО.  

1. В консоли Configuration Manager перейдите в рабочую область **Библиотека программного обеспечения**, разверните узел **Управление приложениями** и щелкните **Пакеты**.  

2. На вкладке **Главная** на ленте в группе **Создать** нажмите кнопку **Создать пакет из определения**.  

3. На странице **Определение пакета** мастера в списке **Издатель** выберите **Microsoft**, а в списке **Определение пакета** — **Обновление клиента Configuration Manager**.  

4. На странице **Исходные файлы** установите флажок **Всегда получать файлы из исходной папки**.  

5. На странице **Исходная папка** выберите **Сетевой путь (UNC-имя)** . Затем введите сетевой путь к серверу и сетевой папке, содержащей установочные файлы клиента.  

    > [!NOTE]  
    > Компьютер, на котором запускается развертывание Configuration Manager, должен иметь доступ к указанной сетевой папке. В противном случае произойдет сбой установки клиента.  

    Чтобы изменить какие-либо свойства установки, измените командную строку CCMSetup.exe на вкладке **Общие** в диалоговом окне **Автоматическое обновление агента Configuration Manager**. Параметры установки по умолчанию: `/noservice SMSSITECODE=AUTO`.  

6. Распределите пакет между всеми точками распределения, на которых необходимо разместить пакет обновления клиента. Затем разверните пакет в коллекциях устройств, содержащих клиенты, которые нужно обновить.  

## <a name="intune-mdm-managed-windows-devices"></a><a name="bkmk_mdm"></a> Устройства Windows под управлением Intune MDM

Разверните клиент Configuration Manager на устройствах, которые зарегистрированы в Microsoft Intune.

Эта процедура используется для традиционных клиентов, которые подключены к интрасети. В ней применяются традиционные методы проверки подлинности клиентов. Чтобы убедиться, что устройство остается в управляемом состоянии после установки клиента, оно должно находиться в интрасети и в пределах границы сайта Configuration Manager.  

Процедуры установки клиента Configuration Manager на современных устройствах Windows 10 с помощью удостоверения Azure AD см. в статье [Установка и назначение клиентов Configuration Manager для Windows 10 с проверкой подлинности при помощи Azure AD](deploy-clients-cmg-azure.md).

После установки клиента Configuration Manager устройства не отменяют регистрацию в Intune. На устройствах может использоваться клиент Configuration Manager и регистрация MDM. Дополнительные сведения см. в разделе [Общие сведения о совместном управлении](../../../comanage/overview.md).  

> [!Note]
> Для установки клиента Configuration Manager на устройстве под управлением Intune можно использовать другие методы установки. Например, если устройство, управляемое Intune, находится в интрасети и присоединено к домену Active Directory, для установки клиента Configuration Manager можно использовать групповую политику.<!-- SCCMDocs#757 -->

### <a name="install-the-configuration-manager-client-by-using-intune"></a>Установка клиента Configuration Manager с помощью Intune

1. В Intune [добавьте бизнес-приложение Windows](https://docs.microsoft.com/mem/intune/apps/lob-apps-windows), содержащее файл установки клиента Configuration Manager **CCMSetup.msi**. Этот файл находится в папке `\bin\i386` каталога установки Configuration Manager на сервере сайта.  

2. В издателе ПО Intune введите параметры командной строки. Например, используйте следующую команду с традиционным клиентом в интрасети:  

    `CCMSETUPCMD="/MP:<FQDN of management point> SMSMP=<FQDN of management point> SMSSITECODE=<your site code> DNSSUFFIX=<DNS suffix of management point>"`  

    > [!NOTE]  
    > Пример команды для использования с современным клиентом Windows 10 на основе проверки подлинности Azure AD см. в разделе [Установка клиента Configuration Manager](../../../comanage/how-to-prepare-Win10.md#install-the-configuration-manager-client).  

3. [Назначьте приложение](https://docs.microsoft.com/mem/intune/apps/apps-deploy) группе зарегистрированных компьютеров Windows.  

## <a name="os-image-installation"></a><a name="BKMK_ClientImage"></a> Установка образа ОС

Установите клиент Configuration Manager заранее на эталонном компьютере, который будет использоваться для создания образов ОС.

> [!IMPORTANT]  
> При использовании последовательности задач Configuration Manager для развертывания образа операционной системы шаг [Подготовка клиента Configuration Manager](../../../osd/understand/task-sequence-steps.md#BKMK_PrepareConfigMgrClientforCapture) полностью удаляет клиент Configuration Manager.  

### <a name="prepare-the-client-computer-for-imaging"></a>Подготовка клиентского компьютера к применению образа  

1. Вручную установите клиентское ПО Configuration Manager на эталонный компьютер. Дополнительные сведения см. в статье [Установка клиентов Configuration Manager вручную](#BKMK_Manual).  

    > [!IMPORTANT]  
    > Не указывайте код сайта Configuration Manager для клиента в командной строке CCMSetup.exe.  

2. Введите в командной строке команду `net stop ccmexec`, чтобы остановить службу "Узел агента SMS" (CcmExec.exe) на эталонном компьютере.  

3. Удалите файл SMSCFG.INI из папки Windows на компьютере-образце.  

4. Удалите все сертификаты из хранилища локального компьютера на эталонном компьютере. Например, если вы используете PKI-сертификаты, перед созданием образа компьютера удалите сертификаты в хранилище **Личное** для объектов **Компьютер** и **Пользователь**.  

5. Если клиенты устанавливаются в иерархии Configuration Manager, отличной от иерархии эталонного компьютера, удалите корневой ключ доверия с эталонного компьютера.  

    > [!NOTE]  
    > Если клиенты не могут запросить доменные службы Active Directory для обнаружения точки управления, они используют корневой ключ доверия для определения доверенных точек управления. Если все клиенты, на которых развернут образ, развертываются в той же иерархии, что и эталонный компьютер, следует оставить корневой ключ доверия на месте.
    >
    > Если клиенты развертываются в других иерархиях, удалите корневой ключ доверия. Кроме того, заранее предоставьте клиентам новый корневой ключ доверия. Дополнительные сведения см. в разделе [Планирование доверенного корневого ключа](../../plan-design/security/plan-for-security.md#BKMK_PlanningForRTK).  

6. Используйте программное обеспечение создания образа эталонного компьютера.  

7. Разверните образ на конечных компьютерах.  

## <a name="workgroup-computers"></a><a name="BKMK_ClientWorkgroup"></a> Компьютеры в рабочих группах

Configuration Manager поддерживает установку клиентов на компьютерах в рабочих группах. Установите клиент на компьютерах рабочей группы, используя способ, указанный в разделе [Установка клиентов Configuration Manager вручную](#BKMK_Manual).  

### <a name="prerequisites"></a>Предварительные условия  

- Установите клиент вручную на каждом компьютере в рабочей группе. Во время установки текущий пользователь должен иметь права локального администратора.  

- Чтобы получить доступ к ресурсам в домене сервера сайта Configuration Manager, настройте для этого сайта учетную запись доступа к сети. Укажите эту учетную запись в компоненте сайта распространения программного обеспечения. Дополнительные сведения см. в разделе [Компоненты сайта](../../servers/deploy/configure/site-components.md).  

### <a name="limitations"></a>Ограничения  

- Клиенты рабочей группы не могут получить точки управления из доменных служб Active Directory. Вместо этого они используют DNS, WINS или другую точку управления.  

- Глобальный роуминг не поддерживается. Клиенты рабочей группы не могут запрашивать доменные службы Active Directory для сведений о сайте.  

- Методы обнаружения Active Directory не могут обнаруживать компьютеры в рабочих группах.  

- Невозможно развертывать программное обеспечение для пользователей компьютеров, входящих в состав рабочей группы.  

- Невозможно использовать принудительную установку клиентов на компьютерах, входящих в состав рабочей группы.  

- Клиенты в рабочих группах не смогут использовать проверку подлинности Kerberos и могут нуждаться в утверждении вручную.  

- Невозможно настроить клиент рабочей группы в качестве точки распространения. Configuration Manager требует, чтобы компьютеры точек распространения были членами домена.  

### <a name="install-the-client-on-workgroup-computers"></a>Установка клиента на компьютеры в составе рабочей группы  

Проверьте необходимые условия, а затем следуйте указаниям в разделе [Установка вручную](#BKMK_Manual).  

#### <a name="workgroup-example-1"></a>Установка в рабочей группе. Пример 1

В этом примере команда выполняет следующие действия:

- Устанавливает клиент для управления клиентами в интрасети
- Указывает код сайта
- Указывает DNS-суффикс для поиска точки управления  

`CCMSetup.exe SMSSITECODE=ABC DNSSUFFIX=constoso.com`  

#### <a name="workgroup-example-2"></a>Установка в рабочей группе. Пример 2

В этом примере сетевое расположение клиента должно быть настроено в группе границ. Если не выполнить это требование, автоматическое назначение сайта не работает. Команда включает резервную точку состояния на сервере FSPSERVER. Это свойство позволяет отслеживать развертывание клиентов, а также выявлять проблемы связи с клиентами.

`CCMSetup.exe FSP=fspserver.constoso.com`  

## <a name="internet-based-client-management"></a><a name="BKMK_ClientInternet"></a> Управление клиентами через Интернет  

> [!NOTE]  
> Этот раздел неприменим к клиентам, использующим [шлюз управления облачными клиентами](../manage/cmg/plan-cloud-management-gateway.md). Сведения об установке интернет-клиентов с использованием шлюза управления облачными клиентами см. в статье [Установка и назначение клиентов Configuration Manager для Windows 10 с проверкой подлинности при помощи Azure AD](deploy-clients-cmg-azure.md).  

Если сайт Configuration Manager поддерживает [управление клиентами в Интернете](../manage/plan-internet-based-client-management.md) для клиентов, которые иногда находятся в интрасети, а иногда — в Интернете, можно использовать два варианта действий при установке клиентов в интрасети:  

- Включить свойство `CCMHOSTNAME=<internet FQDN of the internet-based management point>` Client.msi при установке клиента, например с помощью ручной или принудительной установки. При использовании этого метода назначьте сайт клиенту напрямую. Нельзя использовать автоматическое назначения сайта. Пример этого способа настройки приводится в разделе [Установка клиентов Configuration Manager вручную](#BKMK_Manual).  

- Установить клиент для управления клиентами в интрасети и затем назначить клиенту точку управления клиентами в Интернете. Измените точку управления с помощью свойств клиента на странице **Configuration Manager** в панели управления или с помощью сценария. При использовании этого метода вы можете использовать автоматическое назначение клиента. Дополнительные сведения см. в разделе [Настройка клиентов для управления клиентами через Интернете после установки клиента](#BKMK_ConfigureIBCM_MP).  

Для установки клиентов в Интернете выберите один из поддерживаемых методов.  

- Предоставьте для этих клиентов механизм временного подключения к интрасети с помощью VPN. Затем установите клиент с помощью любого подходящего метода установки.  

- Используйте метод установки, который не зависит от Configuration Manager. Например, упакуйте исходные файлы установки клиента на съемный носитель и передайте его пользователям. Исходные файлы для установки клиентов находятся в папке `<installation path>\Client` на сервере сайта Configuration Manager. Добавьте сценарий на носитель, чтобы вручную скопировать папку клиента. Из этой папки установите клиент, используя CCMSetup.exe и все соответствующие свойства командной строки CCMSetup.  

> [!NOTE]  
> Configuration Manager не поддерживает установку клиентов напрямую из интернет-точки управления или из интернет-точки обновления программного обеспечения.

Клиенты, управление которыми осуществляется через Интернет, должны взаимодействовать системами сайта в Интернете. Перед установкой эти клиенты также должны иметь сертификаты инфраструктуры открытых ключей (PKI). Установите эти сертификаты независимо от Configuration Manager. Дополнительные сведения см. в разделе [Требования к PKI-сертификатам](../../plan-design/network/pki-certificate-requirements.md).  

### <a name="install-clients-on-the-internet-by-specifying-ccmsetup-command-line-properties"></a>Установка клиентов в Интернете с помощью свойств командной строки CCMSetup  

1. Следуйте указаниям, приведенным в разделе [Установка клиентов Configuration Manager вручную](#BKMK_Manual). Всегда указывайте следующие параметры:  

    - Параметр командной строки CCMSetup `/source:<local path of the copied Client folder>`  

    - Параметр командной строки CCMSetup `/UsePKICert`  

    - Параметр Client.msi `CCMHOSTNAME=<FQDN of internet-based management point>`  

    - Параметр Client.msi `SMSSIGNCERT=<local path of exported site server signing certificate>`  

    - Параметр Client.msi `SMSSITECODE=<site code of internet-based management point>`  

    > [!NOTE]  
    > Если у сайта есть несколько интернет-точек управления, то не имеет значения, какая именно из них указана для свойства `CCMHOSTNAME`. Когда клиент Configuration Manager подключается к указанной точке управления в Интернете, она отправляет клиенту список доступных интернет-точек управления на сайте. Клиент случайным образом выбирает одну точку из списка.

2. Если не нужно, чтобы клиент проверял список отзыва сертификатов (CRL), укажите в командной строке CCMSetup параметр `/NoCRLCheck`.  

3. Если вы используете резервную точку состояния в Интернете, укажите параметр Client.msi `FSP=<internet FQDN of the internet-based fallback status point>`.  

4. При установке клиента для управления клиентами только через Интернет укажите параметр Client.msi `CCMALWAYSINF=1`.  

5. Определите, нужно ли указать какие-либо дополнительные параметры командной строки CCMSetup. Например, если на клиенте находится несколько допустимых PKI-сертификатов, может потребоваться указать условие выбора сертификата. Список доступных свойств см. в статье [Сведения о параметрах и свойствах установки клиента](about-client-installation-properties.md).  

#### <a name="internet-based-example"></a>Пример установки через Интернет

`CCMSetup.exe /source: D:\Clients /UsePKICert CCMHOSTNAME=server1.contoso.com SMSSIGNCERT=siteserver.cer SMSSITECODE=ABC FSP=server2.contoso.com CCMALWAYSINF=1 CCMFIRSTCERT=1`

В этом примере клиент устанавливается в следующем режиме:

- используются исходные файлы из папки на диске D;
- используется клиентский сертификат PKI;
- выбирается сертификат с самым длительным сроком действия;
- задается управление только через Интернет;
- для клиента назначается интернет-точка управления с именем SERVER1;
- для клиента назначается резервная точка состояния в Интернете в домене contoso.com;
- клиент назначается сайту ABC.  

### <a name="to-configure-clients-for-internet-based-client-management-after-client-installation"></a><a name="BKMK_ConfigureIBCM_MP"></a> Настройка клиентов для управления через Интернет после их установки  

Чтобы назначать точки управления в Интернете после установки клиентов, воспользуйтесь одной из следующих процедур. В первой процедуре требуется ручная настройка, поэтому она целесообразна для небольшого числа клиентов. Вторая процедура больше подходит для настройки большого числа клиентов.  

#### <a name="configure-clients-for-internet-based-client-management-after-client-installation-from-the-configuration-manager-control-panel"></a>Настройка клиентов для управления клиентами в Интернете после установки клиентов из панели управления Configuration Manager  

1. Откройте панель управления **Configuration Manager** на клиенте.  

2. На вкладке **Интернет** введите полное доменное имя (FQDN) точки управления в Интернете в поле **Полное доменное имя в Интернете**.  

    > [!NOTE]  
    > Вкладка **Интернет** доступна только в том случае, если клиент имеет клиентский PKI-сертификат.  

3. Если клиент будет обращаться к Интернету через прокси-сервер, введите параметры прокси-сервера.  

#### <a name="configure-clients-for-internet-based-client-management-after-client-installation-by-using-a-script"></a>Настройка клиентов для управления клиентами в Интернете после установки клиентов с помощью сценария  

##### <a name="powershell"></a>PowerShell

1. Откройте редактор строк PowerShell, например интегрированную среду сценариев PowerShell или Visual Studio Code. Вы можете также использовать любой текстовый редактор, такой как Блокнот.

2. Скопируйте и вставьте в редактор следующий код. Замените `'mp.contoso.com'` на полное доменное имя точки управления в Интернете.

    ``` PowerShell
    $newInternetBasedManagementPointFQDN = 'mp.contoso.com'
    $client = New-Object -ComObject Microsoft.SMS.Client
    $client.SetInternetManagementPointFQDN($newInternetBasedManagementPointFQDN)
    Restart-Service CcmExec
    $client.GetInternetManagementPointFQDN()
    ```

    > [!NOTE]  
    > Последняя строка нужна, только чтобы проверить новое значение точки управления в Интернете.
    >
    > Чтобы удалить указанную интернет-точку управления, удалите полное доменное имя сервера внутри кавычек. Строка примет следующий вид: `$newInternetBasedManagementPointFQDN = ''`.

3. Сохраните файл с расширением .ps1.  

4. Запустите сценарий с повышенными правами на клиентских компьютерах. Используйте один из следующих методов:  

    - Разверните файл на существующих клиентах Configuration Manager с помощью пакета и программы.  

    - Запустите файл локально на имеющихся клиентах Configuration Manager, дважды щелкнув его в проводнике.  

Может потребоваться перезапустить клиент, чтобы изменения вступили в силу.  

## <a name="provision-client-installation-properties"></a><a name="BKMK_Provision"></a> Настройка свойств установки клиента

Настройка свойств установки клиента для установки клиента в соответствии с групповой политикой и обновлением программного обеспечения. Используйте групповую политику Windows для распространения свойств установки клиентов Configuration Manager на компьютерах. Эти параметры хранятся в реестре компьютера. Клиент считывает их при установке. Как правило, эта процедура не требуется. Но она может потребоваться в некоторых сценариях установки клиентов, например в указанных ниже ситуациях:  

- Используются параметры групповой политики или методы установки клиента на основе обновлений программного обеспечения. Схема Active Directory не расширена для Configuration Manager.  

- Нужно переопределить свойства установки клиентов на определенных компьютерах.  

> [!NOTE]  
> Если в командной строке CCMSetup.exe указаны какие-либо свойства установки, то свойства, распространенные на компьютеры, не используются.

Административный шаблон групповой политики с именем `ConfigMgrInstallation.adm` поставляется на установочном носителе Configuration Manager. Используйте этот шаблон для распространения свойств установки на клиентские компьютеры.

> [!TIP]
> По умолчанию `ConfigMgrInstallation.adm` не поддерживает строки, длина которых превышает 255 символов. Такая конфигурация может повлиять на добавление нескольких параметров или параметров с длинными значениями, например CCMCERTISSUERS.<!-- SCCMDocs#1648 -->
>
> Чтобы решить эту проблему, выполните следующие действия:
>
> 1. Измените `ConfigMgrInstallation.adm` в блокноте.
> 2. Для свойства `VALUENAME SetupParameters` измените значение `MAXLEN` на более целое число. Например, `MAXLEN 511`.

### <a name="configure-and-assign-client-installation-properties-by-using-a-group-policy-object"></a>Настройка и назначение свойств установки клиентов с помощью объекта групповой политики  

1. Импортируйте административный шаблон ConfigMgrInstallation.adm в новый или имеющийся объект групповой политики (GPO) с помощью редактора, такого как редактор объектов групповой политики Windows. Этот файл находится в папке `TOOLS\ConfigMgrADMTemplates` на установочном носителе Configuration Manager.  

2. Открывает свойства импортированного параметра **Настройка параметров развертывания клиента**.  

3. Выберите **Включено**.  

4. В поле **CCMSetup** введите требуемые свойства командной строки CCMSetup. Список всех свойств командной строки CCMSetup и примеры их использования см. в статье [Сведения о параметрах и свойствах установки клиента](about-client-installation-properties.md).  

5. Назначьте GPO компьютерам, которые требуется настроить с использованием свойств установки клиента Configuration Manager.  
