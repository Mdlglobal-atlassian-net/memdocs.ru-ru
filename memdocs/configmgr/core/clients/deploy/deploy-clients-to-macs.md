---
title: Развертывание клиентов Mac
titleSuffix: Configuration Manager
description: Узнайте, как развертывать клиенты на компьютерах Mac в Configuration Manager.
ms.date: 12/10/2018
ms.prod: configuration-manager
ms.technology: configmgr-client
ms.topic: conceptual
ms.assetid: e46ad501-5d73-44ac-92de-0de14ef72b83
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: 8993f4c05b7156f3aecf6fcc9c8ea3790e49e98d
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81694032"
---
# <a name="how-to-deploy-clients-to-macs"></a>Развертывание клиентов на компьютерах Mac

*Область применения: Configuration Manager (Current Branch)*

В этой статье описывается развертывание и обслуживание клиента Configuration Manager на компьютерах Mac. Сведения о том, что нужно настроить перед развертыванием клиентов на компьютерах Mac, см. в разделе [Подготовка к развертыванию клиентского программного обеспечения на компьютерах Mac](prepare-to-deploy-mac-clients.md).

При установке нового клиента для компьютеров Mac необходимо также установить обновления Configuration Manager, чтобы вывести новые сведения о клиенте в консоли Configuration Manager.

В этих процедурах у вас есть два варианта установки сертификатов клиента. Дополнительные сведения о сертификатах клиента для Mac см. в разделе [Подготовка к развертыванию клиентского программного обеспечения на компьютерах Mac](prepare-to-deploy-mac-clients.md#certificate-requirements).  

- Регистрация в Configuration Manager с помощью [средства CMEnroll](#bkmk_enroll). Процесс регистрации не поддерживает автоматическое продление сертификата. Повторно зарегистрируйте компьютер Mac до истечения срока действия установленного сертификата.    

- [Использование метода запроса и установки сертификата, который не зависит от Configuration Manager](#bkmk_external).  

> [!IMPORTANT]  
> Для развертывания клиента на устройствах под управлением macOS Sierra необходимо правильно настроить **имя субъекта** в сертификате точки управления. (например, указав полное доменное имя сервера точки управления).



## <a name="configure-client-settings"></a>Настройка параметров клиента  

Чтобы настроить регистрацию для компьютеров Mac, используйте [параметры клиента по умолчанию](about-client-settings.md). Вы не можете использовать пользовательские параметры клиента. Чтобы запросить и установить сертификат, для клиента Configuration Manager для Mac требуются параметры клиента по умолчанию.  

1. В консоли Configuration Manager перейдите к рабочей области **Администрирование**. Выберите узел **Параметры клиента**, а затем выберите **Параметры клиента по умолчанию**.  

2. На вкладке ленты **Главная** в группе **Свойства** выберите **Свойства**.  

3. Выберите раздел **Регистрация**, а затем настройте следующие параметры:  

    1. **Разрешить пользователям регистрировать мобильные устройства и компьютеры Mac**: **Да**.  

    2. **Профиль регистрации**. Выберите **Задать профиль**.  

4. В диалоговом окне **Профиль регистрации мобильных устройств** нажмите кнопку **Создать**.  

5. В диалоговом окне **Создание профиля регистрации** введите имя этого профиля регистрации, а затем настройте **код сайта управления**. Выберите первичный сайт Configuration Manager, который содержит точки управления для этих компьютеров Mac.  

    > [!NOTE]  
    >  Если сайт выбрать не удается, настройте хотя бы одну точку управления на этом сайте для поддержки мобильных устройств.  

6. Нажмите кнопку **Добавить**.  

7. В окне **Добавление центра сертификации для мобильных устройств** выберите сервер центра сертификации, который выдает сертификаты компьютерам Mac.  

8. В диалоговом окне **Создание профиля регистрации** выберите шаблон сертификата для компьютера Mac, созданный ранее.  

9. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Профиль регистрации**, а затем — диалоговое окно **Параметры клиента по умолчанию**.  

    > [!TIP]  
    > Если требуется изменить интервал политики клиента, используйте параметр **Интервал опроса политики клиента** в группе параметров клиента **Политика клиента**.  

В следующий раз, когда устройства скачают клиентскую политику, Configuration Manager будет применять эти параметры для всех пользователей. Сведения об инициации получения политики для отдельного клиента см. в разделе [Инициация получения политик для клиента Configuration Manager](../manage/manage-clients.md#BKMK_PolicyRetrieval).  

Помимо параметров регистрации клиента, убедитесь в том, что настроены следующие параметры клиентских устройств:  

- **Инвентаризация оборудования**. Включите и настройте эту возможность, если планируется собирать данные инвентаризации оборудования с клиентских компьютеров Mac и Windows. Дополнительные сведения см. в статье [о расширении инвентаризации оборудования](../manage/inventory/extend-hardware-inventory.md).  

- **Параметры соответствия**. Включите и настройте эту возможность, если планируется оценивать и исправлять параметры на клиентских компьютерах Mac и Windows. Дополнительные сведения см. в статье [Планирование и настройка параметров соответствия](../../../compliance/plan-design/plan-for-and-configure-compliance-settings.md).  

Дополнительные сведения см. в разделе [Настройка параметров клиента](configure-client-settings.md).  



## <a name="download-the-client-for-macos"></a><a name="bkmk_download"></a> Скачивание клиента для macOS

1. Скачайте пакет файлов [клиента Microsoft Endpoint Configuration Manager для macOS (64-разрядная версия)](https://www.microsoft.com/download/details.aspx?id=100850). Сохраните файл **ConfigmgrMacClient.msi** на компьютере под управлением Windows. Этот файл отсутствует в установочном носителе Configuration Manager.  

2. Запустите установщик на компьютере Windows. Извлеките пакет клиента Mac, **Macclient.dmg**, в папку на локальном диске. Путь по умолчанию: `C:\Program Files\Microsoft\System Center Configuration Manager for Mac client`.  

3. Скопируйте файл **Macclient.dmg** в папку на компьютере Mac.  

4. На компьютере Mac запустите файл **Macclient.dmg**, чтобы извлечь его файлы в папку на локальном диске.  

5. Убедитесь, что папка содержит следующие файлы: 

    - **Ccmsetup**. Устанавливает клиент Configuration Manager на компьютерах Mac с помощью **CMClient.pkg**.  

    - **CMDiagnostics**. Собирает диагностические сведения, относящиеся к клиенту Configuration Manager, на компьютерах Mac.  

    - **CMUninstall**. Удаляет клиент с компьютеров Mac.  

    - **CMAppUtil**. Преобразует пакеты приложений Apple в формат, который может быть развернут как приложение Configuration Manager.  

    - **CMEnroll**. Запрашивает и устанавливает сертификат клиента на компьютере Mac, на котором затем можно будет установить клиент Configuration Manager.  



## <a name="enroll-the-mac-client"></a><a name="bkmk_enroll"></a> Регистрация клиента Mac  

Отдельные клиенты можно зарегистрировать с помощью [мастера регистрации компьютеров Mac](#enroll-the-client-with-the-mac-computer-enrollment-wizard).

Чтобы автоматизировать регистрацию для большого числа клиентов, используйте [средство CMEnroll](#client-and-certificate-automation-with-cmenroll).   


### <a name="enroll-the-client-with-the-mac-computer-enrollment-wizard"></a>Регистрация клиента с помощью мастера регистрации компьютеров Mac  

1. После установки клиента откроется мастер регистрации компьютеров. Чтобы вручную запустить мастер, на странице настроек **Configuration Manager** выберите **Регистрировать**.  

2. На второй странице мастера предоставьте приведенные ниже сведения.  

   - **Имя пользователя**. Имя пользователя может быть задано в следующих форматах:  

     - `domain\name`. Пример: `contoso\mnorth`  

     - `user@domain`. Пример: `mnorth@contoso.com`  

         > [!IMPORTANT]  
         >  Если для заполнения поля **Имя пользователя** используется адрес электронной почты, Configuration Manager автоматически заполняет поле **Имя сервера**. Используется имя по умолчанию сервера прокси-точки регистрации и доменное имя в адресе электронной почты. Если эти имена не соответствуют имени сервера прокси-точки регистрации, измените значение параметра **Имя сервера** во время регистрации.  

       Имя пользователя и пароль должны соответствовать учетной записи пользователя Active Directory, у которой есть разрешения на **чтение** и **регистрацию** в шаблоне сертификата клиента Mac.  

   - **Имя сервера**. Введите имя сервера прокси-точки регистрации.  


### <a name="client-and-certificate-automation-with-cmenroll"></a>Автоматизация операций с клиентом и сертификатами с помощью CMEnroll  

Эта процедура позволяет автоматизировать установку клиента и запрос регистрации сертификатов клиента с помощью средства CMEnroll. Для запуска средства требуется учетная запись пользователя Active Directory.

1. На компьютере Mac перейдите в папку, в которую было извлечено содержимое файла **Macclient.dmg**.  

2. Выполните следующую команду: `sudo ./ccmsetup`  

3. Подождите, пока не появится сообщение **Установка завершена** . Хотя установщик выводит сообщение о необходимости перезагрузки компьютера, не выполняйте перезагрузку, а перейдите к следующему действию.  

4. Из папки **Tools** на компьютере Mac введите следующую команду: `sudo ./CMEnroll -s <enrollment_proxy_server_name> -ignorecertchainvalidation -u '<user_name>'`.  

    После установки клиента откроется мастер регистрации компьютеров Mac, служащий для упрощения этой процедуры. Дополнительные сведения см. в разделе о [регистрации клиента с помощью мастера регистрации компьютеров Mac](#bkmk_enroll).  

     Пример: Если сервер прокси-точки регистрации называется **server02.contoso.com** и вы предоставляете разрешения **contoso\mnorth** для шаблона сертификата клиента Mac, введите следующую команду: `sudo ./CMEnroll -s server02.contoso.com -ignorecertchainvalidation -u 'contoso\mnorth'`.  

    > [!NOTE]  
    > Если имя пользователя содержит какой-либо из следующих символов, регистрация завершается с ошибкой: `<>"+=,`. Используйте сертификат аппаратного контроллера управления с именем пользователя, которое не содержит такие символы.  
    >  
    > Для обеспечения более удобного пользовательского взаимодействия можно создать скрипт, включающий действия и команды по установке. Затем пользователям достаточно только указать свое имя пользователя и пароль.  

5. Введите пароль для учетной записи пользователя Active Directory. При вводе этой команды выдается запрос на ввод двух паролей. Первый пароль — для учетной записи суперпользователя для выполнения команды. Второй запрос — для учетной записи пользователя Active Directory. Запросы выглядят одинаково, поэтому убедитесь в правильной последовательности ответов на них.  

6. Подождите, пока не появится сообщение **Регистрация выполнена успешно** .  

7. Чтобы ограничить зарегистрированный сертификат рамками Configuration Manager, на компьютере Mac откройте окно терминала и внесите указанные ниже изменения.  

    1. Введите команду `sudo /Applications/Utilities/Keychain Access.app/Contents/MacOS/Keychain Access`.  

    2. В окне **Доступ к цепочке ключей** в области **Цепочки ключей** щелкните **Система**. Затем в разделе **Категория** выберите **Ключи**.  

    3. Разверните ключи для просмотра сертификатов клиента. Найдите сертификат с закрытым ключом, который вы установили, и откройте ключ.  

    4. На вкладке **Управление доступом** выберите пункт **Подтвердить перед предоставлением доступа**.  

    5. Перейдите в папку **/Library/Application Support/Microsoft/CCM**, выберите файл **CCMClient** и нажмите кнопку **Добавить**.  

    6. Нажмите кнопку **Сохранить изменения** и закройте диалоговое окно **Доступ к цепочке ключей**.  

8. Перезапустите компьютер Mac.  

Убедитесь, что клиент успешно установлен, открыв элемент **Configuration Manager** в **системных настройках** на компьютере Mac. Нужно также обновить и просмотреть коллекцию **Все системы** в консоли Configuration Manager. Убедитесь, что компьютер Mac отображается в этой коллекции как управляемый клиент.  

> [!TIP]  
> Чтобы устранить неполадки с клиентом Mac, используйте средство **CMDiagnostics**, входящее в пакет клиента Mac. С его помощью можно собирать следующую диагностическую информацию:  
>   
> - Список запущенных процессов.  
> - Версия операционной системы Mac OS X  
> - Отчеты о сбоях Mac OS X, касающиеся клиента Configuration Manager, в том числе **CCM\*.crash** и **System Preference.crash**.  
> - BOM-файл и файл списка свойств (PLIST), созданные установкой клиента Configuration Manager.  
> - Содержимое папки **/Library/Application Support/Microsoft/CCM/Logs**.  
>   
> Сведения, собранные программой CmDiagnostics, добавляются в ZIP-файл, который сохраняется на рабочем столе компьютера с именем `cmdiag-<hostname>-<datetime>.zip`



## <a name="manage-certificates-external-to-configuration-manager"></a><a name="bkmk_external"></a> Сертификаты управления, внешние по отношению к Configuration Manager

Вы можете использовать метод запроса и установки сертификата, который не зависит от Configuration Manager. Используйте тот же общий процесс, но включите следующие дополнительные шаги: 

- При установке клиента Configuration Manager используйте параметры командной строки **MP** и **SubjectName**. Введите следующую команду: `sudo ./ccmsetup -MP <management point internet FQDN> -SubjectName <certificate subject name>`. Имя субъекта сертификата вводится с учетом регистра. Вводите его в точности так, как оно отображается в окне сведений сертификата.  

     Пример: Полное доменное имя точки управления в Интернете — **server03.contoso.com**. Сертификат клиента Mac имеет полное доменное имя **mac12.contoso.com** в качестве распространенного имени в субъекте сертификата. Используйте следующую команду: `sudo ./ccmsetup -MP server03.contoso.com -SubjectName mac12.contoso.com`.  

- Если у вас есть несколько сертификатов, содержащих одно и то же значение субъекта, укажите серийный номер сертификата для использования в клиенте Configuration Manager. Используйте следующую команду: `sudo defaults write com.microsoft.ccmclient SerialNumber -data "<serial number>"`.  

     Пример: `sudo defaults write com.microsoft.ccmclient SerialNumber -data "17D4391A00000003DB"`  



## <a name="renew-the-mac-client-certificate"></a>Продление сертификата клиента для Mac  

Эта процедура удаляет SMSID. Клиенту Configuration Manager для Mac требуется новый идентификатор для использования нового или продленного сертификата.  

> [!IMPORTANT]  
> После замены SMSID клиента удаление старого ресурса в консоли Configuration Manager также удаляет любой сохраненный журнал клиента. Например, журнал инвентаризации оборудования для этого клиента.  


1. Создайте и заполните коллекцию устройств для компьютеров Mac, на которых требуется обновить сертификаты компьютеров.  

2. В рабочей области **Активы и соответствие** выберите **Запуск мастера создания элементов конфигурации**.  

3. На странице **Общие** мастера укажите следующие данные.  

    - **Имя** — **Удалить SMSID для Mac**.  

    - **Тип** — **Mac OS X**  

4. На странице **Поддерживаемые платформы** выберите все версии Mac OS X.  

5. На странице **Параметры** выберите **Создать**. В диалоговом окне **Создание параметра** укажите следующие сведения:  

    - **Имя** — **Удалить SMSID для Mac**.  

    - **Тип параметра**. **Сценарий**  

    - **Тип данных**. **Строка**.  

6. В окне **Создание параметра** для параметра **Сценарий обнаружения** выберите **Добавить скрипт**. Это действие указывает сценарий для обнаружения компьютеров Mac, настроенных с помощью SMSID.  

7. В окне **Изменение сценария обнаружения** введите следующий сценарий оболочки:  

    ``` Shell
    defaults read com.microsoft.ccmclient SMSID  
    ```  

8. Нажмите кнопку **ОК**, чтобы закрыть окно **Изменение сценария обнаружения**.  

9. В окне **Создание параметра** для параметра **Сценарий исправления (необязательно)** выберите **Добавить скрипт**. Это действие указывает сценарий для удаления SMSID, обнаруженного на компьютерах Mac.  

10. В окне **Создание сценария исправления** введите следующий сценарий оболочки:  

    ``` Shell
    defaults delete com.microsoft.ccmclient SMSID  
    ```  

11. Нажмите кнопку **ОК**, чтобы закрыть окно **Создание сценария исправления**.  

12. На странице **Правила соответствия** выберите **Создать**. Затем в окне **Создать правило** укажите следующие сведения:  

    - **Имя** — **Удалить SMSID для Mac**.  

    - **Выбранный параметр**. Нажмите кнопку **Обзор** и выберите сценарий обнаружения, указанный ранее.  

    - В поле **следующих значений** введите: **домен/пара по умолчанию (com.microsoft.ccmclient, SMSID) не существует**.  

    - Включите параметр **Запустить следующий сценарий исправления, если этот параметр не соответствует требованиям**.  

13. Завершите работу мастера.  

14. Создайте конфигурационную базу, содержащую этот элемент конфигурации. Разверните базовую конфигурацию в целевой коллекции.  

     Дополнительные сведения см. в статье [Создание конфигурационных баз в System Center Configuration Manager](../../../compliance/deploy-use/create-configuration-baselines.md).  

15. После установки нового сертификата на компьютеры Mac с удаленным SMSID выполните следующую команду, чтобы настроить клиент для использования нового сертификата:  

    ``` Shell
    sudo defaults write com.microsoft.ccmclient SubjectName -string <subject_name_of_new_certificate>  
    ```  



## <a name="see-also"></a>См. также

[Подготовка к развертыванию клиентов на компьютерах Mac](prepare-to-deploy-mac-clients.md)

[Обслуживание клиентов Mac](../manage/maintain-mac-clients.md)
