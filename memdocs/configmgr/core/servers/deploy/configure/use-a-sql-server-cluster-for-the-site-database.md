---
title: Кластер SQL Server
titleSuffix: Configuration Manager
description: Размещение базы данных сайта Configuration Manager в кластере SQL Server
ms.date: 04/30/2020
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: d09a82c6-bbd1-49ca-8ffe-e3ce87b85d33
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: d035e6fbd776a03ce38a4cd0fc12755100b60c91
ms.sourcegitcommit: 2aa97d1b6409575d731c706faa2bc093c2b298c4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2020
ms.locfileid: "82643245"
---
# <a name="use-a-sql-server-cluster-for-the-site-database"></a>Использование кластера SQL Server для размещения базы данных сайта

*Область применения: Configuration Manager (Current Branch)*

Базу данных сайта Configuration Manager можно разместить в отказоустойчивом кластере SQL Server. Кластер обеспечивает отработку отказа и повышать надежность базы данных сайта. Но он не предоставляет дополнительных преимуществ с точки зрения обработки или балансировки нагрузки. Кроме того, отказоустойчивый кластер SQL Server использует общее хранилище и предоставляет единую точку отказа. Производительность может даже снизиться, так как сервер сайта должен найти активный узел кластера SQL Server до подключения к базе данных.  

> [!IMPORTANT]  
> Для успешной настройки кластеров SQL Server необходимо иметь четкое представление о данной процедуре и руководствоваться документацией и процедурами, приведенными в библиотеке документации по SQL Server.  


Перед установкой Configuration Manager подготовьте кластер SQL Server для включения поддержки Configuration Manager. Дополнительные сведения см. в разделе [Подготовка кластеризованного экземпляра SQL Server](#bkmk_prepare) далее в этой статье.

Во время выполнения установки Configuration Manager модуль записи службы теневого копирования Windows устанавливается на каждом узле физического компьютера кластера Microsoft Windows Server. Эта служба поддерживает задачу обслуживания **Резервное копирование сервера сайта**.  

После установки сайта Configuration Manager каждый час проверяет наличие изменений в узле кластера. Configuration Manager автоматически управляет всеми обнаруженными изменениями, влияющими на установку его компонентов. Это может быть отработка отказа узла или добавление нового узла в кластер SQL Server.  



## <a name="supported-options"></a>Поддерживаемые варианты

Следующие варианты поддерживаются для отказоустойчивых кластеров SQL Server, используемых в качестве базы данных сайта.

- Кластер с одним экземпляром  

- Несколько конфигураций экземпляров  

- Несколько активных узлов  

- Именованный экземпляр и экземпляр по умолчанию  



## <a name="prerequisites"></a>Предварительные условия

Обратите внимание на следующие необходимые условия.  

- База данных сайта должна находиться удаленно от сервера сайта. Сервер системы сайта нельзя разместить в кластере.  

    > [!Note]  
    > Начиная с версии 1810 процесс установки Configuration Manager более не блокирует установку роли сервера сайта на компьютере с ролью Windows для отказоустойчивой кластеризации. Ранее нельзя было размещать на сервере сайта базу данных сайта. Благодаря этому изменению вы можете создать сайт с высоким уровнем доступности и меньшим количеством серверов за счет использования кластера SQL и сервера сайта в пассивном режиме. Дополнительные сведения см. в статье [Способы обеспечения высокой доступности](high-availability-options.md). <!--3607761, fka 1359132-->  

- Добавьте учетную запись компьютера сервера сайта в локальную группу **Администраторы** на каждом сервере в кластере.  

- Для поддержки проверки подлинности Kerberos включите сетевой протокол связи **TCP/IP** для сетевого подключения каждого узла кластера SQL Server. Протокол **Именованные каналы** не требуется, но может использоваться для устранения проблем, связанных с проверкой подлинности Kerberos. Параметры сетевого протокола настраиваются в **SQL Server Configuration Manager** в разделе **Конфигурация сети SQL Server**.  

- Существуют особые требования к сертификатам при использовании кластера SQL Server для базы данных сайта. Дополнительные сведения см. в следующих статьях:
  - [Установка сертификата в конфигурации отказоустойчивого кластера SQL](https://docs.microsoft.com/sql/database-engine/configure-windows/manage-certificates?view=sql-server-ver15#provision-failover-cluster-cert)
  - [Требования к PKI-сертификатам для Configuration Manager](../../../plan-design/network/pki-certificate-requirements.md#BKMK_PKIcertificates_for_servers)

  > [!NOTE]
  > Если вы заранее не подготовите сертификат в SQL, Configuration Manager создаст и подготовит самозаверяющий сертификат для SQL.<!-- 7099499 -->

## <a name="limitations"></a>Ограничения

Необходимо учитывать следующие ограничения.  


### <a name="installation-and-configuration"></a>Установка и настройка

- Вторичные сайты не могут использовать кластер SQL Server.  

- При указании кластера SQL Server недоступна возможность задать нестандартное расположение файлов для базы данных сайта.  


### <a name="sms-provider"></a>Поставщик SMS

В кластере SQL Server нельзя установить экземпляр поставщика SMS. Это также нельзя сделать на компьютере, выполняющем роль кластеризованного узла SQL Server.  


### <a name="data-replication-options"></a>Варианты репликации данных

При использовании **распределенных представлений** базу данных сайта нельзя размещать в кластере SQL Server.  


### <a name="backup-and-recovery"></a>резервное копирование и восстановление

Configuration Manager не поддерживает резервное копирование с помощью Data Protection Manager (DPM) для кластера SQL Server, использующего именованный экземпляр. Он поддерживает резервное копирование DPM для кластера SQL Server, который использует экземпляр SQL Server по умолчанию.  



## <a name="prepare-a-clustered-sql-server-instance"></a><a name="bkmk_prepare"></a> Подготовка кластеризованного экземпляра SQL Server  

Чтобы завершить подготовку базы данных сайта, сделайте следующее:

- Создайте виртуальный кластер SQL Server для размещения базы данных сайта в существующей среде кластера Windows Server. Конкретные действия по установке и настройке кластера SQL Server см. в документации по своей версии SQL Server. Дополнительные сведения см. в статье [Создание нового отказоустойчивого кластера SQL Server (программа установки)](https://docs.microsoft.com/sql/sql-server/failover-clusters/install/create-a-new-sql-server-failover-cluster-setup?view=sql-server-2017).  

- На каждом компьютере в кластере SQL Server разместите файл в корневой папке каждого диска, на котором не требуется устанавливать компоненты сайта Configuration Manager. Задайте файлу имя `NO_SMS_ON_DRIVE.SMS`. По умолчанию Configuration Manager устанавливает некоторые компоненты на каждом физическом узле для поддержки таких операций, как резервное копирование.  

- Добавьте учетную запись компьютера сервера сайта в локальную группу **Администраторы** на каждом компьютере узла кластера Windows Server.  

- В виртуальном экземпляре SQL Server назначьте роль SQL Server **sysadmin** учетной записи пользователя, от имени которой запускается программа установки Configuration Manager.  


### <a name="to-install-a-new-site-using-a-clustered-sql-server"></a>Установка нового сайта с помощью кластеризованного экземпляра SQL Server  

Чтобы установить сайт, использующий кластерную базу данных сайта, запустите программу установки Configuration Manager и следуйте стандартной процедуре установки сайта, внеся в нее следующие коррективы.  

- На странице **Сведения о базе данных** укажите имя виртуального экземпляра кластера SQL Server, где будет размещаться база данных сайта. Виртуальный экземпляр заменяет имя компьютера, на котором выполняется SQL Server.  

    > [!IMPORTANT]  
    > При вводе имени виртуального экземпляра кластера SQL Server не указывайте имя виртуального экземпляра Windows Server, созданное кластером Windows Server. Если используется имя виртуального сервера Windows Server, база данных сайта устанавливается на локальный жесткий диск активного узла кластера Windows Server. Это препятствует успешной отработке отказа в случае сбоя данного узла.  
