---
title: Методы обнаружения
titleSuffix: Configuration Manager
description: Дополнительные сведения о доступных методах обнаружения для поиска устройств в вашей сети, из Active Directory или Azure Active Directory.
ms.date: 03/22/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: ed931751-18f2-4230-a09e-a0a329fbfa1c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 68e622d45de6575ec0f652f33934654cd1481dc2
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81705002"
---
# <a name="about-discovery-methods-for-configuration-manager"></a>Сведения о методах обнаружения для Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Методы обнаружения Configuration Manager позволяют находить различные устройства в вашей сети, пользователей и устройства из Active Directory и пользователей из Azure Active Directory (Azure AD). Для эффективного использования метода обнаружения необходимо понимать его конфигурации и ограничения.  



##  <a name="active-directory-forest-discovery"></a><a name="bkmk_aboutForest"></a> Обнаружение в лесах Active Directory  
 **Возможность настройки**: Да  

 **Включено по умолчанию**: Нет  

 **Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения лесов Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

В отличие от других методов обнаружения Active Directory, метод обнаружения в лесах Active Directory не используется для поиска ресурсов, которыми можно управлять. Вместо этого этот метод находит сетевые расположения, которые настроены в Active Directory. Он может преобразовать эти расположения в границы для использования в вашей иерархии.  

Этот метод выполняет поиск в локальном лесу Active Directory, каждом доверенном лесу и в каждом дополнительном лесу, настроенном в узле **Леса Active Directory** консоли Configuration Manager.  

Метод обнаружения в лесах Active Directory используется для решения следующих задач:  

-   Обнаружение сайтов и подсетей Active Directory с последующим созданием границ Configuration Manager на основе этих сетевых расположений.  

-   Определите суперсети, назначенные сайту Active Directory. Преобразуйте каждую суперсеть в границу диапазона IP-адресов.  

-   Выполните публикацию в доменных службах Active Directory (AD DS) в лесу, если публикация в этот лес разрешена. У указанной учетной записи леса Active Directory должны быть разрешения для этого леса.  

Вы можете управлять обнаружением в лесах Active Directory в консоли Configuration Manager. Перейдите в рабочую область **Администрирование** и разверните узел **Конфигурация иерархии**.   

-   **Методы обнаружения**: включите обнаружение в лесах Active Directory на сайте верхнего уровня в иерархии. Вы также можете указать простое расписание для запуска обнаружения. Настройте автоматическое создание границ из найденных IP-подсетей и сайтов Active Directory для этого обнаружения. Метод обнаружения в лесах Active Directory нельзя запускать на дочернем первичном сайте или на вторичном сайте.  

-   **Леса Active Directory**: настройте дополнительные леса, которые требуется обнаружить, укажите учетные записи для всех лесов Active Directory и настройте публикацию для каждого леса. Отслеживайте процесс обнаружения. Добавьте IP-подсети и сайты Active Directory в качестве границ Configuration Manager и членов групп границ.  

Чтобы настроить публикацию для лесов Active Directory в каждом сайте иерархии, подключите консоль Configuration Manager к сайту верхнего уровня иерархии. На вкладке **Публикация** в диалоговом окне **Свойства** сайта Active Directory отображается только текущий сайт и его подчиненные сайты. Если для леса включена публикация и схема этого леса расширена для Configuration Manager, то для каждого публикуемого сайта в этом лесу Active Directory публикуются следующие данные:  

-    **SMS-Site-&lt;код сайта>**

-   **SMS-MP-&lt;код сайта>-&lt;имя сервера системы сайта>**  

-   **SMS-SLP-&lt;код сайта>-&lt;имя сервера системы сайта>**  

-   **SMS-&lt;код сайта>-&lt;имя сайта Active Directory или подсети>**  

> [!NOTE]  
>  Для публикации в Active Directory вторичные сайты всегда используют учетную запись компьютера сервера вторичного сайта. Чтобы вторичные сайты выполняли публикацию в Active Directory, учетная запись компьютера сервера вторичного сайта должна иметь разрешения на публикацию в Active Directory. Вторичный сайт не может публиковать данные в лесу, не имеющем доверия.  

> [!CAUTION]  
>  При отключении параметра публикации сайта в лесу Active Directory все ранее опубликованные сведения для этого сайта, включая доступные роли систем сайта, удаляются из Active Directory.  

Действия метода обнаружения в лесах Active Directory записываются в следующие журналы.  

-   Сведения обо всех действиях, за исключением действий, связанных с публикацией, записываются в файл **ADForestDisc.Log** в папке **&lt;путь_установки>\Logs** на сервере сайта.  

-   Действия публикации, выполняемые при обнаружении в лесах Active Directory, записываются в файлы **hman.log** и **sitecomp.log** в папке **&lt;путь_установки>\Logs** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigADForestDisc).  



##  <a name="active-directory-group-discovery"></a><a name="bkmk_aboutGroup"></a> Обнаружение групп Active Directory  
**Возможность настройки**: Да  

**Включено по умолчанию**: Нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения групп Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Используйте этот метод для выполнения поиска в доменных службах Active Directory следующих компонентов:  

-   локальные, глобальные и универсальные группы безопасности;  

-   членство в группах;  

-   ограниченные сведения о входящих в группу компьютерах и пользователях, даже если эти компьютеры и пользователи не были ранее обнаружены с помощью другого метода обнаружения.  

Этот метод обнаружения предназначен для поиска групп и отношений групп для членов групп. По умолчанию обнаруживаются только группы безопасности. Чтобы обнаруживать членство в группах распространения, в диалоговом окне **Свойства метода обнаружения групп Active Directory** на вкладке **Вариант** необходимо установить флажок **Обнаруживать членство в группах распространения**.  

Обнаружение групп Active Directory не поддерживает расширенные атрибуты Active Directory, которые можно идентифицировать с помощью обнаружения систем Active Directory или обнаружения пользователей Active Directory. Поскольку этот метод обнаружения не оптимизирован для обнаружения ресурсов компьютеров и пользователей, его рекомендуется запускать после выполнения обнаружения систем Active Directory и обнаружения пользователей Active Directory. Причина состоит в том, что этот метод создает полную запись данных обнаружения для групп и ограниченную запись для компьютеров и пользователей, входящих в группы.  

Можно настроить следующие области обнаружения, определяющие то, каким образом этот метод обнаружения выполняет поиск данных.  

-   **Расположение** — используется при поиске в одном или нескольких контейнеров Active Directory. Этот параметр области поддерживает рекурсивный поиск указанных контейнеров Active Directory. В ходе поиска обрабатываются все дочерние контейнеры для указанного вами контейнера. Поиск продолжается до тех пор, пока не будут обнаружены все дочерние контейнеры.  

-   **Группы**. Используются при поиске одной или нескольких конкретных групп Active Directory. **Домен Active Directory** можно настроить для использования домена и леса по умолчанию или ограничить поиск отдельным контроллером домена. Кроме того, можно указать одну или несколько групп для поиска. Если не будет указана хотя бы одна группа, будет выполняться поиск всех групп в указанном расположении **Домен Active Directory** .  

> [!CAUTION]  
>  При настройке области обнаружения выберите только те группы, которые необходимо обнаружить. Это нужно сделать, так как в ходе обнаружения групп Active Directory осуществляется попытка поиска каждого участника в каждой группе в области обнаружения. Поиск больших групп может быть связан с использованием значительного количества ресурсов сети и Active Directory.  

> [!NOTE]  
>  Перед созданием коллекций на основе расширенных атрибутов Active Directory и для обеспечения точных результатов обнаружения для компьютеров и пользователей необходимо выполнить обнаружение систем Active Directory или пользователей Active Directory в зависимости от необходимых вам данных.  

Действия метода обнаружения групп Active Directory записываются в файл **adsgdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigADDiscGeneral).  



##  <a name="active-directory-system-discovery"></a><a name="bkmk_aboutSystem"></a> Обнаружение систем Active Directory  
**Возможность настройки**: Да  

**Включено по умолчанию**: Нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения систем Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Этот метод обнаружения применяется для поиска ресурсов компьютеров, которые можно использовать для создания коллекций и запросов, в указанных расположениях доменных служб Active Directory. Кроме того, можно установить клиент Configuration Manager на обнаруженном устройстве с помощью принудительной установки клиента.  

По умолчанию этот метод находит основные сведения о компьютере, включая следующие атрибуты:  

-   Имя компьютера  

-   Название и версия операционной системы  

-   Имя контейнера Active Directory  

-   IP-адрес  

-   Сайт Active Directory  

-   Метка времени последнего входа в систему  

Для успешного создания записи данных обнаружения для компьютера метод обнаружения систем Active Directory должен определить учетную запись компьютера и затем успешно разрешить имя компьютера в IP-адрес.  

На вкладке **Атрибуты Active Directory** в диалоговом окне **Свойства обнаружения систем Active Directory** можно просмотреть полный список атрибутов объектов по умолчанию, обнаружение которых производится. Кроме того, можно настроить метод обнаружения дополнительных (расширенных) атрибутов.  

Действия метода обнаружения систем Active Directory записываются в файл **adsysdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigADDiscGeneral).  



##  <a name="active-directory-user-discovery"></a><a name="bkmk_aboutUser"></a> Обнаружение пользователей Active Directory  
**Возможность настройки**: Да  

**Включено по умолчанию**: Нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения пользователей Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Этот метод обнаружения используется для поиска учетных записей пользователей и связанных с ними атрибутов в доменных службах Active Directory. По умолчанию этот метод обнаружения находит основные сведения об учетной записи пользователя, включая следующие атрибуты:  

-   Имя пользователя  

-   Уникальное имя пользователя (включает имя домена)  

-   Домен  

-   Имена контейнеров Active Directory  

На вкладке **Атрибуты Active Directory** в диалоговом окне **Свойства обнаружения пользователей Active Directory** можно просмотреть полный список атрибутов объектов по умолчанию, обнаружение которых производится. Кроме того, можно настроить метод обнаружения дополнительных (расширенных) атрибутов.

Действия метода обнаружения пользователей Active Directory записываются в файл **adusrdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigADDiscGeneral).  



## <a name="azure-active-directory-user-discovery"></a><a name="azureaddisc"></a> Обнаружение пользователя Azure Active Directory

Используйте обнаружение пользователей Active Directory Azure (Azure AD) для поиска подписки Azure AD для пользователей с современными облачными удостоверениями. Обнаружение пользователей Azure AD позволяет найти следующие атрибуты:

- objectId
- displayName
- почта
- mailNickname
- onPremisesSecurityIdentifier
- userPrincipalName
- AAD tenantID
- onPremisesDomainName
- onPremisesSamAccountName
- onPremisesDistinguishedName

Этот метод поддерживает полную и разностную синхронизацию атрибутов пользователей из Azure AD. Эти сведения можно затем использовать вместе с данными обнаружения, которые собираются с помощью других методов обнаружения.

Действия обнаружения пользователей Azure AD записываются в файл **SMS_AZUREAD_DISCOVERY_AGENT.log** на сервере сайта верхнего уровня иерархии.

Чтобы настроить обнаружение пользователей Azure AD, обратитесь к статье [Настройка служб Azure](azure-services-wizard.md) (служба "Управление облачными клиентами"). Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения для System Center Configuration Manager](configure-discovery-methods.md#azureaadisc).

## <a name="azure-active-directory-user-group-discovery"></a><a name="bkmk_azuregroupdisco"></a> Обнаружение групп пользователей Azure Active Directory
<!--3611956-->
*(Введена в качестве [функции предварительного выпуска](../../manage/pre-release-features.md), начиная с версии 1906)*

Вы можете обнаруживать группы пользователей и членов этих групп из Azure Active Directory (Azure AD). Обнаружение группы пользователей Azure AD позволяет найти следующие атрибуты:

- objectId
- displayName
- mailNickname
- onPremisesSecurityIdentifier
- AAD tenantID

Действия обнаружения группы пользователей Azure AD записываются в файл **SMS_AZUREAD_DISCOVERY_AGENT.log** на сервере сайта верхнего уровня иерархии. Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения для Configuration Manager](configure-discovery-methods.md#bkmk_azuregroupdisco).

##  <a name="heartbeat-discovery"></a><a name="bkmk_aboutHeartbeat"></a> Heartbeat-обнаружение  
**Возможность настройки**: Да  

**Включено по умолчанию**: Да  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись** компьютера сервера сайта  

Heartbeat-обнаружение отличается от других методов обнаружения Configuration Manager. Оно включено по умолчанию и работает на каждом компьютере-клиенте (а не на сервере сайта), обеспечивая создание записи данных обнаружения. Для клиентов, представляющих собой мобильные устройства, такая запись создается точкой управления, которую использует данный клиент. Чтобы не сбивать ведение записей о клиентах Configuration Manager в базе данных, не отключайте Heartbeat-обнаружение. Наряду с сохранением записи в базе данных этот метод позволяет принудительно обнаружить компьютер в качестве новой записи ресурса. Он также может повторно заполнить запись базы данных для компьютера, который был удален из базы данных.  

Heartbeat-обнаружение выполняется по расписанию, установленному для всех клиентов в иерархии. По умолчанию Heartbeat-обнаружение выполняется каждые семь дней. При изменении интервала Heartbeat-обнаружения убедитесь, что оно запускается чаще, чем задача обслуживания сайта **Удалить устаревшие данные обнаружения**. Эта задача удаляет записи неактивных клиентов из базы данных сайта. Задача **Удаление устаревших данных обнаружения** может быть настроена только для первичных сайтов. 

Вы также можете вручную запустить Heartbeat-обнаружение на определенном клиенте. Запустите **Цикл сбора обнаруживаемых данных** на вкладке **Действие** панели управления клиента Configuration Manager.  

В процессе Heartbeat-обнаружения создается запись данных обнаружения, содержащая текущие сведения о клиенте, включая указанные ниже. Клиент затем копирует этот небольшой файл (примерно 1 КБ) в точку управления для последующей обработки первичным сайтом. Файл содержит следующие сведения:  

-   Сетевое расположение  

-   имя NetBIOS;  

-   Версия агента клиента  

-   Сведения об оперативном состоянии  

Heartbeat-обнаружение — это единственный метод, позволяющий получить данные о состоянии установки клиента. Это достигается путем присвоения клиентскому атрибуту системного ресурса значения **Да**.  

> [!NOTE]  
>  Даже когда Heartbeat-обнаружение отключено, для активных мобильных клиентов записи обнаружения данных по-прежнему создаются и передаются в базу данных. Такое поведение гарантирует, что задача **Удаление устаревших данных обнаружения** не затронет активные мобильные устройства. Когда при выполнении задачи **Удаление устаревших данных обнаружения** из базы данных удаляется запись о мобильном устройстве, при этом также отзывается сертификат устройства. Это действие блокирует подключение мобильного устройства к точкам управления.  

Действия Heartbeat-обнаружения регистрируются в следующих расположениях:  

-   для клиентов-компьютеров — в файле **InventoryAgent.log** в папке *%Windir%\CCM\Logs*;  

-   для клиентов-мобильных устройств — в файле **DMPRP.log** в папке *%Program Files%\CCM\Logs* точки управления, которую использует клиент.  

Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigHBDisc).  



##  <a name="network-discovery"></a><a name="bkmk_aboutNetwork"></a> Обнаружение сети  
**Возможность настройки**: Да  

**Включено по умолчанию**: Нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись** компьютера сервера сайта  

Этот метод используется для обнаружения топологии сети и устройств в сети, которым назначен IP-адрес. Обнаружение сетевых ресурсов выполняет поиск в сети ресурсов с IP-адресами путем опроса следующих объектов: 
- Серверы, на которых запущена реализация DHCP корпорации Майкрософт
- Кэши протокола ARP в сетевых маршрутизаторах
- Устройства с поддержкой SNMP.
- Домены Active Directory  

Чтобы использовать обнаружение сетевых ресурсов, необходимо задать требуемый *уровень* обнаружения. Можно также настроить один или несколько механизмов обнаружения, позволяющих запрашивать сетевые сегменты или устройства в ходе обнаружения сетевых ресурсов. Кроме того, можно задать параметры, управляющие действиями по обнаружению в сети. Наконец, есть возможность задать одно или несколько расписаний, по которым будет выполняться обнаружение сетевых ресурсов.  

Для успешного обнаружения сетевого ресурса с помощью этого метода необходимо, чтобы был определен IP-адрес и маска подсети ресурса. Используются следующие методы определения маски подсети объекта.  

-   **Кэш ARP маршрутизатора**. Сетевое обнаружение запрашивает в кэше ARP маршрутизатора сведения о подсети. Как правило, данные в кэше ARP маршрутизатора имеют небольшой срок хранения. Таким образом, когда служба сетевого обнаружения запрашивает кэш ARP, последний уже может не содержать сведения о рассматриваемом объекте.  

-   **DHCP** Служба сетевого обнаружения запрашивает каждый указанный DHCP-сервер на предмет обнаружения устройств, которым была предоставлена аренда канала со стороны DHCP-сервера. Обнаружение сетевых ресурсов поддерживает только DHCP-серверы, на которых работает реализация DHCP, принадлежащая корпорации Майкрософт.  

-   **Устройство SNMP**. Служба сетевого обнаружения может напрямую запрашивать устройство SNMP. Для запроса устройства службой сетевого обнаружения необходимо, чтобы на устройстве был установлен локальный SNMP-агент. Также настройте имя сообщества, которое использует агент SNMP, в обнаружении сетевых ресурсов.  

Когда в ходе обнаружения выявляется объект с IP-адресом, для которого удается определить маску подсети, для этого объекта создается запись данных обнаружения. Поскольку к сети могут подключаться устройства различных типов, обнаружение сетевых ресурсов позволяет выявлять ресурсы, которые не поддерживают клиент Configuration Manager. Примерами устройств, которые допускают обнаружение, но не управление, являются принтеры и маршрутизаторы.  

В ходе обнаружения сетевых ресурсов может возвращаться ряд атрибутов, которые входят в состав создаваемой записи данных обнаружения. Эти атрибуты включают:  

-   имя NetBIOS;  

-   IP-адреса  

-   Домен ресурса  

-   Системные роли  

-   Имя сообщества SNMP  

-   MAC-адреса  

Действие по обнаружению сетевых ресурсов регистрируется в файле **Netdisc.log** в папке *&lt;путь_установки\>\Logs* на сервере сайта, который выполняет обнаружение.  

 Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения](configure-discovery-methods.md#BKMK_ConfigNetworkDisc).  

> [!NOTE]  
>  Сложная топология сетей и низкая пропускная способность каналов связи может привести к тому, что обнаружение сетевых ресурсов будет выполняться медленно и создаст большой объем трафика. Рекомендуется запускать обнаружение сетевых ресурсов только в том случае, когда не удается найти нужные ресурсы с помощью других методов обнаружения. Например, использовать обнаружение сетевых ресурсов следует, если требуется обнаружить компьютеры рабочей группы. Другие методы не позволяют обнаруживать такие компьютеры.  

###  <a name="levels-of-network-discovery"></a><a name="BKMK_NetDiscLevels"></a> Уровни обнаружения сетевых ресурсов  
При настройке обнаружения сетевых ресурсов задается один из трех уровней обнаружения:  

|Уровень обнаружения|Сведения|  
|------------------------|-------------|  
|Топология|На этом уровне обнаруживаются маршрутизаторы и подсети, но не определяется маска подсети объектов.|  
|Топология и клиент|Помимо топологии, на этом уровне обнаруживаются потенциальные клиенты (например, компьютеры) и ресурсы (например, принтеры и маршрутизаторы). На данном уровне обнаружения предпринимается попытка определить маску подсети найденных объектов.|  
|Топология, клиент и операционная система клиента|Помимо топологии и потенциальных клиентов, на этом уровне предпринимается попытка определить название и версию операционной системы компьютера. На данном уровне вызываются API браузера и сетевой поддержки Windows.|  

 Чем выше уровень, тем больше выполняется действий и тем интенсивнее используется пропускная способность сети в процессе обнаружения сетевых ресурсов. Следует учесть потенциальный объем генерируемого сетевого трафика, прежде чем включать все возможности сетевого обнаружения.  

 Например, если обнаружение сетевых ресурсов используется впервые, можно начать с уровня топологии и определить сетевую инфраструктуру. После этого перенастройте обнаружение сетевых ресурсов для поиска объектов и определения операционных систем, установленных на соответствующих устройствах. Можно также настроить параметры, ограничивающие обнаружение сетевых ресурсов конкретным диапазоном сетевых сегментов. Так вы сможете обнаружить объекты в необходимых сетевых расположениях и избежать излишнего сетевого трафика. Это также позволяет обнаружить объекты с пограничных маршрутизаторов из-за пределов вашей сети.  

###  <a name="network-discovery-options"></a><a name="BKMK_NetDiscOptions"></a> Параметры обнаружения сетевых ресурсов  
Чтобы включить поиск адресуемых по протоколу IP устройств при обнаружении сетевых ресурсов, настройте один или несколько из этих параметров.  

> [!NOTE]  
>  Обнаружение сетевых ресурсов выполняется в контексте учетной записи компьютера того сервера сайта, который выполняет обнаружение. Если учетная запись компьютера не имеет разрешений на доступ в ненадежный домен, ресурсы могут не обнаруживаться из-за конфигурации как самого домена, так и DHCP-сервера.  

#### <a name="dhcp"></a>DHCP  

Укажите каждый DHCP-сервер, к которому следует делать запросы при обнаружении сетевых ресурсов. (Обнаружение сетевых ресурсов поддерживает только DHCP-серверы, на которых работает реализация DHCP, принадлежащая корпорации Майкрософт.)  

-   Считывание информации при обнаружении сетевых ресурсов производится из базы данных на DHCP-сервере путем удаленных вызовов процедур (RPC).  

-   Обнаружение сетевых ресурсов предусматривает возможность запрашивать у 32- и 64-разрядных DHCP-серверов список устройств, зарегистрированных на каждом сервере.  

-   Для успешного запроса к DHCP-серверу при обнаружении сетевых ресурсов необходимо, чтобы учетная запись компьютера того сервера, который выполняет обнаружение, входила в группу "Пользователи DHCP" на DHCP-сервере. Например, такой уровень доступа имеет место, когда выполнено одно из следующих условий:  

    -   указанный DHCP-сервер выполняет функцию DHCP-сервера для того сервера, который выполняет обнаружение;  

    -   компьютер, выполняющий обнаружение, и DHCP-сервер располагаются в одном домене;  

    -   между компьютером, выполняющим обнаружение, и DHCP-сервером существует двустороннее доверие;  

    -   сервер сайта входит в группу "Пользователи DHCP".  

-   В процессе опроса DHCP-сервера статические IP-адреса обнаруживаются не всегда. В частности, обнаружение сетевых ресурсов не позволяет находить IP-адреса, входящие в исключенный диапазон адресов на DHCP-сервере. Оно также не позволяет находить IP-адреса, зарезервированные для назначения вручную.  

#### <a name="domains"></a>Домены  

Укажите каждый домен, в котором следует делать запросы при обнаружении сетевых ресурсов.  

-   Учетная запись компьютера сервера сайта, выполняющего обнаружение, должна иметь доступ на чтение к контроллерам каждого из указанных доменов.  

-   Для обнаружения компьютеров из локального домена необходимо включить службу "Обозреватель компьютеров" хотя бы на одном компьютере. Этот компьютер должен находиться в той же подсети, что и сервер сайта, выполняющий обнаружение сетевых ресурсов.  

-   Обнаружение сетевых ресурсов позволяет находить любой компьютер, который можно видеть с сервера сайта при обзоре сети.  

-   При обнаружении сетевых ресурсов определяется IP-адрес устройства. Затем с помощью ICMP-запросов проверяется связь с каждым найденным устройством. Команда **ping** помогает определить, какие компьютеры активные в настоящий момент.  

#### <a name="snmp-devices"></a>SNMP-устройства  

Укажите каждое SNMP-устройство, к которому следует делать запросы при обнаружении сетевых ресурсов.  

-   В ходе обнаружения сетевых ресурсов с каждого SNMP-устройства, ответившего на запрос, считывается значение ipNetToMediaTable. Это значение представляет собой массивы IP-адресов клиентских компьютеров или других ресурсов, таких как принтеры, маршрутизаторы или другие устройства, поддерживающие IP-адресацию.  

-   Чтобы сделать запрос к устройству, необходимо указать его IP-адрес или NetBIOS-имя.  

-   Настройте использование имени сообщества, присвоенного устройству, для обнаружения сетевых ресурсов — в противном случае устройство отклонит SNMP-запрос.  


###  <a name="limiting-network-discovery"></a><a name="BKMK_LimitNetDisc"></a> Ограничение обнаружения сетевых ресурсов  
При запросе к SNMP-устройству на периметре сети в ходе обнаружения сетевых ресурсов может возвращаться информация о подсетях и SNMP-устройствах, находящихся за пределами данной сети. Воспользуйтесь следующими сведениями для ограничения обнаружения сетевых ресурсов, указав SNMP-устройства, с которыми разрешено взаимодействие, а также сегменты сети, в которых следует делать запросы.  

#### <a name="subnets"></a>Подсети  

Укажите подсети, к которым будут делаться запросы при обнаружении сетевых ресурсов в вариантах с использованием SNMP-устройств и DHCP-серверов. В этих двух вариантах поиск будет производиться только в указанных подсетях.  

Например, в ответ на DHCP-запрос могут возвращаться сведения об устройствах, расположенных по всей сети. Если требуется обнаруживать устройства только в конкретной подсети, укажите и включите эту подсеть на вкладке **Подсети** диалогового окна **Свойства обнаружения сети**. Указывая и разрешая определенные подсети, вы ограничиваете будущие задачи обнаружения с использованием DHCP-серверов и SNMP-устройств этими подсетями.  

> [!NOTE]  
>  Указанные подсети не ограничивают круг объектов, которые обнаруживаются при запросах к **доменам**.  

#### <a name="snmp-community-names"></a>Имена SNMP-сообществ  

Для успешной отправки запроса к SNMP-устройству необходимо настроить имя сообщества для этого устройства в обнаружении сетевых ресурсов. Если для обнаружения сетевых ресурсов не указано имя сообщества, присвоенное SNMP-устройству, устройство будет отклонять соответствующие запросы.  

#### <a name="maximum-hops"></a>Максимальное число прыжков  

При указании максимального числа прыжков маршрутизатора ограничивается количество сетевых сегментов и маршрутизаторов, к которым могут делаться запросы при использовании SNMP.  

Указанное число прыжков ограничивает количество дополнительных устройств и сетевых сегментов, к которым могут выполняться запросы в ходе обнаружения сетевых ресурсов.  

Например, если настроить только обнаружение топологии и задать число прыжков, равное **0** (нулю), обнаруживаться будет только подсеть, в которой располагается исходный сервер, включая все маршрутизаторы в этой подсети.  

На приведенной ниже схеме показано, что будет найдено в результате запроса обнаружения сетевых ресурсов, настроенного только для определения топологии и выполняющегося на сервере 1 с максимальным числом прыжков 0: это подсеть D и маршрутизатор 1.  

 ![Обнаружение с маршрутизатором без прыжков](media/Disc-0.gif)  

 На приведенной ниже схеме показано, что будет найдено при обнаружении сетевых ресурсов, настроенном для определения топологии и поиска клиентов, если запрос выполняется на сервере 1 с максимальным числом прыжков 0: это подсеть D, маршрутизатор 1 и все потенциальные клиенты в подсети D.  

 ![Обнаружение с маршрутизатором с одним прыжком](media/Disc-1.gif)  

 Чтобы лучше представить себе, как увеличение максимального числа прыжков может увеличить количество обнаруживаемых сетевых ресурсов, рассмотрим следующую сеть:  

 ![Обнаружение с маршрутизатором с двумя прыжками](media/Disc-2.gif)  

 При запуске обнаружения сетевых ресурсов только для топологии с сервера 1 за один проход маршрутизатора были обнаружены следующие объекты:  

-   Маршрутизатор 1 и подсеть 10.1.10.0 (найдено с нулевым количеством прыжков)  

-   Подсети 10.1.20.0 и 10.1.30.0, подсеть A и маршрутизатор 2 (найдено при первом прыжке)  

> [!WARNING]  
>  Каждое увеличение количества прыжков маршрутизатора может значительно увеличить число обнаруживаемых ресурсов и увеличить полосу пропускания сети, используемую функцией сетевого обнаружения.  



##  <a name="server-discovery"></a><a name="bkmk_aboutServer"></a> Обнаружение серверов  
**Возможность настройки**: Нет  

Помимо перечисленных выше методов обнаружения, настраиваемых пользователем, Configuration Manager использует процесс так называемого **обнаружения серверов** (SMS_WINNT_SERVER_DISCOVERY_AGENT). В этом методе создаются записи о ресурсах для всех компьютеров, представляющих собой системы сайта, например для компьютера, который настроен в качестве точки управления.  



##  <a name="common-features-of-active-directory-group-discovery-system-discovery-and-user-discovery"></a><a name="bkmk_shared"></a> Общие возможности методов обнаружения групп, систем и пользователей Active Directory  
В этом разделе содержатся сведения о функциях, которые являются общими для следующих методов обнаружения:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

-   Обнаружение пользователей Active Directory  

> [!NOTE]  
>  Сведения в этом разделе не применяются к методу обнаружения в лесах Active Directory.  

Эти три метода обнаружения схожи в настройке и работе. Они позволяют обнаруживать компьютеры и пользователей, а также получать сведения о членстве в группах для ресурсов, хранящихся в доменных службах Active Directory. Процессом обнаружения управляет агент обнаружения. Агент запускается на сервере сайта на каждом сайте, на котором должно выполняться обнаружение. Каждый из этих методов обнаружения можно настроить для поиска в одном или нескольких местоположениях Active Directory как экземплярах местоположений в локальном лесу или удаленных лесах.  

Когда в ходе обнаружения ведется поиск ресурсов в ненадежном лесу, агент обнаружения должен быть в состоянии разрешать следующие имена:  

-   Чтобы найти ресурс компьютера при обнаружении систем Active Directory, агент обнаружения должен быть способен разрешить полное доменное имя ресурса. Если разрешить полное доменное имя не удается, агент предпринимает попытку разрешить ресурс по имени NetBIOS.  

-   Чтобы найти пользователей и группы как ресурсы при обнаружении пользователей или групп Active Directory, агент обнаружения должен быть способен разрешить полное доменное имя контроллера домена для данного расположения Active Directory.  

Для каждого заданного расположения можно указать собственные параметры поиска, такие как рекурсивный поиск в дочерних контейнерах Active Directory данного расположения. Можно также указать уникальную учетную запись, которая будет использоваться для поиска в этом расположении. Эта учетная запись обеспечивает гибкость, так как позволяет настроить определенный метод обнаружения на одном сайте для поиска в нескольких расположениях Active Directory, принадлежащих множеству лесов. Вам не требуется создавать единую учетную запись, у которой есть разрешения на доступ ко всем расположениям.  

Когда обнаружение по каждому из трех этих методов выполняется на конкретном сайте, сервер данного сайта Configuration Manager обращается к ближайшему контроллеру домена в указанном лесу Active Directory для поиска ресурсов Active Directory. Домен и лес могут находиться в любом поддерживаемом режиме Active Directory. Учетная запись, назначаемая каждому экземпляру расположения, должна иметь разрешение **Чтение** для доступа к указанным расположениям Active Directory.

При обнаружении ведется поиск объектов в заданных расположениях, а затем предпринимается попытка собрать информацию об этих объектах. Если удается получить достаточно данных о ресурсе, создается запись обнаружения данных (DDR). Перечень необходимых данных зависит от используемого метода обнаружения.  

Если один и тот же метод обнаружения настраивается для выполнения на разных сайтах Configuration Manager с целью отправки запросов локальным серверам Active Directory, каждый сайт можно настроить для использования уникального набора вариантов обнаружения. Поскольку данные обнаружения являются общими для всех сайтов в иерархии, для эффективного однократного обнаружения каждого ресурса необходимо исключить перекрытие конфигураций.

В небольших средах попробуйте запускать каждый метод обнаружения только на одном сайте в иерархии. Такая конфигурация снижает административную нагрузку и вероятность повторного обнаружения одних и тех же ресурсов несколькими действиями обнаружения. Уменьшение числа сайтов, на которых выполняется обнаружение, может привести к сокращению общей пропускной способности, которая используется при обнаружении. Кроме того, может снизиться общее число создаваемых записей обнаружения данных, которые должны быть обработаны серверами сайта.  

Многие конфигурации методов обнаружения являются интуитивно понятными. Следующие разделы содержат дополнительные сведения о вариантах обнаружения, о которых, возможно, потребуется получить больше информации перед настройкой.  

Следующие возможности доступны для использования с несколькими методами обнаружения Active Directory:  

-   [Обнаружение изменений](#bkmk_delta)  

-   [Фильтрация устаревших записей о компьютерах по времени входа в домен](#bkmk_stalelogon)  

-   [Фильтрация устаревших записей по паролю компьютера](#bkmk_stalepassword)  

-   [Поиск настраиваемых атрибутов Active Directory](#bkmk_customAD)  


###  <a name="delta-discovery"></a><a name="bkmk_delta"></a> Обнаружение изменений  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

-   Обнаружение пользователей Active Directory  

Обнаружение изменений является не независимым методом обнаружения, а режимом, доступным для соответствующих методов обнаружения. Обнаружение изменений выполняет поиск изменений конкретных атрибутов Active Directory, внесенных с момента последнего полного цикла обнаружения применимого метода обнаружения. Изменения атрибутов передаются в базу данных Configuration Manager для изменения записи ресурса обнаружения.  

По умолчанию цикл обнаружения изменений длится пять минут. Он выполняется гораздо чаще, чем типичный полный цикл обнаружения. Такая частота выполнения возможна, поскольку обнаружение изменений использует меньше ресурсов сервера сайта и сети, чем полный цикл обнаружения. Если используется обнаружение изменений, можно реже выполнять полный цикл обнаружения для соответствующего метода.  

Вот наиболее распространенные виды изменений, которые могут выявляться в режиме обнаружения изменений:  

-   новых компьютеров или пользователей, добавленные в Active Directory;  

-   изменение основных сведений о компьютерах и пользователей;  

-   новые компьютеры или пользователи, добавленные в группу;  

-   компьютеры или пользователи, удаленные из группы.  

-   Изменения в объектах системных групп  

Хотя обнаружение изменений позволяет выявлять новые ресурсы и изменение членства в группах, оно не позволяет обнаруживать удаление ресурса из Active Directory. Записи данных обнаружения, создаваемые при обнаружении изменений, обрабатываются аналогично записям, созданным в результате полного цикла обнаружения.  

Обнаружение изменений настраивается на вкладке **Расписание опроса** в свойствах для каждого метода обнаружения.  


###  <a name="filter-stale-computer-records-by-domain-logon"></a><a name="bkmk_stalelogon"></a> Фильтрация устаревших записей о компьютерах по времени входа в домен  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

Функцию обнаружения можно настроить для исключения устаревших записей компьютеров. Это исключение определяется на основе последнего входа в домен на компьютере. Если этот параметр включен, метод обнаружения систем Active Directory выполняет оценку каждого обнаруженного компьютера. Метод обнаружения групп Active Directory оценивает каждый компьютер, входящий в обнаруженную им группу.  

Для использования этой возможности:  

-   Компьютеры должны быть настроены для изменения атрибута **lastLogonTimeStamp** в доменных службах Active Directory.  

-   Необходимо задать режим работы домена Active Directory не ниже Windows Server 2003.  

При настройке времени с момента последнего входа, которое будет использоваться для этого параметра, рекомендуется ввести интервал для репликации между контроллерами домена.  

Фильтрация настраивается на вкладке **Вариант** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения групп Active Directory**. Установите параметр **Обнаруживать только те компьютеры, которые подключались к домену в течение указанного периода времени**.  

> [!WARNING]  
>  Если настроить этот фильтр и установить параметр **Фильтрация устаревших записей по паролю компьютера**, из обнаружения будут исключены компьютеры, которые соответствуют условиям любого фильтра.  


###  <a name="filter-stale-records-by-computer-password"></a><a name="bkmk_stalepassword"></a> Фильтрация устаревших записей по паролю компьютера  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

Функцию обнаружения можно настроить для исключения устаревших записей компьютеров. Это исключение определяется на основе последнего обновления пароля учетной записи на компьютере. Если этот параметр включен, метод обнаружения систем Active Directory выполняет оценку каждого обнаруженного компьютера. Метод обнаружения групп Active Directory оценивает каждый компьютер, входящий в обнаруженную им группу.  

Для использования этой возможности:  

-   Компьютеры должны быть настроены для изменения атрибута **pwdLastSet** в доменных службах Active Directory.  

При настройке этого параметра рекомендуется учитывать интервал обновления этого атрибута. Также учитывайте интервал репликации между контроллерами домена.  

Фильтрация настраивается на вкладке **Вариант** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения групп Active Directory**. Установите параметр **Обнаруживать только те компьютеры, для которых в течение указанного периода времени изменялся пароль учетной записи компьютера**.  

> [!WARNING]  
>  Если настроить этот фильтр и установить параметр **Фильтрация устаревших записей по времени входа в домен**, из обнаружения будут исключены компьютеры, которые соответствуют условиям любого фильтра.  


###  <a name="search-customized-active-directory-attributes"></a><a name="bkmk_customAD"></a> Поиск настраиваемых атрибутов Active Directory  
 Доступно для:  

-   Обнаружение систем Active Directory  

-   Обнаружение пользователей Active Directory  

Каждый метод обнаружения поддерживает уникальный список атрибутов Active Directory, которые можно обнаружить.  

Просмотреть и настроить список настраиваемых атрибутов можно на вкладке **Атрибуты Active Directory** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения пользователей Active Directory**.  
