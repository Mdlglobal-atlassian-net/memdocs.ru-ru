---
title: Настройка служб Azure
titleSuffix: Configuration Manager
description: Подключите среду Configuration Manager к службам Azure для управления облаком, а также для использования Microsoft Store для бизнеса и Log Analytics.
ms.date: 07/31/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: a26a653e-17aa-43eb-ab36-0e36c7d29f49
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 3a4dee8af68fec8c08cc58b02520f53e13adfbb3
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81704892"
---
# <a name="configure-azure-services-for-use-with-configuration-manager"></a>Настройка служб Azure для использования с Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Используйте **мастер служб Azure**, чтобы упростить настройку облачных служб Azure, используемых с Configuration Manager. Этот мастер предоставляет общие возможности по настройке с использованием регистрации веб-приложений Azure Active Directory (Azure AD). Эти приложения предоставляют сведения о подписке и конфигурации, а также выполняют проверку подлинности при взаимодействии с Azure AD. Приложение позволяет избежать повторного ввода необходимых сведений при каждой настройке нового компонента или службы Configuration Manager для работы с Azure.


## <a name="available-services"></a>Доступные службы

С помощью этого мастера можно настроить следующие службы Azure:  

- **Управление облаком**. Эта служба позволяет сайту и клиентам проходить проверку подлинности с использованием Azure AD. Эта проверка подлинности позволяет использовать другие сценарии, такие как:  

    - [Установка и назначение клиентов Configuration Manager для Windows 10 с проверкой подлинности при помощи Azure AD](../../../clients/deploy/deploy-clients-cmg-azure.md)  

    - [Настройка обнаружения пользователей Azure AD](configure-discovery-methods.md#azureaadisc)  

    - [Настройка обнаружения групп пользователей в Azure AD](configure-discovery-methods.md#bkmk_azuregroupdisco)

    - Поддержка некоторых [сценариев шлюза управления облаком](../../../clients/manage/cmg/plan-cloud-management-gateway.md#scenarios)  

    - [Уведомления по электронной почте об утверждении приложения](../../../../apps/deploy-use/app-approval.md#bkmk_email-approve)

- **Соединитель Log Analytics**. [Подключение к Azure Log Analytics](https://docs.microsoft.com/azure/azure-monitor/platform/collect-sccm). Синхронизация данных коллекции в Log Analytics.  

    > [!Note]  
    > В этой статье описан *соединитель Log Analytics*, который ранее назывался *соединителем OMS*. Они не отличаются по функциональным возможностям. Дополнительные сведения см. в статье [Общие сведения о службе Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/terminology#log-analytics).  

- **Microsoft Store для бизнеса**. Подключение к [Microsoft Store для бизнеса](../../../../apps/deploy-use/manage-apps-from-the-windows-store-for-business.md). Скачивание приложений магазина для вашей организации, которые можно развернуть с помощью Configuration Manager.  

### <a name="service-details"></a>Сведения о службах

В следующей таблице перечислены сведения о каждой из служб.  

- **Клиенты**: количество экземпляров службы, которые можно настроить. Каждый экземпляр должен представлять собой отдельный клиент Azure.  

- **Облака**: все службы поддерживают глобальное облако Azure, но не все службы поддерживают частные облака, например облако Azure для государственных организаций США.  

- **Веб-приложение**: использует ли служба приложение Azure AD типа *Веб-приложение или API*, которое также называется серверным приложением в Configuration Manager.  

- **Собственное приложение**: использует ли служба приложение Azure AD типа *Собственный*, которое также называется клиентским приложением в Configuration Manager.  

- **Действия**: можно ли импортировать или создавать эти приложения в мастере служб Azure Configuration Manager.  

|Служба  |Клиентов  |Облака  |Веб-приложение  |Собственное приложение  |Действия  |
|---------|---------|---------|---------|---------|---------|
|Управление облаком с помощью<br>обнаружения Azure AD | Несколько | Общедоступные, частные | ![Поддерживается](media/green_check.png) | ![Поддерживается](media/green_check.png) | Импорт, создание |
|Соединитель Log Analytics | Один | Общедоступные, частные | ![Поддерживается](media/green_check.png) | ![Не поддерживается](media/Red_X.png) | Импорт |
|Microsoft Store для<br>бизнеса | Один | Открытый | ![Поддерживается](media/green_check.png) | ![Не поддерживается](media/Red_X.png) | Импорт, создание |

### <a name="about-azure-ad-apps"></a>О приложениях Azure AD

Для различных служб Azure требуется настроить различные параметры. Это можно сделать на портале Azure. Кроме того, для приложений для каждой службы требуется настроить отдельные разрешения для ресурсов Azure.  

Одно приложение можно использовать для нескольких служб. В Configuration Manager и Azure AD есть только один управляемый объект. После истечения срока действия ключа безопасности в приложении, необходимо обновить один ключ.

При создании дополнительных служб Azure в мастере Configuration Manager может повторно использовать сведения, которые являются общими для различных служб. Это позволяет избежать многократного ввода одних и тех же сведений.

Дополнительные сведения о необходимых разрешениях приложений и конфигурациях для каждой службы см. в соответствующей статье Configuration Manager в разделе [Доступные службы](#available-services).

Дополнительные сведения приложениях Azure см. в следующих статьях:

- [Проверка подлинности и авторизация в службе приложений Azure](https://docs.microsoft.com/azure/app-service/app-service-authentication-overview)
- [Общие сведения о веб-приложениях](https://docs.microsoft.com/azure/app-service-web/app-service-web-overview)
- [Основные сведения о регистрации приложения в Azure AD](/azure/active-directory/develop/authentication-scenarios)  
- [Регистрация приложения в клиенте Azure Active Directory](https://docs.microsoft.com/azure/active-directory/active-directory-app-registration)


## <a name="before-you-begin"></a>Подготовка к работе

Выбрав службу, к которой вы хотите подключиться, обратитесь к таблице в разделе [Сведения о службах](#service-details). В этой таблице указаны сведения, необходимые для завершения работы мастера служб Azure. Проведите предварительное обсуждение с администратором Azure AD. Определите, какие из следующих действий следует выполнить:

- Создайте приложения вручную заранее на портале Azure. Затем импортируйте сведения о приложении в Configuration Manager.  

- Или создайте приложения напрямую в Azure AD с помощью Configuration Manager. Чтобы собрать необходимые данные из Azure AD, просмотрите сведения в других разделах этой статьи.  

Для использования некоторых служб приложения Azure AD должны иметь определенные разрешения. Чтобы определить необходимые разрешения, просмотрите сведения для каждой службе. Например, перед импортом веб-приложения администратор Azure сначала должен создать его в [портале Azure](https://portal.azure.com).

При настройке соединителя Log Analytics необходимо предоставить зарегистрированному веб-приложению разрешение *участника* для группы ресурсов, содержащей соответствующую рабочую область. Это разрешение позволяет Configuration Manager обращаться к этой рабочей области. При назначении разрешения нужно найти название зарегистрированного приложения в колонке **Добавление пользователей** на портале Azure. Эти действия аналогичны [предоставлению Configuration Manager разрешений для доступа к Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-sccm#grant-configuration-manager-with-permissions-to-log-analytics). Администратор Azure должен назначить эти разрешения перед импортом приложения в Configuration Manager.


## <a name="start-the-azure-services-wizard"></a>Запуск мастера служб Azure

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Облачные службы** и выберите узел **Службы Azure**.  

2. На вкладке **Главная** на ленте в группе **Службы Azure** щелкните **Настроить службы Azure**.  

3. На странице **Службы Azure** мастера служб Azure выполните следующие действия:  

    1. Укажите **Имя** объекта в Configuration Manager.  

    2. При желании укажите **Описание**, которое поможет идентифицировать службу.  

    3. Выберите службу Azure, к которой необходимо подключиться с помощью Configuration Manager.  

4. Нажмите кнопку **Далее**, чтобы перейти на страницу [Свойства приложения Azure](#azure-app-properties) мастера служб Azure.  


## <a name="azure-app-properties"></a>Свойства приложения Azure

На странице **Приложение** мастера служб Azure выберите **среду Azure** из списка. Среда, которая доступна для службы, указана в таблице [Сведения о службах](#service-details).

Остальная часть страницы "Приложение" зависит от конкретной службы. Тип приложения, используемого службой, и доступные действия указаны в таблице [Сведения о службах](#service-details).

- Если приложение поддерживает действия импорта и создания, нажмите кнопку **Обзор**. Откроется [диалоговое окно "Серверное приложение"](#server-app-dialog) или [диалоговое окно "Клиентское приложение"](#client-app-dialog).  

- Если приложение поддерживает только действие импорта, нажмите кнопку **Импорт**. Откроется [диалоговое окно "Импорт приложений" (сервер)](#import-apps-dialog-server) или [диалоговое окно "Импорт приложений" (клиент)](#import-apps-dialog-client).

Указав приложения на этой странице, нажмите кнопку **Продолжить**, чтобы перейти на страницу [Настройка или обнаружение](#configuration-or-discovery) мастера служб Azure.

### <a name="web-app"></a>Веб-приложение

Это приложение имеет тип *Веб-приложение или API* и также называется серверным приложением в Configuration Manager.

#### <a name="server-app-dialog"></a>Диалоговое окно "Серверное приложение"

При нажатии кнопки **Обзор** для **Веб-приложения** на странице "Приложение" мастера служб Azure открывается диалоговое окно "Серверное приложение". В этом окне отображается список следующих свойств для всех имеющихся веб-приложений:

- Понятное имя клиента
- Понятное имя приложения
- Тип службы

В диалоговом окне "Серверное приложение" можно выполнить три действия:

- Выберите существующее веб-приложение из списка, чтобы использовать его повторно.
- Нажмите кнопку **Импорт**, чтобы открыть [диалоговое окно "Импорт приложений"](#import-apps-dialog-server).
- Нажмите кнопку **Создать**, чтобы открыть [диалоговое окно "Создание серверного приложения"](#create-server-application-dialog).

После импорта или создания веб-приложения нажмите кнопку **ОК**, чтобы закрыть диалоговое окно "Серверное приложение". При этом вы возвращаетесь на [страницу "Приложение"](#azure-app-properties) мастера служб Azure.

#### <a name="import-apps-dialog-server"></a>Диалоговое окно "Импорт приложений" (сервер)

При нажатии кнопки **Импорт** в диалоговом окне "Серверное приложение" или на странице "Приложение" мастера служб Azure открывается диалоговое окно "Импорт". На этой странице можно указать сведения о веб-приложении Azure AD, которое уже создано на портале Azure. Метаданные этого веб-приложения импортируются в Configuration Manager. Укажите следующие сведения:

- **Имя клиента Azure AD**
- **Идентификатор клиента Azure AD**
- **Имя приложения**: понятное имя приложения.
- **Идентификатор клиента**
- **Секретный ключ**
- **Срок действия секретного ключа**: выберите будущую дату в календаре.
- **Универсальный код ресурса идентификатора приложения**: это значение должно быть уникальным в клиенте Azure AD. Это маркер доступа, который клиент Configuration Manager использует, чтобы запросить доступ к службе. По умолчанию это значение равно `https://ConfigMgrService`.  

Указав сведения, нажмите кнопку **Проверить**. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно "Импорт приложений". При этом вы возвращаетесь на [страницу "Приложение"](#azure-app-properties) мастера служб Azure или в [диалоговое окно "Серверное приложение"](#server-app-dialog).

#### <a name="create-server-application-dialog"></a>Диалоговое окно "Создание серверного приложения"

При нажатии кнопки **Создать** в диалоговом окне "Серверное приложение" открывается диалоговое окно "Создание серверного приложения". Эта страница позволяет автоматизировать создание веб-приложения в Azure AD. Укажите следующие сведения:

- **Имя приложения**: понятное имя приложения.
- **URL-адрес домашней страницы**: это значение не используется Configuration Manager, но необходимо для Azure AD. По умолчанию это значение равно `https://ConfigMgrService`.  
- **Универсальный код ресурса идентификатора приложения**: это значение должно быть уникальным в клиенте Azure AD. Это маркер доступа, который клиент Configuration Manager использует, чтобы запросить доступ к службе. По умолчанию это значение равно `https://ConfigMgrService`.  
- **Срок действия секретного ключа**: выберите **1 год** или **2 года** из раскрывающегося списка. По умолчанию используется срок действия 1 год.

Нажмите кнопку **Войти**, чтобы войти в Azure с правами администратора. Эти учетные данные не сохраняются в Configuration Manager. Этому пользователю не требуются разрешения в Configuration Manager, и эта учетная запись не обязана быть той же, от имени которой запускается мастер служб Azure. После успешной проверки подлинности в Azure **Имя клиента Azure AD** отображается на странице.

Нажмите кнопку **ОК**, чтобы создать веб-приложение в Azure AD и закрыть диалоговое окно "Создание серверного приложения". При этом вы возвращаетесь в [диалоговое окно "Серверное приложение"](#server-app-dialog).

> [!NOTE]
> Если вы определили политику условного доступа Azure AD, которая применима ко **всем облачным приложениям**, необходимо исключить созданное серверное приложение из этой политики. Дополнительные сведения о том, как исключить конкретные приложения, см. в разделе [Документация по политикам условного доступа в Azure AD](https://docs.microsoft.com/azure/active-directory/conditional-access/).

### <a name="native-client-app"></a>Собственное клиентское приложение

Это приложение имеет тип *Собственное приложение* и также называется клиентским приложением в Configuration Manager.

#### <a name="client-app-dialog"></a>Диалоговое окно "Клиентское приложение"

При нажатии кнопки **Обзор** для **Собственного клиентского приложения** на странице "Приложение" мастера служб Azure открывается диалоговое окно "Клиентское приложение". В этом окне отображается список следующих свойств для всех имеющихся собственных приложений:

- Понятное имя клиента
- Понятное имя приложения
- Тип службы

В диалоговом окне "Клиентское приложение" можно выполнить три действия:

- Выберите существующее собственное приложение из списка, чтобы использовать его повторно. 
- Нажмите кнопку **Импорт**, чтобы открыть [диалоговое окно "Импорт приложений"](#import-apps-dialog-client).
- Нажмите кнопку **Создать**, чтобы открыть [диалоговое окно "Создание клиентского приложения"](#create-client-application-dialog).

После импорта или создания собственного приложения нажмите кнопку **ОК**, чтобы закрыть диалоговое окно "Клиентское приложение". При этом вы возвращаетесь на [страницу "Приложение"](#azure-app-properties) мастера служб Azure.

#### <a name="import-apps-dialog-client"></a>Диалоговое окно "Импорт приложений" (клиент)

При нажатии кнопки **Импорт** в диалоговом окне "Клиентское приложение" открывается диалоговое окно "Импорт приложений". На этой странице можно указать сведения о собственном приложении Azure AD, которое уже создано на портале Azure. Метаданные этого собственного приложения импортируются в Configuration Manager. Укажите следующие сведения:

- **Имя приложения**: понятное имя приложения.
- **Идентификатор клиента**

Указав сведения, нажмите кнопку **Проверить**. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно "Импорт приложений". При этом вы возвращаетесь в [диалоговое окно "Клиентское приложение"](#client-app-dialog).

#### <a name="create-client-application-dialog"></a>Диалоговое окно "Создание клиентского приложения"

При нажатии кнопки **Создать** в диалоговом окне "Клиентское приложение" открывается диалоговое окно "Создание клиентского приложения". Эта страница позволяет автоматизировать создание собственного приложения в Azure AD. Укажите следующие сведения:

- **Имя приложения**: понятное имя приложения.
- **URL-адрес ответа**: это значение не используется Configuration Manager, но необходимо для Azure AD. По умолчанию это значение равно `https://ConfigMgrService`.

Нажмите кнопку **Войти**, чтобы войти в Azure с правами администратора. Эти учетные данные не сохраняются в Configuration Manager. Этому пользователю не требуются разрешения в Configuration Manager, и эта учетная запись не обязана быть той же, от имени которой запускается мастер служб Azure. После успешной проверки подлинности в Azure **Имя клиента Azure AD** отображается на странице.

Нажмите кнопку **ОК**, чтобы создать собственное приложение в Azure AD и закрыть диалоговое окно "Создание клиентского приложения". При этом вы возвращаетесь в [диалоговое окно "Клиентское приложение"](#client-app-dialog).

## <a name="configuration-or-discovery"></a>Настройка или обнаружение

После указания собственных приложений и веб-приложений на странице "Приложения" мастер служб Azure переходит на страницу **Настройка** или **Обнаружение** в зависимости от того, к какой службе вы подключаетесь. Сведения на этой странице зависят от службы. Дополнительные сведения см. в следующих статьях:  

- Служба **Управление облаком**, страница **Обнаружение**: [Настройка обнаружения пользователей Azure AD](configure-discovery-methods.md#azureaadisc)  

- Служба **Соединитель Log Analytics**, страница **Конфигурация**: [Настройка подключения к Log Analytics](https://docs.microsoft.com/azure/azure-monitor/platform/collect-sccm)  

- Служба **Microsoft Store для бизнеса**, страница **Конфигурация**: [Дополнительные сведения и конфигурации](../../../../apps/deploy-use/manage-apps-from-the-windows-store-for-business.md#bkmk_config)  

Наконец, завершите работу мастера служб Azure на страницах "Сводка", "Ход выполнения" и "Завершение". На этом настройка службы Azure в Configuration Manager завершена. Повторите эти действия для настройки других служб Azure.


## <a name="renew-secret-key"></a><a name="bkmk_renew"></a> Обновление ключа секрета

> [!Note]
> Чтобы обновить ключ секрета приложения Azure в версии 1802 и более ранних, необходимо заново создать приложение.

### <a name="renew-key-for-created-app"></a>Обновление ключа для созданного приложения

1. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Облачные службы** и выберите узел **Клиенты Azure Active Directory**.

1. На панели подробностей выберите клиент Azure AD для приложения.

1. На ленте выберите **Обновить ключ секрета**. Введите учетные данные владельца приложения или администратора Azure AD.

### <a name="renew-key-for-imported-app"></a>Обновление ключа для импортированного приложения

Если вы импортировали приложение Azure в Configuration Manager, для обновления используйте портал Azure. Обратите внимание на новый ключ секрета и дату окончания его срока действия. Добавьте эту информацию в мастер по **обновлению секретного ключа**.  

> [!Note]  
> Сохраните секретный ключ перед закрытием страницы **Ключ** свойств приложения Azure. Эта информация удаляется при закрытии страницы.


## <a name="view-the-configuration-of-an-azure-service"></a>Просмотр конфигурации службы Azure

Просмотрите свойства службы Azure, которые вы настроили. В консоли Configuration Manager перейдите в рабочую область **Администрирование**, разверните узел **Облачные службы** и выберите **Службы Azure**. Выберите службу, которую хотите просмотреть или изменить, и щелкните **Свойства**.

Если выбрать службу и нажать кнопку **Удалить** на ленте, соединение в Configuration Manager будет удалено. При этом приложение в Azure AD удалено не будет. Если приложение больше не требуется, попросите администратора Azure удалить его. Или запустите мастер службы Azure, чтобы импортировать приложение.<!--483440-->


## <a name="cloud-management-data-flow"></a>Поток данных управления облаком

На следующем рисунке показана общая схема потока данных для взаимодействия между Configuration Manager, Azure AD и подключенными облачными службами. В этом примере используется служба **Управление облаком**, которая включает клиент Windows 10, а также серверное и клиентское приложения. Потоки для других служб похожи на указанный.

![Схема потока данных для Configuration Manager с Azure AD и службой "Управление облаком"](media/aad-auth.png)

1. Администратор Configuration Manager импортирует или создает клиентские и серверные приложения в Azure AD.  

2. Запускается метод обнаружения пользователей Azure AD Configuration Manager. Сайт использует маркер серверного приложения Azure AD для отправки в Microsoft Graph запросов, связанных с объектами пользователей.  

3. Сайт сохраняет данные об объектах пользователей. Дополнительные сведения см. в статье [Обнаружение пользователей Azure AD](about-discovery-methods.md#azureaddisc).  

4. Клиент Configuration Manager запрашивает маркер пользователя Azure AD. Клиент формирует утверждение с использованием идентификатора клиентского приложения Azure AD и серверным приложением в качестве аудитории. Дополнительные сведения см. в разделе [Утверждения в маркерах безопасности Azure AD](/azure/active-directory/develop/authentication-scenarios#security-tokens).  

5. Чтобы пройти проверку подлинности для сайта, клиент предоставляет маркер Azure AD шлюзу управления облаком и локальной точке управления с поддержкой HTTPS.  
