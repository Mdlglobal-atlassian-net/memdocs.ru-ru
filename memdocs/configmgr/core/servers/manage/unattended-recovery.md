---
title: Автоматическое восстановление
titleSuffix: Configuration Manager
description: Используйте сценарий для восстановления сайтов в Configuration Manager.
ms.date: 07/30/2018
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 828c31d1-3d70-4412-b1a8-c92e7e504d39
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: a12de673776817330a80cb68588faf225922e241
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81704402"
---
# <a name="unattended-site-recovery-for-configuration-manager"></a>Автоматическое восстановление сайта для Configuration Manager   

*Область применения: Configuration Manager (Current Branch)*

 Для [автоматического восстановления](recover-sites.md#site-recovery-procedures) сайта центра администрирования или первичного сайта Configuration Manager можно создать сценарий автоматической установки и запустить программу установки в командной строке с параметром **/script**. Сценарий предоставляет такие же данные, которые запрашиваются мастером установки, однако в нем отсутствуют значения параметров по умолчанию. Необходимо указать все значения для ключей установки, применимых к используемому типу установки.

 Чтобы использовать параметр /script командной строки программы установки, необходимо создать файл инициализации. Затем вам потребуется указать имя этого файла после параметра /script. Имя файла может быть произвольным, но файл должен обязательно иметь расширение **.ini**. Ссылаясь на файл настройки установки в командной строке, необходимо указывать полный путь к этому файлу. Например, если файл настройки установки называется *setup.ini* и он хранится в *папке C:\setup*, командная строка будет выглядеть так:

 `setup /script c:\setup\setup.ini`

> [!IMPORTANT]  
>  Для запуска программы установки требуются права администратора. При запуске программы установки со сценарием автоматической установки откройте окно командной строки с правами администратора с помощью команды **Запуск от имени администратора**.

 Сценарий содержит имена разделов, имена ключей и значения. Имена необходимых ключей разделов могут различаться в зависимости от типа восстановления, для которого предназначается сценарий. Порядок следования ключей внутри разделов и порядок следования разделов внутри файла не имеет значения. В ключах не учитывается регистр. Значения ключей указываются так: после имени ключа должен стоять знак равенства (=), а затем — значение ключа.

 В следующих разделах содержатся сведения о создании сценария для автоматического восстановления сайта. В таблицах перечисляются доступные ключи сценариев установки, их значения, указывается, являются ли ключи обязательными и для какого типа установки они предназначены. Также приводится краткое описание каждого ключа.

## <a name="recover-a-central-administration-site-unattended"></a>Автоматическое восстановление сайта центра администрирования
 Чтобы настроить файл сценария автоматической установки для восстановления сайта центра администрирования, используйте приведенные ниже сведения.

 **Identification**

-   **Имя ключа:** Действие

    -   **Обязательное:** Да
    -   **Значения:** RecoverCCAR
    -   **Подробные сведения:** восстанавливает сайт центра администрирования


-   **Имя ключа:** CDLatest

    -   **Обязательное:** да (только при использовании носителя из папки CD.Latest)
    -   **Значения:** 1 (любые другие значения будут обозначать, что CD.Latest не используется)
    -   **Подробные сведения:** при запуске программы установки c носителя в папке CD.Latest сценарий должен содержать этот ключ и значение. Это необходимо как для установки первичного сайта и сайта центра администрирования, так и для восстановления этих сайтов. Это значение передает в программу установки сведения о том, что используется носитель из папки CD.Latest.

**RecoveryOptions**   
-   **Имя ключа:** ServerRecoveryOptions   

    -   **Обязательное:** Да
    -   **Значения:** 1, 2 или 4  
         1 = восстановить сервер сайта и сервер SQL Server.   
         2 = восстановить только сервер сайта.  
         4 = восстановить только сервер SQL Server.
    -   **Подробные сведения:** указывает, будет ли программа установки восстанавливать сервер сайта, SQL Server или оба сервера. Если параметру ServerRecoveryOptions задается указанное далее значение, потребуются связанные ключи.  
        -   **Значение 1** . Вы можете указать значение для ключа **SiteServerBackupLocation** , чтобы восстановить сайт с помощью резервной копии сайта. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.

             Ключ **BackupLocation** необходим при настройке значения **10** для ключа **DatabaseRecoveryOptions** , используемого для восстановления базы данных сайта из резервной копии.

        -   **Значение 2** . Вы можете указать значение для ключа **SiteServerBackupLocation** , чтобы восстановить сайт с помощью резервной копии сайта. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.

        -   **Значение = 4** Ключ **BackupLocation** необходим при настройке значения **10** для ключа **DatabaseRecoveryOptions** , используемого для восстановления базы данных сайта из резервной копии.

-   **Имя ключа:** DatabaseRecoveryOptions

    -   **Обязательное:** возможно
    -   **Значения:**   
         - **10** = восстановить базу данных сайта из резервной копии.  
         - **20** = использовать базу данных сайта, которая была восстановлена вручную с помощью другого метода.   
         - **40** = создать новую базу данных для сайта. Используйте этот параметр при отсутствии резервной копии базы данных сайта. Глобальные и сайтовые данные восстанавливаются с помощью репликации с других сайтов.  
         - **80** = пропустить восстановление базы данных.
    -   **Подробные сведения:** указывает, каким образом программа установки восстановит базу данных сайта на сервере SQL Server. Этот ключ необходим, если параметру **ServerRecoveryOptions** задано значение **1** или **4**.


-   **Имя ключа:** ReferenceSite  

    -   **Обязательное:** возможно
    -   **Значения:** &lt;ReferenceSiteFQDN\>
    -   **Подробные сведения:** указывает эталонный первичный сайт. Если резервная копия сайта базы данных старше срока хранения отслеживания изменений или если сайт восстанавливается без резервной копии, сайт центра администрирования использует эталонный сайт для восстановления глобальных данных.

         Если не определить эталонный сайт, а резервная копия старше срока хранения журнала отслеживания изменений, все первичные сайты повторно инициализируются с восстановленными данными с сайта центра администрирования.

         Если не определить эталонный сайт, а резервная копия находится в пределах срока хранения журнала отслеживания изменений, реплицируются только изменения первичных сайтов после резервного копирования. При наличии противоречивых изменений с разных первичных сайтов сайт центра администрирования использует первое полученное изменение.

         Этот параметр необходим, если параметру **DatabaseRecoveryOptions** задано значение **40**.

-   **Имя ключа:** SiteServerBackupLocation

    -   **Обязательное:** Нет
    -   **Значения:** &lt;PathToSiteServerBackupSet\>
    -   **Подробные сведения:** Указывает путь к резервной копии сервера сайта. Этот ключ не является обязательным, если для параметра **ServerRecoveryOptions** задано значение **1** или **2**. Укажите значение ключа **SiteServerBackupLocation** , чтобы восстановить сайт, используя его резервную копию. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.


-   **Имя ключа:** BackupLocation

    -   **Обязательное:** возможно
    -   **Значения:** &lt;PathToSiteDatabaseBackupSet\>
    -   **Подробные сведения:** указывает путь к резервной копии базы данных сайта. Ключ **BackupLocation** необходим, если задано значение **1** или **4** для ключа **ServerRecoveryOptions** , а также значение **10** для ключа **DatabaseRecoveryOptions** .


**Параметры**

- **Имя ключа:** ProductID
  -   **Обязательное:** Да
  -   **Значения:**   
       - xxxxx-xxxxx-xxxxx-xxxxx-xxxxx  
       - (ознакомительная)
  -   **Подробные сведения:** установочный ключ продукта Configuration Manager, включая тире. Введите **Eval**, чтобы установить ознакомительную версию Configuration Manager.  


- **Имя ключа:** SiteCode

  -   **Обязательное:** Да
  -   **Значения:** &lt;Site code\>
  -   **Подробные сведения:** трехзначный буквенно-цифровой код, который уникально идентифицирует сайт в иерархии. Укажите код сайта центра администрирования, используемый до сбоя.


- **Имя ключа:** SiteName

  -   **Обязательное:** Да
  -   **Значения:** SiteName
  -   **Подробные сведения:** описание сайта.


- **Имя ключа:** SMSInstallDir

  - **Обязательное:** Да
  - **Значения:** &lt;*ConfigMgrInstallationPath*>
  - **Подробные сведения:** указывает папку для установки файлов программы Configuration Manager.
    > [!NOTE]   
    >  Вы можете указать любой путь для установки Configuration Manager.

- **Имя ключа:** SDKServer

  -   **Обязательное:** Да
  -   **Значения:** &lt;*FQDN поставщика SMS*>
  -   **Подробные сведения:** полное доменное имя сервера, на котором будет размещен поставщик SMS. Укажите сервер, где поставщик SMS размещался до сбоя.

       Можно настроить дополнительные поставщики SMS для сайта после первоначальной установки.

- **Имя ключа:** PrerequisiteComp

  -   **Обязательное:** Да
  -   **Значения:** 0 или 1  
       0 = загрузить   
       1 = уже загружены
  -   **Подробные сведения:** указывает, загружены ли уже необходимые файлы для программы установки. Например, если установить значение "0", программа установки скачивает эти файлы.  


- **Имя ключа:** PrerequisitePath

  -   **Обязательное:** Да
  -   **Значения:** &lt;*PathToSetupPrerequisiteFiles*>
  -   **Подробные сведения:** указывает путь к необходимым файлам для программы установки. В зависимости от значения параметра **PrerequisiteComp** программа установки использует этот путь, чтобы сохранить загруженные файлы или найти ранее загруженные файлы.

- **Имя ключа:** AdminConsole

  -   **Обязательное:** возможно
  -   **Значения:** 0 или 1 0 = не устанавливать   
       1 = установить
  -   **Подробные сведения:** указывает, следует ли устанавливать консоль Configuration Manager. Этот параметр необходим, если параметру **ServerRecoveryOptions** задано значение **4**.


- **Имя ключа:** JoinCEIP   
  > [!Note]  
  > Начиная с Configuration Manager версии 1802 компонент CEIP будет удален из продукта.

  -   **Обязательное:** Да
  -   **Значения:** 0 или 1  
       0 = не принимать участие  
       1 = принять участие
  -   **Подробные сведения:** указывает, следует ли принимать участие в программе улучшения качества программного обеспечения.

**SQLConfigOptions**

-   **Имя ключа:** SQLServerName

    -   **Обязательное:** Да
    -   **Значения:** *&lt;SQLServerName\>*
    -   **Подробные сведения:** имя сервера или кластерного экземпляра, на котором запускается SQL Server, где размещена база данных сайта. Укажите тот же сервер, где база данных сайта размещалась до сбоя.


-   **Имя ключа:** DatabaseName

    -   **Обязательное:** Да
    -   **Значения:** *&lt;SiteDatabaseName\>* или *&lt;InstanceName\>* \\ *&lt;SiteDatabaseName\>*
    -   **Подробные сведения:** имя базы данных SQL Server, создаваемое или используемое для установки базы данных сайта центра администрирования. Укажите то же имя базы данных, что использовалось до сбоя.

        > [!IMPORTANT]  
        >  Необходимо указать имя экземпляра и имя базы данных сайта, если не используется экземпляр по умолчанию.

-   **Имя ключа:** SQLSSBPort

    -   **Обязательное:** Нет
    -   **Значения:** &lt;*SSBPortNumber*>
    -   **Подробные сведения:** укажите порт SQL Server Service Broker (SSB), используемый сервером SQL Server. Обычно для SSB используется TCP-порт 4022, но поддерживаются и другие порты. Укажите тот же номер порта SSB, который использовался до сбоя.

## <a name="recover-a-primary-site-unattended"></a>Автоматическая установка первичного сайта
 Чтобы настроить файл сценария автоматической установки для восстановления сайта центра администрирования, используйте приведенные ниже сведения.

 **Identification**

-   **Имя ключа:** Действие

    -   **Обязательное:** Да
    -   **Значения:** RecoverPrimarySite
    -   **Подробные сведения:** восстанавливает первичный сайт


-   **Имя ключа:** CDLatest

    -   **Обязательное:** да (только при использовании носителя из папки CD.Latest)
    -   **Значения:** 1 (любые другие значения будут обозначать, что CD.Latest не используется)
    -   **Подробные сведения:** при запуске программы установки c носителя в папке CD.Latest сценарий должен содержать этот ключ и значение. Это необходимо как для установки первичного сайта и сайта центра администрирования, так и для восстановления этих сайтов. Это значение передает в программу установки сведения о том, что используется носитель из папки CD.Latest.

**RecoveryOptions**

-   **Имя ключа:** ServerRecoveryOptions

    -   **Обязательное:** Да
    -   **Значения:** 1, 2 или 4    
         1 = восстановить сервер сайта и сервер SQL Server.   
         2 = восстановить только сервер сайта.  
         4 = восстановить только сервер SQL Server.
    -   **Подробные сведения:** указывает, будет ли программа установки восстанавливать сервер сайта, SQL Server или оба сервера. Если параметру ServerRecoveryOptions задается указанное далее значение, потребуются связанные ключи.

        -   **Значение 1** . Вы можете указать значение для ключа **SiteServerBackupLocation** , чтобы восстановить сайт с помощью резервной копии сайта. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.

             Ключ **BackupLocation** необходим при настройке значения **10** для ключа **DatabaseRecoveryOptions** , используемого для восстановления базы данных сайта из резервной копии.

        -   **Значение 2** . Вы можете указать значение для ключа **SiteServerBackupLocation** , чтобы восстановить сайт с помощью резервной копии сайта. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.

        -   **Значение = 4** Ключ **BackupLocation** необходим при настройке значения **10** для ключа **DatabaseRecoveryOptions** , используемого для восстановления базы данных сайта из резервной копии.

-   **Имя ключа:** DatabaseRecoveryOptions

    -   **Обязательное:** возможно
    -   **Значения:**   
         - **10** = восстановить базу данных сайта из резервной копии.  
         - **20** = использовать базу данных сайта, которая была восстановлена вручную с помощью другого метода.     
         - **40** = создать новую базу данных для сайта. Используйте этот параметр при отсутствии резервной копии базы данных сайта. Глобальные и сайтовые данные восстанавливаются с помощью репликации с других сайтов.  
         - **80** = пропустить восстановление базы данных.
    -   **Подробные сведения:** указывает, каким образом программа установки восстановит базу данных сайта на сервере SQL Server. Этот ключ необходим, если параметру **ServerRecoveryOptions** задано значение **1** или **4**.


-   **Имя ключа:** SiteServerBackupLocation

    -   **Обязательное:** Нет
    -   **Значения:** &lt;PathToSiteServerBackupSet\>
    -   **Подробные сведения:** Указывает путь к резервной копии сервера сайта. Этот ключ не является обязательным, если для параметра **ServerRecoveryOptions** задано значение **1** или **2**. Укажите значение ключа **SiteServerBackupLocation** , чтобы восстановить сайт, используя его резервную копию. Если не указать это значение, сайт будет переустановлен без восстановления из резервной копии.     


-   **Имя ключа:** BackupLocation

    -   **Обязательное:** возможно
    -   **Значения:** &lt;PathToSiteDatabaseBackupSet\>
    -   **Подробные сведения:** указывает путь к резервной копии базы данных сайта. Ключ **BackupLocation** необходим, если задано значение **1** или **4** для ключа **ServerRecoveryOptions** , а также значение **10** для ключа **DatabaseRecoveryOptions** .

**Параметры**

-   **Имя ключа:** ProductID

    -   **Обязательное:** Да
    -   **Значения:**     
         - xxxxx-xxxxx-xxxxx-xxxxx-xxxxx  
         - (ознакомительная)     
    -   **Подробные сведения:** установочный ключ продукта Configuration Manager, включая тире. Введите **Eval**, чтобы установить ознакомительную версию Configuration Manager.  


-   **Имя ключа:** SiteCode

    -   **Обязательное:** Да
    -   **Значения:** &lt;Site code\>
    -   **Подробные сведения:** трехзначный буквенно-цифровой код, который уникально идентифицирует сайт в иерархии. Укажите код сайта центра администрирования, используемый до сбоя.


-   **Имя ключа:** SiteName

    -   **Обязательное:** Да
    -   **Значения:** SiteName
    -   **Подробные сведения:** описание сайта.


-   **Имя ключа:** SMSInstallDir

    -   **Обязательное:** Да
    -   **Значения:** &lt;*ConfigMgrInstallationPath*>
    -   **Подробные сведения:** указывает папку для установки файлов программы Configuration Manager.

        > [!NOTE]   
        >  Вы можете указать любой путь для установки Configuration Manager.

-   **Имя ключа:** SDKServer

    -   **Обязательное:** Да
    -   **Значения:** &lt;*FQDN поставщика SMS*>
    -   **Подробные сведения:** полное доменное имя сервера, на котором будет размещен поставщик SMS. Укажите сервер, где поставщик SMS размещался до сбоя.

         Можно настроить дополнительные поставщики SMS для сайта после первоначальной установки.

-   **Имя ключа:** PrerequisiteComp

    -   **Обязательное:** Да
    -   **Значения:** 0 или 1    
         0 = загрузить   
         1 = уже загружены   
    -   **Подробные сведения:** указывает, загружены ли уже необходимые файлы для программы установки. Например, если установить значение "0", программа установки скачивает эти файлы.


-   **Имя ключа:** PrerequisitePath

    -   **Обязательное:** Да
    -   **Значения:** &lt;*PathToSetupPrerequisiteFiles*>
    -   **Подробные сведения:** указывает путь к необходимым файлам для программы установки. В зависимости от значения параметра **PrerequisiteComp** программа установки использует этот путь, чтобы сохранить загруженные файлы или найти ранее загруженные файлы.


-   **Имя ключа:** AdminConsole

    -   **Обязательное:** возможно
    -   **Значения:** 0 или 1  
         0 = не устанавливать   
         1 = установить  
    -   **Подробные сведения:** указывает, следует ли устанавливать консоль Configuration Manager. Этот параметр необходим, если параметру **ServerRecoveryOptions** задано значение **4**.

-   **Имя ключа:** JoinCEIP  
    > [!Note]  
    > Начиная с Configuration Manager версии 1802 компонент CEIP будет удален из продукта.

    -   **Обязательное:** Да
    -   **Значения:** 0 или 1    
         0 = не принимать участие  
         1 = принять участие
    -   **Подробные сведения:** указывает, следует ли принимать участие в программе улучшения качества программного обеспечения.


**SQLConfigOptions**

-   **Имя ключа:** SQLServerName

    -   **Обязательное:** Да
    -   **Значения:** *&lt;SQLServerName\>*
    -   **Подробные сведения:** имя сервера или кластерного экземпляра, на котором запускается SQL Server, где размещена база данных сайта. Укажите тот же сервер, где база данных сайта размещалась до сбоя.


-   **Имя ключа:** DatabaseName

    -   **Обязательное:** Да
    -   **Значения:** *&lt;SiteDatabaseName\>* или *&lt;InstanceName\>* \\ *&lt;SiteDatabaseName\>*
    -   **Подробные сведения:** имя базы данных SQL Server, создаваемое или используемое для установки базы данных сайта центра администрирования. Укажите то же имя базы данных, что использовалось до сбоя.

        > [!IMPORTANT]    
        >  Необходимо указать имя экземпляра и имя базы данных сайта, если не используется экземпляр по умолчанию.

-   **Имя ключа:** SQLSSBPort

    -   **Обязательное:** Нет
    -   **Значения:** &lt;*SSBPortNumber*>
    -   **Подробные сведения:** укажите порт SQL Server Service Broker (SSB), используемый сервером SQL Server. Обычно для SSB используется TCP-порт 4022, но поддерживаются и другие порты. Укажите тот же номер порта SSB, который использовался до сбоя.

**HierarchyExpansionOption**

-   **Имя ключа:** CCARSiteServer

    -   **Обязательное:** возможно
    -   **Значения:** &lt;*SiteCodeForCentralAdministrationSite*>
    -   **Подробные сведения:** указывает сайт центра администрирования, к которому будет присоединен первичный сайт при его добавлении в иерархию Configuration Manager. Этот параметр требуется, если первичный сайт был присоединен к сайту центра администрирования до сбоя. Укажите код сайта центра администрирования, использовавшийся до сбоя.

-   **Имя ключа:** CASRetryInterval

    -   **Обязательное:** Нет
    -   **Значения:** &lt;*Interval*>
    -   **Подробные сведения:** указывает интервал (в минутах) повтора попыток подключения к сайту центра администрирования после неудачного подключения. Например, если соединение с сайтом центра администрирования прервано, первичный сайт повторно пытается подключиться к сайту через интервал (в минутах), указанный в параметре CASRetryInterval.


-   **Имя ключа:** WaitForCASTimeout

    -   **Обязательное:** Нет
    -   **Значения:** &lt;*Timeout*>
    -   **Подробные сведения:** указывает максимальное значение периода ожидания (в минутах) подключения первичного сайта к сайту центра администрирования. Например, если первичному сайту не удается подключиться к сайту центра администрирования, первичный сайт повторно пытается подключиться к нему через интервал, указанный в CASRetryInterval, до тех пор, пока не истечет период ожидания WaitForCASTimeout. Можно указать значение от 0 до 100.
