---
title: Средство подключения службы
titleSuffix: Configuration Manager
description: Сведения об инструменте, который позволяет подключаться к облачной службе Configuration Manager, чтобы вручную отправить сведения об использовании.
ms.date: 09/06/2017
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 6e4964c5-43cb-4372-9a89-b62ae6a4775c
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: e535653e0f31e186a6bdbde8da77750f2afdfdb0
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81690302"
---
# <a name="use-the-service-connection-tool-for-configuration-manager"></a>Использование средства подключения службы для Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

Используйте **инструмент подключения службы**, если точка подключения службы находится в автономном режиме либо серверы системы сайта Configuration Manager не подключены к Интернету. Этот инструмент позволяет получить последние обновления Configuration Manager для сайта.  

При запуске инструмент вручную подключается к облачной службе Configuration Manager, чтобы отправить сведения об использовании для вашей иерархии и скачать обновления. Отправка данных об использовании необходима для того, чтобы облачная служба могла предоставить правильные обновления для вашего развертывания.  

## <a name="prerequisites-for-using-the-service-connection-tool"></a>Необходимые условия для использования средства подключения службы
Ниже приведены необходимые условия и известные проблемы.

**Необходимые условия**

- В среде установлена точка подключения службы, и для нее задано значение **Автономный режим, подключение по требованию**.  

- Средство необходимо запускать из командной строки.  

- На каждом компьютере, где запускается это средство (компьютер точки подключения службы и компьютер, который подключен к Интернету), должна быть установлена система x64 и следующее.  

  - Файлы **распространяемого компонента Visual C++** x86 и x64.   По умолчанию Configuration Manager устанавливает версию x64 на компьютер, где размещается точка подключения службы.  

    Чтобы скачать копию файлов Visual C++, перейдите на страниц [Распространяемые пакеты Visual C++ для Visual Studio 2013](https://www.microsoft.com/download/details.aspx?id=40784) в Центре загрузки Майкрософт.  

  - .NET Framework 4.5.2 или более поздней версии.  

- Учетная запись, используемая для запуска инструмента, должна иметь разрешения:
  - **локального администратора** на том компьютере, на котором размещается точка подключения службы (где запускается этот инструмент);
  - **Чтение** для базы данных сайта.  



- Вам потребуется USB-накопитель, обладающий достаточным объемом свободного пространства для хранения файлов и обновлений, или другой способ передачи файлов между компьютером точки подключения службы и компьютером, имеющим доступ к Интернету. (В этом сценарии предполагается, что ваш сайт и управляемые компьютеры не имеют прямого подключения к Интернету.)  



## <a name="use-the-service-connection-tool"></a>Использование инструмента подключения службы  

 Инструмент подключения службы (**serviceconnectiontool.exe**) находится в папке **%path%\smssetup\tools\ServiceConnectionTool** на установочном носителе Configuration Manager. Всегда используйте инструмент подключения службы, соответствующий используемой версии Configuration Manager.


 В этой процедуре пример командной строки использует следующие имена файлов и расположения папок (вам не нужно использовать эти пути и имена файлов, используйте вместо них те значения, которые соответствуют вашей среде и предпочтениям):  

- Путь к USB-носителю, где хранятся данные для передачи между серверами:  **D:\USB\\**  

- Имя CAB-файла с данными, экспортированными с сайта: **UsageData.cab**  

- Имя пустой папки, где будут храниться скачанные обновления для Configuration Manager, предназначенные для передачи между серверами: **UpdatePacks**  

На компьютере, где размещается точка подключения службы, выполните следующие действия:  

- Откройте командную строку с правами администратора, а затем перейдите к папке, содержащей файл **serviceconnectiontool.exe**.  

  По умолчанию это средство находится в папке **%path%\smssetup\tools\ServiceConnectionTool** установочного носителя Configuration Manager. Для правильной работы средства подключения службы все файлы в этой папке должны находиться именно в ней, без разнесения по вложенным папкам.  

При выполнении следующей команды инструмент подготавливает CAB-файл, содержащий сведения об использовании, и копирует его в указанное расположение. Данные CAB-файла формируются согласно уровню диагностических данных об использовании, сбор которых настроен для веб-сайта. (См. [Данные о диагностике и использовании для Configuration Manager](../../../core/plan-design/diagnostics/diagnostics-and-usage-data.md).)  Выполните следующую команду для создания CAB-файла.  

- **serviceconnectiontool.exe -prepare -usagedatadest D:\USB\UsageData.cab**  

Кроме того, необходимо будет скопировать папку ServiceConnectionTool со всем содержимым на USB-накопитель или иным способом сделать ее доступной на компьютере, который будет использоваться для шагов 3 и 4.  

### <a name="overview"></a>Обзор
#### <a name="there-are-three-primary-steps-to-using-the-service-connection-tool"></a>Использование средства подключения к службе включает три основных шага.  

1.  **Prepare**.  Этот шаг нужно выполнять на компьютере, где размещается точка подключения службы. При запуске инструмент помещает данные об использовании в CAB-файл и сохраняет его на USB-накопителе (или в указанном вами альтернативном расположении передачи).  

2.  **Подключение**. На этом шаге вы запускаете инструмент на удаленном компьютере, который подключается к Интернету, чтобы вы могли отправить данные об использовании и скачать обновления.  

3.  **Импорт**. Этот шаг нужно выполнять на компьютере, где размещается точка подключения службы. При запуске инструмент импортирует скачанные обновления и добавляет их на сайт для последующего просмотра и установки из консоли Configuration Manager.  

Начиная с версии 1606, при подключении к системам Майкрософт можно за один раз отправить несколько CAB-файлов (из разных иерархий) и указать прокси-сервер и пользователя для прокси-сервера.   

#### <a name="to-upload-multiple-cab-files"></a>Отправка нескольких CAB-файлов
- Поместите все CAB-файлы, экспортированные из отдельных иерархий, в одну папку. Имя каждого файла должно быть уникальным (при необходимости их можно переименовать вручную).
- Затем при выполнении команды для отправки данных в Майкрософт укажите папку, содержащую CAB-файлы. (До обновления 1606 одновременно можно было передавать данные только из одной иерархии, кроме того, средство требовало указывать имя CAB-файла в папке.)
- Позже, при запуске задачи импорта в точке подключения службы иерархии, средство автоматически импортирует только данные для этой иерархии.  

#### <a name="to-specify-a-proxy-server"></a>Указание прокси-сервера
Чтобы указать прокси-сервер, можно использовать следующие необязательные параметры (дополнительные сведения об использовании этих параметров см. в разделе "Параметры командной строки" этой статьи):
- **-proxyserveruri [полное_доменное_имя_прокси-сервера]** — с помощью этого параметра указывается прокси-сервер для этого подключения.
- **-proxyusername [имя_пользователя]**  — с помощью этого параметра указывается имя пользователя для прокси-сервера.

#### <a name="specify-the-type-of-updates-to-download"></a>Указание типа скачиваемых обновлений
Начиная с версии 1706, был изменен режим скачивания средств по умолчанию. Теперь средство поддерживает ряд параметров для контроля скачиваемых файлов.
- По умолчанию средство скачивает только последнее доступное обновление, соответствующее версии веб-сайта. Оно не скачивает исправления.

Чтобы изменить этот режим, используйте один из следующих параметров для выбора скачиваемых файлов. 

> [!NOTE]
> Версия сайта определяется данными в CAB-файле, который отправляется при запуске программы.
>
> Вы можете проверить версию, просмотрев файл *SiteVersion*.txt в файле CAB.

- **-downloadall** — скачиваются все файлы, включая обновления и исправления, независимо от версии веб-сайта.
- **-downloadhotfix** — скачиваются все исправления независимо от версии веб-сайта.
- **-downloadsiteversion** — скачиваются обновления и исправления, версия которых выше версии веб-сайта.

Пример командной строки с использованием параметра *-downloadsiteversion*:
- **serviceconnectiontool.exe -connect  *-downloadsiteversion* -usagedatasrc D:\USB -updatepackdest D:\USB\UpdatePacks**




### <a name="to-use-the-service-connection-tool"></a>Использование средства подключения службы  

1. На компьютере, где размещается точка подключения службы, выполните следующие действия:  

   - Откройте командную строку с правами администратора, а затем перейдите к папке, содержащей файл **serviceconnectiontool.exe**.   

2. Выполните следующую команду для подготовки CAB-файла, содержащего сведения об использовании, и копирования его в указанное расположение:  

   - **serviceconnectiontool.exe -prepare -usagedatadest D:\USB\UsageData.cab**  

   Если вы одновременно отправляете CAB-файлы из нескольких иерархий, каждый CAB-файл в папке должен иметь уникальное имя. Можно вручную переименовать файлы, добавляемые в папку.

   Если вы хотите просмотреть сведения об использовании, собранные для отправки в облачную службу Configuration Manager, выполните следующую команду, чтобы экспортировать эти данные в CSV-файл, который затем можно просмотреть с помощью такого приложения, как Microsoft Excel:  

   - **serviceconnectiontool.exe -export -dest D:\USB\UsageData.csv**  

3. По завершении шага подготовки подключите USB-накопитель к компьютеру с доступом к Интернету или перенесите экспортированные данные другим способом.  

4. На компьютере с доступом в Интернет откройте командную строку с правами администратора и перейдите в папку, содержащую копию средства  **serviceconnectiontool.exe** и другие файлы из этой папки.  

5. Выполните следующую команду, чтобы начать отправку сведений об использовании и скачивание обновлений для Configuration Manager:  

   - **serviceconnectiontool.exe -connect -usagedatasrc D:\USB -updatepackdest D:\USB\UpdatePacks**

   Дополнительные примеры этой командной строки см. в подразделе [Параметры командной строки](../../../core/servers/manage/use-the-service-connection-tool.md#bkmk_cmd) этого раздела.

   > [!NOTE]  
   >  При выполнении команды для подключения к облачной службе Configuration Manager может возникнуть ошибка, аналогичная приведенной ниже:  
   >   
   > - Необработанное исключение: System.UnauthorizedAccessException:  
   >   
   >      Доступ к пути "C:\  
   >     Users\br\AppData\Local\Temp\extractmanifestcab\95F8A562.sql" запрещен.  
   >   
   > Вы можете без опасений проигнорировать эту ошибку, закрыть окно ошибки и продолжить работу.  

6. После завершения скачивания обновлений для Configuration Manager подключите USB-накопитель к компьютеру, на котором размещается точка подключения службы, или перенесите экспортированные данные другим способом.  

7. На компьютере, где размещается точка подключения службы, откройте командную строку с правами администратора, перейдите к папке, содержащей файл **serviceconnectiontool.exe**, а затем выполните следующую команду:  

   - **serviceconnectiontool.exe -import -updatepacksrc D:\USB\UpdatePacks**  

8. После завершения импорта командную строку можно закрыть. (Импортируются только обновления для соответствующей иерархии.)  

9. Откройте консоль Configuration Manager и последовательно выберите **Администрирование** > **Обновления и обслуживание**. Импортированные обновления теперь доступны для установки. (До версии 1702 раздел "Обновления и обслуживание" находился в узле **Администрирование** > **Облачные службы**.)

   Дополнительные сведения см. в статье [Установка обновлений в консоли для Configuration Manager](../../../core/servers/manage/install-in-console-updates.md).  

## <a name="log-files"></a><a name="bkmk_cmd"></a> Файлы журналов

**ServiceConnectionTool.log**

При запуске средства подключения службы в том же расположении, где находится средство, будет создан файл журнала **ServiceConnectionTool.log**.  Этот файл содержит подробные и понятные сведения о выполнении средства с учетом используемых команд.  Существующий файл журнала будет заменяться новым при каждом запуске средства.

**ConfigMgrSetup.log**

При использовании средства для подключения и скачивания обновлений в корне системного диска будет создан файл журнала **ConfigMgrSetup.log**.  В этом файле содержатся подробные сведения о скачиваемых и извлекаемых файлах, а также о статусе проверки хэша.

## <a name="command-line-options"></a><a name="bkmk_cmd"></a> Параметры командной строки  
Чтобы просмотреть справку для средства подключения службы, откройте командную строку из папки, содержащей это средство, и выполните команду:  **serviceconnectiontool.exe**.  


|Параметры командной строки|Сведения|  
|---------------------------|-------------|  
|**-prepare -usagedatadest [диск:][путь][имя_файла.cab]**|Эта команда сохраняет текущие данные об использовании в CAB-файл.<br /><br /> Выполните эту команду с правами **локального администратора** на сервере, где размещается точка подключения службы.<br /><br /> Пример:   **-prepare -usagedatadest D:\USB\Usagedata.cab**|    
|**-connect -usagedatasrc [диск:][путь] -updatepackdest [диск:][путь] -proxyserveruri [полное_доменное_имя_прокси-сервера] -proxyusername [имя_пользователя]** <br /> <br /> При использовании версии Configuration Manager, предшествующей 1606, необходимо указать имя CAB-файла и нельзя использовать параметры для прокси-сервера.  Поддерживаются следующие параметры команды: <br /> **-connect -usagedatasrc [диск:][путь][имя_файла] -updatepackdest [диск:][путь]** |Эта команда устанавливает подключение к облачной службе Configuration Manager для отправки CAB-файлов с данными об использовании из указанного расположения и для загрузки доступных пакетов обновления и содержимого консоли. Параметры для прокси-сервера указывать необязательно.<br /><br /> Выполните эту команду с правами **локального администратора** на компьютере, имеющем подключение к Интернету.<br /><br /> Пример для подключения без прокси-сервера: **-connect -usagedatasrc D:\USB\ -updatepackdest D:\USB\UpdatePacks** <br /><br /> Пример для подключения при использовании прокси-сервера: **-connect -usagedatasrc D:\USB\Usagedata.cab -updatepackdest D:\USB\UpdatePacks -proxyserveruri itgproxy.redmond.corp.microsoft.com -proxyusername Meg** <br /><br /> При использовании версии до 1606 необходимо указывать имя CAB-файла, кроме того, недоступны параметры для прокси-сервера. Выполните следующую командную строку (пример): **-connect -usagedatasrc D:\USB\Usagedata.cab -updatepackdest D:\USB\UpdatePacks**.|      
|**-import -updatepacksrc [диск:][путь]**|Эта команда импортирует пакеты обновления и содержимое консоли, которые были ранее скачаны в консоль Configuration Manager.<br /><br /> Выполните эту команду с правами **локального администратора** на сервере, где размещается точка подключения службы.<br /><br /> Пример:  **-import -updatepacksrc D:\USB\UpdatePacks**|  
|**-export -dest [диск:][путь][имя_файла.csv]**|Эта команда экспортирует данные об использовании в CSV-файл, который затем можно просмотреть.<br /><br /> Выполните эту команду с правами **локального администратора** на сервере, где размещается точка подключения службы.<br /><br /> Пример: **-export -dest D:\USB\usagedata.csv**|  
