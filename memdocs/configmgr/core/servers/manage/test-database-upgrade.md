---
title: Тестирование обновления базы данных
titleSuffix: Configuration Manager
description: Тестовое обновление базы данных сайта при установке обновлений для Configuration Manager.
ms.date: 06/13/2017
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: abb696f3-a816-4f12-a9f1-0503a81e1976
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 56c1422f4157b255f4f7a8624e36d10e01f28fc0
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81703292"
---
# <a name="test-the-database-upgrade-when-installing-an-update"></a>Тестовое обновление базы данных при установке обновлений

*Область применения: Configuration Manager (Current Branch)*

Этот раздел посвящен тестовому обновлению базы данных перед установкой обновления в консоли для текущей ветви Configuration Manager. Теперь тестовое обновление не является требуемым или рекомендуемым шагом, если база данных не отмечена как подозрительная или для нее не заданы настройки, которые Configuration Manager не поддерживает в явной форме.

## <a name="do-i-need-to-run-a-test-upgrade"></a>Нужно ли мне выполнять тестовое обновление?
Устаревание тестового обновления обусловлено изменениями в Configuration Manager (Current Branch). Эти изменения упрощают и ускоряют обновление рабочей среды до более новых версий. Повторное проектирование помогает поддерживать актуальность систем с меньшим риском, а также сокращать операционные издержки при каждой установке обновления.

Изменения касаются способа установки обновлений, включая логику, которая автоматически откатывает обновление в случае сбоя без необходимости восстанавливать сайт. Эти изменения позволяют управлять установкой обновлений из консоли и выполнять [повторные попытки установки обновлений в случае сбоя](install-in-console-updates.md#bkmk_retry).

> [!TIP]
> При обновлении до Configuration Manager (Current Branch) от более ранних продуктов, таких как System Center 2012 Configuration Manager, [тестовое обновление базы данных остается рекомендуемым шагом](../deploy/install/upgrade-to-configuration-manager.md#bkmk_test).

Если вы все же планируете выполнить тестовое обновление базы данных сайта при установке обновления в консоли, см. [руководство по установке обновления в консоли](install-in-console-updates.md#bkmk_install).

## <a name="prepare-to-run-a-test-database-upgrade"></a>Подготовка к тестовому обновлению базы данных  
Перед установкой нового обновления в иерархии, например версии 1702, можно выполнить тестовое обновление базы данных сайта.

Чтобы запустить тестовое обновление, используйте программу установки Configuration Manager из исходных файлов в [папке CD.Latest](the-cd.latest-folder.md) на сайте под управлением версии Configuration Manager, до которой выполняется обновление. Это означает, что для тестового обновления базы данных до версии 1702:
-   требуется хотя бы один сайт под управлением версии 1702, на котором можно получить папку CD.Latest;
-   если сайта под управлением требуемой версии нет, рекомендуется установить его в лабораторной среде и обновить до новой версии. При этом создается папка CD.Latest с нужной версией исходных файлов.

Тестовое обновление выполняется для резервной копии базы данных сайта, восстановленной в отдельном экземпляре SQL Server.  Запустите программу установки из папки **CD.Latest** с параметром командной строки **testdbupgrade** для тестового обновления восстановленной копии базы данных. По завершении тестового обновления обновленная база данных удаляется. Она не может использоваться сайтом Configuration Manager.

Если установка обновления завершается сбоем, вам не нужно восстанавливать сайт. Вместо этого можно попробовать повторно установить обновление из консоли.

##  <a name="run-the-test-upgrade"></a>Выполнение тестового обновления    
1. Используйте программу установки Configuration Manager и исходные файлы из папки **CD.Latest** сайта, где используется версия, до которой планируется выполнить обновление.  

2. Затем скопируйте папку **CD.Latest** в расположение на экземпляре сервера SQL Server, которое будет использоваться для тестового обновления базы данных.

3. Создайте резервную копию базы данных сайта для тестового обновления. Затем восстановите копию базы данных на экземпляре SQL Server, где не размещен сайт Configuration Manager. Для экземпляра сервера SQL Server должен использоваться тот же выпуск SQL Server, что и для базы данных сайта.  

4. Восстановив копию базы данных, запустите **программу установки** из папки CD.Latest с исходными файлами версии, до которой обновляется система. При запуске программы установки используйте параметр командной строки **/TESTDBUPGRADE** . Если экземпляр SQL Server, на котором размещена копия базы данных, не является экземпляром по умолчанию, укажите аргументы командной строки, чтобы указать экземпляр, на котором размещена копия базы данных сайта.   

   Например, у вас есть база данных сайта с именем *SMS_ABC*. Следует восстановить копию этой базы данных сайта на поддерживаемом экземпляре SQL Server с именем экземпляра *DBTest*. Чтобы проверить обновление этой копии базы данных сайта, используйте следующую командную строку: **Setup.exe /TESTDBUPGRADE DBtest\CM_ABC**.  

   Файл Setup.exe находится в следующем каталоге исходного носителя Configuration Manager: **SMSSETUP\BIN\X64**.  

5. На экземпляре SQL Server, где запущено тестовое обновление, выполните мониторинг журнала *ConfigMgrSetup.log* в корневом каталоге системного диска.  

    Если тестовое обновление не удается выполнить, устраните неполадки, связанные со сбоем обновления базы данных сайта. Затем создайте резервную копию базы данных сайта и выполните ее тестовое обновление.  



## <a name="next-steps"></a>Дальнейшие шаги
Завершив тестовое обновление базы данных, удалите ее. Она не может использоваться сайтом Configuration Manager. Затем можно вернуться к активному сайту и [начать установку обновления](install-in-console-updates.md).
