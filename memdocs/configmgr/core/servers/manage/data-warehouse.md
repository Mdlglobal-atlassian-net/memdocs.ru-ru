---
title: Хранилище данных
titleSuffix: Configuration Manager
description: Сведения о точке обслуживания и базе данных хранилища данных для Configuration Manager
ms.date: 05/09/2019
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: aaf43e69-68b4-469a-ad58-9b66deb29057
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 43bb2d1cc85488decf61bce7a3f18aa73bc17bce
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81692672"
---
#  <a name="the-data-warehouse-service-point-for-configuration-manager"></a>Точка обслуживания хранилища данных для Configuration Manager

*Область применения: Configuration Manager (Current Branch)*

<!--1277922-->
Точка обслуживания хранилища данных позволяет длительно хранить исторические данные для развертывания Configuration Manager и создавать отчеты на основе этих данных.

> [!Note]  
> По умолчанию в версии 1910 в Configuration Manager эта функция включена. В версии 1906 и более ранних по умолчанию в Configuration Manager эта дополнительная функция отключена. Перед использованием ее необходимо включить. Дополнительные сведения см. в разделе [Включение дополнительных функций из обновлений](install-in-console-updates.md#bkmk_options).<!--505213-->  


Хранилище данных вмещает до 2 ТБ данных и поддерживает метки времени для отслеживания изменений. Хранение данных обеспечивается путем автоматической синхронизации базы данных сайта Configuration Manager с базой данных хранилища данных. После этого синхронизированные данные доступны в точке служб отчетов. Данные, синхронизированные с базой данных хранилища данных, сохраняются в течение трех лет. Периодически выполняется встроенная задача, которая удаляет данные старше трех лет.

Синхронизируемые данные (данные сайта и глобальные данные) включают в себя следующее:
- Работоспособность инфраструктуры
- Безопасность
- Соответствие требованиям
- Вредоносная программа   
- Развертывания программного обеспечения
- Сведения об инвентаризации (однако журнал инвентаризации не синхронизируется)

Во время установки роли системы сайта также устанавливается и настраивается база данных хранилища данных. Кроме того, устанавливаются несколько отчетов, используя которые вы можете легко найти и просмотреть эти данные.

Мы приняли во внимание ваши отзывы на сайте UserVoice, и с версии 1810 вы можете синхронизировать больше таблиц из базы данных сайта с хранилищем данных. Благодаря этому изменению вы можете создавать дополнительные отчеты с учетом ваших бизнес-требований.<!--1358870--> 



## <a name="prerequisites"></a>Предварительные условия

- Роль системы сайта для хранилища данных поддерживается только на сайте верхнего уровня в иерархии. (Например, это сайт центра администрирования или автономный первичный сайт.)  

- На компьютере, на котором устанавливается эта роль системы сайта, требуется платформа .NET Framework 4.5.2 или более поздней версии.  

- Предоставьте **учетной записи точки служб отчетов** разрешение **db_datareader** на доступ к базе данных хранилища данных.  

- Учетная запись компьютера, на котором находится роль системы сайта, используется в Configuration Manager для синхронизации данных с базой данных хранилища данных. Она должна иметь следующие разрешения:  

    - права **администратора** на компьютере, где будет размещаться база данных хранилища данных;  

    - разрешение **DB_Creator** на доступ к базе данных хранилища данных;  

    - разрешение **DB_owner** или **DB_reader** с разрешением **execute** для базы данных верхнего уровня.  

- База данных хранилища данных должна работать под управлением SQL Server 2012 или более поздней версии. Можно использовать выпуски Standard, Enterprise или Datacenter. Версия SQL Server для хранилища данных необязательно должна быть той же, что и на сервере базы данных сайта.<!--SCCMDocs issue 662-->  

- Для размещения базы данных хранилища можно использовать следующие конфигурации SQL Server:  

    - в экземпляре по умолчанию или именованном экземпляре;  

    - группа доступности SQL Server AlwaysOn;  

    - отказоустойчивый кластер SQL Server.  

- Если вы используете [распределенные представления](../../plan-design/hierarchy/database-replication.md#bkmk_distviews), необходимо установить роль "Точка обслуживания хранилища данных" на том же сервере, на котором размещена база данных сайта для сайта центра администрирования.  

Дополнительные сведения о лицензировании SQL Server см. в статье [Вопросы и ответы о ветвях и лицензировании System Center Configuration Manager](../../understand/product-and-licensing-faq.md). <!-- sms500967 -->

Размер хранилища данных для базы данных задайте так же, как для базы данных сайта. Хотя хранилище данных сначала меньше, оно будет увеличиваться с течением времени. <!--SCCMDocs issue 756-->



## <a name="install"></a>Установить

Каждая иерархия поддерживает один экземпляр этой роли, размещенный на любой системе сайта верхнего уровня. Сервер SQL Server, на котором размещена база данных хранилища данных, может быть локальным по отношению к роли системы сайта или удаленным. Хранилище данных работает с точкой служб отчетов, установленной на том же сайте. Вам не нужно устанавливать две роли системы сайта на одном сервере.   

Чтобы установить роль, используйте **мастер добавления ролей системы сайта** или **мастер создания сервера системы сайта**. Дополнительные сведения см. в статье [Установка ролей системы сайта для System Center Configuration Manager](../deploy/configure/install-site-system-roles.md). На странице мастера **Выбор системной роли** выберите роль **Точка обслуживания хранилища данных**. 

При установке роли Configuration Manager создает базу данных хранилища данных в указанном экземпляре SQL Server. Если указать имя существующей базы данных, Configuration Manager не создает новую базу данных. Вместо этого он использует указанную вами. Этот процесс совпадает с ситуацией, когда вы [перемещаете базу данных хранилища данных на новый сервер SQL Server](#move-the-database).


### <a name="configure-properties"></a>Настройка свойств

#### <a name="general-page"></a>Страница "Общие"

- **Полное доменное имя SQL Server**. Укажите полное доменное имя сервера, на котором находится база данных точки обслуживания хранилища данных.  

- **Имя экземпляра SQL Server, если применимо**. Если вы не используете экземпляр SQL Server по умолчанию, следует указать его имя.  

- **Имя базы данных**. Укажите имя базы данных хранилища данных. Configuration Manager использует это имя при создании базы данных хранилища данных. Если вы укажете имя уже существующей базы данных в этом экземпляре SQL Server, Configuration Manager будет использовать эту базу данных.  

- **Порт SQL Server, используемый для подключения**. Укажите номер порта TCP/IP, используемый сервером SQL Server, на котором размещена база данных хранилища данных. Этот порт используется службой синхронизации для подключения к базе данных хранилища данных. По умолчанию для обмена данными используется порт SQL Server **1433**.  

- **Учетная запись точки обслуживания хранилища данных**. Для версий, начиная с 1802, укажите **Имя пользователя**, которое SQL Server Reporting Services использует для подключения к базе данных хранилища данных.  


#### <a name="synchronization-schedule-page"></a>Страница "Расписание синхронизации"
*Применимо к версии 1806 и более ранним*

- **Время начала**. Укажите время, когда необходимо начать синхронизацию хранилища данных.  

- **Расписание повторения**

    - **Ежедневно**. Настройте ежедневное выполнение синхронизации.  

    - **Еженедельно**. Настройте еженедельное выполнение синхронизации, указав определенный день для выполнения этого процесса.


#### <a name="synchronization-settings-page"></a>Страница "Параметры синхронизации"
*Применимо к версии 1810 и более поздним*

- **Пользовательский параметр синхронизации данных**. Выберите параметр **Выбрать таблицы**. В окне таблиц базы данных выберите имена таблиц для синхронизации с базой данных хранилища данных. Используйте фильтр, чтобы выполнить поиск по имени, или выберите конкретные группы в раскрывающемся списке. Выберите **ОК** после завершения для сохранения.  

    > [!Note]  
    > Удалить таблицы, выбираемые ролью по умолчанию, невозможно.  

- **Время начала**. Укажите время, когда необходимо начать синхронизацию хранилища данных.  

- **Расписание повторения**

    - **Ежедневно**. Настройте ежедневное выполнение синхронизации.  

    - **Еженедельно**. Настройте еженедельное выполнение синхронизации, указав определенный день для выполнения этого процесса.



## <a name="reporting"></a>Отчеты

После установки точки обслуживания хранилища данных в точке служб отчетов на том же сайте становятся доступными несколько отчетов. Если вы сперва установили точку обслуживания хранилища данных, эти отчеты будут автоматически добавлены во время установки точки служб отчетов.

> [!WARNING]  
> Начиная с версии 1802 точка хранилища данных поддерживает альтернативные учетные данные.<!--507334--> При обновлении с предыдущей версии Configuration Manager необходимо указать учетные данные, которые SQL Server Reporting Services будет использовать для подключения к базе данных хранилища данных. Пока вы не добавите учетные данные, не будут открываться отчеты хранилища данных. 
> 
> Чтобы указать учетную запись, задайте **имя пользователя** для учетной записи точки обслуживания хранилища в свойствах роли. Дополнительные сведения см. в разделе [Настройка свойств](#configure-properties). 

Роль системы сайта "Хранилище данных" содержит следующие отчеты с категорией **Хранилище данных**.  

- **Развертывание приложений — журнал**. Содержит сведения о развертывании определенного приложения на компьютере.  

- **Соответствие EndPoint Protection и обновлений ПО — журнал**. Содержит сведения о компьютерах, на которых отсутствуют обновления программного обеспечения.  

- **Общая инвентаризация оборудования — журнал**. Содержит полные инвентарные данные по оборудованию на определенном компьютере.  

- **Общая инвентаризация ПО — журнал**. Содержит полные инвентарные данные по программному обеспечению на определенном компьютере.  

- **Общие сведения о работоспособности инфраструктуры — журнал**. Содержит обзор работоспособности инфраструктуры Configuration Manager.  

- **Список обнаруженных вредоносных программ — журнал**. Содержит сведения о вредоносных программах, обнаруженных в организации.  

- **Сводка распространения ПО — журнал**. Сводка распространения программного обеспечения для определенного объявления и компьютера.  



## <a name="site-expansion"></a>Расширение сайта

Перед установкой сайта центра администрирования, используемого для расширения имеющегося автономного основного сайта, сначала необходимо удалить роль точки обслуживания хранилища данных. После установки сайта центра администрирования на нем можно установить роль системы сайта.  

В отличие от перемещения базы данных хранилища данных, это изменение приводит к потере исторических данных, синхронизированных ранее на основном сайте. Резервное копирование базы данных с основного сайта и восстановление его на сайте центра администрирования не поддерживается.



## <a name="move-the-database"></a>Перемещение базы данных

Чтобы перенести базу данных хранилища данных на новый сервер SQL Server, выполните указанные ниже действия.  

1. Используйте SQL Server Management Studio для резервного копирования базы данных хранилища данных. Затем восстановите эту базу данных в SQL Server на новом компьютере, на котором размещается хранилище данных.  

    > [!NOTE]  
    > После восстановления базы данных на новом сервере убедитесь в том, что разрешения на доступ к новой базе данных хранилища данных совпадают с исходными.  

2. Чтобы удалить роль "Точка обслуживания хранилища данных" с текущего сервера, используйте консоль Configuration Manager.  

3. Повторно установите точку обслуживания хранилища данных. Укажите имя нового сервера и экземпляра SQL Server, где размещается восстановленная база данных хранилища данных.  

4. После установки роли системы сайта перемещение завершено.  



## <a name="troubleshooting"></a>Устранение неполадок 

### <a name="log-files"></a>Файлы журнала 

Чтобы изучить проблемы, возникающие при установке точки обслуживания хранилища данных или синхронизации данных, используйте следующие журналы:

- **DWSSMSI.log** и **DWSSSetup.log**. Используйте эти журналы для изучения ошибок, возникающих при установке точки обслуживания хранилища данных.  

- **Microsoft.ConfigMgrDataWarehouse.log**. Используйте этот журнал для изучения ошибок синхронизации данных между базой данных сайта и базой данных хранилища данных.  


### <a name="set-up-failure"></a>Сбой при установке 

Если роль точки обслуживания хранилища данных устанавливается на удаленном сервере первой, установка завершается сбоем для хранилища данных.  

#### <a name="workaround"></a>Обходной путь 
Убедитесь, что на компьютере, где вы устанавливаете точку обслуживания хранилища данных, есть как минимум еще одна роль.  


### <a name="synchronization-failed-to-populate-schema-objects"></a>Не удалось выполнить синхронизацию для заполнения объектов схемы 

Синхронизация завершается сбоем, и в журнале **Microsoft.ConfigMgrDataWarehouse.log** регистрируется сообщение: `failed to populate schema objects`.

#### <a name="workaround"></a>Обходной путь 
Убедитесь, что учетная запись компьютера, на котором размещена роль системы сайта, имеет разрешение **db_owner** на доступ к базе данных хранилища данных.


### <a name="reports-fail-to-open"></a>Не удается открыть отчеты

Не удается открыть отчеты хранилища данных, если база данных хранилища данных и точка служб отчетов расположены в разных системах сайта.  

#### <a name="workaround"></a>Обходной путь
Предоставьте **учетной записи точки служб отчетов** разрешение **db_datareader** на доступ к базе данных хранилища данных.


### <a name="error-opening-reports"></a>Ошибка при открытии отчетов

При открытии отчета хранилища данных возвращается следующая ошибка:

``` Output
An error has occurred during report processing. (rsProcessingAborted)
Cannot create a connection to data source 'AutoGen__39B693BB_524B_47DF_9FDB_9000C3118E82_'. (rsErrorOpeningConnection)
A connection was successfully established with the server, but then an error occurred during the pre-login handshake. (provider: SSL Provider, error: 0 - The certificate chain was issued by an authority that is not trusted.)
```

#### <a name="workaround"></a>Обходной путь 
Чтобы настроить сертификаты, выполните следующие действия:

1. На компьютере, на котором размещена база данных хранилища данных, сделайте следующее:  

    1. Откройте IIS, выберите **Сертификаты сервера**, щелкните правой кнопкой мыши **Создать самозаверяющий сертификат**. Затем укажите "понятное имя" имя сертификата, например **сертификат идентификации сервера SQL Server хранилища данных**. Выберите **личное** хранилище сертификатов.  

    2. Откройте **SQL Server Configuration Manager**. В разделе **Сетевая конфигурация SQL Server** щелкните правой кнопкой мыши в разделе **Protocols for MSSQLSERVER** (Протоколы для MSSQLSERVER) и выберите **Свойства**. Затем на вкладке **Сертификат** в качестве сертификата выберите **сертификат идентификации сервера SQL Server хранилища данных** и сохраните изменения.  

    3. В **диспетчере конфигурации SQL Server** в разделе **Службы SQL Server** перезапустите **службу SQL Server**. Если службы SQL Server Reporting Services установлены на сервере, на котором размещена база данных хранилища данных, также перезапустите **службу отчетов**.  

    4. Откройте консоль управления (MMC) и добавьте оснастку **Сертификаты**. Выберите **учетную запись** локального компьютера. Разверните папку **Личные** и выберите **Сертификаты**. Экспортируйте **сертификат идентификации сервера SQL Server хранилища данных** в формате **двоичного файла X.509 (CER) в кодировке DER**.  

2. На компьютере, где размещена среда SQL Server Reporting Services, откройте консоль управления и добавьте оснастку **Сертификаты**. Выберите **Учетная запись**. В папке **Trusted Root Certificate Authorities** (Доверенные корневые центры сертификации) импортируйте **сертификат идентификации сервера SQL Server хранилища данных**.  



## <a name="data-flow"></a>Поток данных   

![Схема, иллюстрирующая логический поток данных между компонентами сайта для хранилища данных](./media/datawarehouse.png)

#### <a name="data-storage-and-synchronization"></a>Хранение и синхронизация данных

| Шаг   | Сведения  |
|--------|----------|  
| **1**  | Сервер сайта передает и сохраняет данные в базе данных сайта. |  
| **2**  | В соответствии с расписанием и конфигурацией точка обслуживания хранилища данных получает данные из базы данных сайта. |  
| **3**  | Точка обслуживания хранилища данных передает и сохраняет копию синхронизированных данных в базе данных хранилища данных. |  


#### <a name="reporting"></a>Отчеты

| Шаг   | Сведения  |
|--------|----------|  
| **А**  | С помощью встроенных отчетов пользователь запрашивает данные. Этот запрос передается в точку служб отчетов с помощью SQL Server Reporting Services. |  
| **Б**  | Большинство отчетов служат для получения текущей информации, и соответствующие запросы выполняются к базе данных сайта. |  
| **В**  | Когда отчет запрашивает исторические данные с использованием одного из отчетов, *категория* которых представлена **хранилищем данных**, такой запрос направляется к базе данных хранилища данных. |  
