---
title: CMPivot для данных в режиме реального времени
titleSuffix: Configuration Manager
description: Сведения о том, как использовать CMPivot в Configuration Manager для запроса клиентов в режиме реального времени.
ms.date: 04/08/2020
ms.prod: configuration-manager
ms.technology: configmgr-core
ms.topic: conceptual
ms.assetid: 32e2d6b9-148f-45e2-8083-98c656473f82
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: dcd441c7f35748f42adc8824c68ec703291a13e0
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81702092"
---
# <a name="cmpivot-for-real-time-data-in-configuration-manager"></a>CMPivot для данных в режиме реального времени в Configuration Manager

<!--1358456-->

*Область применения: Configuration Manager (Current Branch)*

В Configuration Manager всегда предоставлялось большое централизованное хранилище данных устройств, которые клиенты использовали для создания отчетов. Сайт обычно собирает эти данные еженедельно. Начиная с версии 1806 CMPivot представляет собой новую служебную программу в консоли, которая теперь предоставляет доступ к состоянию устройств в вашей среде в режиме реального времени. Она отправляет запрос сразу на все подключенные устройства в целевой коллекции и возвращает результаты. После этого отфильтруйте и сгруппируйте эти данные в средстве. Благодаря тому, что данные от клиентов в сети предоставляются в реальном времени, вы можете быстрее удовлетворять бизнес-требования, устранять неполадки и реагировать на угрозы безопасности.

Например, одним из требований для [устранения рисков при уязвимостях упреждающего исполнения по сторонним каналам](https://techcommunity.microsoft.com/t5/configuration-manager-blog/additional-guidance-to-mitigate-speculative-execution-side/ba-p/274974) является обновление системы BIOS. С помощью CMPivot можно быстро запросить данные о системе BIOS и найти клиентов, которые не соответствуют требованиям.

 > [!IMPORTANT]  
 > - Некоторые программы для обеспечения безопасности могут блокировать выполнение скриптов из c:\windows\ccm\scriptstore. Это может препятствовать успешному выполнению запросов CMPivot. Некоторые программы для обеспечения безопасности могут также создавать события аудита или предупреждения при выполнении CMPivot PowerShell.
 > - Некоторое программное обеспечение для защиты от вредоносных программ может случайно активировать события для сценариев запуска Configuration Manager или функций CMPivot. Рекомендуется исключить %windir%\CCM\ScriptStore, чтобы программное обеспечение для защиты от вредоносных программ не мешало выполнению этих функций.


## <a name="prerequisites"></a>Предварительные условия

Для использования CMPivot нужно следующее:

- Обновите целевые устройства до последней версии клиента Configuration Manager.  

- Целевым клиентам требуется версия PowerShell не ниже 4.

- Чтобы собрать данные для следующих сущностей, целевым клиентам требуется PowerShell 5.0:  
  - Администраторы
  - Подключение
  - IPConfig
  - SMBConfig


- Разрешения для CMPivot:
  - разрешение на **чтение** для объекта **Скрипты SMS**;
  - разрешение на **выполнение скриптов** для **коллекции**;
    - Кроме того, начиная с версии 1906 вы можете использовать разрешение на **запуск CMPivot** для **коллекции**.
  - разрешение на **чтение** для **отчетов по инвентаризации**.
  - Область по умолчанию.

>[!NOTE]
> Разрешение на **выполнение скриптов** — это надмножество разрешения на **запуск CMPivot**.
 
## <a name="limitations"></a>Ограничения

- В иерархии подключите консоль Configuration Manager к *первичному сайту* для запуска CMPivot. Действие **Запустить CMPivot** не отображается в консоли, когда она подключена к сайту центра администрирования.
  - Начиная с Configuration Manager версии 1902 CMPivot можно запускать с сайта центра администрирования. В некоторых средах требуются дополнительные разрешения. Дополнительные сведения см. в разделе [CMPivot с версии 1902](#bkmk_cmpivot1902).

- CMPivot возвращает данные только для клиентов, подключенных к текущему сайту.  

- Если коллекция содержит устройства с другого сайта, результаты CMPivot охватывают только устройства на текущем сайте.  

- Вы не можете настроить свойства сущности, столбцы результатов или действия на устройствах.  

- Только один экземпляр CMPivot может одновременно выполняться на компьютере, где запущена консоль Configuration Manager.  

- В версии 1806 запрос сущности **Administrators** выполняется, только если группа называется "Administrators". Он не работает, если имя группы локализовано. Например, "Administrateurs" на французском языке.<!--SCCMDocs issue 759-->  


## <a name="start-cmpivot"></a>Запустить CMPivot

1. В консоли Configuration Manager подключитесь к первичному сайту. Перейдите в рабочую область **Активы и соответствие** и выберите узел **Коллекции устройств**. Выберите целевую коллекцию и щелкните **Запустить CMPivot** на ленте, чтобы запустить средство.  

    > [!Tip]  
    > Если этот параметр не отображается, проверьте следующие конфигурации:  
    > 
    > - Уточните у администратора сайта, имеет ли ваша учетная запись необходимые разрешения. Дополнительные сведения см. в разделе [Необходимые условия](#prerequisites).  
    > 
    > - Подключите консоль к *первичному сайту*.  

2. Дополнительные сведения по использованию средства предоставляются в интерфейсе.  

     - Вручную введите строки запросов в верхней части окна или перейдите по ссылкам во встроенной документации.  

     - Выберите одну из **сущностей**, чтобы добавить ее в строку запроса.  

     - Если щелкнуть ссылки **операторов таблиц**, **статистических функций** и **скалярных функций**, в веб-браузере откроется справочная документация по языку запросов. CMPivot использует [язык запросов Kusto (KQL)](https://docs.microsoft.com/azure/kusto/query/).  

3. Не закрывайте окно CMPivot для просмотра результатов от клиентов. При закрытии окна CMPivot сеанс завершается.  

    > [!Note]  
    > Если запрос был отправлен, клиенты продолжают отправлять ответ на сообщение о состоянии на сервер.  



## <a name="how-to-use-cmpivot"></a>Использование CMPivot

![Пример окна CMPivot](media/1358456-cmpivot-sample.png)

Окно CMPivot содержит следующие элементы:  

1. Коллекция, на которую ориентирована CMPivot, указана в строке заголовка сверху и в строке состояния снизу окна. Например, "PM_Team_Machines" на приведенном выше снимке экрана.  

2. В области слева перечислены **Сущности**, доступные на клиентах. Некоторые сущности зависят от WMI, а другие используют PowerShell для получения данных от клиентов.   

    - Щелкните сущность правой кнопкой мыши для доступа к следующим действиям:  

       - **Вставить**. Добавление сущности в запрос в текущем положении курсора. Сущность не запускается автоматически. Это действие используется по умолчанию при двойном щелчке сущности. Используйте это действие при создании запроса.  

       - **Запросить все**. Выполнение запроса для этой сущности, включая все свойства. Используйте это действие, чтобы быстро выполнить запрос для одной сущности.  

       - **Запросить по устройствам**. Выполнение запроса для этой сущности и группирование результатов. Например, `Disk | summarize dcount( Device ) by Name`  

    - Разверните сущность для просмотра определенных свойств, доступных для каждой сущности. Дважды щелкните свойство, чтобы добавить его в запрос в текущем положении курсора.  

3. На вкладке **Главная** отображаются общие сведения о CMPivot, включая ссылки на примеры запросов и сопроводительную документацию.  

4. На вкладке **Запрос** отображается область запросов, область результатов и строка состояния. На приведенном выше снимке экрана вкладка запроса выбрана.  

5. Область запросов — это место, где вы создаете или вводите запрос для выполнения на клиентах в коллекции.  

    - CMPivot использует подмножество [языка запросов Kusto (KQL)](https://docs.microsoft.com/azure/kusto/query/).  

    - В области запросов можно вырезать, копировать или вставлять содержимое.  
    <!-- markdownlint-disable MD038 -->
    - По умолчанию эта область использует технологию IntelliSense. Например, если пользователь начинает вводить `D`, IntelliSense предлагает все сущности, начинающиеся с этой буквы. Выберите параметр и нажмите клавишу TAB для его вставки. Введите знак вертикальной черты и пробел `| `, после чего затем IntelliSense предлагает все операторы таблицы. Вставьте `summarize` и введите пробел, после чего IntelliSense предлагает все статистические функции. Для получения дополнительных сведений об этих операторах и функциях откройте вкладку **Главная** в CMPivot.  

    - Область запросов также предоставляет следующие возможности:  

        - Выполнение запроса.  

        - Перемещение вперед и назад в списке журнала запросов.  

        - Создание коллекции с непосредственным членством.  

        - Экспорт результатов запроса в CSV-файл или буфер обмена.  

6. Область результатов отображает данные, возвращаемые активными клиентами для запроса.  

   - Доступные столбцы зависят от сущности и запроса.  

   - Щелкните имя столбца для сортировки результатов по этому свойству.  

   - Щелкните правой кнопкой мыши имя любого столбца, чтобы сгруппировать результаты по тем же сведениям в этом столбце, или отсортируйте результаты.  

   - Щелкните правой кнопкой мыши имя устройства, чтобы выполнить на нем следующие дополнительные действия:  

      - **Сведение по**. Выполнение запроса для другой сущности на этом устройстве.  

      - **Запуск скрипта**. Запуск мастера запуска скрипта для выполнения существующего скрипта PowerShell на этом устройстве. Дополнительные сведения см. в разделе [Запуск сценария](../../../apps/deploy-use/create-deploy-scripts.md#run-a-script).  

      - **Удаленное управление**. Запуск сеанса удаленного управления Configuration Manager на этом устройстве. Дополнительные сведения см. в разделе [Удаленное администрирование клиентского компьютера Windows](../../clients/manage/remote-control/remotely-administer-a-windows-client-computer.md).  

      - **Обозреватель ресурсов**. Запуск обозревателя ресурсов Configuration Manager для этого устройства. Дополнительные сведения см. в разделе [Просмотр инвентаризации оборудования](../../clients/manage/inventory/use-resource-explorer-to-view-hardware-inventory.md) или [Просмотр инвентаризации программного обеспечения](../../clients/manage/inventory/use-resource-explorer-to-view-software-inventory.md).  

   - Щелкните правой кнопкой мыши любую ячейку, не относящуюся к устройству, чтобы выполнить следующие дополнительные действия:  

     - **Копировать**. Копирование текста ячейки в буфер обмена.  

     - **Показать устройства с**. Запрашивание устройств с этим значением для этого свойства. Например, в результатах выполнения запроса `OS` выберите этот параметр для ячейки в строке версии: `OS | summarize countif( (Version == '10.0.17134') ) by Device | where (countif_ > 0)`  

     - **Показать устройства без**. Запрашивание устройств без этого значения для этого свойства. Например, в результатах выполнения запроса `OS` выберите этот параметр для ячейки в строке версии: `OS | summarize countif( (Version == '10.0.17134') ) by Device | where (countif_ == 0) | project Device`  

     - **Найти в Bing**. Перейдите в веб-браузере по умолчанию по адресу https://www.bing.com с этим значением в качестве строки запроса.  

   - Щелкните любой текст, выделенный как гиперссылка, чтобы вывести в представлении соответствующую сводную информацию.  

   - В области результатов отображается не более 20 000 строк. Измените запрос для дальнейшей фильтрации данных либо перезапустите CMPivot для коллекции меньшего размера.  

7. Строка состояния отображает следующую информацию (слева направо):  

   - Состояние текущего запроса для целевой коллекции. Это состояние включает в себя следующее:  
     - Количество активных клиентов, выполнивших запрос (3)  
     - Общее число клиентов (5)  
     - Число автономных клиентов (2)  
     - Все клиенты, возвратившие ошибку (0)  

       Пример: `Query completed on 3 of 5 clients (2 clients offline and 0 failure)`  

   - Идентификатор операции клиента. Пример: `id(16780221)`  

   - Текущая коллекция. Пример: `PM_Team_Machines`  

   - Общее число строк в области результатов. Например, `1 objects`  



## <a name="example-scenarios"></a>Примеры сценариев

Следующие разделы содержат примеры использования CMPivot в вашей среде:


### <a name="example-1-stop-a-running-service"></a>Пример 1. Остановка выполняющейся службы

Администратор безопасности просит вас как можно скорее остановить и отключить службу браузера компьютеров на всех устройствах в бухгалтерии. Запустите CMPivot в коллекции для всех устройств в бухгалтерии, а затем выберите значение **Запросить все** для сущности **Service**. 

`Service`

Когда появляются результаты, щелкните правой кнопкой мыши столбец **Имя** и выберите **Группировать по**. 

`Service | summarize dcount( Device ) by Name`

В строке для службы **Браузер** щелкните являющийся гиперссылкой номер в столбце **dcount_** . 

`Service | where (Name == 'Browser') | summarize count() by Device`

Выберите сразу все устройства, щелкните их правой кнопкой мыши и выберите пункт **Запуск сценария**. Это действие запускает мастер запуска сценария, используемый для выполнения существующего сценария для остановки и отключения службы. CMPivot позволяет быстро отреагировать на инцидент безопасности для всех активных компьютеров, просматривая результаты в мастере запуска сценария. После этого создайте конфигурационную базу, чтобы исправлять другие компьютеры в этой коллекции по мере их появления в будущем. 

![Пример CMPivot для службы браузера и действия запуска сценария](media/cmpivot-example1.png)


### <a name="example-2-proactively-resolve-application-failures"></a>Пример 2: Упреждающее устранение сбоев приложения  

Для заблаговременного выполнения общего обслуживания один раз в неделю запустите CMPivot для коллекции управляемых вами серверов и выберите **Запросить все** для сущности **AppCrash**. Щелкните правой кнопкой мыши столбец **FileName** и выберите пункт **Сортировка по возрастанию**. Одно устройство возвращает семь результатов для sqlsqm.exe с меткой времени около 03:00 каждый день. Выберите имя файла в одной из строк, щелкните его правой кнопкой мыши и выберите пункт **Найти в Bing**. Просматривая результаты поиска в веб-браузере, найдите справочную статью Майкрософт по этой проблеме с дополнительными сведениями и способом устранения. 


### <a name="example-3-bios-version"></a>Пример 3. Версия BIOS

Одним из требований для [устранения рисков при уязвимостях упреждающего исполнения по сторонним каналам](https://techcommunity.microsoft.com/t5/configuration-manager-blog/additional-guidance-to-mitigate-speculative-execution-side/ba-p/274974) является обновление системы BIOS. Начните с запроса для сущности **BIOS**. Затем выберите **Группировать по** и свойство **Версия**. После этого щелкните правой кнопкой мыши конкретное значение, например "LENOVO — 1140", и выберите пункт **Показать устройства с**.  

`Bios | summarize countif( (Version == 'LENOVO - 1140') ) by Device | where (countif_ > 0)`


### <a name="example-4-free-disk-space"></a>Пример 4. Свободное дисковое пространство

Вам нужно временно сохранить большой файл на сетевом файловом сервере, но вы не уверены, на каком из них достаточно свободного места. Запустите CMPivot для коллекции файловых серверов и запросите сущность **Disk**. Измените запрос для CMPivot, чтобы быстро получить список активных серверов с данными реального времени о хранилище:  

`Disk | where (Description == 'Local Fixed Disk') | where isnotnull( FreeSpace ) | order by FreeSpace asc`


## <a name="cmpivot-starting-in-version-1810"></a><a name="bkmk_cmpivot"></a> CMPivot с версии 1810
<!--1359068, 3607759-->

Начиная с Configuration Manager версии 1810 в CMPivot внесены следующие улучшения:

- [Производительность и функциональность CMPivot](#bkmk_cmpivot-perf)
- [Скалярные функции](#bkmk_cmpivot-functions)  
- [Отрисовка визуализаций](#bkmk_cmpivot-charts)  
- [Инвентаризация оборудования](#bkmk_cmpivot-hinv)  
- [Скалярные операторы](#bkmk_cmpivot-operators)  
- [Сводка по запросу](#bkmk_cmpivot-summary)  
- [Сообщения о состоянии аудита](#cmpivot-audit-status-messages)

### <a name="cmpivot-utility-and-performance"></a><a name="bkmk_cmpivot-perf"></a> Производительность и функциональность CMPivot

- CMPivot возвращает до 100 000 ячеек, а не максимум 20 000 строк.
  - Если у сущности 5 свойств, то есть 5 столбцов, отображаются до 20 000 строк.
  - Для сущности с 10 свойствами отображаются до 10 000 строк.
  - Общий объем отображаемых данных не превышает 100 000 ячеек.
- На вкладке "Сводка запроса" выберите число неисправных или автономных устройств, а затем пункт **Создать коллекцию**. Этот параметр упрощает развертывание обновлений для таких устройств.
- Вы можете сохранять **избранные** запросы, щелкая значок папки.
   ![Пример сохранения избранного запроса в CMPivot](media/cmpivot-favorite.png)

- Клиенты, обновленные до версии 1810, возвращают выходные данные объемом менее 80 КБ на сайт по быстрому коммуникационному каналу.
  - Это изменение повышает производительность просмотра выходных данных сценариев или запросов.
  - Если выходные данные сценария или запроса превышают 80 КБ, клиент отправляет данные через сообщение о состоянии.
  - Если клиент не обновлен до версии 1810, он продолжает использовать сообщения о состоянии.

- При запуске CMPivot может появиться следующее сообщение об ошибке:  **You can't use CMPivot right now due to an incompatible script version. This issue may be because the hierarchy is in the process of upgrading a site. Wait until the upgrade is complete and then try again (Использовать CMPivot прямо сейчас нельзя из-за несовместимой версии скрипта. Эта проблема может быть связана с тем, что для иерархии выполняется обновление сайта. Дождитесь завершения обновления и повторите попытку).**

  - Если вы видите это сообщение, это может означать следующее:
    - Область безопасности не настроена должным образом.
    - Возникли проблемы с процессом обновления.
    - Базовый скрипт CMPivot является несовместимым.


### <a name="scalar-functions"></a><a name="bkmk_cmpivot-functions"></a> Скалярные функции
CMPivot поддерживает следующие скалярные функции.
- **ago()** : вычитает данный временной диапазон из текущего времени в формате UTC.  
- **datetime_diff()** : вычисляет календарную разницу между двумя значениями даты и времени.  
- **now()** : возвращает текущее время в формате UTC.  
- **bin()** : округляет значения в меньшую сторону до целого значения, кратного заданному размеру ячейки.  

> [!Note]  
> Тип данных datetime представляет момент времени, обычно выраженный в виде даты и времени суток. Значения времени измеряются в единицах, равных 1 секунде. Значение даты и времени всегда указывается в часовом поясе UTC. Литералы даты и времени всегда следует выражать в формате ISO 8601, например `yyyy-mm-dd HH:MM:ss`.  

#### <a name="examples"></a>Примеры
- `datetime(2015-12-31 23:59:59.9)`: определенный литерал даты и времени   
- `now()`: текущее время  
- `ago(1d)`: текущее время минус один день  


### <a name="rendering-visualizations"></a><a name="bkmk_cmpivot-charts"></a> Отрисовка визуализаций

Теперь в CMPivot доступна базовая поддержка [оператора отрисовки](https://docs.microsoft.com/azure/kusto/query/renderoperator) KQL. Эта поддержка распространяется на следующие типы.  
- **barchart**: первый столбец является осью X и может иметь тип text, datetime или numeric. Второй столбец должен иметь тип numeric и отображается в виде горизонтальной полосы.  
- **columnchart**: аналогичен barchart с вертикальными полосами вместо горизонтальных.  
- **piechart**: первый столбец — это ось цвета, второй столбец имеет тип numeric.  
- **timechart**: линейный график. Первый столбец — это ось X с типом данных datetime. Второй столбец — это ось Y.  

#### <a name="example-bar-chart"></a>Пример: линейчатая диаграмма.
Следующий запрос отображает недавно использовавшиеся приложения в виде линейчатой диаграммы.

``` Kusto
CCMRecentlyUsedApplications
| summarize dcount( Device ) by ProductName
| top 10 by dcount_
| render barchart
```

![Пример визуализации линейчатой диаграммы CMPivot](media/1359068-cmpivot-barchart.png)

#### <a name="example-time-chart"></a>Пример: диаграмма времени
Для визуализации диаграмм времени используйте новый **bin()** оператор, позволяющий группировать события во времени. Следующий запрос отображает время запуска устройств в течение последних семи дней.

``` Kusto
OperatingSystem
| where LastBootUpTime <= ago(7d)
| summarize count() by bin(LastBootUpTime,1d)
| render timechart
```

![Пример визуализации диаграммы времени CMPivot](media/1359068-cmpivot-timechart.png)

#### <a name="example-pie-chart"></a>Пример: круговая диаграмма.
Следующий запрос отображает все версии ОС на круговой диаграмме.

``` Kusto
OperatingSystem
| summarize count() by Caption
| render piechart
```

![Пример визуализации круговой диаграммы CMPivot](media/1359068-cmpivot-piechart.png)


### <a name="hardware-inventory"></a><a name="bkmk_cmpivot-hinv"></a> Инвентаризация оборудования
Используйте CMPivot для запроса любого класса инвентаризации оборудования. Эти классы содержат любые пользовательские расширения, внесенные в инвентаризацию оборудования. CMPivot немедленно возвращает кэшированные результаты из последней проверки инвентаризации оборудования, хранящейся в базе данных сайта. В то же время он при необходимости обновляет результаты динамическими данными с клиентов в сети.

Насыщенность цвета данных в таблице результатов или на диаграмме означает вид данных — динамические или кэшированные. Например, темно-синим цветом показаны данные в режиме реального времени от клиента в сети. Светло-синим цветом выделены кэшированные данные.

#### <a name="example"></a>Пример

``` Kusto
LogicalDisk
| summarize sum( FreeSpace ) by Device
| order by sum_ desc
| render columnchart
```

![Пример запроса инвентаризации CMPivot с визуализацией в виде гистограммы](media/1359068-cmpivot-inventory.png)

#### <a name="limitations"></a>Ограничения
- Не поддерживаются следующие сущности инвентаризации оборудования:  
    - свойства массива, например IP-адрес;  
    - Real32/Real64; <!--example?-->  
    - свойства внедренного объекта. <!--example?-->  
- Имена сущностей инвентаризации должны начинаться с символа.
- Перезаписать встроенные сущности путем создания сущности инвентаризации с тем же именем невозможно.  


### <a name="scalar-operators"></a><a name="bkmk_cmpivot-operators"></a> Скалярные операторы
CMPivot включает в себя следующие скалярные операторы:  

> [!Note]  
> - LHS: строка слева от оператора  
> - RHS: строка справа от оператора  


|Оператор|Описание:|Пример (возвращает true)|
|--------|-----------|---------------------|
|==|Равно|`"aBc" == "aBc"`|
|!=|Не равно|`"abc" != "ABC"`|
|like|LHS содержит совпадение для RHS|`"FabriKam" like "%Brik%"`|
|!like|LHS не содержит совпадение для RHS|`"Fabrikam" !like "%xyz%"`|
|содержит|RHS возникает как последовательность LHS|`"FabriKam" contains "BRik"`|
|!contains|RHS не возникает в LHS|`"Fabrikam" !contains "xyz"`|
|startswith|RHS является начальной последовательностью LHS|`"Fabrikam" startswith "fab"`|
|!startswith|RHS не является начальной последовательностью LHS|`"Fabrikam" !startswith "kam"`|
|endswith|RHS является закрывающей последовательностью LHS|`"Fabrikam" endswith "Kam"`|
|!endswith|RHS не является закрывающей последовательностью LHS|`"Fabrikam" !endswith "brik"`|


### <a name="query-summary"></a><a name="bkmk_cmpivot-summary"></a> Сводка по запросу

В нижней части окна CMPivot откройте вкладку **Сводка по запросу**. Это состояние поможет вам определить клиенты, которые находятся в автономном режиме, или устранить возможные ошибки. Выберите значение в столбце Count, чтобы открыть список конкретных устройств с этим состоянием. 

Например, выберите число устройств с состоянием "Сбой". Просмотрите конкретное сообщение об ошибке и экспортируйте список этих устройств. Если ошибка заключается в невозможности распознать определенный командлет, создайте коллекцию из экспортированного списка устройств для развертывания обновления Windows PowerShell.  

### <a name="cmpivot-audit-status-messages"></a>Сообщения о состоянии аудита CMPivot

Начиная с версии 1810 при запуске CMPivot создается сообщение о состоянии аудита с **MessageID 40805**. Чтобы просмотреть сообщения о состоянии, последовательно выберите **Мониторинг** > **Состояние системы** > **Запросы сообщения о состоянии**. Можно выполнить запрос **Все сообщения об изменении состояния аудита для указанного пользователя**, **Все сообщения об изменении состояния аудита с указанного сайта** или создать собственный запрос сообщений о состоянии.

Сообщение имеет следующий формат:

MessageId 40805: Пользователь &lt;имя_пользователя> выполнил скрипт &lt;GUID_скрипта> с хэш-кодом &lt;хэш-код_скрипта> для коллекции &lt;ИД_коллекции>.

- 7DC6B6F1-E7F6-43C1-96E0-E1D16BC25C14 — это GUID скрипта для CMPivot.
- Хэш-код скрипта можно просмотреть в файле scripts.log клиента.
- Вы можете также просмотреть хэш-код в хранилище скриптов клиента. Имя файла в клиенте — &lt;GUID_скрипта>_&lt;хэш-код_скрипта>.
    - Пример имени файла: C:\Windows\CCM\ScriptStore\7DC6B6F1-E7F6-43C1-96E0-E1D16BC25C14_abc1d23e45678901fabc123d456ce789fa1b2cd3e456789123fab4c56789d0123.ps
   

![Пример сообщения о состоянии аудита CMPivot](media/cmpivot-audit-status-message.png)

## <a name="cmpivot-starting-in-version-1902"></a><a name="bkmk_cmpivot1902"></a> CMPivot с версии 1902
<!--3610960-->
Начиная с Configuration Manager версии 1902 CMPivot можно запускать с сайта центра администрирования в иерархии. Первичный сайт по-прежнему обеспечивает связь с клиентом. При запуске CMPivot с сайта центра администрирования этот компонент обменивается данными с первичным сайтом по высокоскоростному каналу подписки на сообщения. При этом стандартная репликация SQL между сайтами не используется.

Для запуска CMPivot на сайте центра администрирования требуются дополнительные разрешения, если SQL или поставщик находятся на другом компьютере или используется конфигурация SQL Always On. При таких удаленных конфигурациях происходит двойной прыжок для CMPivot.

Чтобы CMPivot мог выполняться на сайте центра администрирования в сценарии двойного прыжка, можно определить ограниченное делегирование. Описание последствий такой конфигурации для безопасности см. в статье [Обзор ограниченного делегирования Kerberos](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-constrained-delegation-overview). Протокол Kerberos должен работать сквозь все прыжки между компьютерами.<!--5746133--> Если имеется несколько удаленных конфигураций, например поставщика SQL или SMS с совместным или раздельным размещением с сайтом центра администрирования либо нескольких доверенных лесов, может потребоваться комбинация разрешений. Ниже описываются действия, которые может потребоваться выполнить.

### <a name="cas-has-a-remote-sql-server"></a>На сайте центра администрирования размещен удаленный сервер SQL

1. Перейдите на каждый сервер SQL основного сайта.
   1. Добавьте удаленный сервер SQL сайта центра администрирования и сервер сайта центра администрирования в группу [Configmgr_DviewAccess](../../plan-design/hierarchy/accounts.md#configmgr_dviewaccess).
   ![Группа Configmgr_DviewAccess на сервере SQL основного сайта](media/cmpivot-dviewaccess-group.png)
1. Откройте оснастку "Active Directory — пользователи и компьютеры".
   1. Щелкните правой кнопкой мыши каждый сервер основного сайта и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте службу сервера SQL сайта центра администрирования с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.
   1. Щелкните правой кнопкой мыши сайт центра администрирования и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте каждую службу сервера SQL основного сайта с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.

   ![Пример делегирования Active Directory для CMPivot в сценарии двойного прыжка](media/cmpivot-ad-delegation.png)

### <a name="cas-has-a-remote-provider"></a>На сайте центра администрирования размещен удаленный поставщик

1. Перейдите на каждый сервер SQL основного сайта.
   1. Добавьте учетную запись компьютера поставщика сайта центра администрирования и сервер сайта центра администрирования в группу [Configmgr_DviewAccess](../../plan-design/hierarchy/accounts.md#configmgr_dviewaccess).
1. Откройте оснастку "Active Directory — пользователи и компьютеры".
   1. Выберите компьютер поставщика сайта центра администрирования, щелкните его правой кнопкой мыши и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте каждую службу сервера SQL основного сайта с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.
   1. Выберите сервер сайта центра администрирования, щелкните его правой кнопкой мыши и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте каждую службу сервера SQL основного сайта с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.
1. Перезапустите компьютер удаленного поставщика сайта центра администрирования.

### <a name="sql-always-on"></a>SQL Always On

1. Перейдите на каждый сервер SQL основного сайта.
   1. Добавьте сервер сайта центра администрирования в группу [Configmgr_DviewAccess](../../plan-design/hierarchy/accounts.md#configmgr_dviewaccess).
1. Откройте оснастку "Active Directory — пользователи и компьютеры".
   1. Щелкните правой кнопкой мыши каждый сервер основного сайта и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте учетные записи службы сервера SQL сайта центра администрирования для узлов SQL с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.
   1. Выберите сервер сайта центра администрирования, щелкните его правой кнопкой мыши и выберите пункт **Свойства**.
      1. На вкладке делегирования выберите третий параметр **Доверять компьютеру делегирование указанных служб**. 
      1. Выберите **Использовать только Kerberos**.
      1. Добавьте каждую службу сервера SQL основного сайта с портом и экземпляром.
      1. Эти изменения должны производиться с учетом политики безопасности организации.
1. Убедитесь в том, что [имя субъекта-службы опубликовано](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/listeners-client-connectivity-application-failover?view=sql-server-2017#SPNs) для имени прослушивателя SQL сайта центра администрирования и каждого имени прослушивателя SQL основного сайта.
1. Перезапустите серверы SQL основного сайта.
1. Перезапустите сервер сайта центра администрирования и серверы SQL сайта центра администрирования.

## <a name="cmpivot-starting-in-version-1906"></a><a name="bkmk_cmpivot1906"></a> CMPivot с версии 1906

Начиная с версии 1906, в CMPivot были добавлены следующие элементы:

- [объединения, дополнительные операторы и агрегаторы;](#bkmk_cmpivot_joins)
- [добавлены разрешения CMPivot для роли администратора безопасности;](#bkmk_cmpivot_secadmin1906)
- [Автономный CMPivot](#bkmk_standalone)

### <a name="add-joins-additional-operators-and-aggregators-in-cmpivot"></a><a name="bkmk_cmpivot_joins"></a> Добавление соединений, дополнительных операторов и агрегатов в CMPivot
<!--4054074-->
Теперь у вас есть дополнительные арифметические операторы, агрегаторы и возможность добавлять объединения запросов, такие как использование реестра и файла вместе. Были добавлены следующие новые элементы.

#### <a name="table-operators"></a>Табличные операторы

|Табличные операторы| Описание:|
|-----|-----|
| [join](https://docs.microsoft.com/azure/kusto/query/joinoperator)| Слияние строк двух таблиц для формирования новой таблицы путем сопоставления для того же устройства|
|render|Отображает результаты как графический вывод.|

Оператор render уже существует в CMPivot. Добавлена поддержка нескольких рядов и инструкции **with**. Дополнительные сведения см. в разделе [Примеры](#bkmk_cmpivot_examples1906) раздел и статье Kusto [Оператор join](https://docs.microsoft.com/azure/kusto/query/joinoperator).

#### <a name="limitations-for-joins"></a>Ограничения для соединений

1. Столбец соединения всегда неявно выбирается как поле **Device**.
1. Можно использовать не более 5 соединений в запросе.
1. Всего можно использовать не более 64 столбцов.

#### <a name="scalar-operators"></a>Скалярные операторы

|Оператор| Описание:|Пример|
|-----|-----|-----|
| + | Add| `2 + 1, now() + 1d`|
| - |  Subtract| `2 - 1, now() - 1d`|
| * | Multiply| `2 * 2`|
| / | Divide | `2 / 1`|
| % | Modulo | `2 % 1`

#### <a name="aggregation-functions"></a>Агрегатные функции

|Функция| Описание:|
|-----|-----|
| percentile()| Возвращает оценку для указанного процентиля ближайшего ранга популяции, определенной Expr|
| sumif() | Возвращает сумму Expr, для которого Predicate возвращает значение true|

#### <a name="scalar-functions"></a>Скалярные функции

|Функция| Описание:|
|-----|-----|
| case()| Вычисляет список предикатов и возвращает первое выражение, предикат которого выполняется |
| iff() | Вычисляет первый аргумент и возвращает значение второго или третьего аргумента в зависимости от того, вернул предикат значение true (второй) или false (третий)|
 | indexof() | Функция возвращает отсчитываемый от нуля индекс первого вхождения указанной строки во входной строке|
| strcat() | Объединяет от 1 до 64 аргументов |
| strlen()| Возвращает длину входной строки в символах|
| substring() | Извлекает подстроку из исходной строки, начиная с какого-либо индекса до конца строки |
| tostring() | Преобразует входные данные в строку |

#### <a name="examples"></a><a name="bkmk_cmpivot_examples1906"></a> Примеры

- Показать устройство, изготовителя, модель и версию ОС:

   ``` Kusto
   ComputerSystem
   | project Device, Manufacturer, Model
   | join (OperatingSystem | project Device, OSVersion=Caption)
   ```

- Показать график времени загрузки для устройства:

   ``` Kusto
   SystemBootData
   | where Device == 'MyDevice'
   | project SystemStartTime, BootDuration, OSStart=EventLogStart, GPDuration, UpdateDuration
   | order by SystemStartTime desc
   | render barchart with (kind=stacked, title='Boot times for MyDevice', ytitle='Time (ms)')
   ```

   ![Нормированная линейчатая диаграмма, показывающая время загрузки для устройства в миллисекундах](./media/4054074-render-using-with-statement.png)

### <a name="added-cmpivot-permissions-to-the-security-administrator-role"></a><a name="bkmk_cmpivot_secadmin1906"></a> Добавлены разрешения CMPivot для роли администратора безопасности
<!--4683130-->

Начиная с версии 1906 во встроенную в Configuration Manager роль **Администратор безопасности** были добавлены следующие разрешения:

 - **Чтение** скрипта SMS.
 - **Запуск CMPivot** для коллекции.
 - **Чтение** отчета инвентаризации.

>[!NOTE]
> Разрешение на **выполнение скриптов** — это надмножество разрешения на **запуск CMPivot**.
 

### <a name="cmpivot-standalone"></a><a name="bkmk_standalone"></a> Автономный CMPivot
<!--3555890, 4619340, 4683130 -->

Начиная с версии 1906, CMPivot можно использовать как автономное приложение. Автономная версия CMPivot доступна только на английском языке. Запустите CMPivot за пределами консоли Configuration Manager для просмотра состояния устройств в вашей среде в режиме реального времени. Это изменение позволяет использовать CMPivot на устройстве без предварительной установки консоли.

> [!Tip]  
> Эта функция появилась в версии 1906 [на стадии предварительного выпуска](pre-release-features.md). Начиная с версии 2002, эта функция больше не считается функцией предварительной версии.  

Вы можете поделиться возможностями CMPivot с другими людьми, такими как специалисты службы поддержки или администраторы безопасности, у которых на компьютере не установлена ​​консоль. Эти люди смогут использовать CMPivot для запроса Configuration Manager вместе с другими средствами, которые они традиционно используют. Обмениваясь этими обширными данными управления, вы можете совместно работать над упреждающим решением бизнес-задач, связанных между собой.

#### <a name="install-cmpivot-standalone"></a>Установка автономной версии CMPivot

1. Установите разрешения, необходимые для запуска CMPivot. Дополнительные сведения см. в разделе [Предварительные требования](#prerequisites). Можно также использовать роль [Администратора безопасности ](#bkmk_cmpivot_secadmin1906), если разрешения подходят для этого пользователя.
2. Установщик приложения CMPivot расположен по следующему пути: `<site install path>\tools\CMPivot\CMPivot.msi`. Можно запустить его отсюда или скопировать в другое место.
3. При запуске автономного приложения CMPivot нужно будет выполнить подключение к сайту. Укажите полное доменное имя или имя компьютера Центра администрирования или сервера первичного сайта.
   - Каждый раз, при открытии автономной версии CMPivot, вам будет предложено подключиться к серверу сайта.
4. Найдите коллекцию, для которой вы хотите запустить CMPivot, а затем отправьте свой запрос.

   ![Найдите коллекцию, для которой вы хотите отправить свой запрос.](./media/3555890-cmpivot-standalone-browse-collection.png)

> [!NOTE]
> Команды контекстного меню мыши, такие как **Запуск сценариев**, **Обозреватель ресурсов** и веб-поиск, недоступны в автономной версии CMPivot. Основное назначение автономной версии CMPivot заключается в выполнении запросов независимо от инфраструктуры Configuration Manager. Чтобы помочь администраторам безопасности, автономная версия CMpivot позволяет подключиться к Центру безопасности в Microsoft Defender. <!--5605358-->

## <a name="cmpivot-starting-in-version-1910"></a><a name="bkmk_cmpivot1910"></a> CMPivot с версии 1910
<!--5410930, 3197353-->
Начиная с версии 1910 CMPivot был значительно оптимизирован для уменьшения сетевого трафика и нагрузки на серверы. Кроме того, был добавлен ряд сущностей и усовершенствований сущностей, помогающих в устранении неполадок и поиске. Далее представлены изменения, появившиеся для CMPivot в версии 1910:

- [Оптимизация модуля CMPivot](#bkmk_optimization)
- Дополнительные сущности и усовершенствования сущностей:
  - журналы событий Windows ([WinEvent](#bkmk_WinEvent));
  - содержимое файла ([FileContent](#bkmk_File));
  - библиотеки DLL, загруженные процессами ([ProcessModule](#bkmk_ProcessModule));
  - сведения Azure Active Directory ([AADStatus](#bkmk_AadStatus));
  - состояние Endpoint Protection ([EPStatus](#bkmk_EPStatus)).
- [Оценка запросов локального устройства с помощью автономной версии CMPivot](#bkmk_local-eval)
- [Другие улучшения CMPivot](#bkmk_Other)


### <a name="optimizations-to-the-cmpivot-engine"></a><a name="bkmk_optimization"></a> Оптимизация модуля CMPivot
<!--3197353-->
Чтобы сократить сетевой трафик и нагрузку на серверы, CMPivot был оптимизирован в версии 1910. Многие операции запроса теперь выполняются непосредственно на клиенте, а не на серверах. Это изменение также означает, что некоторые операции CMPivot возвращают минимальные данные из первого запроса. Если вы хотите детализировать данные для получения дополнительных сведений, можно выполнить новый запрос для получения дополнительных данных от клиента. Например, ранее при выполнении запроса суммарного количества на сервер был возвращен большой набор данных.  Хотя возврат большого набора данных обеспечивает немедленную детализацию, в большинстве случаев требуется лишь суммарное количество. Если в версии 1910 выбрать детализацию по конкретному клиенту, выполняется другой сбор данных, возвращающий дополнительные запрошенные данные. Это изменение улучшает производительность и масштабируемость запросов, адресованных большому числу клиентов. <!--3197353, 5458337-->

#### <a name="examples"></a>Примеры

Оптимизация CMPivot радикально снижает нагрузку на сеть и ЦП сервера при выполнении запросов CMPivot. Благодаря этой оптимизации мы можем теперь обрабатывать гигабайты клиентских данных в реальном времени. Эти оптимизации иллюстрируют следующие запросы:

- Поиск сведений об ошибках проверки подлинности во всех журналах событий на всех клиентах предприятия.

   ``` Kusto
   EventLog('Security')
   | where  EventID == 4673
   | summarize count() by Device
   | order by count_ desc
   ```

- Поиск файла по хэшу.

   ``` Kusto
   Device
   | join kind=leftouter ( File('%windir%\\system32\\*.exe')
   | where SHA256Hash == 'A92056D772260B39A876D01552496B2F8B4610A0B1E084952FE1176784E2CE77')
   | project Device, MalwareFound = iif( isnull(FileName), 'No', 'Yes')
   ```

### <a name="wineventlognametimespan"></a><a name="bkmk_WinEvent"></a> WinEvent(\<logname>,[\<timespan>])

Эта сущность используется для получения событий из журналов событий и файлов журнала трассировки событий. Сущность получает данные из журналов событий, созданных с помощью технологии журнала событий Windows. Сущность также получает события в файлах журналов, создаваемых функцией трассировки событий для Windows (ETW). WinEvent просматривает события, произошедшие в течение последних 24 часов по умолчанию. Однако 24-часовое значение по умолчанию можно изменить, включив интервал времени.

``` Kusto
WinEvent('Microsoft-Windows-HelloForBusiness/Operational', 1d)
| where LevelDisplayName =='Error'
| summarize count() by Device
```

### <a name="filecontentfilename"></a><a name="bkmk_File"></a> FileContent(\<filename>)

FileContent используется для получения содержимого текстового файла.

``` Kusto
FileContent('c:\\windows\\SMSCFG.ini')
| where Content startswith  'SMS Unique Identifier='
| project Device, SMSId= substring(Content,22)
```

### <a name="processmoduleprocessname"></a><a name="bkmk_ProcessModule"></a> ProcessModule(\<processname>)  

Эта сущность используется для перечисления модулей (DLL), загруженных заданным процессом. ProcessModule полезен при поиске вредоносных программ, которые скрываются в допустимых процессах.  

``` Kusto
ProcessModule('powershell')
| summarize count() by ModuleName
| order by count_ desc
```

### <a name="aadstatus"></a><a name="bkmk_AadStatus"></a> AadStatus

Эта сущность может использоваться для получения текущей информации об идентификаторе Azure Active Directory с устройства.

``` Kusto
AadStatus
| project Device, IsAADJoined=iif( isnull(DeviceId),'No','Yes')
| summarize DeviceCount=count() by IsAADJoined
| render piechart
```

### <a name="epstatus"></a><a name="bkmk_EPStatus"></a> EPStatus

EPStatus используется для получения состояния антивредоносного ПО, установленного на компьютере.

``` Kusto
EPStatus
| project Device, QuickScanAge=datetime_diff('day',now(),QuickScanEndTime)
| summarize DeviceCount=count() by QuickScanAge
| order by QuickScanAge
| render barchart
```

### <a name="local-device-query-evaluation-using-cmpivot-standalone"></a><a name="bkmk_local-eval"></a> Оценка запросов локального устройства с помощью автономной версии CMPivot
<!--3197353-->
При использовании CMPivot вне консоли Configuration Manager можно запрашивать само локальное устройство без инфраструктуры Configuration Manager. Теперь вы можете использовать запросы Azure Log Analytics CMPivot, чтобы быстро просматривать данные WMI на локальном устройстве. Благодаря этому также можно выполнять проверку и уточнение запросов CMPivot перед их запуском в более крупной среде. Автономная версия CMPivot доступна только на английском языке. Дополнительные сведения об установке автономной версии CMPivot см. [здесь](#install-cmpivot-standalone).

#### <a name="known-issues-for-local-device-query-evaluation"></a>Известные проблемы для оценки запросов локального устройства

 - Если вы выполняете запрос на **этом компьютере** для сущности WMI, к которой у вас нет доступа, например заблокированного класса WMI, может произойти сбой CMPivot. Запустите CMPivot, используя учетную запись с повышенными привилегиями для запроса этих сущностей. <!--5753242-->
- При запросе сущностей, отличных от WMI, на **этом компьютере** вы столкнетесь с сообщением о **недопустимом пространстве имен** или неоднозначным исключением.
- Запустите автономную версию CMPivot с помощью ярлыка из меню "Пуск", а не непосредственно из пути к исполняемому файлу. <!--5787962-->

### <a name="other-enhancements"></a><a name="bkmk_Other"></a> Другие улучшения

- С помощью нового оператора `like` можно выполнять запросы с регулярными выражениями. Пример.<!--3056858-->
  
   ```kusto
   //Find BIOS manufacture that contains any word like Micro, such as Microsoft
   Bios
   | where Manufacturer like '%Micro%'
   ```

- Мы обновили сущности **CcmLog()** и **EventLog()** , чтобы просматривать только сообщения за последние 24 часа по умолчанию. Это поведение можно переопределить, передав необязательный интервал времени. Например, следующий запрос будет просматривать события за последний час:

   ```kusto
   CcmLog('Scripts',1h)
   ```

- Сущность **File()** была обновлена для получения сведений о скрытых и системных файлах и содержит хэш MD5. Хотя хэш MD5 не такой точный, как хэш SHA256, он, как правило, часто указывается в большинстве бюллетеней о вредоносных программах.  

- В запросы можно добавлять комментарии.<!-- 5431463 --> Это поведение полезно при совместном использовании запросов. Пример.

    ``` Kusto
    //Get the top ten devices sorted by user
    Device
    | top 10 by UserName
    ```

- CMPivot автоматически подключается к последнему сайту.<!-- 5420395 --> После запуска CMPivot можно подключиться к новому сайту, если это необходимо.

- В меню **Экспорт** выберите новый параметр **Query link to clipboard** (Запрос ссылки на буфер обмена).<!-- 5431577 --> Это действие копирует ссылку в буфер обмена, к которому можно предоставить общий доступ другим пользователям. Пример.

    `cmpivot:Ly8gU2FtcGxlIHF1ZXJ5DQpPcGVyYXRpbmdTeXN0ZW0NCnwgc3VtbWFyaXplIGNvdW50KCkgYnkgQ2FwdGlvbg0KfCBvcmRlciBieSBjb3VudF8gYXNjDQp8IHJlbmRlciBiYXJjaGFydA==`

    Эта ссылка открывает автономный CMPivot с помощью следующего запроса:

    ``` Kusto
    // Sample query
    OperatingSystem
    | summarize count() by Caption
    | order by count_ asc
    | render barchart
    ```

    > [!TIP]
    > Чтобы эта ссылка работала, [установите автономную версию CMPivot](#install-cmpivot-standalone).

- Если в результатах запроса устройство зарегистрировано в Advanced Threat Protection (ATP) в Microsoft Defender, щелкните его правой кнопкой мыши, чтобы запустить интерактивный портал **Центра безопасности Microsoft Defender**.

### <a name="known-issues-for-cmpivot-in-version-1910"></a>Известные проблемы для CMPivot в версии 1910

- Баннер максимального числа результатов может не отображаться при достижении предела. <!--5431427-->
  - Каждый клиент имеет ограничение в 128 КБ данных на запрос.
  - Результаты могут быть усечены, если результаты запроса больше 128 КБ.
  
## <a name="cmpivot-starting-in-version-2002"></a><a name="bkmk_2002"></a> CMPivot с версии 2002
<!--5870934-->
Мы упростили навигацию по сущностям CMPivot. Начиная с Configuration Manager версии 2002, вы можете использовать поиск по сущностям CMPivot. Также добавлены новые значки, которые позволяют легко различать сущности и типы объектов сущностей.

![Поиск сущностей CMPivot](./media/5870934-search-cmpivot-entities.png)

 
## <a name="inside-cmpivot"></a>Особенности работы CMPivot

CMPivot отправляет запросы клиентам, используя "быстрый канал" Configuration Manager. Этот коммуникационный канал, связывающий сервер с клиентом, также используется и другими функциями, такими как действия уведомления клиента, состояние клиента и Endpoint Protection. Клиенты возвращают результаты с помощью аналогичной системы быстрых сообщений о состоянии. Сообщения о состоянии временно хранятся в базе данных. Дополнительные сведения о портах, используемых для уведомления клиента, см. в статье [Порты](../../plan-design/hierarchy/ports.md#BKMK_PortsClient-MP).

Запросы и результаты представляют собой лишь текст. Сущности **InstallSoftware** и **Process** возвращают одни из наиболее крупных результирующих наборов. При тестировании производительности максимальный размер файла сообщения о состоянии от одного клиента для этих запросов был меньше **1 КБ**. Если масштабировать все это до крупной среды с 50 000 активных клиентов, этот одноразовый запрос приведет к передаче менее чем 50 МБ данных по сети. Все подчеркнутые элементы на странице приветствия возвращают менее 1 КБ данных для каждого клиента.

![Пример подчеркнутых сущностей CMPivot](media/cmpivot-underlined-entities.png)

Начиная с Configuration Manager 1810 CMPivot может запрашивать данные инвентаризации оборудования, в том числе расширенные классы инвентаризации оборудования. Эти новые сущности (которые не подчеркиваются на странице приветствия) могут возвращать наборы данных гораздо большего размера в зависимости от того, сколько данных определено для свойства инвентаризации оборудования. Например, сущность InstalledExecutable может возвращать несколько мегабайтов данных для клиента в зависимости от того, какие данные вы запрашиваете. При получении больших наборов данных инвентаризации оборудования из больших коллекций с помощью CMPivot учитывайте производительность и масштабируемость систем.

Время ожидания запроса истекает через час. Например, коллекция содержит 500 устройств, и 450 клиентов подключены к сети. Эти активные устройства получают запрос и возвращают результаты почти мгновенно. Если оставить окно CMPivot открытым, то как только другие 50 клиентов переходят в рабочий режим, они также получают запрос и возвращают результаты. 

## <a name="log-files"></a>Файлы журнала

 Взаимодействия CMPivot регистрируются в указанных ниже файлах журнала.

**На стороне сервера:**
- Smsprov.log;
- BgbServer.log;
- StateSys.log.

**На стороне клиента:**
- CCMNotificationAgent.log
- Scripts.log;
- StateMessage.log

Дополнительные сведения см. в статьях о [файлах журнала](../../plan-design/hierarchy/log-files.md) и [устранении неполадок CMPivot](cmpivot-tsg.md).

## <a name="next-steps"></a>Дальнейшие шаги
 
[Устранение неполадок CMPivot](cmpivot-tsg.md)

[Создание и выполнение сценариев PowerShell](../../../apps/deploy-use/create-deploy-scripts.md)


