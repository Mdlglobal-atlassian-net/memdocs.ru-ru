---
title: Сертификаты для локальной среды MDM
titleSuffix: Configuration Manager
description: Настройте сертификаты для доверенного взаимодействия с локальным управлением мобильными устройствами (MDM) в Configuration Manager.
ms.date: 01/09/2020
ms.prod: configuration-manager
ms.technology: configmgr-mdm
ms.topic: conceptual
ms.assetid: 2a7d7170-1933-40e9-96d6-74a6eb7278e2
author: aczechowski
ms.author: aaroncz
manager: dougeby
ms.openlocfilehash: bc63a21970bb522407c86d027690b83894b3cb99
ms.sourcegitcommit: 578ad1e8088f7065b565e8a4f4619f5a26b94001
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81724668"
---
# <a name="set-up-certificates-for-trusted-communications-with-on-premises-mdm"></a>Настройка сертификатов для доверенного взаимодействия с локальной системой MDM

*Область применения: Configuration Manager (Current Branch)*

Для Configuration Manager локального управления мобильными устройствами (MDM) необходимо настроить роли системы сайта для доверенного взаимодействия с управляемыми устройствами. Требуются сертификаты двух типов:

- **Сертификат веб-сервера** в службах IIS на серверах, на которых размещаются необходимые роли системы сайта. Если на одном сервере размещается несколько ролей системы сайта, то для этого сервера требуется только один сертификат. Если каждая роль находится на отдельном сервере, каждому серверу требуется отдельный сертификат.

- **Доверенный корневой сертификат** центра сертификации (ЦС), который выдает сертификаты веб-сервера. Установите этот корневой сертификат на всех устройствах, которым требуется подключение к ролям системы сайта.

Для устройств, присоединенных к домену, при использовании служб Active Directory Certificate Services они могут автоматически установить эти сертификаты на всех устройствах. Для устройств, не присоединенных к домену, установите доверенный корневой сертификат другими способами.

Для устройств с невысокой регистрацией можно включить сертификат в пакет регистрации. При регистрации устройств пользователями необходимо добавить сертификат по электронной почте, скачать через Интернет или каким-то другим способом.

При использовании хорошо известного общедоступного центра сертификации, такого как VeriSign или GoDaddy, для выдаче сертификатов сервера можно избежать необходимости вручную устанавливать доверенный корневой сертификат на каждом устройстве. Большинство устройств изначально доверяют эти общедоступные центры. Этот метод является полезной альтернативой для зарегистрированных пользователем устройств, а не установки сертификата другими способами.

> [!IMPORTANT]  
> Существует множество способов настройки сертификатов для доверенного взаимодействия между устройствами и серверами системы сайта для локального MDM. Сведения в этой статье представляют собой пример одного из способов выполнения этой задачи. Этот метод требует Active Directory служб сертификации с центром сертификации и ролью веб-регистрации центра сертификации. Дополнительные сведения см. в статье [Active Directory Certificate Services](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831740\(v=ws.11\)).

## <a name="publish-the-crl"></a><a name="bkmk_configCa"></a>Публикация списка отзыва сертификатов

По умолчанию центр сертификации (ЦС) Active Directory использует списки отзыва сертификатов (CRL) на основе LDAP. Он позволяет подключаться к списку отзыва сертификатов для устройств, присоединенных к домену. Чтобы разрешить устройствам, не присоединенным к домену, доверять сертификатам, выданным ЦС, добавьте список отзыва сертификатов на основе HTTP.

1. На сервере, на котором запущен центр сертификации для сайта, перейдите в меню **Пуск** , выберите **Администрирование**и щелкните **центр сертификации**.

1. В консоли центра сертификации щелкните правой кнопкой мыши **CertificateAuthority**и выберите пункт **свойства**.

1. В свойствах CertificateAuthority перейдите на вкладку **Extensions (расширения** ). Убедитесь, что для **параметра расширение SELECT** задано значение **точка распространения списка отзыва сертификатов (CDP)**.

1. Выберите `http://<ServerDNSName>/CertEnroll/<CAName><CRLNameSuffix><DeltaCRLAllowed>.crl`. Затем выберите следующие параметры:

    - **Включить в списки отзыва сертификатов. клиенты используют его для поиска расположений разностных списков отзыва сертификатов.**

    - **Включать в CDP-расширение выданных сертификатов.**

    - **Включить в расширение IDP выданных списков отзыва сертификатов**

1. Перейдите на вкладку **модуль выхода** . Выберите **свойства**, а затем выберите **Разрешить публикацию сертификатов в файловой системе**. Вы увидите уведомление о перезапуске Active Directory служб сертификатов.

1. Щелкните правой кнопкой мыши **отозванные сертификаты**, выберите **все задачи**, а затем нажмите кнопку **опубликовать**.

1. В окне Публикация списка отзыва сертификатов выберите **только разностный CRL**, а затем нажмите кнопку **ОК** , чтобы закрыть окно.

## <a name="create-the-certificate-template"></a><a name="bkmk_certTempl"></a>Создание шаблона сертификата

Центр сертификации использует шаблон сертификата веб-сервера для выдаче сертификатов для серверов, на которых размещаются роли системы сайта. Эти серверы будут являться конечными точками SSL для доверенного взаимодействия между ролями системы сайта и зарегистрированными устройствами.

1. Создайте группу безопасности домена с именем **серверы MDM Configuration Manager**. Добавьте в группу учетные записи компьютеров серверов системы сайта.

1. В консоли центра сертификации щелкните правой кнопкой мыши **шаблоны сертификатов**и выберите пункт **Управление**. Это действие загружает консоль шаблонов сертификатов.

1. В области результатов щелкните правой кнопкой мыши запись, в которой отображается **веб-сервер** , в столбце **Отображаемое имя шаблона** , а затем выберите пункт **дублировать шаблон**.

1. В окне **дубликат шаблона** выберите **Windows 2003 Server, Enterprise edition** или **Windows 2008 Server, Enterprise Edition**, а затем нажмите кнопку **ОК**.

    > [!TIP]
    > Configuration Manager поддерживает шаблоны сертификатов Windows 2008 Server, также известные как сертификаты версии V3 или криптографии следующего поколения (CNG). Дополнительные сведения см. в статье [Общие сведения о сертификатах CNG](../../core/plan-design/network/cng-certificates-overview.md).

    Если ваш ЦС работает под управлением Windows Server 2012 или более поздней версии, в этом окне не отображается параметр версия шаблона сертификата. После дублирования шаблона выберите версию на вкладке **Совместимость** свойств шаблона.

1. В окне **Свойства нового шаблона** на вкладке **Общие** введите имя шаблона. Центр сертификации использует это имя для создания веб-сертификатов, которые будут использоваться на Configuration Manager системах сайта. Например, введите **Configuration Manager MDM Web Server**.

1. Перейдите на вкладку **имя субъекта** и выберите **Сборка на основе сведений о Active Directory**. В поле Формат имени субъекта укажите **DNS-имя**. Если выбрано **имя участника-пользователя (UPN)** , отключите параметр для альтернативного имени субъекта.

1. Перейдите на вкладку **Безопасность** .

    1. Удалите разрешение **Регистрация** из групп безопасности **Администраторы домена** и **Администраторы предприятия** .

    1. Нажмите кнопку **Добавить**и введите имя группы безопасности. Например, **серверы MDM ConfigMgr**. Нажмите кнопку **ОК** , чтобы закрыть окно.

    1. Выберите разрешение **Регистрация** для этой группы. Не удаляйте разрешение **Чтение** .

1. Нажмите кнопку **ОК** , чтобы сохранить изменения и закрыть консоль Шаблоны сертификатов.

1. В консоли центра сертификации щелкните правой кнопкой мыши **шаблоны сертификатов**, выберите **создать**, а затем выберите **шаблон сертификата для выдачи**.

1. В окне **Включение шаблонов сертификатов** выберите новый шаблон. Например, **Configuration Manager MDM Web Server**. Затем нажмите кнопку **ОК** , чтобы сохранить и закрыть окно.

## <a name="request-the-certificate"></a><a name="bkmk_requestCert"></a>Запрос сертификата

Этот процесс описывает, как запросить сертификат веб-сервера для IIS. Выполните этот процесс для каждого сервера системы сайта, на котором размещается одна из ролей для локального MDM.

1. На сервере системы сайта, на котором размещается одна из ролей, откройте командную строку от имени администратора. Введите `mmc` , чтобы открыть пустую консоль управления (Майкрософт).

1. В окне консоли перейдите в меню **файл** и выберите команду **Добавить или удалить оснастку**.

    1. Выберите **Сертификаты** из списка доступных оснасток и нажмите кнопку **Добавить**.

    1. В окне оснастки "сертификаты" выберите **учетная запись компьютера**. Нажмите кнопку **Далее**, а затем кнопку **Готово** , чтобы управлять локальным компьютером.

    1. Нажмите кнопку **ОК** , чтобы закрыть окно Добавление или удаление оснастки.

1. Разверните узел **Сертификаты (локальный компьютер)** и выберите **личное** хранилище. Перейдите в меню **действие** , выберите **все задачи**и щелкните **запросить новый сертификат**. Это действие взаимодействует со службами Active Directory Certificate Services для создания нового сертификата с помощью ранее созданного шаблона.

    1. В мастере регистрации сертификатов на странице перед началом работы нажмите кнопку **Далее**.

    1. На странице Выбор политики регистрации сертификатов выберите **Active Directory Политика регистрации**, а затем нажмите кнопку **Далее**.

    1. Выберите шаблон сертификата веб-сервера (**веб-сервер MDM Configuration Manager**) и нажмите кнопку **Регистрация**.

    1. После запроса сертификата нажмите кнопку **Готово**.

Каждому серверу требуется уникальный сертификат веб-сервера. Повторите эту процедуру для каждого сервера, на котором размещается одна из требуемых ролей системы сайта. Если на одном сервере размещаются все роли системы сайта, необходимо просто запросить один сертификат веб-сервера.

## <a name="bind-the-certificate"></a><a name="bkmk_bindCert"></a>Привязка сертификата

Следующим шагом является привязка нового сертификата к веб-серверу. Выполните эту процедуру для каждого сервера, на котором размещаются роли системы сайта *точки регистрации* и *прокси-точки регистрации* . Если на одном сервере размещаются все роли системы сайта, этот процесс нужно выполнить только один раз.

> [!NOTE]
> Вам не нужно выполнять этот процесс для ролей системы сайта точки распространения и точки управления устройствами. Они автоматически получают требуемый сертификат во время регистрации.

1. На сервере, где размещается точка регистрации или прокси-точка регистрации, перейдите в меню " **Пуск** ", выберите " **Администрирование**" и щелкните " **Диспетчер IIS**".

1. В списке подключений выберите **веб-сайт по умолчанию**, а затем щелкните **изменить привязки**.

    1. В окне привязки сайта выберите **HTTPS**и нажмите кнопку **изменить**.

    1. В окне Изменение привязки сайта выберите только что зарегистрированный сертификат для **SSL-сертификата**. Нажмите кнопку **ОК** , чтобы сохранить, а затем нажмите кнопку **Закрыть**.

1. В консоли диспетчера служб IIS в списке подключений выберите веб-сервер. На панели действий в правой части щелкните **перезапустить**. Это действие перезапускает службу веб-сервера.

## <a name="export-the-trusted-root-certificate"></a><a name="bkmk_exportCert"></a>Экспорт доверенного корневого сертификата

Active Directory службы сертификатов автоматически устанавливают необходимый сертификат из центра сертификации на всех присоединенных к домену устройствах. Чтобы получить сертификат, необходимый для связи устройств, не присоединенных к домену, с ролями системы сайта, экспортируйте его из сертификата, привязанного к веб-серверу.

1. В диспетчере служб IIS выберите **веб-сайт по умолчанию**. На панели действий в правой части выберите **привязки**.

1. В окне привязки сайта выберите **HTTPS**и нажмите кнопку **изменить**.

1. Выберите сертификат веб-сервера и щелкните **Просмотр**.

1. В свойствах сертификата веб-сервера перейдите на вкладку **путь сертификации** . Выберите корень пути сертификации и щелкните **Просмотреть сертификат**.

1. В свойствах корневого сертификата перейдите на вкладку **сведения** , а затем выберите **Копировать в файл**.

1. В мастере экспорта сертификатов на странице приветствия нажмите кнопку **Далее**.

1. Выберите **двоичный файл X. 509 в кодировке DER (. CER)** в качестве формата и нажмите кнопку **Далее**.

1. Введите путь и имя файла, чтобы указать этот доверенный корневой сертификат. В качестве имени файла нажмите кнопку **Обзор...**, выберите расположение для сохранения файла сертификата, имя файла и нажмите кнопку **Далее**.

1. Проверьте параметры и нажмите кнопку **Готово** , чтобы экспортировать сертификат в файл.

В зависимости от структуры центра сертификации может потребоваться экспортировать дополнительные корневые сертификаты подчиненного ЦС. Повторите эту процедуру, чтобы экспортировать другие сертификаты из пути сертификации веб-сервера.

## <a name="next-step"></a>Следующий шаг

> [!div class="nextstepaction"]
> [Настройка регистрации устройств](set-up-device-enrollment-on-premises-mdm.md)
