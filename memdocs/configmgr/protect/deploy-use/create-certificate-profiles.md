---
title: Создание профилей сертификатов SCEP
titleSuffix: Configuration Manager
description: Узнайте, как использовать профили сертификатов для предоставления управляемым устройствам необходимых сертификатов
ms.date: 11/29/2019
ms.prod: configuration-manager
ms.technology: configmgr-protect
ms.topic: conceptual
ms.assetid: 634d612c-92d7-4c03-873a-b2e730c9a72d
author: mestew
ms.author: mstewart
manager: dougeby
ms.openlocfilehash: 159afbf2c5aae9516fc5244ee06a2aa484290c20
ms.sourcegitcommit: bbf820c35414bf2cba356f30fe047c1a34c5384d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "81705772"
---
# <a name="create-certificate-profiles"></a>Создание профилей сертификатов

*Область применения: Configuration Manager (Current Branch)*

Профили сертификатов в Configuration Manager служат для предоставления управляемым устройствам сертификатов, которые требуются им для доступа к ресурсам организации. Прежде чем создавать профили сертификатов, настройте инфраструктуру сертификатов, как описано в разделе [Настройка инфраструктуры сертификатов](certificate-infrastructure.md).  

> [!TIP]
> В случае совместно управляемых устройств можно переместить рабочую нагрузку [**Политики доступа к ресурсам**](../../comanage/workloads.md#resource-access-policies) в Intune, а затем использовать политики Intune для управления этими сертификатами. Дополнительные сведения см. в статье [о переключении рабочих нагрузок](../../comanage/how-to-switch-workloads.md).

В этой статье описывается создание профилей доверенных корневых сертификатов и сертификатов SCEP. Сведения о создании профилей сертификатов PFX см. в разделе [Создание профилей сертификатов PFX](../../mdm/deploy-use/create-pfx-certificate-profiles.md).

Создание профиля сертификата.

1. Запустите мастер создания профилей сертификатов.
1. Укажите общие сведения о профиле сертификата.
1. Настройте сертификат доверенного центра сертификации (ЦС).  
1. Настройте сведения о сертификате SCEP.  
1. Укажите поддерживаемые платформы для профиля сертификата.

## <a name="start-the-wizard"></a>Запуск мастера  

Процедура запуска создания профилей сертификатов:

1. На консоли Configuration Manager в рабочей области **Активы и соответствие** разверните узлы **Параметры соответствия** и **Доступ к ресурсам компании**, а затем выберите **Профили сертификатов**.  

1. На вкладке ленты **Главная** в группе **Создать** выберите **Создать профиль сертификата**.  

## <a name="general"></a>Общие

На странице **Общие** мастера создания профиля сертификата укажите перечисленные ниже сведения.  

- **Имя** — Введите уникальное имя для профиля сертификата. Можно использовать не более 256 символов.  

- **Описание**. Введите описание, которое предоставляет общие сведения о данном профиле сертификата. Укажите и другие важные сведения, которые помогут его узнать в консоли Configuration Manager. Можно использовать не более 256 символов.  

- Укажите тип создаваемого профиля сертификата:

  - **Сертификат доверенного ЦС**. Выберите этот тип профиля сертификата, если необходимо развернуть сертификат доверенного корневого центра сертификации (ЦС) или промежуточного ЦС для формирования цепочки сертификатов, когда пользователь или устройство должны проверять подлинность другого устройства. Этим устройством может быть, например, сервер RADIUS или VPN-сервер.
  
    Перед созданием профиля сертификата SCEP настройте профиль сертификата доверенного ЦС. В этом случае сертификат доверенного ЦС должен предназначаться для ЦС, выдающего сертификат для пользователя или устройства.  

  - **Параметры протокола SCEP**. Выберите этот тип, если необходимо запросить сертификат для пользователя или устройства с помощью протокола SCEP и службы роли службы регистрации сертификатов для сетевых устройств (NDES).

  - **Обмен личной информацией — параметры PKCS 12 (PFX) — импорт**. Выберите этот параметр, чтобы импортировать сертификат PFX. Дополнительные сведения см. в статье об [импорте профилей сертификатов PFX](../../mdm/deploy-use/import-pfx-certificate-profiles.md).

  - **Обмен личной информацией — параметры PKCS #12 (PFX) — создание**: выберите этот параметр для обработки сертификатов PFX с помощью центра сертификации. Дополнительные сведения см. в разделе [Создание профилей сертификатов PFX](../../mdm/deploy-use/create-pfx-certificate-profiles.md).

## <a name="trusted-ca-certificate"></a>Сертификат доверенного ЦС  

> [!IMPORTANT]  
> Перед созданием профиля сертификата SCEP настройте по крайней мере один профиль сертификата доверенного ЦС.
>
> После развертывания сертификата запрашивается новый сертификат, если вы измените следующие значения:
>
> - Поставщик хранилища ключей
> - Имя шаблона сертификата
> - Тип сертификата
> - Формат имени субъекта
> - Альтернативное имя субъекта
> - Срок действия сертификата
> - Использование ключа
> - Размер ключа
> - Расширенное использование ключа
> - Сертификат корневого ЦС

1. На странице **Сертификат доверенного ЦС** мастера создания профиля сертификата укажите перечисленные ниже сведения.  

    - **Файл сертификата**. Выберите **Импорт** и укажите файл сертификата.  

    - **Конечное хранилище**. На устройствах, имеющих более одного хранилища сертификатов, выберите место для хранения сертификата. На устройствах с одним хранилищем этот параметр игнорируется.  

2. Используйте значение параметра **Отпечаток сертификата**, чтобы проверить правильность импортированного сертификата.  

## <a name="scep-certificates"></a>Сертификаты SCEP

### <a name="1-scep-servers"></a>1. SCEP-серверы

На странице **Серверы SCEP** мастера создания профилей сертификатов укажите URL-адреса для серверов NDES, которые будут выдавать сертификаты через SCEP. Можно выбрать автоматическое присвоение URL-адреса NDES на основе конфигурации точки регистрации сертификатов либо добавить URL-адреса вручную.  

### <a name="2-scep-enrollment"></a>2. Регистрация SCEP

На странице **Регистрация SCEP** мастера создания профиля сертификата задайте сведения.

- **Повторы**. Укажите количество повторных попыток, автоматически предпринимаемых устройством для запроса сертификата с сервера NDES. Этот параметр поддерживает сценарий, в котором диспетчер ЦС должен утвердить запрос на сертификат, прежде чем он будет принят. Этот параметр обычно используется в средах с высоким уровнем безопасности или при наличии автономного выдающего ЦС вместо ЦС предприятия. Этот параметр также можно использовать для тестирования, чтобы проверить параметры запроса на сертификат перед тем как выдающий ЦС его обработает. Используйте этот параметр совместно с параметром **Пауза между попытками (в минутах)** .  

- **Интервал повторения (в минутах)** . Укажите интервал (в минутах) между попытками регистрации, если перед обработкой запроса на сертификат выдающим ЦС используется утверждение диспетчером ЦС. Если вы используете утверждение диспетчером для тестирования, укажите низкое значение. В этом случае вам не придется долго ждать, пока устройство повторит запрос сертификата после утверждения запроса.

    Если вы используете утверждение диспетчером в рабочей сети, укажите более высокое значение. Такое поведение даст администратору ЦС достаточно времени для утверждения или отклонения незавершенных утверждений.  

- **Порог обновления (%)** . Укажите процент времени существования сертификата, который остается, прежде чем устройство запросит его возобновление.  

- **Поставщик хранилища ключей (KSP)** . Укажите место, где хранится ключ для сертификата. Выберите одно из следующих значений:  

  - **Установить в доверенный платформенный модуль (TPM) при его наличии**. Устанавливает ключ в доверенном платформенном модуле. Если доверенный платформенный модуль отсутствует, ключ устанавливается в поставщик хранилища ключей программного обеспечения.  

  - **Установить в доверенный платформенный модуль (TPM), в противном случае выдать отказ**. Устанавливает ключ в доверенном платформенном модуле. Если доверенный платформенный модуль отсутствует, установка выполнена не будет.  

  - **Установить в Windows Hello для бизнеса, в ином случае — сбой**: этот параметр доступен для устройств с Windows 10. Он позволяет хранить сертификат в магазине Windows Hello для бизнеса, защищенном многофакторной проверкой подлинности. Дополнительные сведения см. в разделе [Windows Hello для бизнеса](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-identity-verification).

    > [!NOTE]  
    > Этот параметр не поддерживает вход со смарт-картой для расширенного использования ключа на странице свойств сертификата.

  - **Установить в поставщик хранилища ключей программного обеспечения**. Устанавливает ключ в поставщик хранилища ключей программного обеспечения.  

- **Устройства для регистрации сертификата**. Если профиль сертификата развертывается в коллекции пользователей, разрешите регистрацию сертификата только на основном устройстве пользователя или на любом устройстве, где пользователь выполнил вход.

    Если профиль сертификата развертывается в коллекции устройств, укажите, разрешить регистрацию сертификата только для основного пользователя устройства или для всех пользователей, которые выполнят вход на этом устройстве.  

### <a name="3-certificate-properties"></a>3. Свойства сертификата

На странице **Свойства сертификата** мастера создания профиля сертификата укажите перечисленные ниже сведения.  

- **Имя шаблона сертификата**. Выберите имя шаблона сертификата, настроенного в NDES и добавленного в выдающий ЦС. Для перехода к шаблонам сертификатов учетная запись пользователя должна иметь разрешение на **чтение** шаблона сертификата. Если вы не можете найти сертификат через **Обзор**, введите его имя.  

  > [!IMPORTANT]
  > Если имя шаблона сертификата содержит символы не из набора ASCII, этот сертификат не будет развернут. (Один из примеров таких символов —это буквы китайского алфавита.) Чтобы проверить, развернут ли сертификат, сначала создайте копию шаблона сертификата в ЦС. Затем переименуйте копию, используя символы ASCII.  

  - Если для выбора имени шаблона сертификата используется кнопка *Обзор*, некоторые поля на странице заполняются автоматически на основе шаблона сертификата. В некоторых случаях эти значения нельзя изменить, не выбрав другой шаблон сертификата.  

  - Если вы ввели *вручную* имя шаблона сертификата, убедитесь, что это имя полностью совпадает с именем в одном из шаблонов сертификатов. Оно должно совпадать с одним из имен, перечисленных в реестре сервера NDES. Убедитесь, что вы ввели имя шаблона сертификата, а не отображаемое имя шаблона сертификата.  

    Чтобы найти имена шаблонов сертификатов, перейдите к следующему разделу реестра: `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Cryptography\MSCEP`. Вы увидите список шаблонов сертификатов в виде значений для параметров **EncryptionTemplate**, **GeneralPurposeTemplate** и **SignatureTemplate**. По умолчанию для всех трех шаблонов сертификатов используется значение **IPSECIntermediateOffline**, которое соответствует отображаемому имени шаблона **IPSec (автономный запрос)** .  

    > [!WARNING]  
    > Если вы вводите имя шаблона сертификата вручную, Configuration Manager не может проверить содержимое этого шаблона. Вы можете выбрать параметры, которые не поддерживаются шаблоном сертификата, и тогда запрос сертификата выполнен не будет. В этом случае вы увидите сообщение об ошибке для w3wp.exe в файле CPR.log, в котором говорится о том, что имя шаблона в запросе подписи сертификата не соответствует запросу.  
    >
    > При вводе имени шаблона сертификата, которое указано в значении для ключа **GeneralPurposeTemplate**, необходимо выбрать параметры **Шифрование ключей** и **Цифровая подпись** для этого профиля сертификата. Если необходимо включить в этот профиль сертификата только параметр **Шифрование ключей**, укажите имя шаблона сертификата для ключа **EncryptionTemplate**. Аналогично, если вы хотите включить в этот профиль сертификата только параметр **Цифровая подпись** , укажите имя шаблона сертификата для ключа **SignatureTemplate** .  

- **Тип сертификата**. Укажите тип развертывания сертификата — для устройства или для пользователя.  

- **Формат имени субъекта**. Выберите, как Configuration Manager будет автоматически создавать имя субъекта в запросе на сертификат. Если сертификат предназначен для пользователя, в имя субъекта можно также включить адрес электронной почты пользователя.

    > [!NOTE]  
    > Выбор **номера IMEI** или **серийного номера** позволяет различать устройства, принадлежащие одному пользователю. Например, устройства могут иметь одинаковое имя, но номера IMEI или серийные номера будут разными. Если устройство не сообщает свой номер IMEI или серийный номер, сертификат будет выпущен с общим именем.

- **Альтернативное имя субъекта**. Укажите способ, которым Configuration Manager автоматически создает значения для альтернативного имени субъекта в запросе на сертификат. Например, если вы выбрали тип сертификата пользователя, в альтернативное имя субъекта можно включить имя участника-пользователя. Если сертификат клиента будет использоваться для проверки подлинности сервера политики сети, в качестве альтернативного имени субъекта необходимо задать имя участника-пользователя.  

- **Срок действия сертификата**. Если вы установили собственный срок действия на выдающем ЦС, укажите оставшееся время до истечения срока действия сертификата.

    > [!TIP]
    > Для указания собственного срока действия используйте следующую командную строку: `certutil -setreg Policy\EditFlags +EDITF_ATTRIBUTEENDDATE`
    > Дополнительные сведения об этой команде см. в разделе [Инфраструктура сертификатов](certificate-infrastructure.md).  

    Можно указать значение ниже, но не выше периода действия в указанном шаблоне сертификата. Например, если в шаблоне сертификата указан срок действия сертификата два года, можно указать значение в один год, но не в пять лет. Кроме того, значение не должно превышать значение оставшегося периода действия сертификата, выдаваемого центром сертификации.  

- **Использование ключа**. Укажите параметры использования ключа для сертификата. Выберите один из следующих параметров.  

  - **Шифрование ключа**. Обмен ключами разрешается, только если они зашифрованы.  

  - **Цифровая подпись**. Обмен ключами разрешается, только если они защищены с помощью цифровой подписи.  

  Если для выбора шаблона сертификата использовалась кнопка "Обзор", вы не сможете изменить эти параметры, не выбрав другой шаблон сертификата.  

  Настройте выбранный шаблон сертификата с использованием одного или обоих параметров использования ключа, описанных выше. Если это не так, в файле журнала точки регистрации сертификатов, **Crp.log**, появится сообщение: **Key usage in CSR and challenge do not match** (Использование ключа в CSR и запросе не совпадает).  

- **Размер ключа (разрядов)** . Выберите размер ключа в битах.  

- **Расширенное использование ключа**. Добавьте значения для назначения сертификата. В большинстве случаев для сертификата требуется **Проверка подлинности клиента**, чтобы пользователь или устройство могли выполнить проверку подлинности на сервере. При необходимости можно добавить любые другие варианты использования ключа.  

- **Хэш-алгоритм**. Используйте с этим сертификатом один из доступных типов хэш-алгоритмов. Выберите максимальный уровень безопасности, который поддерживают подключающиеся устройства.  

  > [!NOTE]  
  > **SHA-2** поддерживает SHA-256, SHA-384 и SHA-512. **SHA-3** поддерживает только SHA-3.  

- **Сертификат корневого ЦС**. Выберите профиль сертификата корневого ЦС, ранее настроенный и развернутый для пользователя или устройства. Этот сертификат ЦС должен быть корневым сертификатом ЦС, который выдаст сертификат, настраиваемый в данном профиле сертификата.  

  > [!IMPORTANT]  
  > Если указать сертификат корневого ЦС, который не развернут для пользователя или устройства, Configuration Manager не инициирует запрос на сертификат, настраиваемый в данном профиле сертификата.  

## <a name="supported-platforms"></a>Поддерживаемые платформы  

На странице **Поддерживаемые платформы** мастера создания профиля сертификата выберите версии операционных систем, в которых необходимо установить профиль сертификата. Щелкните **Выбрать все**, чтобы установить профиль сертификата во все доступные операционные системы.

## <a name="next-steps"></a>Дальнейшие шаги

Новый профиль сертификата появится в узле **Профили сертификатов** рабочей области **Активы и соответствие**. Он готов к развертыванию для пользователей или устройств. Дополнительные сведения см. в разделе [Развертывание профилей](deploy-wifi-vpn-email-cert-profiles.md).
